<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Comprehensive Knowledge of C++(V18.02)</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

    body {
        margin: 0 auto;
        max-width: none;
        width: 1000px;
        padding-left: 50px;
        padding-right: 50px;
        padding-top: 50px;
        padding-bottom: 50px;
        hyphens: auto;
        overflow-wrap: break-word;
        text-rendering: optimizeLegibility;
        font-kerning: normal;
    }

    table {
        border-collapse: collapse;
    }

    table, th, td {
        border: 2px solid black;
    }

    header {
        margin-bottom: 4em;
        text-align: center;
        color: white;
        background-color: lightblue;
    }

    h1:not(:first-of-type) {
        page-break-before: always;
    }

  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Comprehensive Knowledge of C++(V18.02)</h1>
<p class="author">autor:ichiroprogrammer</p>
</header>
<!-- ./md/programming_convention.md -->
<h1 id="プログラミング規約">3 プログラミング規約 <a id="SS_3"></a></h1>
<p>組織に秩序を与える法、道徳、慣習等をここではルールと呼ぶことにする。
当然ながら、秩序ある組織には良いルールがあり、混沌とした組織には悪いルールがあるか、
ルールはあっても守られていないか、そもそもルールが存在しない。</p>
<p>秩序あるソースコードとは、</p>
<ul>
<li>可読性が高い。
<ul>
<li>簡潔に記述されている。</li>
<li>記述スタイルが統一されている(「<a
href="coding_style.html#SS_5">コーディングスタイル</a>」参照)。</li>
<li>ファイルや識別子の名前に規則性があり、適切に命名されている (「<a
href="software_practice.html#SS_2_5">Name and Conquer</a>」、「<a
href="naming_practice.html#SS_6">命名規則</a>」参照)。</li>
<li>コメントの記法が統一されており、内容が適切である(「<a
href="comment.html#SS_7">コメント</a>」参照)。</li>
</ul></li>
<li>保守、テスト、移植等が容易である。</li>
<li>型安全性が配慮されている。</li>
<li>コンパイル警告レベルが高く、かつ指摘がない(「<a
href="code_analysis.html#SS_4_1_1">g++の警告機能</a>」参照)。</li>
</ul>
<p>のような特性を満たすものであるが、そうあるためには秩序ある組織と同様に良いルールが必要である。
本章の目的は、C++プログラミングにおけるそのようなルール(=プログラミング規約)を示すことである。</p>
<p>なお、型安全性とは、「正しく型付けされたソースコードは未定義動作をしない」
ことが保証されるという言語の特性である。
配列のオーバランが未定義動作を引き起こすことを考えれば明らかである通り、
C++は型安全性を保証しない。このことは、C++の劣等性を意味しないが、
それに配慮したプログラミング(型システムの最大限の利用等)が必要となることは事実である。</p>
<h2 id="型とインスタンス">3.1 型とインスタンス <a id="SS_3_1"></a></h2>
<h3 id="算術型">3.1.1 算術型 <a id="SS_3_1_1"></a></h3>
<h4 id="整数型">3.1.1.1 整数型 <a id="SS_3_1_1_1"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_1_3">整数型</a>には、整数の基本型(intやlong等)を直接使わずに、
<a href="https://cpprefjp.github.io/reference/cstdint.html">cstdint</a>
で定義されている型エイリアスを使用する。
<ul>
<li>STLやPOSIX等の標準クラスや関数のインターフェースが基本型を直接使用している場合は、
その型に合わせるために基本型を直接使用する。</li>
</ul></li>
<li>整数型には、特に理由がない限りに、int32_tを使用する。</li>
<li>整数型の変数が負にならないのであれば、uint32_tを使用する。
<ul>
<li>符号あり型との演算がある場合は、その変数が負にならなくともint32_tを使用する。</li>
<li>符号あり型と符号なし型との比較をしない。</li>
</ul></li>
<li>sizeofの値や配列の長さの保持等には、size_tを使用する。</li>
<li>int32_tからint16_tや、int32_tからuint32_t等の値が変わる可能性がある代入を避ける。
やむを得ずそのような代入をする場合、下記のようなnarrow_castを使いこのような問題を緩和する。</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 9</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> DST<span class="op">,</span> <span class="kw">typename</span> SRC<span class="op">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    DST narrow_cast<span class="op">(</span>SRC v<span class="op">)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_integral_v<span class="op">&lt;</span>DST<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="bu">std::</span>is_integral_v<span class="op">&lt;</span>DST<span class="op">&gt;,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;DST, SRC shoud be integral-type.&quot;</span><span class="op">);</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> r <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span>DST<span class="op">&gt;(</span>v<span class="op">);</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">((</span>r <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span>v <span class="op">&lt;</span> <span class="dv">0</span><span class="op">));</span>        <span class="co">// 符号が変わっていないことの確認</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">(</span><span class="kw">static_cast</span><span class="op">&lt;</span>SRC<span class="op">&gt;(</span>r<span class="op">)</span> <span class="op">==</span> v<span class="op">);</span>  <span class="co">// bit落ちしていないことの確認</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 28</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> ui32 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;(</span><span class="dv">128</span><span class="op">);</span>                <span class="co">// 安全なint32_t -&gt; uint32_t</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>ui32<span class="op">,</span> <span class="dv">128</span><span class="op">);</span>                                  <span class="co">//</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    ASSERT_DEATH<span class="op">(</span>ui32 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;(-</span><span class="dv">128</span><span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">);</span>  <span class="co">// 危険なint32_t -&gt; uint32_t</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> i8 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">int8_t</span><span class="op">&gt;(</span><span class="dv">127</span><span class="op">);</span>                    <span class="co">// 安全なint32_t -&gt; int8_t</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>i8<span class="op">,</span> <span class="dv">127</span><span class="op">);</span>                                    <span class="co">//</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    ASSERT_DEATH<span class="op">(</span>i8 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">int8_t</span><span class="op">&gt;(</span><span class="dv">128</span><span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">);</span>       <span class="co">// 危険なint32_t -&gt; int8_t</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    i8 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">int8_t</span><span class="op">&gt;(-</span><span class="dv">1</span><span class="op">);</span>                          <span class="co">// 安全なint32_t -&gt; int8_t</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>i8<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span>                                     <span class="co">//</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    ASSERT_DEATH<span class="op">(</span>i8 <span class="op">=</span> narrow_cast<span class="op">&lt;</span><span class="dt">int8_t</span><span class="op">&gt;(-</span><span class="dv">129</span><span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">);</span>      <span class="co">// 危険なint32_t -&gt; int8_t</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_1">演習-汎整数型の選択</a></li>
</ul>
<h4 id="char型">3.1.1.2 char型 <a id="SS_3_1_1_2"></a></h4>
<ul>
<li>charはascii文字の保持のみに使用する。</li>
<li>char*をvoid*の代わりに使わない。</li>
<li>charがsingedかunsignedかは処理系に依存するため、char型を<a
href="term_explanation.html#SS_18_1_2">汎整数型</a>として扱わない。
8ビット整数には、int8_tまたは、uint8_tを使用する。
<ul>
<li>バイトストリームを表現する場合、int8_t*、int8_t[]、uint8_t*、uint8_t[]のいずれかを使う。</li>
</ul></li>
<li><a href="exercise_q.html#SS_19_1_2">演習-汎整数型の演算</a></li>
</ul>
<h4 id="stdbyte型">3.1.1.3 std::byte型 <a id="SS_3_1_1_3"></a></h4>
<ul>
<li>intよりもビット幅の小さい組み込み型の演算の結果は<a
href="term_explanation.html#SS_18_1_5">汎整数拡張</a>によりint型になるため、
uint8_tのビット演算の型もintとなる。
intへの拡張が意図したものかどうかの判別は困難であるため、
uint8_tインスタンスにビット演算が必要な場合、
uint8_tの代わりに下記のようにstd::byte(「<a
href="design_pattern.html#SS_9_2">BitmaskType</a>」参照)を用いる。</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 50</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uint8_tのビット演算例</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> u    <span class="op">=</span> <span class="dt">uint8_t</span><span class="op">{</span><span class="bn">0b1000&#39;0001</span><span class="op">};</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> ret0 <span class="op">=</span> u <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uint8_t ret1{u &lt;&lt; 1};  // 縮小型変換のため、コンパイルエラー</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> ret1 <span class="op">=</span> u <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>ret0<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span>  <span class="co">// u &lt;&lt; 1はintになる</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="bn">0b1&#39;0000&#39;0010</span><span class="op">,</span> ret0<span class="op">);</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="bn">0b0000&#39;0010</span><span class="op">,</span> ret1<span class="op">);</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 64</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uint8_tに代わりstd::byteを使用したビット演算例</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b    <span class="op">=</span> <span class="bu">std::</span>byte<span class="op">{</span><span class="bn">0b1000&#39;0001</span><span class="op">};</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> ret0 <span class="op">=</span> b <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> ret1 <span class="op">=</span> <span class="bu">std::</span>byte<span class="op">{</span>b <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">};</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>ret0<span class="op">),</span> <span class="bu">std::</span>byte<span class="op">&gt;);</span>  <span class="co">// b &lt;&lt; 1はstd::byteになる</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="bu">std::</span>byte<span class="op">{</span><span class="bn">0b0000&#39;0010</span><span class="op">},</span> ret0<span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="bu">std::</span>byte<span class="op">{</span><span class="bn">0b0000&#39;0010</span><span class="op">},</span> ret1<span class="op">);</span></span></code></pre></div>
<ul>
<li>std::byteの初期化には{}を用いる(static_castを使用しない)。</li>
</ul>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 77</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>byte<span class="op"> </span>b0<span class="op">{</span><span class="bn">0b1000&#39;0001</span><span class="op">};</span>                           <span class="co">// OK</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>      b1 <span class="op">=</span> <span class="bu">std::</span>byte<span class="op">{</span><span class="bn">0b1000&#39;0001</span><span class="op">};</span>               <span class="co">// OK</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>byte<span class="op"> </span>b2 <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span><span class="bu">std::</span>byte<span class="op">&gt;(</span><span class="bn">0b1000&#39;0001</span><span class="op">);</span>  <span class="co">// NG</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::byte b3 = 0b1000&#39;0001;                       // NG コンパイルエラー</span></span></code></pre></div>
<h4 id="bool型">3.1.1.4 bool型 <a id="SS_3_1_1_4"></a></h4>
<ul>
<li>bool型は、bool型リテラル(true/false)やbool型オブジェクトの保持のみに使用する。</li>
<li>bool型を<a
href="term_explanation.html#SS_18_1_2">汎整数型</a>として扱わない。bool型に++を使用しない(–はコンパイルできない)。</li>
</ul>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 95</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if </span><span class="ot">__cplusplus</span><span class="pp"> &lt; 201703L  </span><span class="co">// 以下のコードはC++14以前ではコンパイルできるが、</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                               <span class="co">// C++17以降ではコンパイルエラー</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> b <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">++</span>b<span class="op">);</span>  <span class="co">// NG 予想通り動作するが、boolの目的外使用</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">++</span>b<span class="op">);</span>  <span class="co">// NG bは2ではなく1</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ASSERT_EQ(1, --b);  // NG コンパイルエラー</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span></code></pre></div>
<ul>
<li>ポインタ型やboolを除く汎整数型のインスタンスをbool値として使用しない。</li>
</ul>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 111</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> g<span class="op">(</span><span class="dt">int32_t</span><span class="op">*</span> ptr0<span class="op">,</span> <span class="dt">int32_t</span><span class="op">*</span> ptr1<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ptr0<span class="op">)</span> <span class="op">{</span>  <span class="co">// NG ポインタ型をbool値として使用</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ptr1 <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h4 id="浮動小数点型">3.1.1.5 浮動小数点型 <a id="SS_3_1_1_5"></a></h4>
<ul>
<li>floatやdoubleのダイナミックレンジが必要な場合のみに、これらの型を使用する。
ちなみに銀河系の直径は1e+21メートル程度、プランク長は1.616229e-35メートルであるため、
銀河から素粒子までのサイズを一つの基本型で表す場合においても、
floatのダイナミックレンジに収まる。
従って、floatやdoubleが必要になる場合は極めて限られる。</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">正の最小値</th>
<th style="text-align: center;">正の最大値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">floatの範囲</td>
<td style="text-align: center;">1.175494351 e-38</td>
<td style="text-align: center;">3.402823466 e+38</td>
</tr>
<tr class="even">
<td style="text-align: left;">doubleの範囲</td>
<td style="text-align: center;">2.2250738585072014 e-308</td>
<td style="text-align: center;">1.7976931348623158 e+308</td>
</tr>
<tr class="odd">
<td style="text-align: left;">uint32_tの範囲</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4.294967295 e+9</td>
</tr>
<tr class="even">
<td style="text-align: left;">uint64_tの範囲</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1.8446744073709551615 e+19</td>
</tr>
</tbody>
</table>
<ul>
<li>演算順序等により誤差が生じることがあるため、floatやdoubleのインスタンスを、
==、!=、&gt;、&lt;等で比較しない。</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 11</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記の0.01は2進数では循環小数となるため、実数の0.01とは異なる。</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> a <span class="op">=</span> <span class="fl">0.01</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000001010001111...</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> b <span class="op">=</span> <span class="fl">0.04</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000101000111101...</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  ASSERT_EQ(0.05F, a + b);  // NG  a + b == 0.05Fは一般には成立しない。</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_NE<span class="op">(</span><span class="fl">0.05</span><span class="bu">F</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 22</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@fn</span><span class="co"> </span><span class="do">bool</span><span class="co"> </span><span class="do">is_equal_f(float</span><span class="co"> </span><span class="do">lhs,</span><span class="co"> </span><span class="do">float</span><span class="co"> </span><span class="do">rhs)</span><span class="co"> </span><span class="do">noexcept</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@brief</span><span class="co"> float比較用関数</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_equal_f<span class="op">(</span><span class="dt">float</span> lhs<span class="op">,</span> <span class="dt">float</span> rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>abs<span class="op">(</span>lhs <span class="op">-</span> rhs<span class="op">)</span> <span class="op">&lt;=</span> <span class="bu">std::</span>numeric_limits<span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;::</span>epsilon<span class="op">();</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 34</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記の0.01は2進数では循環小数となるため、実数の0.01とは異なる。</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> a <span class="op">=</span> <span class="fl">0.01</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000001010001111...</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> b <span class="op">=</span> <span class="fl">0.04</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000101000111101...</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// floatの比較はis_equal_fのような関数を使う。</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>is_equal_f<span class="op">(</span><span class="fl">0.05</span><span class="bu">F</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">));</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>一つの式にfloatとdoubleを混在させない。</li>
</ul>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 46</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 上記例と似たソースコードであるが、下記のような問題が起こる</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@fn</span><span class="co"> </span><span class="do">bool</span><span class="co"> </span><span class="do">is_equal_d(double</span><span class="co"> </span><span class="do">lhs,</span><span class="co"> </span><span class="do">double</span><span class="co"> </span><span class="do">rhs)</span><span class="co"> </span><span class="do">noexcept</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@brief</span><span class="co"> double比較用関数</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_equal_d<span class="op">(</span><span class="dt">double</span> lhs<span class="op">,</span> <span class="dt">double</span> rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>abs<span class="op">(</span>lhs <span class="op">-</span> rhs<span class="op">)</span> <span class="op">&lt;=</span> <span class="bu">std::</span>numeric_limits<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;::</span>epsilon<span class="op">();</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 59</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記の0.01は2進数では循環小数となるため、実数の0.01とは異なる。</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> a <span class="op">=</span> <span class="fl">0.01</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000001010001111...</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> b <span class="op">=</span> <span class="fl">0.04</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000101000111101...</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a + bはfloatの精度のまま、is_equal_dの引数の型であるdoubleに昇格される。</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 一方、0.05はdoubleであるため(循環小数をdoubleの精度で切り捨てた値であるため)、</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a + b(floatの精度の値)と0.05の差はdoubleのepsilonを超える。</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  ASSERT_TRUE(is_equal_d(0.05, a + b));  // NG</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>is_equal_d<span class="op">(</span><span class="fl">0.05</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">));</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 73</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// is_equal_dを改良して、引数の型が統一されていない呼び出しをコンパイルエラーにできるようにした。</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@fn</span><span class="co"> </span><span class="do">bool</span><span class="co"> </span><span class="do">is_equal(FLOAT_0</span><span class="co"> </span><span class="do">lhs,</span><span class="co"> </span><span class="do">FLOAT_1</span><span class="co"> </span><span class="do">rhs)</span><span class="co"> </span><span class="do">noexcept</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@brief</span><span class="co"> 浮動小数点比較用関数</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> FLOAT_0<span class="op">,</span> <span class="kw">typename</span> FLOAT_1<span class="op">&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_equal<span class="op">(</span>FLOAT_0 lhs<span class="op">,</span> FLOAT_1 rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_floating_point_v<span class="op">&lt;</span>FLOAT_0<span class="op">&gt;,</span> <span class="st">&quot;FLOAT_0 shoud be float or double.&quot;</span><span class="op">);</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span>FLOAT_0<span class="op">,</span> FLOAT_1<span class="op">&gt;,</span> <span class="st">&quot;FLOAT_0 and FLOAT_1 shoud be a same type.&quot;</span><span class="op">);</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>abs<span class="op">(</span>lhs <span class="op">-</span> rhs<span class="op">)</span> <span class="op">&lt;=</span> <span class="bu">std::</span>numeric_limits<span class="op">&lt;</span>FLOAT_0<span class="op">&gt;::</span>epsilon<span class="op">();</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 90</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記の0.01は2進数では循環小数となるため、実数の0.01とは異なる。</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> a <span class="op">=</span> <span class="fl">0.01</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000001010001111...</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> b <span class="op">=</span> <span class="fl">0.04</span><span class="bu">F</span><span class="op">;</span>  <span class="co">// 0.0000101000111101...</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a + bはfloatであり、0.05はdoubleであるため、下記コードはコンパイルできない。</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ASSERT_TRUE(is_equal(0.05, a + b));</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>is_equal<span class="op">(</span><span class="fl">0.05</span><span class="bu">F</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">));</span>  <span class="co">// OK リテラルに型を指定して、引数の型を統一</span></span></code></pre></div>
<ul>
<li>INFや、NANを演算で使用しない。</li>
<li><a
href="term_explanation.html#SS_18_1_2">汎整数型</a>の演算とは違い、0除算等の浮動小数点演算のエラーは、
通常、プログラム終了シグナルを発生させないため、
浮動小数点演算のエラーを捕捉する必要がある場合(ほとんどの場合、そうなる)は、
std::fetestexcept()、std::isnan()、std::isinf()等を使用してエラーを捕捉する。</li>
</ul>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 102</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span>   global_zero<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> div<span class="op">(</span><span class="dt">float</span> a<span class="op">,</span> <span class="dt">float</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/float_ut.cpp 110</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>feclearexcept<span class="op">(</span>FE_ALL_EXCEPT<span class="op">);</span>  <span class="co">// エラーをクリア</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    div<span class="op">(</span><span class="fl">1.0</span><span class="bu">F</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">F</span><span class="op">);</span>  <span class="co">// 関数の中で0除算するが、終了シグナルは発生しない</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span><span class="bu">std::</span>fetestexcept<span class="op">(</span>FE_ALL_EXCEPT<span class="op">)</span> <span class="op">&amp;</span> FE_DIVBYZERO<span class="op">);</span>  <span class="co">// 0除算</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>feclearexcept<span class="op">(</span>FE_ALL_EXCEPT<span class="op">);</span>  <span class="co">// エラーをクリア</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    div<span class="op">(</span><span class="bu">std::</span>numeric_limits<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;::</span>max<span class="op">(),</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> excepts <span class="op">=</span> <span class="bu">std::</span>fetestexcept<span class="op">(</span>FE_ALL_EXCEPT<span class="op">);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>excepts <span class="op">&amp;</span> FE_DIVBYZERO<span class="op">);</span>  <span class="co">// 0除算</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>excepts <span class="op">&amp;</span> FE_INEXACT<span class="op">);</span>     <span class="co">// 演算が不正確</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>excepts <span class="op">&amp;</span> FE_INVALID<span class="op">);</span>    <span class="co">// 不正な操作</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>excepts <span class="op">&amp;</span> FE_OVERFLOW<span class="op">);</span>    <span class="co">// 演算がオーバーフローを起こした</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>excepts <span class="op">&amp;</span> FE_UNDERFLOW<span class="op">);</span>  <span class="co">// 演算がアンダーフローを起こした</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>feclearexcept<span class="op">(</span>FE_ALL_EXCEPT<span class="op">);</span>  <span class="co">// エラーをクリア</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> a <span class="op">=</span> <span class="fl">1.0</span><span class="bu">F</span> <span class="op">/</span> global_zero<span class="op">;</span>  <span class="co">// global_zero == 0</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span><span class="bu">std::</span>isinf<span class="op">(</span>a<span class="op">));</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> b <span class="op">=</span> <span class="bu">std::</span>sqrt<span class="op">(-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> c <span class="op">=</span> <span class="bu">std::</span>sqrt<span class="op">(-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span><span class="bu">std::</span>isnan<span class="op">(</span>b<span class="op">));</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>b <span class="op">==</span> c<span class="op">);</span>  <span class="co">// NaN == NaNは常にfalse</span></span></code></pre></div>
<ul>
<li>できる限り浮動小数点の代わりに固定小数点を使用する
(全ソースコードは「“<a
href="sample_code.html#SS_23_2_37">example/programming_convention/fixed_point.h</a>”」に掲載)。</li>
</ul>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/fixed_point.h 6</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@class</span><span class="co"> </span><span class="cv">FixedPoint</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@brief</span><span class="co"> BASIC_TYPEで指定する基本型のビット長を持つ固定小数点を扱うためのクラス</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@tparam</span><span class="co"> </span><span class="cv">BASIC_TYPE</span><span class="co">       全体のビット長や、符号を指定するための整数型</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@tparam</span><span class="co"> </span><span class="cv">FRACTION_BIT_NUM</span><span class="co"> 小数点保持のためのビット長</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> BASIC_TYPE<span class="op">,</span> <span class="dt">uint32_t</span> FRACTION_BIT_NUM<span class="op">&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> FixedPoint <span class="op">{</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        FixedPoint<span class="op">(</span>BASIC_TYPE                                integer  <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">typename</span> <span class="bu">std::</span>make_unsigned_t<span class="op">&lt;</span>BASIC_TYPE<span class="op">&gt;</span> fraction <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">value_</span><span class="op">{</span>get_init_value<span class="op">(</span>integer<span class="op">,</span> fraction<span class="op">)}</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        FixedPoint<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">+=(</span>FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        FixedPoint<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">-=(</span>FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        FixedPoint<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">*=(</span>FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        FixedPoint<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">/=(</span>FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        BASIC_TYPE <span class="va">value_</span><span class="op">;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>FixedPoint lhs<span class="op">,</span> FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// FixedPoint() + intのようなオーバーロードを作るためにあえてfriend</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> FixedPoint <span class="kw">operator</span><span class="op">+(</span>FixedPoint lhs<span class="op">,</span> FixedPoint rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/fixed_point_ut.cpp 19</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 以下は、FixedPoint&lt;&gt;の使用例である。</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> FP4 <span class="op">=</span> FixedPoint<span class="op">&lt;</span><span class="dt">uint8_t</span><span class="op">,</span> <span class="dv">4</span><span class="op">&gt;;</span>  <span class="co">// 基本型uint8_t、小数点4ビット</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> fp0  <span class="op">=</span> FP4<span class="op">{};</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>    ASSERT_EQ<span class="op">(</span><span class="dv">7</span><span class="op">,</span> fp0<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>    ASSERT_NE<span class="op">(</span><span class="dv">6</span><span class="op">,</span> fp0<span class="op">);</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">+=</span> <span class="dv">2</span><span class="op">;</span>   ASSERT_EQ<span class="op">(</span>FP4<span class="op">{</span><span class="dv">9</span><span class="op">},</span> fp0<span class="op">);</span>         </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                    ASSERT_TRUE<span class="op">(</span>is_equal<span class="op">(</span><span class="fl">9.0</span><span class="op">,</span> fp0<span class="op">.</span>ToFloatPoint<span class="op">()));</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">/=</span> <span class="dv">2</span><span class="op">;</span>   ASSERT_EQ<span class="op">((</span>FP4<span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="dv">8</span><span class="op">}),</span> fp0<span class="op">);</span>    </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                    ASSERT_TRUE<span class="op">(</span>is_equal<span class="op">(</span><span class="fl">4.5</span><span class="op">,</span> fp0<span class="op">.</span>ToFloatPoint<span class="op">()));</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">/=</span> <span class="dv">2</span><span class="op">;</span>   ASSERT_EQ<span class="op">((</span>FP4<span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">}),</span> fp0<span class="op">);</span>    </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                    ASSERT_TRUE<span class="op">(</span>is_equal<span class="op">(</span><span class="fl">2.25</span><span class="op">,</span> fp0<span class="op">.</span>ToFloatPoint<span class="op">()));</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">*=</span> <span class="dv">4</span><span class="op">;</span>   ASSERT_EQ<span class="op">(</span>FP4<span class="op">{</span><span class="dv">9</span><span class="op">},</span> fp0<span class="op">);</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">+=</span> <span class="dv">7</span><span class="op">;</span>   ASSERT_EQ<span class="op">(</span>FP4<span class="op">{</span><span class="dv">0</span><span class="op">},</span> fp0<span class="op">);</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> FP8 <span class="op">=</span> FixedPoint<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">,</span> <span class="dv">8</span><span class="op">&gt;;</span>  <span class="co">// 基本型int32_t、小数点8ビット</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> fp0 <span class="op">=</span> FP8<span class="op">{};</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">=</span> <span class="dv">3</span><span class="op">;</span>            ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">0</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span>           ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">6</span><span class="op">,</span> <span class="dv">0</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">-=</span> <span class="dv">3</span><span class="op">;</span>           ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">0</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">*=</span> <span class="dv">5</span><span class="op">;</span>           ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">15</span><span class="op">,</span> <span class="dv">0</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">/=</span> <span class="dv">5</span><span class="op">;</span>           ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">0</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        fp0 <span class="op">=</span> fp0 <span class="op">/</span> <span class="dv">2</span><span class="op">;</span>      ASSERT_EQ<span class="op">((</span>FP8<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">}),</span> fp0<span class="op">);</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_3">演習-浮動小数点型</a></li>
</ul>
<h3 id="enum">3.1.2 enum <a id="SS_3_1_2"></a></h3>
<ul>
<li>C++の強力な型システムや、コンパイラの静的解析機能(switchでのcase抜け)を効果的に使用するために、
一連の定数の列挙にはenumを使用する。</li>
<li>使用範囲や方法が明示しづらく、且つ整数型への<a
href="term_explanation.html#SS_18_1_4">算術変換</a>が行われてしまう旧来のenum
(非スコープドenum)は、一部の例外を除き定義しない。
代わりに、より型安全なスコープドenumを使用する。</li>
</ul>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 133</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> CarLight <span class="op">{</span> CL_Red<span class="op">,</span> CL_Yellow<span class="op">,</span> CL_Blue <span class="op">};</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> WalkerLight <span class="op">{</span> WL_Red<span class="op">,</span> WL_Yellow<span class="op">,</span> WL_Blue <span class="op">};</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> f<span class="op">(</span>CarLight cl<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>cl<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 非スコープドenumは下記のようなコードを許容する(if文でも同様)。</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// スコープドenumであればこのような間違いはコンパイルエラーで発見できる。</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> WL_Red<span class="op">:</span>  <span class="co">// CL_Regの間違い?</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> CL_Yellow<span class="op">:</span>  <span class="co">// これは正しい</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> CL_Blue<span class="op">:</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>列挙子に値を設定する必要がない場合（具体的な値に意味を持たない場合）には、値を設定しない。
値を設定する場合にはそれらを最初に書き、同じ値を設定しない。</li>
</ul>
<div class="sourceCode" id="cb20"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 163</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Colour <span class="op">{</span>   <span class="co">// NG スコープドになっていない。</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        Red   <span class="op">=</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// NG 配列インデックスでない場合、0を定義する必要はない。</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        Green <span class="op">=</span> <span class="dv">1</span><span class="op">,</span>  <span class="co">// NG 連続値を定義する必要はない。</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        Blue  <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> Colour <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        Red<span class="op">,</span>             <span class="co">// OK 不要な記述がない。</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        Green<span class="op">,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        Blue</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>enumを配列のインデックスとして使う場合は以下のようにする。
<ul>
<li>スコープドenumの代わりに、旧来のenumをstruct内で定義する。</li>
<li>最初に定義されるenumメンバは0で初期化する。</li>
<li>最後の要素のシンボル名はMaxで終わることにより、
その要素が最大値であることを示す。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb21"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 185</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> Foo <span class="op">{</span> FooA <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> FooB<span class="op">,</span> FooMAX <span class="op">};</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Hoo  <span class="co">// structによるスコーピング</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            HooA <span class="op">=</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// OK</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            HooB<span class="op">,</span>      <span class="co">// OK 値は暗黙に定義</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            HooMAX     <span class="co">// OK</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  int32_t a0[Foo::FooMAX];                       // NG コンパイルエラー</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> a1<span class="op">[</span><span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">size_t</span><span class="op">&gt;(</span>Foo<span class="op">::</span>FooMAX<span class="op">)];</span>  <span class="co">// NG castが必要になる</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> a2<span class="op">[</span>Hoo<span class="op">::</span>HooMAX<span class="op">];</span>                       <span class="co">// OK</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>enumはC++11から前方宣言できるようになったため、
この機能を使用して、不要なヘッダファイルの依存関係を作らないようにする。</li>
</ul>
<div class="sourceCode" id="cb22"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 211</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> IncompleteEnum<span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> IncompleteEnum2 <span class="op">:</span> <span class="dt">uint64_t</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このファイルから可視である範囲にIncompleteEnum、IncompleteEnum2の定義はないが、</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 前方宣言することで以下の関数宣言をすることができる。</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">void</span> g<span class="op">(</span>IncompleteEnum<span class="op">);</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">void</span> g<span class="op">(</span>IncompleteEnum2<span class="op">);</span></span></code></pre></div>
<ul>
<li><p>アプリケーションの設定ファイルに保存された情報を復元させるような場合や、
「<a
href="design_pattern.html#SS_9_2">BitmaskType</a>」を使用する場合を除き、enumへのキャストをしない。</p></li>
<li><p>クラスのstatic constの整数定数の代わりにenumを使うことは、
C++言語仕様やコンパイラの機能が不十分だった頃のテクニックであり、もはや不要である。
代わりにstatic constexprインスタンス(「<a
href="term_explanation.html#SS_18_1_15">constexprインスタンスと関数</a>」参照)を使用する。
こうすることで定数の型を明示できる。</p></li>
<li><p><a href="exercise_q.html#SS_19_1_4">演習-定数列挙</a></p></li>
<li><p><a href="exercise_q.html#SS_19_1_5">演習-enum</a></p></li>
</ul>
<h3 id="bit-field">3.1.3 bit field <a id="SS_3_1_3"></a></h3>
<ul>
<li>ハードウエアレジスタにアクセスをする目的でのみ使用する。</li>
<li>bit fieldの型は、unsigned intにする。</li>
</ul>
<h3 id="class">3.1.4 class <a id="SS_3_1_4"></a></h3>
<ul>
<li>「<a
href="programming_convention.html#SS_3_2">クラスとインスタンス</a>」を参照せよ。</li>
</ul>
<h3 id="struct">3.1.5 struct <a id="SS_3_1_5"></a></h3>
<ul>
<li>メンバ変数を持つ構造体は、<a
href="term_explanation.html#SS_18_1_6">POD</a>としてのみ使用する。</li>
<li>メンバ変数を持つ構造体を基底クラスとした継承をしない。
従ってそのような構造体は常にfinalであるが、finalの明示はしない。</li>
<li>メンバ変数(static constやstatic
constexprメンバは定数とする)を持たない構造体は、
templateや非スコープドenumのスコーピング(「<a
href="programming_convention.html#SS_3_1_2">enum</a>」参照)等に使用しても良い。</li>
<li>コンストラクタ以外のメンバ関数を定義しない。
<ul>
<li><a href="term_explanation.html#SS_18_3_2">ディープコピー</a>(「<a
href="programming_convention.html#SS_3_3_2_2">コンストラクタ</a>」参照)が必要な型は、structでなくclassで表す。</li>
<li>デフォルトコンストラクタを除く<a
href="programming_convention.html#SS_3_3_2_1">特殊メンバ関数</a>に対して、
= defaultの明示をしない。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb23"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 224</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Pod <span class="kw">final</span> <span class="op">{</span>                        <span class="co">// NG finalは不要</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        Pod<span class="op">()</span>                     <span class="op">=</span> <span class="cf">default</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>Pod<span class="op">()</span>                    <span class="op">=</span> <span class="cf">default</span><span class="op">;</span>  <span class="co">// NG = defaultは不要</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        Pod<span class="op">(</span>Pod <span class="at">const</span><span class="op">&amp;)</span>           <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span>   <span class="co">// OK copyを禁止する場合</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        Pod <span class="kw">operator</span><span class="op">=(</span>Pod <span class="at">const</span><span class="op">&amp;)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span>   <span class="co">// OK copyを禁止する場合</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> x<span class="op">;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> y<span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>Cとシェアしない構造体を無名構造体とそのtypedefで定義しない。</li>
</ul>
<div class="sourceCode" id="cb24"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 237</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span>  <span class="co">// NG   無名構造体</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> x<span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> y<span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> StructNG<span class="op">;</span>  <span class="co">// NG   無名構造体をtypedef</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="kw">struct</span> StructOK_C_Share <span class="op">{</span>  <span class="co">// Cとシェアする場合OK</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> x<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> y<span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> StructOK_C_Share<span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> StructOK <span class="op">{</span>  <span class="co">// OK   Cとシェアしない場合このように書く</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> x<span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> y<span class="op">;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<h3 id="union">3.1.6 union <a id="SS_3_1_6"></a></h3>
<ul>
<li>ハードウエアレジスタにアクセスをする目的以外で使用しない(以下のような使い方のみ認められる)。</li>
</ul>
<div class="sourceCode" id="cb25"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 258</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> XXX_REG <span class="op">{</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span>  bytes<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> word32<span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 0x14000000はハードウェアレジスタのアドレスとする</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span><span class="op">&amp;</span> XXX_REG_INST <span class="op">=</span> <span class="op">*</span><span class="kw">reinterpret_cast</span><span class="op">&lt;</span>XXX_REG<span class="op">*&gt;(</span><span class="bn">0x14000000</span><span class="op">);</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span>  byte_1       <span class="op">=</span> XXX_REG_INST<span class="op">.</span>bytes<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> byte_1<span class="op">;</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>上記のようなunionはランタイム依存性が強いため、それへの依存を最小にする。
従って、unionの定義を外部パッケージに公開(「<a
href="programming_convention.html#SS_3_7_1">パッケージの実装と公開</a>」参照)しない。</p></li>
<li><p>上記以外でunionのような機能が必要な場合、 std::variant(「<a
href="template_meta_programming.html#SS_13_6_2_2">std::variantとジェネリックラムダ</a>」参照)を使用する
(std::anyはunionの代替えにはならないので、このような場合には使用しない)。</p></li>
</ul>
<h3 id="配列">3.1.7 配列 <a id="SS_3_1_7"></a></h3>
<ul>
<li>配列をnew[]により生成しない。
可変長配列が必要な場合は、std::vectorを使用する(「<a
href="programming_convention.html#SS_3_5_6_1">new</a>」参照)。
固定長配列を動的に確保する場合は、std::arrayをnewする。</li>
<li>配列からポインタへの暗黙の型変換をしない(「<a
href="programming_convention.html#SS_3_5_10">キャスト、暗黙の型変換</a>」参照)。
特に、オブジェクトの配列をそのオブジェクトの基底クラスへのポインタに代入しないことは重要である
(「<a
href="programming_convention.html#SS_3_2_8">スライシング</a>」参照)。</li>
<li>関数の仮引数を一見、配列に見える型にしない (「<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>」参照)。</li>
<li>char型の配列を文字列リテラルで初期化する場合、配列の長さを指定しない。</li>
</ul>
<div class="sourceCode" id="cb26"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 279</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">        // g++では通常コンパイルエラーとなるが、-fpermissiveを付ければコンパイルできてしまう。</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">        char a[3]{&quot;abc&quot;};  // NG aはヌル終端されない</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> a<span class="op">[]{</span><span class="st">&quot;abc&quot;</span><span class="op">};</span>  <span class="co">// OK</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span></code></pre></div>
<ul>
<li><p>配列の全要素にアクセスするような繰り返し処理には<a
href="programming_convention.html#SS_3_4_4">範囲for文</a>を使用する。</p></li>
<li><p><a
href="exercise_q.html#SS_19_1_6">演習-配列の範囲for文</a></p></li>
</ul>
<h3 id="型エイリアス">3.1.8 型エイリアス <a id="SS_3_1_8"></a></h3>
<ul>
<li>Cとシェアされる型エイリアスを除き、typedefではなくusingを使用する。</li>
</ul>
<div class="sourceCode" id="cb27"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 296</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// C90スタイル</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">int</span> <span class="ex">uint</span><span class="op">;</span>                 <span class="co">// NG</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="dt">void</span> <span class="op">(*</span>void_func_int32<span class="op">)(</span><span class="dt">int32_t</span><span class="op">);</span>  <span class="co">// NG</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// C++11スタイル</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="ex">uint</span>            <span class="op">=</span> <span class="dt">unsigned</span> <span class="dt">int</span><span class="op">;</span>       <span class="co">// OK</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> void_func_int32 <span class="op">=</span> <span class="dt">void</span> <span class="op">(*)(</span><span class="dt">int32_t</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span>  <span class="co">// templateで型エイリアスを作ることもできる。</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Dict <span class="op">=</span> <span class="bu">std::</span>map<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> T<span class="op">&gt;;</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>型へのポインタのエイリアスは、それを使用してconstポインタが定義できないため、
型へのポインタ(関数ポインタを除く)のエイリアスを作らない。</li>
</ul>
<div class="sourceCode" id="cb28"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 320</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">pint32_t</span> <span class="op">=</span> <span class="dt">int32_t</span><span class="op">*;</span>  <span class="co">// pint32_tにはconstポインタを代入できない。</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pint32_t</span> <span class="at">const</span> pint32_0_c <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span>  <span class="co">// 一見pint32_0_cはconstポインタに見えるが。</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="at">const</span><span class="op">*</span> pint32_1_c <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// pint32_0_cの型とpint32_1_cの型が同じであれば問題ないのだが、</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// エイリアスのため結合順が変わった影響でそうはならない。</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// *pint32_0_cはconstではなく、pint32_0_cがconstとなる。</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>pint32_0_c<span class="op">),</span>  <span class="dt">int32_t</span><span class="op">*</span> <span class="at">const</span><span class="op">&gt;);</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(*</span>pint32_0_c<span class="op">),</span> <span class="dt">int32_t</span><span class="op">&amp;&gt;);</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>pint32_1_c<span class="op">),</span>  <span class="dt">int32_t</span> <span class="at">const</span><span class="op">*&gt;);</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(*</span>pint32_1_c<span class="op">),</span> <span class="dt">int32_t</span> <span class="at">const</span><span class="op">&amp;&gt;);</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_7">演習-エイリアス</a></li>
</ul>
<h3 id="constconstexprインスタンス">3.1.9 const/constexprインスタンス
<a id="SS_3_1_9"></a></h3>
<ul>
<li>インスタンス、インスタンスへのポインタ、インスタンスへのリファレンス等に対して、
<ul>
<li>constexpr(「<a
href="term_explanation.html#SS_18_1_15">constexprインスタンスと関数</a>」参照)にできる場合、constexprにする。</li>
<li>constexprにはできないが、const(「<a
href="term_explanation.html#SS_18_1_14">constインスタンス</a>」にはできる場合、constにする。
関数の仮引数になっているリファレンスやポインタをconstにすることは特に重要である
(「<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>」、「<a
href="programming_convention.html#SS_3_5_5">三項演算子</a>」参照)。</li>
<li>文字列リテラルのアドレスを非constポインタ型変数に代入しない(「<a
href="programming_convention.html#SS_3_1_10">リテラル</a>」参照)。</li>
<li>イテレータにおいても、可能な場合は、イテレータをconstするか、const_iteratorを使う。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb29"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_const_ut.cpp 13</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// name0は文字列リテラルを指すポインタなのでconstでなければならない。</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> name0 <span class="op">=</span> <span class="st">&quot;hoge&quot;</span><span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// name1は文字列リテラルでないのでconstでなくてよい。</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name1<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;hoge&quot;</span><span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> get_str<span class="op">();</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 左側のconstはname2の指す先をconstにする。</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 右側のconstはname2自体をconstにする。</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> <span class="at">const</span> name2 <span class="op">=</span> get_str<span class="op">();</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// name2の右辺がリテラルならば、下記のようにするべきである。</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> name3 <span class="op">=</span> <span class="st">&quot;hoge&quot;</span><span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;&amp;</span> vec<span class="op">)</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;::</span>iterator <span class="at">const</span> iter <span class="op">=</span> vec<span class="op">.</span>begin<span class="op">();</span>  <span class="co">// iter自体がconst</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>iter <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ++iter;      // 意図的にコンパイルエラー</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;::</span>const_iterator const_iter_0 <span class="op">=</span> vec<span class="op">.</span>begin<span class="op">();</span>   <span class="co">// *const_iter_0がconst</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span>                                 const_iter_1 <span class="op">=</span> vec<span class="op">.</span>cbegin<span class="op">();</span>  <span class="co">// *const_iter_1がconst</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;::</span>const_iterator<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>const_iter_1<span class="op">)&gt;);</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// *const_iter_0 = 10;   // 意図的にコンパイルエラー</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">++</span>const_iter_0<span class="op">;</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// *const_iter_1 = 10;   // 意図的にコンパイルエラー</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">++</span>const_iter_1<span class="op">;</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>constは、意味が変わらない範囲で出来るだけ右側に書く。</li>
</ul>
<div class="sourceCode" id="cb30"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_const_ut.cpp 52</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> </span>s<span class="op">;</span>  <span class="co">// NG</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span> t<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op">*</span> <span class="va">s_ptr</span><span class="op">;</span>  <span class="co">// NG</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">*</span> t_ptr<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> f<span class="op">();</span>  <span class="co">// NG 関数の宣言</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> g<span class="op">();</span>  <span class="co">// OK 関数の宣言</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>        abc<span class="op">[]{</span><span class="st">&quot;abc&quot;</span><span class="op">};</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> a <span class="op">=</span> abc<span class="op">;</span>  <span class="co">// NG *aはconst</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> b <span class="op">=</span> abc<span class="op">;</span>  <span class="co">// OK *aはconst</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span> <span class="at">const</span> c <span class="op">=</span> abc<span class="op">;</span>  <span class="co">// NG *aではなく、aがconstになり、意味が変わる</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> <span class="at">const</span> d <span class="op">=</span> abc<span class="op">;</span>  <span class="co">// NG</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> <span class="at">const</span> e <span class="op">=</span> abc<span class="op">;</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_8">演習-constの意味</a></li>
<li><a href="exercise_q.html#SS_19_1_9">演習-const/constexpr</a></li>
</ul>
<h3 id="リテラル">3.1.10 リテラル <a id="SS_3_1_10"></a></h3>
<ul>
<li>ヌルポインタを表すポインタリテラルとして、nullptrを使用する(0やNULLを使用しない)。</li>
</ul>
<div class="sourceCode" id="cb31"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 343</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> a<span class="op">{</span><span class="dv">0</span><span class="op">};</span>        <span class="co">// NG   オールドスタイル</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> b<span class="op">{</span>NULL<span class="op">};</span>     <span class="co">// NG   C90の書き方</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> c<span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span>  <span class="co">// OK   C++11</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 362</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">int</span> g<span class="op">(</span><span class="dt">long</span> a<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">int</span> g<span class="op">(</span><span class="dt">int</span><span class="op">*</span> a<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NULLを使ったことで、わかりづらいバグが発生する例</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    g<span class="op">(</span>NULL<span class="op">);</span>  <span class="co">// NG NULLはポインタではないため、この呼び出しはg(long)を呼び出す</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">long</span><span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>NULL<span class="op">)&gt;);</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    g<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span>  <span class="co">// OK 意図通り、g(int*)を呼び出す。</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="bu">std::</span>nullptr_t<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span><span class="kw">nullptr</span><span class="op">)&gt;);</span></span></code></pre></div>
<ul>
<li>文字列リテラル(“xxx”)はconstオブジェクトとして扱う (「<a
href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a>」、「<a
href="term_explanation.html#SS_18_1_17">std::string型リテラル</a>」参照)。</li>
<li>長い<a
href="term_explanation.html#SS_18_1_2">汎整数型</a>リテラルを使用する場合は、適切に区切りを入れる(C++14)。</li>
<li>ビットマスク等2進数を使用した方が直感的な場合には2進数リテラルを使用する(C++14)。</li>
</ul>
<div class="sourceCode" id="cb33"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 384</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> <span class="dv">123&#39;456&#39;789</span><span class="bu">U</span><span class="op">;</span>       <span class="co">// = 123456789</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b <span class="op">=</span> <span class="bn">0x123&#39;456&#39;789</span><span class="bu">U</span><span class="op">;</span>     <span class="co">// = 0x123456789</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c <span class="op">=</span> <span class="bn">0b1001&#39;0001&#39;0101</span><span class="bu">U</span><span class="op">;</span>  <span class="co">// = 0x915</span></span></code></pre></div>
<ul>
<li>bool型を表すリテラルにはtrue、falseを使用する。代わりに0、1、!0等を使わない。</li>
</ul>
<div class="sourceCode" id="cb34"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 395</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> a<span class="op">{</span><span class="dv">0</span><span class="op">};</span>          <span class="co">// NG</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> b<span class="op">{!</span><span class="dv">0</span><span class="op">};</span>         <span class="co">// NG</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> c<span class="op">{</span><span class="kw">false</span><span class="op">};</span>      <span class="co">// OK</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> d <span class="op">=</span> <span class="dt">bool</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span>   <span class="co">// NG</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> e <span class="op">=</span> <span class="dt">bool</span><span class="op">{!</span><span class="dv">0</span><span class="op">};</span>  <span class="co">// NG</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>      <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>long値リテラルを表す文字には”l”ではなく、“L”を使う。</li>
</ul>
<div class="sourceCode" id="cb35"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 408</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> <span class="dv">432</span><span class="bu">l</span><span class="op">;</span>  <span class="co">// NG 4321と区別が難しい</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b <span class="op">=</span> <span class="dv">432</span><span class="bu">L</span><span class="op">;</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_10">演習-危険なconst_cast</a></li>
<li><a href="exercise_q.html#SS_19_1_11">演習-リテラル</a></li>
</ul>
<h3 id="型推論">3.1.11 型推論 <a id="SS_3_1_11"></a></h3>
<h4 id="auto">3.1.11.1 auto <a id="SS_3_1_11_1"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>に従い適切にautoを使用する。</li>
</ul>
<div class="sourceCode" id="cb36"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 422</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> strs<span class="op">)</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> s0 <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;hehe&quot;</span><span class="op">};</span>  <span class="co">// OK</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> s1<span class="op">{</span><span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;hehe&quot;</span><span class="op">}};</span>   <span class="co">// OKだが、通常は代入を使用する</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> s2 <span class="op">=</span> s0<span class="op">;</span>                   <span class="co">// OK</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> s3 <span class="op">=</span> get_name<span class="op">();</span>           <span class="co">// NG get_name()の戻り値を見ないとs3の型が不明</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> str <span class="op">:</span> strs<span class="op">)</span> <span class="op">{</span>  <span class="co">// OK strsの型が明らかであるため、strの型も明らか</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>autoを使用する場合、&amp;、*、const等の付け忘れに注意する。</li>
</ul>
<div class="sourceCode" id="cb37"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 442</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0  </span><span class="co">// NG この関数を呼び出すとクラッシュ</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">        std::string const&amp; Get(char first_byte) const noexcept</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">        {</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">            static std::string const empty;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">            for (auto const str : strs) {       // NG &amp;の付け忘れのため、スタック上の</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">                if (str.at(0) == first_byte) {  //    オブジェクトのリファレンスをreturnする。</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">                    return str;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">                }</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">            return empty;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span>  <span class="co">// OK 上のGetの修正。</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> Get<span class="op">(</span><span class="dt">char</span> first_byte<span class="op">)</span> <span class="at">const</span> <span class="kw">noexcept</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">static</span> <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span> empty<span class="op">;</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> str <span class="op">:</span> strs<span class="op">)</span> <span class="op">{</span>      <span class="co">// OK &amp;を付けて、インスタンスのオブジェクトの</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>str<span class="op">.</span>at<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">==</span> first_byte<span class="op">)</span> <span class="op">{</span>  <span class="co">//    リファレンスを返せるようになった。</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> str<span class="op">;</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> empty<span class="op">;</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> strs<span class="op">{</span><span class="st">&quot;aha&quot;</span><span class="op">,</span> <span class="st">&quot;ihi&quot;</span><span class="op">,</span> <span class="st">&quot;uhu&quot;</span><span class="op">};</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>autoと= {}を使用した変数の宣言には以下のような紛らわしさがあるため、
そのような記述を行わない(「<a
href="programming_convention.html#SS_3_1_12">インスタンスの初期化</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb38"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 493</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> <span class="dv">1</span><span class="op">;</span>       <span class="co">// OK aの型はint</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b<span class="op">(</span><span class="dv">1</span><span class="op">);</span>        <span class="co">// 別の規制でNG ()より{}を優先的に使うべき</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c<span class="op">{</span><span class="dv">1</span><span class="op">};</span>        <span class="co">// OK cの型はint</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> d <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">};</span>     <span class="co">// NG dの型はstd::initializer_list&lt;int&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> e <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">};</span>  <span class="co">// NG eの型はstd::initializer_list&lt;int&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f <span class="op">=</span> <span class="bu">std::</span>initializer_list<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">};</span>  <span class="co">// OK</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>a<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>b<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>c<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d<span class="op">),</span> <span class="bu">std::</span>initializer_list<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>e<span class="op">),</span> <span class="bu">std::</span>initializer_list<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>f<span class="op">),</span> <span class="bu">std::</span>initializer_list<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;,</span> <span class="st">&quot;type not same&quot;</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>auto、<a href="term_explanation.html#SS_18_5_7">decltype</a>,
decltype(auto)の微妙な違いに気を付ける。</li>
</ul>
<div class="sourceCode" id="cb39"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 515</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span>  s0<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span><span class="op">&amp;</span> s0_ref<span class="op">{</span>s0<span class="op">};</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>  <span class="co">// autoとdecltypeが同じ動作をするパターン</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> s0<span class="op">;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>a<span class="op">),</span> <span class="dt">short</span><span class="op">&gt;);</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span>s0<span class="op">)</span> d <span class="op">=</span> s0<span class="op">;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d<span class="op">),</span> <span class="dt">short</span><span class="op">&gt;);</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span><span class="kw">auto</span><span class="op">)</span> da <span class="op">=</span> s0<span class="op">;</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>da<span class="op">),</span> <span class="dt">short</span><span class="op">&gt;);</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>  <span class="co">// autoとdecltypeに違いが出るパターン</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> s0_ref<span class="op">;</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>a<span class="op">),</span> <span class="dt">short</span><span class="op">&gt;);</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span>s0_ref<span class="op">)</span> d <span class="op">=</span> s0_ref<span class="op">;</span>  <span class="co">// dはリファレンス</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d<span class="op">),</span> <span class="dt">short</span><span class="op">&amp;&gt;);</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span><span class="kw">auto</span><span class="op">)</span> da <span class="op">=</span> s0_ref<span class="op">;</span>  <span class="co">// daはリファレンス</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>da<span class="op">),</span> <span class="dt">short</span><span class="op">&amp;&gt;);</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> s1<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>  <span class="co">// 微妙な違いで出るパターン</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> s0 <span class="op">+</span> s1<span class="op">;</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>a<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span>s0<span class="op">)</span> d <span class="op">=</span> s0 <span class="op">+</span> s1<span class="op">;</span>  <span class="co">// これが意図的ならよいが</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d<span class="op">),</span> <span class="dt">short</span><span class="op">&gt;);</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span>s0 <span class="op">+</span> s1<span class="op">)</span> d2 <span class="op">=</span> s0 <span class="op">+</span> s1<span class="op">;</span>  <span class="co">// int&amp;&amp;にはならない</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d2<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">decltype</span><span class="op">(</span><span class="kw">auto</span><span class="op">)</span> da <span class="op">=</span> s0 <span class="op">+</span> s1<span class="op">;</span>  <span class="co">// この方がクローンがないため上よりも良い</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>da<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_1_12">演習-適切なautoの使い方</a></li>
</ul>
<h3 id="インスタンスの初期化">3.1.12 インスタンスの初期化
<a id="SS_3_1_12"></a></h3>
<ul>
<li>関数内のオブジェクトは、出来る限り<a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>を用いて宣言し、同時に初期化する。</li>
<li><a href="term_explanation.html#SS_18_1_1">算術型</a>の宣言に<a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>が使えない場合、
「代入演算子を伴わない<a
href="term_explanation.html#SS_18_2_7">一様初期化</a>」を使用する。
「代入演算子を伴う一様初期化」、「()、=による初期化」を使用しない。</li>
</ul>
<div class="sourceCode" id="cb40"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 572</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> a0<span class="op">(</span><span class="dv">0</span><span class="op">);</span>            <span class="co">// NG</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> a1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>           <span class="co">// NG</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> a2<span class="op">{</span><span class="dv">0</span><span class="op">};</span>            <span class="co">// OK 一様初期化</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> a3 <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span>         <span class="co">// NG 代入演算子を伴う一様初期化</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>    a4 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>           <span class="co">// OK AAAの場合は一様初期を使わなくても問題ない</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>    a5 <span class="op">=</span> <span class="dt">int32_t</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span>  <span class="co">// OK AAA且つ一様初期</span></span></code></pre></div>
<ul>
<li>リファレンスやポインタの宣言に<a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>が使えない場合、
「代入演算子を伴わない<a
href="term_explanation.html#SS_18_2_7">一様初期化</a>」か「=による初期化」を使用する。
「代入演算子を伴う一様初期化」、「()による初期化」を使用しない。</li>
</ul>
<div class="sourceCode" id="cb41"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 581</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">&amp;</span> r0<span class="op">(</span>a0<span class="op">);</span>     <span class="co">// NG</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">&amp;</span> r1 <span class="op">=</span> a0<span class="op">;</span>    <span class="co">// OK</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">&amp;</span> r2<span class="op">{</span>a0<span class="op">};</span>     <span class="co">// OK 一様初期化</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">&amp;</span> r3 <span class="op">=</span> <span class="op">{</span>a0<span class="op">};</span>  <span class="co">// NG 代入演算子を伴う一様初期化</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span>    r4 <span class="op">=</span> a0<span class="op">;</span>  <span class="co">// OK AAAの場合は一様初期を使わなくても問題ないが、&amp;の付け忘れに気を付ける</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> p0<span class="op">(&amp;</span>a0<span class="op">);</span>     <span class="co">// NG</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> p1 <span class="op">=</span> <span class="op">&amp;</span>a0<span class="op">;</span>    <span class="co">// OK</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> p2<span class="op">{&amp;</span>a0<span class="op">};</span>     <span class="co">// OK 一様初期化</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span> p3 <span class="op">=</span> <span class="op">{&amp;</span>a0<span class="op">};</span>  <span class="co">// NG 代入演算子を伴う一様初期化</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>     p4 <span class="op">=</span> <span class="op">&amp;</span>a0<span class="op">;</span>    <span class="co">// OK AAAの場合は一様初期を使わなくても問題ない</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">*</span>    p5 <span class="op">=</span> <span class="op">&amp;</span>a0<span class="op">;</span>    <span class="co">// OK AAAの場合は一様初期を使わなくても問題ない</span></span></code></pre></div>
<ul>
<li>構造体やクラス型オブジェクトの宣言に<a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>が使えない場合、
<ul>
<li>「代入演算子を伴わない<a
href="term_explanation.html#SS_18_2_7">一様初期化</a>」を使用する。</li>
<li>上記では意図したコンストラクタが呼び出せない場合にのみ「()による初期化」を使用する。
ただし、std::string、std::string_viewに関しては「 =
“xxx”」を使用しても良い。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb42"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 609</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 構造体の初期化</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Struct <span class="op">{</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span>     a<span class="op">;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str<span class="op">;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    Struct s0<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">};</span>           <span class="co">// OK 代入演算子を伴わない一様初期化</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    Struct s1 <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="st">&quot;2&quot;</span><span class="op">};</span>        <span class="co">// NG 代入演算子による一様初期化</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    Struct s2<span class="op">{};</span>                 <span class="co">// OK s2.aは0、s2.strはnullptrに初期化される。</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    Struct s3<span class="op">;</span>                   <span class="co">// NG s3は未初期化</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>   s4 <span class="op">=</span> Struct<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">};</span>  <span class="co">// OK AAAスタイル</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>   s5 <span class="op">=</span> Struct<span class="op">{};</span>        <span class="co">// OK AAAスタイル</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// クラスの初期化</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>Widget<span class="op">&gt;</span> a<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>Widget<span class="op">&gt;()};</span>   <span class="co">// OK</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>Widget<span class="op">&gt;</span> b<span class="op">(</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>Widget<span class="op">&gt;());</span>   <span class="co">// NG {}を使うべき</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>                    c<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>Widget<span class="op">&gt;()};</span>   <span class="co">// OK</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>                    d <span class="op">=</span> <span class="bu">std::</span>make_unique<span class="op">&lt;</span>Widget<span class="op">&gt;();</span>  <span class="co">// OK</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このような場合、重複を避けるため、変数宣言の型はautoが良い</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::string、std::string_viewの初期化</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>str0<span class="op">{</span><span class="st">&quot;222&quot;</span><span class="op">};</span>     <span class="co">// OK</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>str1 <span class="op">=</span> <span class="op">{</span><span class="st">&quot;222&quot;</span><span class="op">};</span>  <span class="co">// NG = は不要</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>str2<span class="op">(</span><span class="st">&quot;222&quot;</span><span class="op">);</span>     <span class="co">// NG {}で初期化できない時のみ、()を使う。</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>str3<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span><span class="op">);</span>    <span class="co">// OK {}では初期化できない。str3 == &quot;222&quot;</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>str4 <span class="op">=</span> <span class="st">&quot;222&quot;</span><span class="op">;</span>    <span class="co">// OK 例外的に認める</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>        str5 <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;222&quot;</span><span class="op">};</span>  <span class="co">// OK AAAスタイル</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string_view<span class="op"> </span>sv0 <span class="op">=</span> <span class="st">&quot;222&quot;</span><span class="op">;</span>                    <span class="co">// OK 例外的に認める</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>             sv1 <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="st">&quot;222&quot;</span><span class="op">};</span>  <span class="co">// OK AAAスタイル</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// {}、()による初期化の違い</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> vec0_i<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span>  <span class="co">// OK vec0_i.size() == 3 &amp;&amp; vec0_i[0] == 1 ...</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> vec1_i<span class="op">{</span><span class="dv">10</span><span class="op">};</span>       <span class="co">// OK vec1_i.size() == 1 &amp;&amp; vec1_i[0] == 10</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> vec2_i<span class="op">(</span><span class="dv">10</span><span class="op">);</span>       <span class="co">// OK vec1_i.size() == 10</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>                 vec3_i <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span>  <span class="co">// OK vec0_iと同じ</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> vec1_s<span class="op">{</span><span class="dv">10</span><span class="op">};</span>  <span class="co">// OK vec1_s.size() == 10</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> vec2_s<span class="op">(</span><span class="dv">10</span><span class="op">);</span>  <span class="co">// NG vec2_s.size() == 10  {}を優先するべき</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>                     vec3_s <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="dv">10</span><span class="op">};</span>  <span class="co">// OK vec1_sと同じ</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// vec1_i、vec2_i、vec1_sの初期化は似ているが、結果は全く異なる。</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// vec1_iは、vector(initializer_list&lt;&gt;)を呼び出す。</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// vec2_iは、vector(int)を呼び出す。</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// vec1_sは、vector(int)を呼び出す。</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">3</span><span class="op">,</span> vec0_i<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> vec1_i<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">10</span><span class="op">,</span> vec2_i<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>vec0_i<span class="op">,</span> vec3_i<span class="op">);</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">10</span><span class="op">,</span> vec1_s<span class="op">.</span>size<span class="op">());</span>  <span class="co">// vec1_iと同じ形式で初期化したが結果は全く異なる。</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">10</span><span class="op">,</span> vec2_s<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">10</span><span class="op">,</span> vec3_s<span class="op">.</span>size<span class="op">());</span></span></code></pre></div>
<ul>
<li>decltypeによるオブジェクトの宣言は、<a
href="term_explanation.html#SS_18_2_8">AAAスタイル</a>と同様に行う。</li>
</ul>
<div class="sourceCode" id="cb43"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 677</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>  a <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span> b <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">decltype</span><span class="op">(</span>a<span class="op">)</span>    c <span class="op">=</span> a<span class="op">;</span>    <span class="co">// OKがautoの方が良い</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">decltype</span><span class="op">(</span>a<span class="op">)</span>    d <span class="op">=</span> <span class="op">{</span>a<span class="op">};</span>  <span class="co">// NG</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">decltype</span><span class="op">(</span>b<span class="op">)</span>    e <span class="op">=</span> a<span class="op">;</span>    <span class="co">// OK</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">decltype</span><span class="op">(</span><span class="kw">auto</span><span class="op">)</span> f <span class="op">=</span> b<span class="op">;</span>    <span class="co">// OK</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>c<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>d<span class="op">),</span> <span class="dt">int</span><span class="op">&gt;);</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>e<span class="op">),</span> <span class="dt">int</span><span class="op">&amp;&gt;);</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>f<span class="op">),</span> <span class="dt">int</span><span class="op">&amp;&gt;);</span></span></code></pre></div>
<ul>
<li>配列の宣言には、「代入演算子を伴わない<a
href="term_explanation.html#SS_18_2_7">一様初期化</a>」を使用する。
char[]に関しては、「代入演算子を伴わない一様初期化」か「 =
“xxx”」を使用する。</li>
</ul>
<div class="sourceCode" id="cb44"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 700</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> array0<span class="op">[</span><span class="dv">3</span><span class="op">]{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span>     <span class="co">// OK 代入演算子を伴わない一様初期化</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> array1<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span>  <span class="co">// NG 代入演算子による一様初期化</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> array2<span class="op">[</span><span class="dv">3</span><span class="op">]{};</span>            <span class="co">// OK 代入演算子を伴わない一様初期化</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> array3<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{};</span>         <span class="co">// NG 代入演算子による一様初期化</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c_str0<span class="op">[]{</span><span class="ch">&#39;1&#39;</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span><span class="op">,</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">};</span>     <span class="co">// OKだが、非推奨</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c_str1<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="ch">&#39;1&#39;</span><span class="op">,</span> <span class="ch">&#39;2&#39;</span><span class="op">,</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">};</span>  <span class="co">// NG 代入演算子による一様初期化</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c_str2<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="st">&quot;12&quot;</span><span class="op">};</span>            <span class="co">// NG 代入演算子による一様初期化</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c_str3<span class="op">[]{</span><span class="st">&quot;12&quot;</span><span class="op">};</span>               <span class="co">// OK</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c_str4<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;12&quot;</span><span class="op">;</span>              <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>宣言時にポインタ変数の初期値が決まらない場合、nullptrで初期化する(「<a
href="programming_convention.html#SS_3_1_10">リテラル</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb45"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 723</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span>       ptr1 <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span><span class="op">*</span>       ptr2<span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span>   <span class="co">// OK</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span>    pchar0 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>      <span class="co">// NG</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span>          pchar1 <span class="op">=</span> NULL<span class="op">;</span>   <span class="co">// NG</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="at">const</span><span class="op">*</span> ptr0<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span>   <span class="co">// NG {}か=で初期化する</span></span></code></pre></div>
<ul>
<li>初期化順序が不定になるため、
別のコンパイル単位で定義された静的なオブジェクトに依存した静的オブジェクトの初期化を行わない
(同じファイルの上方にある静的なオブジェクトや、 <a
href="design_pattern.html#SS_9_12">Singleton</a>に依存した初期化を行うことには問題はない)。</li>
<li>コンパイル時に値が確定する「基本型」や「コンストラクタがconstexprであるクラス」のインスタンスは、
constexpr(「<a
href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a>」参照)と宣言する。</li>
</ul>
<div class="sourceCode" id="cb46"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 735</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> f_constexpr<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> <span class="dv">3</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span>           f_normal<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> <span class="dv">3</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 743</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> a <span class="op">=</span> f_constexpr<span class="op">(</span><span class="dv">3</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span>     b <span class="op">=</span> f_constexpr<span class="op">(</span><span class="dv">3</span><span class="op">);</span>  <span class="co">// NG constexprにできる</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// constexpr auto c = f_normal(3);  // NG コンパイルエラー</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> d <span class="op">=</span> f_normal<span class="op">(</span><span class="dv">3</span><span class="op">);</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>constなオブジェクトが複雑な初期化を必要とする場合、その初期化にはラムダ式を使用する。</li>
</ul>
<div class="sourceCode" id="cb48"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 756</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> len<span class="op">{</span><span class="dv">10</span><span class="op">};</span>  <span class="co">// ここではlenは固定だが、関数引数等で外部から与えられるとする</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> vc0 <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;(</span>len<span class="op">);</span>  <span class="co">// vc0が初期化以外で変更されないのであれば、NG</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>iota<span class="op">(</span>vc0<span class="op">.</span>begin<span class="op">(),</span> vc0<span class="op">.</span>end<span class="op">(),</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// vc0の初期化</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span> vc1 <span class="op">=</span> <span class="op">[</span>len<span class="op">]()</span> <span class="op">{</span>  <span class="co">// OK vc1の初期化</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> ret<span class="op">(</span>len<span class="op">);</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>iota<span class="op">(</span>ret<span class="op">.</span>begin<span class="op">(),</span> ret<span class="op">.</span>end<span class="op">(),</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}();</span>  <span class="co">// ラムダ式の生成と呼び出し</span></span></code></pre></div>
<ul>
<li><a
href="exercise_q.html#SS_19_1_15">演習-インスタンスの初期化</a></li>
<li><a href="exercise_q.html#SS_19_1_14">演習-vector初期化</a></li>
<li><a href="exercise_q.html#SS_19_1_13">演習-ポインタの初期化</a></li>
</ul>
<h3 id="rvalue">3.1.13 rvalue <a id="SS_3_1_13"></a></h3>
<ul>
<li>関数の仮引数以外のリファレンスで<a
href="term_explanation.html#SS_18_5_3">rvalue</a>をバインドしない (「<a
href="programming_convention.html#SS_3_2_10">オブジェクトのライフタイム</a>」参照)。</li>
<li>rvalueの内部ハンドルを使用しない(「<a
href="programming_convention.html#SS_3_10_1_4">std::string_viewの使用制限</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb49"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/type_ut.cpp 790</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;str&quot;</span><span class="op">}.</span>c_str<span class="op">();</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// strが指すポインタはこの行では解放済</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_STREQ<span class="op">(</span>str<span class="op">,</span> <span class="st">&quot;str&quot;</span><span class="op">);</span>  <span class="co">//    strは無効なポインタを保持であるため、未定義動作</span></span></code></pre></div>
<ul>
<li>非constなリファレンスでrvalueをバインドしない。</li>
</ul>
<h2 id="クラスとインスタンス">3.2 クラスとインスタンス
<a id="SS_3_2"></a></h2>
<h3 id="ファイルの使用方法">3.2.1 ファイルの使用方法
<a id="SS_3_2_1"></a></h3>
<ul>
<li>下記の例外を除き、一つのクラスはそれを宣言、定義する1つのヘッダファイルと、
一つの.cppファイルによって構成する。
<ul>
<li>ファイル外部から使用されないクラスは、一つの.cppファイルの無名名前空間で宣言、定義する。</li>
<li>ファイル外部から使用されるインラインクラス(クラステンプレート等)は、
一つのヘッダファイルで宣言、定義する。</li>
<li>「一つのヘッダファイル(a.h)と、一つの.cpp(a.cpp)で構成されたクラスA」のみをサポートするクラス
(Aのインターフェースや実装専用に定義されたクラス(「<a
href="design_pattern.html#SS_9_3">Pimpl</a>」参照))は、
a.h、a.cppで宣言、定義する。</li>
</ul></li>
</ul>
<h3 id="クラスの規模">3.2.2 クラスの規模 <a id="SS_3_2_2"></a></h3>
<h4 id="行数">3.2.2.1 行数 <a id="SS_3_2_2_1"></a></h4>
<ul>
<li>それ以外に方法がない場合を除き、ヘッダファイル内のクラスの定義、
宣言はコメントを含め200行程度に収める。</li>
<li>クラス内定義関数が大きくなると下記のような問題が発生しやすくなるため、
10行を超える関数はクラス内で定義しない。
<ul>
<li>関数のインポートする外部シンボルが多くなり、
このクラスを使用する別のクラスに不要な依存関係を作ってしまう (「<a
href="solid.html#SS_8_4">インターフェース分離の原則(ISP)</a>」参照)。</li>
<li>クラスの定義が間延びして、クラスの全体構造を把握することが困難になる。</li>
</ul></li>
</ul>
<h4 id="メンバの数">3.2.2.2 メンバの数 <a id="SS_3_2_2_2"></a></h4>
<ul>
<li>それ以外に方法がない場合を除き、publicメンバ関数の数は、最大7個程度に収める
(ただし、オーバーロードにより同じ名前を持つ関数群は、全部で1個とカウントする)。</li>
<li>オブジェクトの状態を保持するメンバ変数の数は、最大4個程度に留める。
constやconstexprメンバ・インスタンスは定数(状態を保持するメンバ変数ではない)であるため、
この数に含めない。</li>
</ul>
<h4 id="凝集度">3.2.2.3 凝集度 <a id="SS_3_2_2_3"></a></h4>
<ul>
<li><p>単なるデータホルダー(アプリケーションの設定データを保持するようなクラス等)や、
ほとんどの振る舞いを他のクラスに委譲するようなクラスを除き、 <a
href="term_explanation.html#SS_18_11_1">凝集度</a>が高くなるように設計する。</p></li>
<li><p><a href="exercise_q.html#SS_19_2_1">演習-凝集度の意味</a></p></li>
<li><p><a href="exercise_q.html#SS_19_2_2">演習-凝集度の向上</a></p></li>
</ul>
<h3 id="アクセスレベルと隠蔽化">3.2.3 アクセスレベルと隠蔽化
<a id="SS_3_2_3"></a></h3>
<ul>
<li>アクセスレベルは、特別な理由がない限り、上からpublic、protected、privateの順番で明示する。</li>
</ul>
<div class="sourceCode" id="cb50"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 12</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f0<span class="op">();</span>  <span class="co">// NG デフォルト private を使用しない。</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f1<span class="op">();</span>  <span class="co">// OK</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f2<span class="op">();</span>  <span class="co">// OK</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span><span class="op">:</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f3<span class="op">();</span>  <span class="co">// NG privateの前に定義すべき。</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>全てのメンバ変数はprivateにする。
<ul>
<li>メンバ変数にアクセスしたい場合は、Accessorメンバ関数を経由させる
(「<a
href="design_pattern.html#SS_9_4">Accessor</a>」参照)。その場合でもsetterは控えめに使用する。</li>
<li>派生クラスから基底クラスの変数の値が必要になる場合は、protectedなAccessorを定義する。</li>
<li>単体テスト用クラスでは、protectedメンバ変数を定義してよい。</li>
</ul></li>
<li>アクセスレベルによるカプセル化が破壊されるため、
メンバ変数のハンドル(リファレンスやポインタ)を返さない。
それが避けがたい場合においては、constハンドルを返す。</li>
</ul>
<div class="sourceCode" id="cb51"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 28</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> B <span class="op">{</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span><span class="op">*</span> f0<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// NG メンバ変数が保持するポインタを返している</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">v_ptr_</span><span class="op">;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op">*</span> f1<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// NG メンバ変数へのポインタを返している</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">&amp;</span><span class="va">str_</span><span class="op">;</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op">&amp;</span> f2<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// NG メンバ変数へのリファレンスを返している</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">str_</span><span class="op">;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span>f3<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span>  <span class="co">// OK ただし、パフォーマンスに注意</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">str_</span><span class="op">;</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> f4<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span>  <span class="co">// OK</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">str_</span><span class="op">;</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span><span class="op">*</span>       <span class="va">v_ptr_</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="va">str_</span><span class="op">{};</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>以下のような場合を除き、friendを使用しない。
<ul>
<li>単体テスト用クラス</li>
<li>二項演算子をオーバーロードした関数</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb52"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 68</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Integer <span class="op">{</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        Integer<span class="op">(</span><span class="dt">int32_t</span> integer<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">integer_</span><span class="op">{</span>integer<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// メンバ関数に見えるが、非メンバ関数</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>Integer lhs<span class="op">,</span> Integer rhs<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// OK</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> lhs<span class="op">.</span><span class="va">integer_</span> <span class="op">==</span> rhs<span class="op">.</span><span class="va">integer_</span><span class="op">;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="at">const</span> <span class="va">integer_</span><span class="op">;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span><span class="op">!=(</span>Integer lhs<span class="op">,</span> Integer rhs<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">!(</span>lhs <span class="op">==</span> rhs<span class="op">);</span> <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="design_pattern.html#SS_9_8">NVI(non virtual
interface)</a>に従う。従って、
virtualな関数はprivateかprotectedと宣言し、それをpublicな非仮想メンバ関数から呼び出す。</li>
</ul>
<div class="sourceCode" id="cb53"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 86</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Widget <span class="op">{</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> DoSomething<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// NG virtualでpublic</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> DoSomething<span class="op">(</span><span class="dt">bool</span> b<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// OK non-virtualでpublic</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> do_something<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> do_something<span class="op">(</span><span class="dt">bool</span> b<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// OK virtualでprivate</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<h3 id="継承派生">3.2.4 継承/派生 <a id="SS_3_2_4"></a></h3>
<ul>
<li>派生は最大2回程度までに留める。やむを得ず階層が深くなる場合、
コードの静的解析等を使用し派生関係を明確にする(「<a
href="term_explanation.html#SS_18_2_11">クラスのレイアウト</a>」参照)。</li>
<li>実装の継承よりも、包含、委譲を優先的に使用する。やむを得ず実装の継承を行う場合は、
private継承を使用する。
実装の継承をしたクラスがfinalでないならば、protected継承を使用する (<a
href="design_pattern.html#SS_9_21">CRTP(curiously recurring template
pattern)</a>等は例外的に認められる)。</li>
</ul>
<div class="sourceCode" id="cb54"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 124</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// private継承。非推奨</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> StringWrapper0 <span class="kw">final</span> <span class="op">:</span> <span class="kw">private</span> <span class="bu">std::</span>string<span class="op"> {</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> StringWrapper0<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str<span class="op">)</span> <span class="op">:</span> <span class="bu">std::</span>string<span class="op">{</span>str<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> AddStr<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str<span class="op">)</span> <span class="op">{</span> <span class="op">*</span><span class="kw">this</span> <span class="op">+=</span> str<span class="op">;</span> <span class="op">}</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="bu">std::</span>string<span class="bu">::</span>c_str<span class="op">;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 移譲。こちらを優先する</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> StringWrapper1 <span class="kw">final</span> <span class="op">{</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> StringWrapper1<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str<span class="op">)</span> <span class="op">:</span> <span class="va">str_</span><span class="op">{</span>str<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> AddStr<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> str<span class="op">)</span> <span class="op">{</span> <span class="va">str_</span> <span class="op">+=</span> str<span class="op">;</span> <span class="op">}</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> c_str<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">str_</span><span class="op">.</span>c_str<span class="op">();</span> <span class="op">}</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="va">str_</span><span class="op">;</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>派生させないクラスは、finalと宣言する。ほとんどのクラスは派生しないはずなので、
ほとんどのクラスはfinalになる。</li>
<li>リソースリークの原因になり得るため、非virtualなデストラクタをもつクラスを継承しない。
ただし、継承したクラスが基底クラスのメンバ変数以外のメンバ変数を持たないならば、継承しても良い。</li>
</ul>
<div class="sourceCode" id="cb55"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 149</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span>  <span class="co">// デストラクタの呼び出しチェック用のクラス</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">(</span><span class="dt">bool</span><span class="op">&amp;</span> destructed<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">destructed_</span><span class="op">{</span>destructed<span class="op">}</span> <span class="op">{</span> <span class="va">destructed_</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>A<span class="op">()</span> <span class="op">{</span> <span class="va">destructed_</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span><span class="op">&amp;</span> <span class="va">destructed_</span><span class="op">;</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> BaseNG <span class="op">{</span>  <span class="co">// NG デストラクタが非virtual</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        BaseNG<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> DerivedNG <span class="op">:</span> <span class="kw">public</span> BaseNG <span class="op">{</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>        DerivedNG<span class="op">(</span><span class="dt">bool</span><span class="op">&amp;</span> destructed<span class="op">)</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>A<span class="op">&gt;(</span>destructed<span class="op">)}</span> <span class="op">{}</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>A<span class="op">&gt;</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 183</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_destructed <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>DerivedNG<span class="op">&gt;</span> d<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>DerivedNG<span class="op">&gt;(</span>a_destructed<span class="op">)};</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>a_destructed<span class="op">);</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>a_destructed<span class="op">);</span>  <span class="co">// OK A::~A()が呼ばれたため問題ないが、、、</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>BaseNG<span class="op">&gt;</span> d<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>DerivedNG<span class="op">&gt;(</span>a_destructed<span class="op">)};</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>a_destructed<span class="op">);</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    ASSERT_FALSE<span class="op">(</span>a_destructed<span class="op">);</span>  <span class="co">// NG A::~A()が呼ばれないため、メモリリークする</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 201</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> BaseOK <span class="op">{</span>  <span class="co">// OK デストラクタがvirtual</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        BaseOK<span class="op">()</span>          <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>BaseOK<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> DerivedOK <span class="op">:</span> <span class="kw">public</span> BaseOK <span class="op">{</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>        DerivedOK<span class="op">(</span><span class="dt">bool</span><span class="op">&amp;</span> destructed<span class="op">)</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>A<span class="op">&gt;(</span>destructed<span class="op">)}</span> <span class="op">{}</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>A<span class="op">&gt;</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 221</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_destructed <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>DerivedOK<span class="op">&gt;</span> d<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>DerivedOK<span class="op">&gt;(</span>a_destructed<span class="op">)};</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>a_destructed<span class="op">);</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>a_destructed<span class="op">);</span>  <span class="co">// OK A::~A()が呼ばれたため問題ない</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>BaseOK<span class="op">&gt;</span> d<span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span>DerivedOK<span class="op">&gt;(</span>a_destructed<span class="op">)};</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>a_destructed<span class="op">);</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>a_destructed<span class="op">);</span>  <span class="co">// OK A::~A()が呼ばれたため問題ない</span></span></code></pre></div>
<h4 id="インターフェースの継承">3.2.4.1 インターフェースの継承
<a id="SS_3_2_4_1"></a></h4>
<ul>
<li>クラス間に「Is-a」の関係が成り立つときに限りpublic継承を行う。
<ul>
<li>public継承を行う場合、<a
href="solid.html#SS_8_3">リスコフの置換原則(LSP)</a>を守る。</li>
<li>インターフェースを継承しない場合、public継承をしない。</li>
</ul></li>
<li>C#やJavaのinterfaceが必要ならば(インタフェースと実装の完全分離をしたい場合等)、
pure-virtualなメンバ関数のみを宣言したクラス (もしくはそのクラスに<a
href="design_pattern.html#SS_9_8">NVI(non virtual
interface)</a>を適用したクラス) を定義する。</li>
</ul>
<h4 id="多重継承">3.2.4.2 多重継承 <a id="SS_3_2_4_2"></a></h4>
<ul>
<li>それが不可避でない限り、多重継承は使用しない。</li>
<li>多重継承を使用する場合、複数個の基底クラスのうち、一つを除きメンバ変数を持ってはならない。</li>
<li>多重継承を使用する場合、継承階層内に同じ基底クラスが複数回出てきてはならない
(ダイヤモンド継承をしない)。</li>
<li>やむを得ずダイヤモンド継承をせざるを得ない場合、
継承階層内に複数回出現する基底クラスにはvirtual継承を行う。</li>
<li>virtual継承を行ったクラスのコンストラクタからは、
virtual基底クラスのコンストラクタを呼び出すようにする
(こうしないとvirtual基底クラスは初期化されない)。</li>
</ul>
<h3 id="非静的なメンバ変数定数の初期化">3.2.5
非静的なメンバ変数/定数の初期化 <a id="SS_3_2_5"></a></h3>
<ul>
<li>[定義] 非静的なメンバ変数の初期化には下記の3つの方法がある。
<ul>
<li>初期化方法０: 非静的メンバ変数の初期化子による初期化(<a
href="term_explanation.html#SS_18_2_6">NSDMI</a>)</li>
<li>初期化方法１: コンストラクタの非静的メンバ初期化子による初期化</li>
<li>初期化方法２:
コンストラクタ内での非静的なメンバ変数の初期値の代入</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb59"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 243</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A0 <span class="op">{</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        A0<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">b_</span><span class="op">{</span><span class="dv">0</span><span class="op">}</span>    <span class="co">// 初期化方法１</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>            <span class="va">c_</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>     <span class="co">// 初期化方法２</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">a_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span> <span class="co">// 初期化方法０</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">c_</span><span class="op">;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>[注意]
初期化方法０と、初期化方法１が同一変数に行われた場合、初期化方法０は実行されない。</li>
<li>すべての非静的なメンバ変数は、コンストラクタ終了時までに明示的に初期化する。</li>
<li>多くのコンパイラや静的解析ツールは、
初期化方法０、１による初期化の漏れについては容易に発見、指摘できるが、
初期化方法２による初期化の漏れについては、発見が難しい場合がある。
また、constメンバ変数は、初期化方法２では初期化できないため、
それ以外に方法がない場合を除き、初期化方法２の使用を避ける。</li>
<li>非静的なメンバ変数はクラス内で定義された順序に従い初期化されるため、
初期化方法１で羅列される初期化の順序を定義順序と同じにする
(初期化方法１での初期化の順序は、実際の初期化の順序とは関係がない)。</li>
</ul>
<div class="sourceCode" id="cb60"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 262</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A_NG <span class="op">{</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        A_NG<span class="op">(</span><span class="dt">int32_t</span> x<span class="op">,</span> <span class="dt">int32_t</span> y<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">b_</span><span class="op">{</span>x <span class="op">+</span> y<span class="op">},</span> <span class="va">a_</span><span class="op">{</span>x<span class="op">},</span> <span class="va">c_</span><span class="op">{</span>y<span class="op">}</span> <span class="co">// NG メンバ変数定義と初期化の順序が違う</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">;</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">c_</span><span class="op">;</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A_OK <span class="op">{</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>        A_OK<span class="op">(</span><span class="dt">int32_t</span> x<span class="op">,</span> <span class="dt">int32_t</span> y<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>x<span class="op">},</span> <span class="va">b_</span><span class="op">{</span>x <span class="op">+</span> y<span class="op">},</span> <span class="va">c_</span><span class="op">{</span>x<span class="op">}</span>  <span class="co">// OK</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">;</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">c_</span><span class="op">;</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>クラスがただ一つのコンストラクタを持つ場合、初期化方法０と初期化方法１を混在させない。
従って、初期化方法１を必要とするメンバ変数が一つでもある場合は、
すべての変数の初期化を初期化方法１で行う。</li>
</ul>
<div class="sourceCode" id="cb61"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 291</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A1 <span class="op">{</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        A1<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{}</span>  <span class="co">// OK 初期化方法０に統一</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="at">const</span> <span class="va">a_</span><span class="op">{</span><span class="dv">1</span><span class="op">};</span>  <span class="co">// OK 初期化方法０による初期化。</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                              <span class="co">//    ただし、static constexprにすべき。</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">[</span><span class="dv">2</span><span class="op">]{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span>  <span class="co">// OK 初期化方法０による初期化</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">c_</span><span class="op">{</span><span class="dv">5</span><span class="op">};</span>        <span class="co">// OK 初期化方法０による初期化</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A2 <span class="op">{</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> A2<span class="op">(</span><span class="dt">int</span> a<span class="op">)</span> <span class="kw">noexcept</span>   <span class="co">// OK 初期化方法１に統一</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">},</span> <span class="va">b_</span><span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="va">c_</span><span class="op">{</span><span class="dv">5</span><span class="op">}</span>  <span class="co">// OK 初期化方法１による初期化</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="at">const</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span>       <span class="va">b_</span><span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span>       <span class="va">c_</span><span class="op">;</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A3 <span class="op">{</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> A3<span class="op">(</span><span class="dt">int</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">}</span>  <span class="co">// NG 初期化方法の混在</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">c_</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// NG 初期化方法０、１使用可能にもかかわらず初期化方法２を使用している</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="at">const</span> <span class="va">a_</span><span class="op">;</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span>       <span class="va">b_</span><span class="op">[</span><span class="dv">2</span><span class="op">]{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span>  <span class="co">// NG 初期化方法の混在</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span>       <span class="va">c_</span><span class="op">;</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>クラスが複数のコンストラクタを持つ場合、すべてのメンバ変数に対して初期化方法０を行い(デフォルト値の設定)、
デフォルト値とは異なる初期値を持つ変数に対してのみ、コンストラクタ毎に初期化方法１を行う。</li>
</ul>
<div class="sourceCode" id="cb62"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 331</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A4 <span class="op">{</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        A4<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{}</span>  <span class="co">// OK 初期化方法０</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        A4<span class="op">(</span><span class="dt">int32_t</span> e<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">e_</span><span class="op">{</span>e<span class="op">}</span> <span class="op">{}</span>  <span class="co">// OK 初期化方法１によるe_の上書き</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 注) A4()とA4(int32_t)はデフォルト引数を使用すれば統一できるが、</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 例の単純化のためにあえてそれぞれを定義している。</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">d_</span><span class="op">{</span><span class="dv">5</span><span class="op">};</span>  <span class="co">// OK 初期化方法０による初期化</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">e_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span>  <span class="co">// OK 初期化方法０による初期化</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li><a
href="exercise_q.html#SS_19_2_3">演習-メンバ変数の初期化方法の選択</a></li>
<li><a href="exercise_q.html#SS_19_2_4">演習-メンバの型</a></li>
<li><a href="exercise_q.html#SS_19_2_5">演習-メンバ変数の初期化</a></li>
</ul>
<h3 id="静的なメンバ変数定数の初期化">3.2.6
静的なメンバ変数/定数の初期化 <a id="SS_3_2_6"></a></h3>
<ul>
<li>静的な(且つconstexprでない)メンバ変数は、ヘッダファイルで宣言し、.cppで定義、初期化する。</li>
<li>クラス宣言内で初期化される基本型のstatic
constメンバ定数を定義しない。 代わりに、static
constexprメンバ定数として定義、初期化する
(クラス宣言外で初期化されるメンバ定数はstatic constにする)。</li>
<li>privateなstatic constexprメンバ定数は、
そのクラスが宣言されているヘッダファイル内で依存されている場合のみ使用する。</li>
<li>privateなstatic
constexprメンバ定数がヘッダファイル内で依存されていない場合は、
.cppの無名名前空間内で定義、初期化する
(つまり、クラスのメンバとして定義しない。こうすることで不要なコンパイルが防げる)。</li>
</ul>
<div class="sourceCode" id="cb63"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class.h 5</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> StaticConstexprVar <span class="op">{</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        StaticConstexprVar<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> MultiplyBy2<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> MultiplyBy3<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> static_constexpr_var_3 <span class="op">*</span> a<span class="op">;</span> <span class="op">}</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> MultiplyBy4<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">uint32_t</span> static_constexpr_var_2<span class="op">{</span><span class="dv">2</span><span class="op">};</span>  <span class="co">// NG クラス内で定義する必要なし</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">uint32_t</span> static_constexpr_var_3<span class="op">{</span><span class="dv">3</span><span class="op">};</span>  <span class="co">// OK クラス内で定義する必要あり</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 351</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> StaticConstexprVar<span class="op">::</span>MultiplyBy2<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> static_constexpr_var_2 <span class="op">*</span> a<span class="op">;</span> <span class="op">}</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> <span class="op">{</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">uint32_t</span> static_constexpr_var_4<span class="op">{</span><span class="dv">4</span><span class="op">};</span>  <span class="co">// OK クラス内で定義する必要なし</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> StaticConstexprVar<span class="op">::</span>MultiplyBy4<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> static_constexpr_var_4 <span class="op">*</span> a<span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<h3 id="mutableなメンバ変数">3.2.7 mutableなメンバ変数
<a id="SS_3_2_7"></a></h3>
<ul>
<li>排他制御用(std::mutex等)や計算データのキャッシュ用等のメンバ変数を除き、
メンバ変数をmutableと宣言しない。</li>
</ul>
<div class="sourceCode" id="cb65"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 365</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> GetValue<span class="op">()</span> <span class="at">const</span>  <span class="co">// OK GetValue()をconstにするためにmutex_はmutable</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> lock <span class="op">=</span> <span class="bu">std::</span>lock_guard<span class="op">{</span><span class="va">mutex_</span><span class="op">};</span>  <span class="co">// constでない関数std::mutex::lock()の呼び出し</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">v_</span><span class="op">;</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> AddValue<span class="op">(</span><span class="dt">uint32_t</span> v<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> lock <span class="op">=</span> <span class="bu">std::</span>lock_guard<span class="op">{</span><span class="va">mutex_</span><span class="op">};</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">v_</span> <span class="op">+=</span> v<span class="op">;</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">mutable</span> <span class="bu">std::</span>mutex<span class="op"> </span><span class="va">mutex_</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span>           <span class="va">v_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<h3 id="スライシング">3.2.8 スライシング <a id="SS_3_2_8"></a></h3>
<ul>
<li><p>オブジェクトの<a
href="term_explanation.html#SS_18_3_3">スライシング</a>には以下のいずれかで対処する。</p>
<ul>
<li><a
href="design_pattern.html#SS_9_7">Clone(仮想コンストラクタ)</a>を使用する。</li>
<li>copy代入演算子を= deleteする。</li>
</ul></li>
<li><p><a
href="term_explanation.html#SS_18_3_3">スライシング</a>と類似の問題が起こるため、
オブジェクトの配列をそのオブジェクトの基底クラスへのポインタに代入しない。</p></li>
<li><p><a href="exercise_q.html#SS_19_2_6">演習-スライシング</a></p></li>
</ul>
<h3 id="オブジェクトの所有権">3.2.9 オブジェクトの所有権
<a id="SS_3_2_9"></a></h3>
<ul>
<li>オブジェクトaの所有権 (「<a
href="term_explanation.html#SS_18_2_9">オブジェクトの所有権</a>」参照)を持つオブジェクトもしくは関数は、
オブジェクトaの解放責務を持つ。</li>
<li>オブジェクトaの所有権を持たないオブジェクトは、
オブジェクトaのハンドルをメンバ変数で保持することを出来る限り避ける (<a
href="design_pattern.html#SS_9_22">Observer</a>パターン等、このルール順守が困難な場合は多い)。</li>
<li>オブジェクトaがオブジェクトbにnewで生成された(もしくはstd::make_unique()で生成された)とすると、
<ul>
<li>オブジェクトaのポインタはstd::unique_ptr&lt;&gt;(「<a
href="design_pattern.html#SS_9_9">RAII(scoped
guard)</a>」参照)で保持する。</li>
<li>オブジェクトa(正確にはオブジェクトaを管理するstd::unique_ptr&lt;&gt;オブジェクト)の所有権は、
オブジェクトbが保持する。</li>
<li>オブジェクトbはオブジェクトaの解放責務を持つ(std::unique_ptr&lt;&gt;による自動解放)。</li>
<li>オブジェクトaの所有権を保持していないオブジェクトは、オブジェクトaを解放してはならない。</li>
<li>オブジェクトaの所有権を別のオブジェクトxへ移動させる場合、
std::unique_ptr&lt;&gt;とstd::move()を使用する。</li>
</ul></li>
<li><a href="exercise_q.html#SS_19_2_7">演習-オブジェクトの所有権</a></li>
</ul>
<h3 id="オブジェクトのライフタイム">3.2.10 オブジェクトのライフタイム
<a id="SS_3_2_10"></a></h3>
<ul>
<li><a
href="term_explanation.html#SS_18_2_10">オブジェクトのライフタイム</a>開始前、
もしくは終了後のオブジェクトにアクセスしない。</li>
</ul>
<div class="sourceCode" id="cb66"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 419</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 初期化前にオブジェクトにアクセスしてしまう例</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    B<span class="op">&amp;</span> getB<span class="op">()</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bが初期される前に(ライフタイム開始前)に、a.A::A()が呼び出される。</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a.A::A()が呼び出される前に、getB()が呼び出される。</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 従って、bが初期化される前にgetB()が未初期化のbのリファレンスを返してしまう。</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    A a<span class="op">{</span>getB<span class="op">()};</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    B  b<span class="op">;</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    B<span class="op">&amp;</span> getB<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<ul>
<li>オブジェクトaが所有権を持たないオブジェクトbへのハンドルをa自体のメンバ変数で保持する場合、
オブジェクトbのライフタイムが終了する前に、
オブジェクトaがオブジェクトbにアクセスできないようにする(Observerパターンのdetachメンバ関数等)。</li>
</ul>
<div class="sourceCode" id="cb67"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 435</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ライフタイムが終了したオブジェクトにアクセスしてしまう例</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a <span class="op">=</span> A<span class="op">{};</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> b <span class="op">=</span> B<span class="op">{};</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>        a<span class="op">.</span>SetB<span class="op">(&amp;</span>b<span class="op">);</span>  <span class="co">// NG aのメンバ変数へ&amp;bを代入。</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>                <span class="co">//    この行でbのライフタイム終了。</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    a<span class="op">.</span>DoSomething<span class="op">();</span>  <span class="co">// NG bのポインタを使用して何かすると不定動作。</span></span></code></pre></div>
<ul>
<li>スタック上のオブジェクトのハンドルをその関数外部へ開示しない
(そのハンドルは、ライフタイムが終了したオブジェクトを指している)。</li>
<li>thread_localオブジェクトは、ログやデバッグ用途のみで使用する。</li>
<li><a
href="term_explanation.html#SS_18_5_3">rvalue</a>はライフタイム終了間際のオブジェクトであるため、
関数の仮引数以外のリファレンスでrvalueをバインドしない
(特にリファレンス型のメンバ変数でrvalueをバインドしないことは重要である)。
rvalueをリファレンス型の引数で受け取る場合はconstリファレンス、
もしくはrvalueリファレンス(T&amp;&amp;)を使用する(「<a
href="programming_convention.html#SS_3_1_13">rvalue</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb68"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 466</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f0<span class="op">(</span>E<span class="op">&amp;)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f1<span class="op">(</span>E <span class="at">const</span><span class="op">&amp;)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f2<span class="op">(</span>E<span class="op">&amp;&amp;)</span> <span class="kw">noexcept</span><span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb69"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 475</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f0(E{});  NG ほとんどのコンパイラではエラー</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    f1<span class="op">(</span>E<span class="op">{});</span>  <span class="co">// OK rvalueはconstリファレンスにバインド可</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    f2<span class="op">(</span>E<span class="op">{});</span>  <span class="co">// OK rvalueはrvalueリファレンス</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    E <span class="at">const</span><span class="op">&amp;</span> a0 <span class="op">=</span> E<span class="op">{</span><span class="st">&quot;4&quot;</span><span class="op">};</span>  <span class="co">// NG rvalueを引数以外のconstリファレンスに代入</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    E<span class="op">&amp;&amp;</span>      a1 <span class="op">=</span> E<span class="op">{</span><span class="st">&quot;5&quot;</span><span class="op">};</span>  <span class="co">// NG rvalueを引数以外のrvalueリファレンスに代入</span></span></code></pre></div>
<h2 id="非メンバ関数メンバ関数">3.3 非メンバ関数/メンバ関数
<a id="SS_3_3"></a></h2>
<h3 id="非メンバ関数">3.3.1 非メンバ関数 <a id="SS_3_3_1"></a></h3>
<ul>
<li><p>下記のような関数を除き、グローバル名前空間に非メンバ関数を定義しない。</p>
<ul>
<li>C言語から呼び出される関数</li>
<li>アセンブラ関数</li>
</ul></li>
<li><p>.cppファイルから、そのファイルの外部で定義された関数を呼び出す場合、
その.cppファイル内での局所的な関数宣言をしない
(関数が宣言、定義されているヘッダファイルをインクルードする)。</p></li>
<li><p>コンパイル時に戻り値が確定する関数はconstexprと宣言する。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_1">演習-非メンバ関数の宣言</a></p></li>
</ul>
<h3 id="メンバ関数">3.3.2 メンバ関数 <a id="SS_3_3_2"></a></h3>
<ul>
<li>可能な場合(メンバに直接アクセスしない場合)、メンバ関数をstaticにする。</li>
<li>コンパイル時に戻り値が確定するメンバ関数はconstexprと宣言する。</li>
<li>オブジェクトの状態を変えないメンバ関数は、constと宣言する。
<ul>
<li>getter(下記の例ではGetString)はconstと宣言する。</li>
<li>下記のSetPtrのような関数はconstにしない。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb70"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 19</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">()</span> <span class="op">:</span> <span class="va">s_ptr_</span><span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;(</span><span class="st">&quot;haha&quot;</span><span class="op">)},</span> <span class="va">s_inst_</span><span class="op">{</span><span class="st">&quot;hihi&quot;</span><span class="op">}</span> <span class="op">{}</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> GetString<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span>  <span class="co">// OK 必ずconst</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">s_inst_</span><span class="op">;</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// SetPtrと、SetInstは実質的には同じことを行っている。</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// SetInstはconstと宣言できない(コンパイルエラー)。</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 従ってSetPtrもconstと宣言してはならない。</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// なお、この問題はstd::experimental::propagate_constを使用することで解決できるが、</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 名前空間からわかるように、このライブラリが将来にわたって有効かどうかは不明である。</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> SetPtr<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>name<span class="op">)</span> <span class="at">const</span>  <span class="co">// NG このconstはつけてはならない。</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span><span class="va">s_ptr_</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> SetInst<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>name<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">s_inst_</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">s_ptr_</span><span class="op">;</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span>                 <span class="va">s_inst_</span><span class="op">;</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>        A <span class="at">const</span> a<span class="op">;</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>        a<span class="op">.</span>SetPtr<span class="op">(</span><span class="st">&quot;0&quot;</span><span class="op">);</span>  <span class="co">// constオブジェクトaを変更できてしまう。</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  a.SetInst(&quot;1&quot;); // constオブジェクトaを変更しようとしたため、</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// 正しく(constの目的通り)コンパイルエラー。</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>クラス内部のハンドル（ポインタやリファレンス）を戻り値に使用しない。
<ul>
<li>それが避けがたい場合は、戻り値のハンドルをconstにする。</li>
<li>ハンドルがconstにできない場合(関数が非constなハンドルを返す場合)、
そのハンドル経由でクラスの状態を変更できるため、その関数をconstにしない。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb71"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 62</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> B <span class="op">{</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>        B<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{}</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// GetStringsは、避けがたい理由で、strings_のリファレンスを返さざるを得ないとする。</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// この場合、GetStringsはconstにしてはならない。</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&amp;</span> GetStrings<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">strings_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">strings_</span><span class="op">{};</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>非静的メンバのハンドルを返すメンバ関数を持つオブジェクトが <a
href="term_explanation.html#SS_18_5_3">rvalue</a>である場合、
そのオブジェクトからその関数を呼び出した戻り値(メンバへのハンドル)を変数で保持しない
(そのハンドルは無効なオブジェクトを指している)。
そういった使用方法が必要ならばlvalue修飾、<a
href="term_explanation.html#SS_18_5_4">rvalue修飾</a>を用いたオーバーロード関数を定義する。</li>
</ul>
<div class="sourceCode" id="cb72"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 82</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> s <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;hehe&quot;</span><span class="op">}.</span>c_str<span class="op">();</span>  <span class="co">// std::string{&quot;hehe&quot;}はrvalue</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> s <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>  <span class="co">// この時点ではsは解放されている。</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_3_2">演習-メンバ関数の修飾</a></li>
</ul>
<h4 id="特殊メンバ関数">3.3.2.1 特殊メンバ関数
<a id="SS_3_3_2_1"></a></h4>
<ul>
<li><a href="term_explanation.html#SS_18_2_1">特殊メンバ関数</a>
<ul>
<li>デフォルトコンストラクタ</li>
<li>copyコンストラクタ</li>
<li>copy代入演算子(operator =)</li>
<li>moveコンストラクタ</li>
<li>move代入演算子</li>
<li>デストラクタ</li>
</ul>
について、デフォルトコンストラクタ以外を定義する場合、
その他の関数には以下のいずれかを選択する(不要な代入演算子を=
deleteすることは特に重要である)。</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">コンパイラ生成関数を</th>
<th>定義方法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">使用する</td>
<td>= default</td>
</tr>
<tr class="even">
<td style="text-align: center;">使用しない</td>
<td>= delete、もしくは自分で実装</td>
</tr>
</tbody>
</table>
<ul>
<li>クラスを宣言、定義する場合、下記のClassStationery(クラスのひな形)を参考にし、
不要なコンパイラ生成関数が作られないようにする。</li>
</ul>
<div class="sourceCode" id="cb73"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/class_ut.cpp 489</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@class</span><span class="co"> </span><span class="cv">ClassStationery</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="an">@brief</span><span class="co"> クラスのひな形。クラスを定義、宣言するときには、このクラスの下記6関数を適切に</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">///        定義、宣言すること。</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ClassStationery <span class="kw">final</span> <span class="op">{</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        ClassStationery<span class="op">()</span>  <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>ClassStationery<span class="op">()</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>        ClassStationery<span class="op">(</span>ClassStationery <span class="at">const</span><span class="op">&amp;)</span>                <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        ClassStationery<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>ClassStationery <span class="at">const</span><span class="op">&amp;)</span>     <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        ClassStationery<span class="op">(</span>ClassStationery<span class="op">&amp;&amp;)</span> <span class="kw">noexcept</span>            <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>        ClassStationery<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>ClassStationery<span class="op">&amp;&amp;)</span> <span class="kw">noexcept</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li><p>リソース管理等の都合からコンパイラが生成するデストラクタでは機能が不十分な場合、
プログラマがそのクラスのデストラクタを定義する。
この場合、コンパイラが生成するcopyコンストラクタ、copy代入演算子、moveコンストラクタ、
move代入演算子では機能が不十分であることが予測されるため、
これらを使用しない(「<a
href="design_pattern.html#SS_9_5">Copy-And-Swap</a>」参照)。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_3">演習-特殊メンバ関数の削除</a></p></li>
</ul>
<h4 id="コンストラクタ">3.3.2.2 コンストラクタ
<a id="SS_3_3_2_2"></a></h4>
<ul>
<li>クラスが複数の初期化方法を提供する場合でも、
デフォルト引数を使用し、できる限りコンストラクタを一つに集約する。</li>
<li>一つのコンストラクタに集約できない場合、<a
href="term_explanation.html#SS_18_2_4">委譲コンストラクタ</a>等により処理の重複を防ぐ。
<a
href="programming_convention.html#SS_3_2_5">非静的なメンバ変数/定数の初期化</a>処理の重複を避けることは特に重要である。</li>
<li>オブジェクトの初期化が完了するまでは派生クラスの仮想関数呼び出し等の
<a
href="programming_convention.html#SS_3_5_9">RTTI</a>機能を使うことはできないため(「<a
href="term_explanation.html#SS_18_2_11">クラスのレイアウト</a>」参照)、
コンストラクタの中でRTTI機能を使わない(デストラクタでも同様)。</li>
</ul>
<div class="sourceCode" id="cb74"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 95</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        Base<span class="op">(</span><span class="bu">std::</span>ostream<span class="op">&amp;</span> os<span class="op">)</span> <span class="op">:</span> <span class="va">os_</span><span class="op">{</span>os<span class="op">}</span> <span class="op">{</span> <span class="va">os_</span> <span class="op">&lt;&lt;</span> <span class="ot">__func__</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;-&quot;</span> <span class="op">&lt;&lt;</span> Name<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; -&gt; &quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Base<span class="op">()</span> <span class="op">{</span> <span class="va">os_</span> <span class="op">&lt;&lt;</span> <span class="ot">__func__</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;-&quot;</span> <span class="op">&lt;&lt;</span> Name<span class="op">();</span> <span class="op">}</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string_view<span class="op"> </span>Name<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="st">&quot;Base&quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span><span class="op">:</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ostream<span class="op">&amp;</span> <span class="va">os_</span><span class="op">;</span>  <span class="co">// protectedなメンバ変数を定義すべきではないが、コードの動作例示のため</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>        Derived<span class="op">(</span><span class="bu">std::</span>ostream<span class="op">&amp;</span> os<span class="op">)</span> <span class="op">:</span> Base<span class="op">{</span>os<span class="op">}</span> <span class="op">{</span> <span class="va">os_</span> <span class="op">&lt;&lt;</span> <span class="ot">__func__</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;-&quot;</span> <span class="op">&lt;&lt;</span> Name<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; -&gt; &quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Derived<span class="op">()</span> <span class="op">{</span> <span class="va">os_</span> <span class="op">&lt;&lt;</span> <span class="ot">__func__</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;-&quot;</span> <span class="op">&lt;&lt;</span> Name<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; -&gt; &quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string_view<span class="op"> </span>Name<span class="op">()</span> <span class="at">const</span> <span class="kw">override</span> <span class="op">{</span> <span class="cf">return</span> <span class="st">&quot;Derived&quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 122</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> oss <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> d <span class="op">=</span> Derived<span class="op">{</span>oss<span class="op">};</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="st">&quot;Base-Base -&gt; Derived-Derived -&gt; ~Derived-Derived -&gt; ~Base-Base&quot;</span><span class="op">,</span> oss<span class="op">.</span>str<span class="op">());</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// つまり、</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//          Base::Base()とBase::~Base()からは、Base::Name()が</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//          Derived::Derived()とDerived::~Derived()からは、Derived::Name()</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// が呼び出される。</span></span></code></pre></div>
<ul>
<li><p>クラスが解放責務を持つポインタ型メンバ変数を持つならば、copyコンストラクタ、
copy代入演算子に対して以下のいずれかを行い、<a
href="term_explanation.html#SS_18_3_1">シャローコピー</a>が行われないようにする
(このルールはファイルディスクリプタ等のリソース管理をするクラス全般に当てはまる)。</p>
<ul>
<li><a
href="term_explanation.html#SS_18_3_2">ディープコピー</a>をさせる。</li>
<li>= deleteする(「<a
href="programming_convention.html#SS_3_3_2_1">特殊メンバ関数</a>」参照)。</li>
</ul>
<p>またこの場合、moveコンストラクタ、move代入演算子の定義を検討する(「<a
href="design_pattern.html#SS_9_5">Copy-And-Swap</a>」参照)。</p></li>
<li><p><a
href="term_explanation.html#SS_18_2_5">非explitなコンストラクタによる暗黙の型変換</a>
が不要なクラスのコンストラクタに関しては、下記の目的のためにexplicitと宣言する。</p>
<ul>
<li>仮引数一つのコンストラクタに関しては、暗黙の型変換が行われないようにする。</li>
<li>仮引数二つ以上のコンストラクタに関しては、 代入演算子での<a
href="term_explanation.html#SS_18_2_7">一様初期化</a>ができないようにする。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb76"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 144</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A0 <span class="op">{</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NG int32_tからA0への暗黙の型変換が起こる。</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>        A0<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A1 <span class="op">{</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// OK int32_tからA1への暗黙の型変換をさせない。</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> A1<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A2 <span class="op">{</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NG 代入演算子でのリスト初期化ができてしまう。</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>        A2<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span><span class="op">*</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">},</span> <span class="va">b_</span><span class="op">{</span>b<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A3 <span class="op">{</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// OK 代入演算子でのリスト初期化をさせない。</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> A3<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span><span class="op">*</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">},</span> <span class="va">b_</span><span class="op">{</span>b<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f_A0<span class="op">(</span>A0<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{}</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f_A1<span class="op">(</span>A1<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{}</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f_A2<span class="op">(</span>A2<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{}</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f_A3<span class="op">(</span>A3<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{}</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 198</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>        A0 a0 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span>           <span class="co">// NG 1からA0への暗黙の型変換。</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                             <span class="co">//    このような変換はセマンティクス的不整合につながる場合がある。</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  A1 a1 = 1;           // OK explicitの効果で、意図通りコンパイルエラー。</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>        f_A0<span class="op">(</span><span class="dv">1</span><span class="op">);</span>             <span class="co">// NG 1からA0への暗黙の型変換のためf_A0が呼び出せてしまう。</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">        f_A1(1);             // OK explicitの効果で、意図通り以下のようなコンパイルエラー。</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">                             //    error: could not convert ‘1’ from ‘int’ to ‘A1’</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>        f_A1<span class="op">(</span>A1<span class="op">{</span><span class="dv">1</span><span class="op">});</span>         <span class="co">// OK f_A1の呼び出し</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> i <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>        A2  a2 <span class="op">=</span> <span class="op">{</span>i<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">};</span>    <span class="co">// NG 代入演算子でのリスト初期化をしている。</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  A3 a3 = { i, &amp;i };   // OK explicitの効果で、意図通りコンパイルエラー。</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>        A3 a3<span class="op">{</span>i<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">};</span>        <span class="co">// OK リスト初期化</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a4 <span class="op">=</span> A3<span class="op">{</span>i<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">};</span> <span class="co">// OK AAA</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>        f_A2<span class="op">({</span>i<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">});</span>       <span class="co">// NG { i, &amp;i }からA2への暗黙の型変換のためf_A2が呼び出せてしまう。</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co">        f_A3({i, &amp;i});       // OK explicitの効果で、意図通り以下のようなコンパイルエラー。</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="co">                             //    error: converting to A3 from initializer list would use explicit </span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co">                             //           constructor A3::A3(int32_t, int32_t*)’</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>        f_A3<span class="op">(</span>A3<span class="op">{</span>i<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">});</span>     <span class="co">// OK f_A3の呼び出し</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span></code></pre></div>
<ul>
<li><p>派生クラスが基底クラスの全コンストラクタを必要とする場合、 <a
href="term_explanation.html#SS_18_2_3">継承コンストラクタ</a>を使用する。</p></li>
<li><p>デフォルト引数はインターフェース関数の呼び出しを簡略化する目的で使用するべきであるため、
private関数にデフォルト引数を持たさない。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_4">演習-委譲コンストラクタ</a></p></li>
</ul>
<h4 id="copyコンストラクタcopy代入演算子">3.3.2.3
copyコンストラクタ、copy代入演算子 <a id="SS_3_3_2_3"></a></h4>
<ul>
<li>copyコンストラクタ、copy代入演算子は<a
href="term_explanation.html#SS_18_8_2">copyセマンティクス</a>に従わせる。</li>
<li>copyコンストラクタ、copy代入演算子の引数はconstリファレンスにする。</li>
<li><a href="term_explanation.html#SS_18_10_12">RVO(Return Value
Optimization)</a>により、
copyコンストラクタの呼び出しは省略されることがあるため、
copyコンストラクタ、copy代入演算子はコピー以外のことをしない。</li>
<li>copy代入演算子は<a
href="term_explanation.html#SS_18_5_5">lvalue修飾</a>をする。</li>
</ul>
<div class="sourceCode" id="cb78"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 239</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Widget <span class="op">{</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        Widget<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>Widget <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span>  <span class="co">// NG lvalue修飾無し</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        Widget<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>Widget<span class="op">&amp;&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// NG lvalue修飾無し</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 268</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    Widget w0<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    Widget w1<span class="op">{</span><span class="dv">2</span><span class="op">};</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    w0 <span class="op">=</span> w1<span class="op">;</span>         <span class="co">// これには問題ない</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    w1 <span class="op">=</span> Widget<span class="op">{</span><span class="dv">3</span><span class="op">};</span>  <span class="co">// これにも問題ない</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    Widget<span class="op">{</span><span class="dv">2</span><span class="op">}</span> <span class="op">=</span> w0<span class="op">;</span>  <span class="co">// NG lvalue修飾無しのcopy代入演算子であるため、コンパイルできる</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    Widget<span class="op">{</span><span class="dv">3</span><span class="op">}</span> <span class="op">=</span> Widget<span class="op">{</span><span class="dv">4</span><span class="op">};</span>  <span class="co">// NG lvalue修飾無しのmove代入演算子であるため、コンパイルできる</span></span></code></pre></div>
<div class="sourceCode" id="cb80"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 287</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Widget <span class="op">{</span>  <span class="co">// 上記の修正</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>        Widget<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>Widget <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="op">&amp;</span>  <span class="co">// OK lvalue修飾</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>        Widget<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>Widget<span class="op">&amp;&amp;</span> rhs<span class="op">)</span> <span class="op">&amp;</span> <span class="kw">noexcept</span>  <span class="co">// OK lvalue修飾</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb81"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 316</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    Widget w0<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    Widget w1<span class="op">{</span><span class="dv">2</span><span class="op">};</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Widget{2} = w0;          lvalue修飾の効果でコンパイルエラー</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Widget{3} = Widget{4};   lvalue修飾の効果でコンパイルエラー</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_3_5">演習-copyコンストラクタ</a></li>
</ul>
<h4 id="moveコンストラクタmove代入演算子">3.3.2.4
moveコンストラクタ、move代入演算子 <a id="SS_3_3_2_4"></a></h4>
<ul>
<li><p>moveコンストラクタ、move代入演算子は<a
href="term_explanation.html#SS_18_8_3">moveセマンティクス</a>に従わせ、
エクセプションをthrowさせない(「<a
href="programming_convention.html#SS_3_3_3_10">エクセプション処理</a>」参照)。</p></li>
<li><p>[注意] noexceptでないmoveコンストラクタ、
move代入演算子を持つクラスをSTLコンテナのtemplate引数として使用した場合、
moveコンストラクタ、move代入演算子の代わりに、
copyコンストラクタ、copy代入演算子が使用され、パフォーマンス問題を引き起こす場合がある。</p></li>
<li><p>move代入演算子はlvalue修飾(「<a
href="programming_convention.html#SS_3_3_2_3">copyコンストラクタ、copy代入演算子</a>」参照)をする。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_6">演習-moveコンストラクタ</a></p></li>
</ul>
<h4 id="初期化子リストコンストラクタ">3.3.2.5
初期化子リストコンストラクタ <a id="SS_3_3_2_5"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_2_2">初期化子リストコンストラクタ</a>は、コンテナクラスの初期化のためのみに定義する。</li>
<li>初期化子リストコンストラクタと同じ仮引数を取り得るコンストラクタを定義しない。</li>
</ul>
<h4 id="デストラクタ">3.3.2.6 デストラクタ <a id="SS_3_3_2_6"></a></h4>
<ul>
<li>デストラクタの中でRTTI機能を使わない(「<a
href="programming_convention.html#SS_3_3_2_2">コンストラクタ</a>」参照)。</li>
<li>デストラクタはnoexceptであり、throwするとプログラムが終了するため、デストラクタでthrowしない。</li>
</ul>
<h4 id="オーバーライド">3.3.2.7 オーバーライド
<a id="SS_3_3_2_7"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_10_1">オーバーライドとオーバーロードの違い</a>に注意する。</li>
<li>オーバーライドしたメンバ関数には、オーバーライドされたメンバ関数の機能の意味を踏襲させる。</li>
<li>オーバーライドする/される一連の仮想関数(デストラクタを含む)について、
<ul>
<li>全ての宣言にはvirtualを付ける。</li>
<li>一連の仮想関数の最初でも最後でもないものの宣言には、overrideを付ける。</li>
<li>一連の仮想関数の最後のものの宣言には、overrideを付けず、finalを付ける。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb82"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 334</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Base<span class="op">();</span>                   <span class="co">// OK</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span><span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> g<span class="op">()</span> <span class="kw">noexcept</span><span class="op">;</span>         <span class="co">// OK</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Derived_0::fは、Base::fのオーバーライドのつもりであったが、タイポのため新たな関数の宣言、</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 定義になってしまった。この手のミスは、自分で気づくのは難しい</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_0 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Derived_0<span class="op">();</span>               <span class="co">// NG overrideが必要</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> f<span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span>  <span class="co">// NG Derived_0:fはBase:fのオーバーライドではない</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> g<span class="op">()</span> <span class="kw">noexcept</span> <span class="kw">override</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_1 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NG 下記が必要</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// virtual ~Derived_1() override;</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> f<span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span> <span class="kw">override</span><span class="op">;</span>  <span class="co">// OK overrideと書いたことで、</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>                                            <span class="co">//    コンパイルできないため、タイポに気づく</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_2 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Derived_2<span class="op">()</span> <span class="kw">override</span><span class="op">;</span>                    <span class="co">// OK Derived_2はfinalではない</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span><span class="op">)</span> <span class="kw">noexcept</span> <span class="kw">override</span> <span class="kw">final</span><span class="op">;</span>  <span class="co">// NG overrideは不要</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> g<span class="op">()</span> <span class="kw">noexcept</span> <span class="kw">final</span><span class="op">;</span>  <span class="co">// OK これ以上オーバーライドしない</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>オーバーライド元の関数とそのオーバーライド関数のデフォルト引数の値は一致させる。
オーバーライド元の関数にデフォルト引数を持たせないのであれば、
そのオーバーライド関数にもデフォルト引数を持たせない。</li>
</ul>
<div class="sourceCode" id="cb83"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 373</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> GetArg<span class="op">(</span><span class="dt">int32_t</span> a <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a<span class="op">;</span> <span class="op">}</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NG Base::GetArgのデフォルト引数と違う</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> GetArg<span class="op">(</span><span class="dt">int32_t</span> a <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="kw">override</span> <span class="op">{</span> <span class="cf">return</span> a<span class="op">;</span> <span class="op">}</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb84"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 397</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>  d <span class="op">=</span> Derived<span class="op">{};</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    Base<span class="op">&amp;</span> b<span class="op">{</span>d<span class="op">};</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 同じオブジェクトであるにもかかわらず、その表層型でデフォルト引数の値が変わってしまう。</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">0</span><span class="op">,</span> b<span class="op">.</span>GetArg<span class="op">());</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> d<span class="op">.</span>GetArg<span class="op">());</span></span></code></pre></div>
<ul>
<li><p>privateやprotectedなオーバーライド関数にはデフォルト引数を持たさない
(「<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>」参照)。
さらに<a href="design_pattern.html#SS_9_8">NVI(non virtual
interface)</a>にも従うことにより、
上の条項の示した一連のオーバーライド関数のデフォルト引数の一致について考慮の必要がなくなり、
且つこのクラスのユーザはデフォルト引数が使用できるようになる。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_8">演習-オーバーライド関数の修飾</a></p></li>
</ul>
<h3 id="非メンバ関数メンバ関数共通">3.3.3 非メンバ関数/メンバ関数共通
<a id="SS_3_3_3"></a></h3>
<h4 id="サイクロマティック複雑度">3.3.3.1 サイクロマティック複雑度
<a id="SS_3_3_3_1"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_11_2">サイクロマティック複雑度</a>は15以下が好ましい。</li>
<li>特別な理由がない限り、サイクロマティック複雑度は20以下にする。</li>
</ul>
<h4 id="行数-1">3.3.3.2 行数 <a id="SS_3_3_3_2"></a></h4>
<ul>
<li>10行程度が好ましい。</li>
<li>特別な理由がない限り、30行以下で記述する。</li>
<li>[注意] C++の創始者であるビャーネ・ストラウストラップ氏は、 <a
href="https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9EC-%E7%AC%AC4%E7%89%88-%E3%83%93%E3%83%A3%E3%83%BC%E3%83%8D%E3%83%BB%E3%82%B9%E3%83%88%E3%83%A9%E3%82%A6%E3%82%B9%E3%83%88%E3%83%A9%E3%83%83%E3%83%97-ebook/dp/B01BGEO9MS">プログラミング言語C++
第4版</a> の中で、下記のように述べている。</li>
</ul>
<pre><code>    約 40 行を関数の上限にすればよい。 
    私自身は、もっと小さい平均 7 行程度を理想としている。 </code></pre>
<ul>
<li><a href="exercise_q.html#SS_19_3_7">演習-関数分割</a></li>
</ul>
<h4 id="オーバーロード">3.3.3.3 オーバーロード
<a id="SS_3_3_3_3"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_10_1">オーバーライドとオーバーロードの違い</a>に注意する。</li>
<li>オーバーロードされた関数は実行目的を同じにする。
異なる目的のためには異なる名前の関数を用意する。</li>
<li><a
href="programming_convention.html#SS_3_3_2_7">オーバーライド</a>を除き、基底クラスのメンバ関数と同じ名前を持つメンバ関数を派生クラスで宣言、
定義しない。 これに反すると<a
href="term_explanation.html#SS_18_4_8">name-hiding</a>のため、基底クラスのメンバ関数の可視範囲を縮小させてしまう。</li>
</ul>
<div class="sourceCode" id="cb86"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 411</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NGな例</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Base<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> DerivedNG <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// NG DerivedNG::f(int32_t)がBase::fを隠す(可視範囲の縮小)</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> d <span class="op">=</span> DerivedNG<span class="op">{};</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span>f<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a><span class="co">        d.f(); // NG DerivedNG::f(int32_t)がBase::fを隠す(可視範囲の縮小)ためコンパイルエラー</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DerivedNGの修正</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> DerivedOK <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> Base<span class="op">::</span>f<span class="op">;</span>  <span class="co">// OK Base::fをDerivedOKに導入。</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> g<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> d <span class="op">=</span> DerivedOK<span class="op">{};</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span>f<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span>f<span class="op">();</span>  <span class="co">// OK usingにより、Base::fが見える</span></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>仮引数の型が互いに暗黙に変換できるオーバーロード関数の定義、使用には気を付ける。</li>
</ul>
<div class="sourceCode" id="cb87"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 468</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">(</span><span class="dt">int32_t</span><span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">(</span><span class="dt">int16_t</span><span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb88"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 476</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> i16 <span class="op">=</span> <span class="dt">int16_t</span><span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> f<span class="op">(</span>i16<span class="op">));</span>        <span class="co">// f(int16_t)が呼ばれる</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">0</span><span class="op">,</span> f<span class="op">(</span>i16 <span class="op">+</span> i16<span class="op">));</span>  <span class="co">// f(int32_t)が呼ばれる</span></span></code></pre></div>
<ul>
<li>暗黙の型変換による関数の使用範囲の拡張を防ぐには、オーバーロード関数を=
deleteする。</li>
</ul>
<div class="sourceCode" id="cb89"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 488</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 実引数がdoubleを認めないパターン</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f0<span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f0<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">/</span> <span class="dv">2</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 実引数がint32_t以外を認めないパターン</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f1<span class="op">(</span>T<span class="op">)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f1<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">/</span> <span class="dv">2</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 実引数がunsigned以外を認めないパターン</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;!</span><span class="bu">std::</span>is_unsigned_v<span class="op">&lt;</span>T<span class="op">&gt;&gt;*</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">&gt;</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> f2<span class="op">(</span>T<span class="op">)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span><span class="bu">std::</span>is_unsigned_v<span class="op">&lt;</span>T<span class="op">&gt;&gt;*</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">&gt;</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> f2<span class="op">(</span>T t<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> f2_impl<span class="op">(</span><span class="dt">uint64_t</span><span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tがsignedで、tが-1のような値の場合、f2_impl(uint64_t)の呼び出しによる算術変換により、</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// tは巨大な値に変換されるが、</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tがunsignedならば、f2_impl(uint64_t)の呼び出しによる算術変換は安全</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f2_impl<span class="op">(</span>t<span class="op">);</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb90"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 518</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>     c<span class="op">{</span><span class="ch">&#39;c&#39;</span><span class="op">};</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int8_t</span>   i8<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span>  i32<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> ui32<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> ui64<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span>   d<span class="op">{</span><span class="fl">1.0</span><span class="op">};</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    f0<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    f0<span class="op">(</span>i8<span class="op">);</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    f0<span class="op">(</span>i32<span class="op">);</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f0(d);    呼び出そうとしたf0(double)はdeleteされているので意図通りエラー</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    f1<span class="op">(</span>i32<span class="op">);</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f1(u32);  呼び出そうとしたf1&lt;uint32_t&gt;(uint32_t)はdeleteされているので意図通りエラー</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    f2<span class="op">(</span>ui32<span class="op">);</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    f2<span class="op">(</span>ui64<span class="op">);</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f2(c);    呼び出そうとしたf2&lt;char&gt;(char)はdeleteされているので意図通りエラー</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f2(i32);  呼び出そうとしたf2&lt;int32_t&gt;(int32_t)はdeleteされているので意図通りエラー</span></span></code></pre></div>
<ul>
<li><a
href="exercise_q.html#SS_19_3_9">演習-オーバーライド/オーバーロード</a><br />
</li>
<li><a
href="exercise_q.html#SS_19_3_10">演習-オーバーロードによる誤用防止</a></li>
</ul>
<h4 id="演算子オーバーロード">3.3.3.4 演算子オーバーロード
<a id="SS_3_3_3_4"></a></h4>
<ul>
<li>演算子をオーバーロードする場合、
<ul>
<li>単項演算子はメンバ関数で定義する。</li>
<li>二項演算子は非メンバ関数で定義する。</li>
</ul></li>
<li>&amp;&amp;, ||, カンマ(,)をオーバーロードしない。</li>
<li>型変換オペレータの宣言、定義を多用しない。</li>
<li>boolへの型変換オペレータは、explicit付きで定義する。</li>
</ul>
<div class="sourceCode" id="cb91"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 547</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A0 <span class="op">{</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">operator</span> <span class="dt">bool</span><span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span>  <span class="co">// NG intへの型変換が可能</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">state_</span><span class="op">;</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> <span class="va">state_</span><span class="op">{</span><span class="kw">true</span><span class="op">};</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A1 <span class="op">{</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> <span class="kw">operator</span> <span class="dt">bool</span><span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span>  <span class="co">// OK explicitすることで誤使用を避ける。</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">state_</span><span class="op">;</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> <span class="va">state_</span><span class="op">{</span><span class="kw">true</span><span class="op">};</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a0 <span class="op">=</span> A0<span class="op">{};</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a1 <span class="op">=</span> A1<span class="op">{};</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> a0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// NG コンパイルできてしまう。</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a><span class="co">        std::cout &lt;&lt; a1 + 1;  // OK 意図通りコンパイルエラー</span></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>演算子をオーバーロードする場合、それが自然に使えるようにする。
<ul>
<li>operator == を定義するならば、operator != も定義する（&lt;,
&gt;等のその他の例も同様）。</li>
<li>operator+ を定義するならば、operator +=
も定義する(+以外も同様)。</li>
<li>copy(またはmove)代入演算子を定義する場合、copy(またはmove)コンストラクタも定義する
(その際、コードクローンを作りがちなので注意する(「<a
href="design_pattern.html#SS_9_5">Copy-And-Swap</a>」参照))。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb92"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 586</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Integer <span class="op">{</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>        Integer<span class="op">(</span><span class="dt">int32_t</span> integer<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">integer_</span><span class="op">{</span>integer<span class="op">}</span> <span class="op">{}</span>  <span class="co">// int32_tの暗黙の型変換が必要なのでexplicitしない</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// copyコンストラクタ、copy代入演算子の定義</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>        Integer<span class="op">(</span>Integer <span class="at">const</span><span class="op">&amp;)</span>            <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>        Integer<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>Integer <span class="at">const</span><span class="op">&amp;)</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>Integer lhs<span class="op">,</span> Integer rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> lhs<span class="op">.</span><span class="va">integer_</span> <span class="op">==</span> rhs<span class="op">.</span><span class="va">integer_</span><span class="op">;</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>        Integer<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">+=(</span>Integer rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">integer_</span> <span class="op">+=</span> rhs<span class="op">.</span><span class="va">integer_</span><span class="op">;</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">integer_</span><span class="op">;</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">!=(</span>Integer lhs<span class="op">,</span> Integer rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">!(</span>lhs <span class="op">==</span> rhs<span class="op">);</span>  <span class="co">// operator==の活用</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> Integer <span class="kw">operator</span><span class="op">+(</span>Integer lhs<span class="op">,</span> Integer rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>        lhs <span class="op">+=</span> rhs<span class="op">;</span>  <span class="co">// operator+=の活用</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lhs<span class="op">;</span></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a
href="term_explanation.html#SS_18_1_16">ユーザ定義リテラル演算子</a>のサフィックスには、
アンダーバーから始まる3文字以上の文字列を使用する。</li>
</ul>
<div class="sourceCode" id="cb93"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 628</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> one_km<span class="op">{</span><span class="dv">1000</span><span class="op">};</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ユーザ定義リテラル演算子の定義</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> <span class="kw">operator</span><span class="st">&quot;&quot;</span>_kilo_meter<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num_by_mk<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> num_by_mk <span class="op">*</span> one_km<span class="op">;</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> <span class="kw">operator</span><span class="st">&quot;&quot;</span> <span class="er">km</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num_by_mk<span class="op">)</span>  <span class="co">// NG STDでリザーブ</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> num_by_mk <span class="op">*</span> one_km<span class="op">;</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> <span class="kw">operator</span><span class="st">&quot;&quot;</span>_meter<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num_by_m<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> num_by_m<span class="op">;</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> <span class="kw">operator</span><span class="st">&quot;&quot;</span>_m<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num_by_m<span class="op">)</span>  <span class="co">// NG 短すぎる</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> num_by_m<span class="op">;</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb94"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 656</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> km <span class="op">=</span> <span class="dt">int32_t</span><span class="op">{</span><span class="dv">3_kilo_meter</span><span class="op">};</span>  <span class="co">// ユーザ定義リテラル演算子の利用</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> m  <span class="op">=</span> <span class="dt">int32_t</span><span class="op">{</span><span class="dv">3000_meter</span><span class="op">};</span>    <span class="co">// ユーザ定義リテラル演算子の利用</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>m<span class="op">,</span> km<span class="op">);</span></span></code></pre></div>
<h4 id="実引数仮引数">3.3.3.5 実引数/仮引数 <a id="SS_3_3_3_5"></a></h4>
<ul>
<li>仮引数(「<a
href="term_explanation.html#SS_18_10_2">実引数/仮引数</a>」参照)の数は、4個程度を上限とする。</li>
<li>仮引数を関数の戻り値として利用しない場合
(且つ仮引数が関数テンプレートの<a
href="term_explanation.html#SS_18_6_1">ユニバーサルリファレンス</a>でない場合)、
<ul>
<li>基本型やその型のエイリアス、enumは値渡しにする。</li>
<li>それ以外のオブジェクトはconstリファレンス渡しにする (「<a
href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a>」参照)。
ただし、数バイトの小さいオブジェクトは値渡ししても良い。</li>
<li>「引数がnullptrである場合の処理をその関数が行う」場合、constポインタ渡しにする。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb95"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 674</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="kw">enum</span> EnumArg b<span class="op">,</span> NotSmall <span class="at">const</span><span class="op">&amp;</span> c<span class="op">,</span> Small d<span class="op">,</span> NotSmall <span class="at">const</span><span class="op">*</span> e<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// a : 基本型</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// b : enum</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// c : サイズが小さくないオブジェクトで、nullptrでないことが前提</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// d : サイズ小さいオブジェクト</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// e : サイズが小さくないオブジェクトを指すが、nullptrである場合も処理の対象</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>e <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>[注意]
仮引数をconstリファレンス渡しやconstポインタ渡しにすることで、</p>
<ul>
<li>値渡しに比べて、ランタイムでの処理が速くなる。</li>
<li>リファレンスやポインタ経由で引数に使用されたオブジェクトが変更されるのを防ぐ
(値渡しであれば引数に使用されたオブジェクトが変更されることはない)。</li>
</ul></li>
<li><p>仮引数を関数の戻り値として利用する場合、</p>
<ul>
<li>「関数が、仮引数がnullptrである場合の処理を行う」場合、ポインタ渡しにする。</li>
<li>「関数が、仮引数がnullptrでないことを前提している」場合、リファレンス渡しにする。</li>
</ul></li>
<li><p><a
href="term_explanation.html#SS_18_6_1">ユニバーサルリファレンス</a>を仮引数とする関数テンプレートでは、
仮引数を関数の戻り値として利用しない場合でも、仮引数は非constにする
(ユニバーサルリファレンスはrvalueにもバインドできるためconstにすることはできない)。</p></li>
<li><p>継承の都合等で、使用しないにもかかわらず定義しなければならない仮引数には名前を付けない。</p></li>
<li><p>関数f()の仮引数が2つ以上であり、f()に渡す引数をそれぞれに生成する関数があった場合、
引数を生成する関数の戻り値を直接f()に渡さない。</p></li>
</ul>
<div class="sourceCode" id="cb96"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 698</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> f0<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">a_</span><span class="op">++;</span> <span class="op">}</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> f1<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">a_</span><span class="op">--;</span> <span class="op">}</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="dt">int32_t</span> a0<span class="op">,</span> <span class="dt">int32_t</span> a1<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> g<span class="op">(</span>A<span class="op">&amp;</span> a<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>        f<span class="op">(</span>a<span class="op">.</span>f0<span class="op">(),</span> a<span class="op">.</span>f1<span class="op">());</span>  <span class="co">// NG f0()、f1()が呼ばれる順番は未定義。</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a0 <span class="op">=</span> a<span class="op">.</span>f0<span class="op">();</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a1 <span class="op">=</span> a<span class="op">.</span>f1<span class="op">();</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>        f<span class="op">(</span>a0<span class="op">,</span> a1<span class="op">);</span>          <span class="co">// OK f0()はf1()よりも先に呼ばれる。</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>copyコンストラクタ、copy代入演算子、moveコンストラクタ、
move代入演算子の仮引数名はrhs(「<a
href="naming_practice.html#SS_6_1_1">略語リスト</a>」参照)にする。</li>
<li>二項演算子の仮引数名は、左側をlhs、右側をrhsにする。</li>
</ul>
<div class="sourceCode" id="cb97"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 731</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> B <span class="op">{</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>        B<span class="op">(</span>A <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">);</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>        B<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span>A <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">);</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>B <span class="at">const</span><span class="op">&amp;</span> lhs<span class="op">,</span> B <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> lhs<span class="op">.</span><span class="va">b_</span> <span class="op">==</span> rhs<span class="op">.</span><span class="va">b_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>仮引数の意味を明示するために、関数宣言の仮引数の名前は省略しない。</li>
<li>仮引数がない関数の()の中には何も書かない。
Cからリンクされる場合に限り、関数の()の中にはvoidと書く。</li>
</ul>
<div class="sourceCode" id="cb98"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 747</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> C <span class="op">{</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> SetValue<span class="op">(</span><span class="dt">int32_t</span> number_of_peaple<span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  void SetValue(int32_t);                   // NG 仮引数名を書く</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> SetValue<span class="op">(</span>D <span class="at">const</span><span class="op">&amp;</span> d<span class="op">);</span>                <span class="co">// OK</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  void SetValue(D const&amp;);                  // NG 仮引数名を書く</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  int32_t GetValue(void) const;             // NG void不要</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> GetValue<span class="op">()</span> <span class="at">const</span><span class="op">;</span>                 <span class="co">// OK</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="st">&quot;C&quot;</span> <span class="dt">int32_t</span> XxxGetValue<span class="op">(</span><span class="dt">void</span><span class="op">);</span>  <span class="co">// OK Cからリンクされる</span></span></code></pre></div>
<ul>
<li>実引数として使用される配列がポインタ型へ暗黙に変換されることを前提に、
仮引数をポインタ型にしない。また、仮引数を一見、配列に見えるポインタ型にしない
(「<a
href="term_explanation.html#SS_18_3_3">スライシング</a>」で述べたように、
特に基底クラスを配列にすることは危険である)。
代わりに配列へのリファレンスを使用する。</li>
</ul>
<div class="sourceCode" id="cb99"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 770</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>        Base<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> name<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">name0_</span><span class="op">{</span>name<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> Name0<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">name0_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> <span class="va">name0_</span><span class="op">;</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived <span class="kw">final</span> <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>        Derived<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> name0<span class="op">,</span> <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> name1<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> Base<span class="op">{</span>name0<span class="op">},</span> <span class="va">name1_</span><span class="op">{</span>name1<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> Name1<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">name1_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="at">const</span><span class="op">*</span> <span class="va">name1_</span><span class="op">;</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> f<span class="op">(</span>Base <span class="at">const</span><span class="op">*</span> array<span class="op">,</span> <span class="dt">uint32_t</span> n<span class="op">)</span>  <span class="co">// NG 誤用しやすいシグネチャ</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>n<span class="op">};</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(</span>array<span class="op">,</span> array <span class="op">+</span> n<span class="op">,</span> ret<span class="op">.</span>begin<span class="op">(),</span> <span class="op">[](</span>Base <span class="at">const</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> g<span class="op">(</span>Base <span class="at">const</span> array<span class="op">[</span><span class="dv">10</span><span class="op">],</span> <span class="dt">uint32_t</span> n<span class="op">)</span>  <span class="co">// NG 誤用しやすいシグネチャ</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// str_arrayは一見、配列に見えるが、実際はポインタであるため、</span></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// この関数のシグネチャはf(Base const* str_array, uint32_t n)と同じ。</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 配列の長さに見える10はシンタックス上の意味を持たない。</span></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>n<span class="op">};</span></span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(</span>array<span class="op">,</span> array <span class="op">+</span> n<span class="op">,</span> ret<span class="op">.</span>begin<span class="op">(),</span> <span class="op">[](</span>Base <span class="at">const</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb100"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 821</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    TEST<span class="op">(</span>ProgrammingConvention<span class="op">,</span> use_convert_to_ptr<span class="op">)</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>        Base    b<span class="op">[]{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">};</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>        Derived d<span class="op">[]{{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">},</span> <span class="op">{</span><span class="st">&quot;2&quot;</span><span class="op">,</span> <span class="st">&quot;3&quot;</span><span class="op">}};</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> f<span class="op">(</span>b<span class="op">,</span> array_length<span class="op">(</span>b<span class="op">)));</span>  <span class="co">// OK これは良いが</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> g<span class="op">(</span>b<span class="op">,</span> array_length<span class="op">(</span>b<span class="op">)));</span>  <span class="co">// OK これは良いが</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0  </span><span class="co">// 本来なら、下記のようになるべきだが、</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="co">        ASSERT_EQ((std::vector&lt;std::string&gt;{&quot;0&quot;, &quot;2&quot;}), f(d, array_length(d)));  // NG</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co">        ASSERT_EQ((std::vector&lt;std::string&gt;{&quot;0&quot;, &quot;2&quot;}), g(d, array_length(d)));  // NG</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span>  <span class="co">// レイアウトずれにより、下記のようになる</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">}),</span> f<span class="op">(</span>d<span class="op">,</span> array_length<span class="op">(</span>d<span class="op">)));</span>  <span class="co">// NG</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">}),</span> g<span class="op">(</span>d<span class="op">,</span> array_length<span class="op">(</span>d<span class="op">)));</span>  <span class="co">// NG</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb101"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 842</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ポインタではなく、配列へのリファレンスを使用することで、</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 上記のようなバグを避けることができる</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> f_ref_2<span class="op">(</span>Base <span class="at">const</span> <span class="op">(&amp;</span>array<span class="op">)[</span><span class="dv">2</span><span class="op">])</span>  <span class="co">// OK</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>array_length<span class="op">(</span>array<span class="op">)};</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// arrayの型はポインタではなく、リファレンスなのでstd::endが使える</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(</span>array<span class="op">,</span> <span class="bu">std::</span>end<span class="op">(</span>array<span class="op">),</span> ret<span class="op">.</span>begin<span class="op">(),</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>                       <span class="op">[](</span>Base <span class="at">const</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">uint32_t</span> N<span class="op">&gt;</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> f_ref_n<span class="op">(</span>Base <span class="at">const</span> <span class="op">(&amp;</span>array<span class="op">)[</span>N<span class="op">])</span>  <span class="co">// OK</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>N<span class="op">};</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(</span>array<span class="op">,</span> <span class="bu">std::</span>end<span class="op">(</span>array<span class="op">),</span> ret<span class="op">.</span>begin<span class="op">(),</span> <span class="op">[](</span><span class="kw">auto</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="dt">uint32_t</span> N<span class="op">&gt;</span></span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">g_ref</span><span class="op">(</span>T <span class="at">const</span> <span class="op">(&amp;</span>array<span class="op">)[</span>N<span class="op">])</span>  <span class="co">// OK</span></span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>N<span class="op">};</span></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(</span>array<span class="op">,</span> <span class="bu">std::</span>end<span class="op">(</span>array<span class="op">),</span> ret<span class="op">.</span>begin<span class="op">(),</span> <span class="op">[](</span><span class="kw">auto</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NULLを渡す必要がある場合、配列へのリファレンスの代わりに、</span></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 配列へのポインタを使うことができる</span></span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="dt">uint32_t</span> N<span class="op">&gt;</span></span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">g_ptr</span><span class="op">(</span>T <span class="at">const</span> <span class="op">(*</span>array<span class="op">)[</span>N<span class="op">])</span>  <span class="co">// OK</span></span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>array <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{};</span></span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb101-46"><a href="#cb101-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-47"><a href="#cb101-47" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span>N<span class="op">};</span></span>
<span id="cb101-48"><a href="#cb101-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-49"><a href="#cb101-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>transform<span class="op">(*</span>array<span class="op">,</span> <span class="bu">std::</span>end<span class="op">(*</span>array<span class="op">),</span> ret<span class="op">.</span>begin<span class="op">(),</span></span>
<span id="cb101-50"><a href="#cb101-50" aria-hidden="true" tabindex="-1"></a>                       <span class="op">[](</span><span class="kw">auto</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> b<span class="op">.</span>Name0<span class="op">();</span> <span class="op">});</span></span>
<span id="cb101-51"><a href="#cb101-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-52"><a href="#cb101-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb101-53"><a href="#cb101-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb102"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 899</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    TEST<span class="op">(</span>ProgrammingConvention<span class="op">,</span> not_use_convert_to_ptr<span class="op">)</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>        Base    b<span class="op">[]{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">};</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>        Derived d<span class="op">[]{{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">},</span> <span class="op">{</span><span class="st">&quot;2&quot;</span><span class="op">,</span> <span class="st">&quot;3&quot;</span><span class="op">}};</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> f_ref_2<span class="op">(</span>b<span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> f_ref_n<span class="op">(</span>b<span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> <span class="va">g_ref</span><span class="op">(</span>b<span class="op">));</span>    <span class="co">// OK</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ASSERT_EQ((std::vector&lt;std::string&gt;{&quot;0&quot;, &quot;2&quot;}), f_ref_2(d));  OK 誤用なのでコンパイルエラー</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;2&quot;</span><span class="op">}),</span> <span class="va">g_ref</span><span class="op">(</span>d<span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 配列へのポインタを使う場合</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{</span><span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;0&quot;</span><span class="op">}),</span> <span class="va">g_ptr</span><span class="op">(&amp;</span>b<span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>        Derived<span class="op">(*</span>d_null<span class="op">)[</span><span class="dv">3</span><span class="op">]{</span><span class="kw">nullptr</span><span class="op">};</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{}),</span> <span class="va">g_ptr</span><span class="op">(</span>d_null<span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>デフォルト引数は関数のプロトタイプ宣言もしくはクラス宣言内のメンバ関数宣言のみに記述する
(「<a
href="programming_convention.html#SS_3_3_2_7">オーバーライド</a>」参照)。</li>
<li>メンバ関数のデフォルト引数は、
そのクラス外部からのメンバ関数呼び出しを簡潔に記述するための記法であるため、
非publicなメンバ関数にデフォルト引数を持たさない。</li>
<li>デフォルト引数の初期化オブジェクトは定数、もしくは常に等価なオブジェクトにする。
デフォルト引数の初期化オブジェクトは関数呼出し時に評価されるため、
引数の初期化オブジェクトが等価でない場合、
関数の処理が初期化オブジェクトの現在の状態に依存してしまう。</li>
</ul>
<div class="sourceCode" id="cb103"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 921</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> default_arg<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> get_default_arg<span class="op">(</span><span class="dt">int32_t</span> a <span class="op">=</span> default_arg<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> a<span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb104"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 930</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">0</span><span class="op">,</span> get_default_arg<span class="op">());</span>  <span class="co">// default_arg == 0</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    default_arg <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> get_default_arg<span class="op">());</span>  <span class="co">// default_arg == 2</span></span></code></pre></div>
<ul>
<li>std::unique_ptr&lt;T&gt; const&amp;を引数とする関数は、
その引数が指すオブジェクトが保持しているT型オブジェクトを書き換えることができるため、
そのような記述をしない。
関数がそのT型オブジェクトを書き換える必要があるのであれば引数をT&amp;とする。
書き換える必要がないのであれば引数をT const&amp;とする。</li>
</ul>
<div class="sourceCode" id="cb105"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 942</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f0<span class="op">(</span><span class="bu">std::</span>unique_ptr<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span>  <span class="co">// NG *strは書き換え可能</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>str <span class="op">=</span> <span class="st">&quot;it can be changed&quot;</span><span class="op">;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0  </span><span class="co">// strはconstなので以下はできない</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">        str = std::make_unique&lt;std::string&gt;(&quot;haha&quot;);</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f1<span class="op">(</span><span class="bu">std::</span>string<span class="op">&amp;</span> str<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>        str <span class="op">=</span> <span class="st">&quot;it can be changed&quot;</span><span class="op">;</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f2<span class="op">(</span><span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0  </span><span class="co">// strは変更できない</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="co">        str = &quot;it can NOT be changed&quot;;</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> g<span class="op">()</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> s <span class="op">=</span> <span class="bu">std::</span>make_unique<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;(</span><span class="st">&quot;hehe&quot;</span><span class="op">);</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>        f0<span class="op">(</span>s<span class="op">);</span>   <span class="co">// sは変更されないが、sが保持しているstd::stringオブジェクトは変更できる</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>        f1<span class="op">(*</span>s<span class="op">);</span>  <span class="co">// sは変更されないが、sが保持しているstd::stringオブジェクトは変更できる</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>        f2<span class="op">(*</span>s<span class="op">);</span>  <span class="co">// sも、sが指しているstd::stringオブジェクトも変更されない</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_3_11">演習-仮引数の修飾</a></li>
</ul>
<h4 id="自動変数">3.3.3.6 自動変数 <a id="SS_3_3_3_6"></a></h4>
<ul>
<li>一つの文で複数の変数の宣言をしない。</li>
<li>自動変数は、それを使う直前に定義することでスコープを最小化する。</li>
<li>自動変数は、定義と同時に初期化する。</li>
</ul>
<div class="sourceCode" id="cb106"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1008</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> a<span class="op">,</span> b<span class="op">;</span>  <span class="co">// NG 一度に2つの変数定義</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> index<span class="op">;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Do something</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> get_index<span class="op">();</span>                    <span class="co">// NG 定義と使用箇所が離れている</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> index2<span class="op">{</span>get_index<span class="op">()};</span>            <span class="co">// OK</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>    index3 <span class="op">=</span> get_index<span class="op">();</span>           <span class="co">// OK AAA</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>    index4 <span class="op">=</span> <span class="dt">int32_t</span><span class="op">{</span>get_index<span class="op">()};</span>  <span class="co">// OK 型を明示したAAA</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> i<span class="op">;</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> max<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span>  <span class="co">// NG 定義と使用箇所が離れている</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int32_t</span> i<span class="op">{</span><span class="dv">0</span><span class="op">};</span> i <span class="op">&lt;</span> max<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> max<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span>  <span class="co">// OK AAAスタイル</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">&amp;</span> w0 <span class="op">=</span> Widget<span class="op">::</span>Inst<span class="op">();</span>  <span class="co">// if文後にはw0を使用しないならばNG</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>w0<span class="op">.</span>GetStatus<span class="op">()</span> <span class="op">==</span> Widget<span class="op">::</span>Success<span class="op">)</span> <span class="op">{</span></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>        w0<span class="op">.</span>DoSomething<span class="op">();</span></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>        w0<span class="op">.</span>DoSomething<span class="op">(</span>Widget<span class="op">::</span>None<span class="op">);</span></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この後w0を使用しない</span></span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="kw">auto</span><span class="op">&amp;</span> w1 <span class="op">=</span> Widget<span class="op">::</span>Inst<span class="op">();</span> w1<span class="op">.</span>GetStatus<span class="op">()</span> <span class="op">==</span> Widget<span class="op">::</span>Success<span class="op">)</span> <span class="op">{</span>  <span class="co">// OK C++17より使用可能</span></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>        w1<span class="op">.</span>DoSomething<span class="op">();</span></span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>        w1<span class="op">.</span>DoSomething<span class="op">(</span>Widget<span class="op">::</span>None<span class="op">);</span></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> w2 <span class="op">=</span> Widget<span class="op">::</span>InstConst<span class="op">();</span>  <span class="co">// switch文後にw2を使用しないならばNG</span></span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>w2<span class="op">.</span>GetStatus<span class="op">())</span> <span class="op">{</span></span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> Widget<span class="op">::</span>Success<span class="op">:</span></span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この後w2を使用しない</span></span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> w3 <span class="op">=</span> Widget<span class="op">::</span>InstConst<span class="op">();</span> w3<span class="op">.</span>GetStatus<span class="op">())</span> <span class="op">{</span>  <span class="co">// OK C++17より使用可能</span></span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> Widget<span class="op">::</span>Success<span class="op">:</span></span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Do something</span></span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h4 id="戻り値型">3.3.3.7 戻り値型 <a id="SS_3_3_3_7"></a></h4>
<ul>
<li>メモリアロケータ以外の関数の戻り値をvoid*にしない。</li>
<li>避けがたい理由なしに「戻り値の型を後置する関数宣言構文」を使用しない。</li>
</ul>
<div class="sourceCode" id="cb107"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1111</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">-&gt;</span> <span class="kw">decltype</span><span class="op">(</span>a <span class="op">+</span> b<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f<span class="op">(</span>T a<span class="op">,</span> T b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">-&gt;</span> <span class="kw">decltype</span><span class="op">(</span>a <span class="op">+</span> b<span class="op">)</span>  <span class="co">// OK 後置構文以外に方法がない</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span>  <span class="co">// T = uint8_tとすると、a + bの型はint32_t</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>戻り値を比較的大きなオブジェクトにする場合、パフォーマンスに注意する
(「<a
href="programming_convention.html#SS_3_9_3">関数の戻り値オブジェクト</a>」参照)。</p></li>
<li><p>関数が複数の値を返す場合、std::pair、std::tupple、構造体オブジェクトを戻り値にして返す。
パフォーマンスに著しい悪影響がない限り、その値をリファレンス引数で返さない。</p></li>
</ul>
<div class="sourceCode" id="cb108"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1124</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> g0<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">,</span> <span class="dt">int32_t</span><span class="op">&amp;</span> quotient<span class="op">,</span> <span class="dt">int32_t</span><span class="op">&amp;</span> remainder<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>        quotient  <span class="op">=</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>        remainder <span class="op">=</span> a <span class="op">%</span> b<span class="op">;</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> g1<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">,</span> <span class="dt">int32_t</span><span class="op">&amp;</span> remainder<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>        remainder <span class="op">=</span> a <span class="op">%</span> b<span class="op">;</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>pair<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">,</span> <span class="dt">int32_t</span><span class="op">&gt;</span> <span class="va">g_pair</span><span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">{</span>a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b<span class="op">};</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Result <span class="op">{</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> quotient<span class="op">;</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> remainder<span class="op">;</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    Result <span class="va">g_struct</span><span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">{</span>a <span class="op">/</span> b<span class="op">,</span> a <span class="op">%</span> b<span class="op">};</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb109"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1157</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> quotient<span class="op">;</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> remainder<span class="op">;</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>        g0<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> quotient<span class="op">,</span> remainder<span class="op">);</span>  <span class="co">// NG quotient、remainderが戻り値かどうかわかりづらい</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> quotient<span class="op">);</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> remainder<span class="op">);</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> remainder<span class="op">;</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> quotient<span class="op">{</span>g1<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> remainder<span class="op">)};</span>  <span class="co">// NG remainderが戻り値かどうかわかりづらい</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> quotient<span class="op">);</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> remainder<span class="op">);</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="va">g_pair</span><span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> ret<span class="op">.</span>first<span class="op">);</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> ret<span class="op">.</span>second<span class="op">);</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="op">[</span>quotient<span class="op">,</span> remainder<span class="op">]</span> <span class="op">=</span> <span class="va">g_struct</span><span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// OK C++17 構造化束縛</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> quotient<span class="op">);</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> remainder<span class="op">);</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="va">g_struct</span><span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> ret<span class="op">.</span>quotient<span class="op">);</span></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> ret<span class="op">.</span>remainder<span class="op">);</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>処理の成否をbool等で通知し、成功時の戻り値をリファレンス引数で戻す関数や、
処理の成功時の値と、失敗時の外れ値を戻り値で返す関数を作らない。
代わりにC++17で導入されたstd::optionalを使用する。</li>
</ul>
<div class="sourceCode" id="cb110"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1215</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> h0<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">,</span> <span class="dt">int32_t</span><span class="op">&amp;</span> remainder<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>        remainder <span class="op">=</span> a <span class="op">%</span> b<span class="op">;</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> h1<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">,</span> <span class="dt">uint32_t</span> b<span class="op">)</span>  <span class="co">// NG 余りが-1になる場合(外れ値)、エラー通知</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">%</span> b<span class="op">;</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>pair<span class="op">&lt;</span><span class="dt">bool</span><span class="op">,</span> <span class="dt">int32_t</span><span class="op">&gt;</span> h_pair<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">{</span><span class="kw">false</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">{</span><span class="kw">true</span><span class="op">,</span> a <span class="op">%</span> b<span class="op">};</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Result2 <span class="op">{</span></span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span>    is_success<span class="op">;</span></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> remainder<span class="op">;</span></span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>    Result2 h_struct<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span>  <span class="co">// NG</span></span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">{</span><span class="kw">false</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">{</span><span class="kw">true</span><span class="op">,</span> a <span class="op">%</span> b<span class="op">};</span></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> h_optional<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">,</span> <span class="dt">int32_t</span> b<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">std::</span>nullopt<span class="op">;</span></span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">%</span> b<span class="op">;</span></span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb111"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1272</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> remainder<span class="op">;</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> h0<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> remainder<span class="op">);</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>result<span class="op">);</span>  <span class="co">// エラー時にremainderが有効か否かわからない</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> remainder <span class="op">=</span> h1<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(-</span><span class="dv">1</span><span class="op">,</span> remainder<span class="op">);</span>  <span class="co">// エラー通知がわかりづらい</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="op">[</span>result<span class="op">,</span> remainder<span class="op">]</span> <span class="op">=</span> h_pair<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>result<span class="op">);</span>  <span class="co">// エラー時にremainderが有効か否かわからない</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="op">[</span>result<span class="op">,</span> remainder<span class="op">]</span> <span class="op">=</span> h_struct<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>result<span class="op">);</span>  <span class="co">// エラー時にremainderが有効か否かわからない</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> h_optional<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>        ASSERT_FALSE<span class="op">(</span>result<span class="op">);</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> h_optional<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>        ASSERT_TRUE<span class="op">(</span>result<span class="op">);</span></span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="op">*</span>result<span class="op">);</span>  <span class="co">// 成功時の値取り出し</span></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h4 id="constexpr関数">3.3.3.8 constexpr関数
<a id="SS_3_3_3_8"></a></h4>
<ul>
<li><p>多くの使用箇所で戻り値がコンパイル時に確定する関数テンプレートもしくはinline関数は、
constexprと宣言する(「<a
href="term_explanation.html#SS_18_1_15">constexprインスタンスと関数</a>」参照)。</p></li>
<li><p>コンパイル時に値が確定する<a
href="programming_convention.html#SS_3_4_8">ラムダ式</a>を戻り値に持つ関数はconstexprと宣言する。</p></li>
<li><p><a
href="exercise_q.html#SS_19_3_12">演習-constexpr関数</a></p></li>
</ul>
<h4 id="リエントラント性">3.3.3.9 リエントラント性
<a id="SS_3_3_3_9"></a></h4>
<ul>
<li>関数、メンバ関数はなるべくリエントラントに実装する。</li>
<li>複数のスレッドから呼び出される関数は必ずリエントラントにする。</li>
</ul>
<div class="sourceCode" id="cb112"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1328</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> var<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// リエントラントでない関数f()</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">++</span>var<span class="op">;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">(</span><span class="dt">int32_t</span><span class="op">&amp;</span> i<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// リエントラントな関数f()</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">++</span>i<span class="op">;</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h4 id="エクセプション処理">3.3.3.10 エクセプション処理
<a id="SS_3_3_3_10"></a></h4>
<ul>
<li>関数はそれが不可避でない限り、<a
href="term_explanation.html#SS_18_7_1">no-fail保証</a>をする。</li>
<li>throwをせざるを得ない場合、最低でも<a
href="term_explanation.html#SS_18_7_3">基本保証</a>をする。</li>
<li>STLコンテナ(std::string,
std::vector等)が発生させるエクセプションはtry-catchせず
(catchしてデバッグ情報を保存するような場合を除く)、
プログラムをクラッシュさせる。try-catchしてもできることはない。</li>
<li>特別な理由がない限り、コンストラクタ呼び出しはnoexceptと宣言する。
ネットワーク接続等、簡単にエラーすることをコンストラクタ内で行わない。</li>
<li><a href="solid.html#SS_8_2">オープン・クローズドの原則(OCP)</a>、<a
href="solid.html#SS_8_3">リスコフの置換原則(LSP)</a>に違反する場合が多いため、
「throwキーワードによるエクセプション仕様」を使用しない(C++17で廃止)。</li>
<li>エクセプションをthrowしないことが確定している関数は、noexceptと宣言する。
move代入演算子をnoexceptと宣言することは特に重要である。</li>
</ul>
<div class="sourceCode" id="cb113"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1359</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">()</span> <span class="kw">noexcept</span><span class="op">;</span>  <span class="co">// OK fはno-fail保証</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// オブジェクトの状態を変えず(const)、エクセプションを発生させず(noexcept)</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// f()の最後(final)のoverride</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> f<span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="kw">final</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>try-catchが不可避である場合、以下の理由によりconstリファレンスで受け取る。
<ul>
<li>実態で受け取るとオブジェクトの<a
href="term_explanation.html#SS_18_3_3">スライシング</a>が起こる場合がある。</li>
<li>受け取ったエクセプションオブジェクトを書き換えるべきではない。</li>
</ul></li>
<li>エクセプションによるリソースリークを避けるため<a
href="design_pattern.html#SS_9_9">RAII(scoped
guard)</a>でリソースを管理する。</li>
<li>一連のcatch節では、catchするエクセプションの型の最もマッチ率の高いcatch節で処理されるのではなく、
マッチした最上位のcatch節で処理されるため、
catchするエクセプションの型に継承関係があるのであれば、継承順位が低い順番にcatchする。
また、catch(…)は一番最後に書く(関数tryブロックの場合も同様にする)。</li>
</ul>
<div class="sourceCode" id="cb114"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1379</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ExceptionA <span class="op">:</span> <span class="bu">std::</span>exception<span class="op"> {};</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ExceptionB <span class="op">:</span> ExceptionA <span class="op">{};</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ExceptionX <span class="op">:</span> <span class="bu">std::</span>exception<span class="op"> {};</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> order_of_catch<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(</span>ExceptionB <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// ExceptionAの前に書く。</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(</span>ExceptionA <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// std::exceptionの前に書く。</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(</span>ExceptionX <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// std::exceptionの前に書く。</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(</span><span class="bu">std::</span>exception<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// catch(...)の前に書く。</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(...)</span> <span class="op">{</span>  <span class="co">// 必ず一番最後に書く。</span></span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> order_of_catch_with_try<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span>  <span class="co">// 関数tryブロック</span></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span> <span class="op">(</span>ExceptionB <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// ExceptionAの前に書く。</span></span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span> <span class="op">(</span>ExceptionA <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// std::exceptionの前に書く。</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span> <span class="op">(</span>ExceptionX <span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// std::exceptionの前に書く。</span></span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span> <span class="op">(</span><span class="bu">std::</span>exception<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span>  <span class="co">// catch(...)の前に書く。</span></span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span> <span class="op">(...)</span> <span class="op">{</span>  <span class="co">// 必ず一番最後に書く。</span></span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>エクセプションをthrowする場合、独自定義したオブジェクトを使用しない。
代わりにstd::exceptionか、これから派生したクラスを使用する。
また、throwされたオブジェクトのwhat()から、throwされたファイル位置が特定できるようにする
(「<a
href="template_meta_programming.html#SS_13_6_7_4">ファイル位置を静的に保持したエクセプションクラスの開発</a>」参照)。</p></li>
<li><p>noexceptと宣言された関数へのポインタへ、noexceptでない関数のポインタを代入しない
(C++17では<a
href="term_explanation.html#SS_18_10_8">ill-formed</a>になる)。</p></li>
</ul>
<div class="sourceCode" id="cb115"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1442</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f0<span class="op">()</span>  <span class="co">// noexceptではないため、エクセプションを発生させることがある。</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f1<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if </span><span class="ot">__cplusplus</span><span class="pp"> &lt; 201703L  </span><span class="co">// 以下のコードはC++14以前ではコンパイルできるが、</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>                               <span class="co">// C++17以降ではコンパイルエラー</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(*</span>f_ptr0<span class="op">)()</span> <span class="kw">noexcept</span> <span class="op">=</span> <span class="op">&amp;</span>f0<span class="op">;</span>  <span class="co">// NG f_ptr0()はnoexceptだが、</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="co">//    f0はエクセプションを発生させる可能性がある。</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(*</span>f_ptr1<span class="op">)()</span> <span class="kw">noexcept</span> <span class="op">=</span> <span class="op">&amp;</span>f1<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(*</span>f_ptr2<span class="op">)()</span>          <span class="op">=</span> <span class="op">&amp;</span>f0<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(*</span>f_ptr3<span class="op">)()</span>          <span class="op">=</span> <span class="op">&amp;</span>f1<span class="op">;</span>  <span class="co">// OK f1はエクセプションを発生させない。</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> f0<span class="op">()</span>  <span class="co">// noexceptではないため、エクセプションを発生させることがある。</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> f1<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if </span><span class="ot">__cplusplus</span><span class="pp"> &lt; 201703L  </span><span class="co">// 以下のコードはC++14以前ではコンパイルできるが、</span></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a>                               <span class="co">// C++17以降ではコンパイルエラー</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(</span>A<span class="op">::*</span>mf_ptr0<span class="op">)()</span> <span class="kw">noexcept</span> <span class="op">=</span> <span class="op">&amp;</span>A<span class="op">::</span>f0<span class="op">;</span>  <span class="co">// NG mf_ptr0()はnoexceptだが、</span></span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a>                                                <span class="co">//    f0はエクセプションを発生させる可能性がある。</span></span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(</span>A<span class="op">::*</span>mf_ptr1<span class="op">)()</span> <span class="kw">noexcept</span> <span class="op">=</span> <span class="op">&amp;</span>A<span class="op">::</span>f1<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(</span>A<span class="op">::*</span>mf_ptr2<span class="op">)()</span>          <span class="op">=</span> <span class="op">&amp;</span>A<span class="op">::</span>f0<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> <span class="op">(</span>A<span class="op">::*</span>mf_ptr3<span class="op">)()</span>          <span class="op">=</span> <span class="op">&amp;</span>A<span class="op">::</span>f1<span class="op">;</span>  <span class="co">// OK f1はエクセプションを発生させない。</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_3_13">演習-エクセプションの型</a></li>
</ul>
<h4 id="ビジーループ">3.3.3.11 ビジーループ
<a id="SS_3_3_3_11"></a></h4>
<ul>
<li>待ち合わせにビジーループを使わない。イベントドリブンにする。</li>
</ul>
<div class="sourceCode" id="cb116"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/func_ut.cpp 1504</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NG イベントドリブンにするべき</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> wait_busily<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>            sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>xxx_flag<span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">...</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// OK selectでイベント発生を待つ。</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> wait_event<span class="op">(</span>fd_set <span class="at">const</span><span class="op">&amp;</span> rfds<span class="op">,</span> <span class="dt">uint32_t</span> wait_sec<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> rfds2 <span class="op">=</span> rfds<span class="op">;</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> tv    <span class="op">=</span> timeval<span class="op">{</span>wait_sec<span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> retval <span class="op">=</span> select<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>rfds2<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">&amp;</span>tv<span class="op">);</span></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>[注意] C++11からイベント通知のためにstd::condition_variable (「<a
href="concurrency.html#SS_12">並行処理</a>」参照)が導入された。</li>
</ul>
<h2 id="構文">3.4 構文 <a id="SS_3_4"></a></h2>
<h3 id="複合文">3.4.1 複合文 <a id="SS_3_4_1"></a></h3>
<ul>
<li>if, else, for, while, do後には複合文を使う。</li>
</ul>
<div class="sourceCode" id="cb117"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 22</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>                      <span class="co">// NG 複合文でない</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>                      <span class="co">// OK</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>                            <span class="co">// NG 複合文でない</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> a<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>        c<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> a<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span>    <span class="co">// NG</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>        c<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span></code></pre></div>
<ul>
<li>空の複合文には、何もすることがないという意図を表現するため、“;”だけの文を置き、
空の複合文である事を明示する。</li>
</ul>
<div class="sourceCode" id="cb118"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 53</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>volatile_flag<span class="op">)</span> <span class="op">{</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// NG ;が無い</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>volatile_flag<span class="op">)</span> <span class="op">{</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>volatile_flag<span class="op">)</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">;</span>  <span class="co">// NG whileの文が複合文でない</span></span></code></pre></div>
<h3 id="switch文">3.4.2 switch文 <a id="SS_3_4_2"></a></h3>
<ul>
<li><p>caseラベル、defaultラベルに関連付けられた一連の文はできだけフォールスルーさせない。
実装がシンプルになる等の理由からフォールスルーさせる場合、
それが意図であることを明示するため以下のような記述する。</p>
<p>// fallthrough // C++14以前</p>
<p>[[fallthrough]]; // C++17以降</p></li>
<li><p>defaultラベルは省略せず、switch文の末尾に書く。</p>
<ul>
<li>defaultラベルに関連付けられた処理がない場合は、breakのみを記述する。</li>
<li>論理的にdefaultラベルに到達しないのであれば、
defaultラベルに続いてassert(false)を実行することで、
そこを通過してはならないことを明示する(「<a
href="programming_convention.html#SS_3_11_1">assertion</a>」参照)。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb119"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 79</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// NG break無しで抜けているのにコメントが無い</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// fallthrough  C++14以前であればOK</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>        e <span class="op">+=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">[[</span><span class="at">fallthrough</span><span class="op">]];</span>  <span class="co">// OK C++17</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">4</span><span class="op">:</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span>  <span class="co">// OK 論理的にここには来ないのならば、defaultを省略せずにassert</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="if文">3.4.3 if文 <a id="SS_3_4_3"></a></h3>
<ul>
<li>if-else-ifと連続する場合は、else文で終了させる。
最後のelseのブロックでやるべき処理がないのであれば、そのブロックに;のみを記述する。</li>
</ul>
<div class="sourceCode" id="cb120"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 111</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// NG elseで終了していない</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span>  <span class="co">// OK else文でやることがない場合は、;のみ記述</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">;</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>if-else-ifの最後のelseのブロックに論理的に到達しないのであれば、
そのブロックでassert(false)を実行する(「<a
href="programming_convention.html#SS_3_11_1">assertion</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb121"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 134</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span>              <span class="co">// OK</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span>  <span class="co">//    ここに来るのはバグの場合。</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>条件が2つ以上且つ、switchで表現できる条件文には、ifではなくswitchを使用する。</li>
<li>ifの条件式が、コンパイル時に定まるのであれば、<a
href="template_meta_programming.html#SS_13_6_4">constexpr
if文</a>を使用する。</li>
</ul>
<h3 id="範囲for文">3.4.4 範囲for文 <a id="SS_3_4_4"></a></h3>
<ul>
<li>配列やコンテナの全要素にアクセスするような繰り返し処理には、 <a
href="https://ja.wikipedia.org/wiki/Off-by-one%E3%82%A8%E3%83%A9%E3%83%BC">off-by-oneエラー</a>
が避けられ、従来よりもシンプルに記述できる<a
href="term_explanation.html#SS_18_10_3">範囲for文</a>を使用する。</li>
</ul>
<div class="sourceCode" id="cb122"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 155</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> vect <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NG oldスタイル</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> <span class="dv">0</span><span class="bu">U</span><span class="op">;</span> i <span class="op">&lt;</span> vect<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> vect<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; &quot;</span><span class="op">;</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NG C++03スタイル</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;::</span>iterator it <span class="op">=</span> vect<span class="op">.</span>begin<span class="op">();</span> it <span class="op">!=</span> vect<span class="op">.</span>end<span class="op">();</span> <span class="op">++</span>it<span class="op">)</span> <span class="op">{</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>it <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;::</span>const_iterator it <span class="op">=</span> vect<span class="op">.</span>cbegin<span class="op">();</span> it <span class="op">!=</span> vect<span class="op">.</span>cend<span class="op">();</span> <span class="op">++</span>it<span class="op">)</span> <span class="op">{</span></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="op">*</span>it <span class="op">&lt;&lt;</span> <span class="st">&quot; &quot;</span><span class="op">;</span></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// OK C++11スタイル</span></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> a <span class="op">:</span> vect<span class="op">)</span> <span class="op">{</span></span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> a <span class="op">&lt;&lt;</span> <span class="st">&quot; &quot;</span><span class="op">;</span></span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<ul>
<li><p>独自のコンテナクラスを定義する場合、STLコンテナと同様の要件を満たすbegin()、end()や、
cbegin()、cend()も定義し、そのコンテナに<a
href="term_explanation.html#SS_18_10_3">範囲for文</a>を適用できるようにする
(「<a
href="dynamic_memory_allocation.html#SS_14_2_4">デバッグ用イテレータ</a>」参照)。</p></li>
<li><p><a
href="exercise_q.html#SS_19_4_1">演習-コンテナの範囲for文</a></p></li>
</ul>
<h3 id="制御文のネスト">3.4.5 制御文のネスト <a id="SS_3_4_5"></a></h3>
<ul>
<li>breakとの関係がわかりづらい、ブロックが巨大になる等の問題があるため、
if, for, while, do-while,
switch文に付随するブロックの中にswitch文を書かない。</li>
</ul>
<h3 id="return文">3.4.6 return文 <a id="SS_3_4_6"></a></h3>
<ul>
<li>returnの後に括弧をつけない。</li>
</ul>
<div class="sourceCode" id="cb123"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 194</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>xxx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// decltype(retval)は、int32_t</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// decltype((retval))は、(retval)がlvalueであるためint32_t&amp;</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// この違いは通常問題にはならないが、関数の戻り値を型推測させると問題になる。</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>retval<span class="op">);</span>  <span class="co">// NG ()は不要</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> retval2<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>下記のようなreturnしない関数には、[[noreturn]]をつけて宣言、定義する。</li>
</ul>
<div class="sourceCode" id="cb124"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 215</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @fn terminate(char const* message)</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @brief メッセージを出力してプログラムを終了させる。</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @param const char* message 上記メッセージ</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">[[</span><span class="at">noreturn</span><span class="op">]]</span> <span class="dt">void</span> terminate<span class="op">(</span><span class="dt">char</span> <span class="at">const</span><span class="op">*</span> message<span class="op">)</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="at">const</span> str <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;unrecoverable error&quot;</span><span class="op">}</span> <span class="op">+</span> message<span class="op">;</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="bu">std::</span>runtime_error<span class="op">{</span>str<span class="op">};</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="goto文">3.4.7 goto文 <a id="SS_3_4_7"></a></h3>
<ul>
<li>二重以上のループを抜ける目的以外でgotoを使用しない。</li>
<li>二重以上のループを抜ける目的でgotoを使用する場合、gotoのジャンプ先ラベルはそのループの直後に置く。</li>
</ul>
<h3 id="ラムダ式">3.4.8 ラムダ式 <a id="SS_3_4_8"></a></h3>
<ul>
<li><a
href="term_explanation.html#SS_18_10_4">ラムダ式</a>を複雑にしない。
<ul>
<li>できるだけワンライナーにする。</li>
<li>必ず10行以下にする。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb125"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 235</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ラムダ式はワンライナーが基本</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> itr <span class="op">=</span> <span class="bu">std::</span>find_if<span class="op">(</span>strs<span class="op">.</span>begin<span class="op">(),</span> strs<span class="op">.</span>end<span class="op">(),</span> <span class="op">[](</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> n<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>n<span class="op">.</span>at<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">==</span> <span class="ch">&#39;n&#39;</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>n<span class="op">.</span>size<span class="op">()</span> <span class="op">&gt;</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span></code></pre></div>
<ul>
<li>デフォルトのキャプチャ方式は、ローカル変数を無限定にキャプチャしてしまうため使用しない。
<ul>
<li>C++11では、キャプチャする変数ごとに代入キャプチャか参照キャプチャを使用する。</li>
<li>C++14以降では、初期化キャプチャを使用する。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb126"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 260</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NG デフォルトのキャプチャ方式</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> GetNameLessThan<span class="op">(</span><span class="dt">uint32_t</span> length<span class="op">)</span> <span class="at">const</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{};</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 1  </span><span class="co">// 手が滑って、strをstrs_としてしまったバグ([=]によってthisが導入されている)。</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>copy_if<span class="op">(</span><span class="va">strs_</span><span class="op">.</span>cbegin<span class="op">(),</span> <span class="va">strs_</span><span class="op">.</span>cend<span class="op">(),</span> <span class="bu">std::</span>back_inserter<span class="op">(</span>ret<span class="op">),</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>                         <span class="op">[=](</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span><span class="va">strs_</span><span class="op">.</span>size<span class="op">()</span> <span class="op">&lt;</span> length<span class="op">);</span> <span class="op">});</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span><span class="co">  // 本来は下記のように書きたかったが、</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co">           // キャプチャ範囲が大きすぎるため上記バグを生み出してしまった。</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="co">            std::copy_if(strs_.cbegin(), strs_.cend(), std::back_inserter(ret),</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a><span class="co">                         [=](auto const&amp; str) noexcept { return (str.size() &lt; length); });</span></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">strs_</span><span class="op">;</span></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb127"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 295</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// OK 限定したキャプチャにより、ラムダ式から可視である変数が限定された</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> GetNameLessThan<span class="op">(</span><span class="dt">uint32_t</span> length<span class="op">)</span> <span class="at">const</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{};</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if CPP_VER == 11  </span><span class="co">// c++11</span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>                       <span class="co">// [length]を代入キャプチャと呼ぶ。</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>copy_if<span class="op">(</span><span class="va">strs_</span><span class="op">.</span>cbegin<span class="op">(),</span> <span class="va">strs_</span><span class="op">.</span>cend<span class="op">(),</span> <span class="bu">std::</span>back_inserter<span class="op">(</span>ret<span class="op">),</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>                         <span class="op">[</span>length<span class="op">](</span><span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>str<span class="op">.</span>size<span class="op">()</span> <span class="op">&lt;</span> length<span class="op">);</span> <span class="op">});</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif CPP_VER == 14  </span><span class="co">// c++14以降</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// [length = length]を初期化キャプチャと呼ぶ。</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 左のlengthのスコープはラムダ式内。右のlengthのスコープはGetNameLessThan内。</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>copy_if<span class="op">(</span><span class="va">strs_</span><span class="op">.</span>cbegin<span class="op">(),</span> <span class="va">strs_</span><span class="op">.</span>cend<span class="op">(),</span> <span class="bu">std::</span>back_inserter<span class="op">(</span>ret<span class="op">),</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>                         <span class="op">[</span>length <span class="op">=</span> length<span class="op">](</span><span class="kw">auto</span> <span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">(</span>str<span class="op">.</span>size<span class="op">()</span> <span class="op">&lt;</span> length<span class="op">);</span> <span class="op">});</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">static_assert</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> <span class="st">&quot;CPP_VER should be 11 or 14&quot;</span><span class="op">);</span></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>外部のオブジェクトを参照キャプチャしたクロージャを、
その外部オブジェクトのライフタイムを超えて使用しない。
<ul>
<li>関数で作られたクロージャがその関数のローカル変数のハンドルを使用するのであれば、
そのクロージャをその関数外で使用しない。</li>
<li>オブジェクトで作られたクロージャがそのメンバ変数のハンドルを使用するのであれば、
そのオブジェクトの終了後にそのクロージャを使用しない。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb128"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 331</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> B <span class="op">{</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>function<span class="op">&lt;</span><span class="dt">bool</span><span class="op">(</span><span class="dt">int</span><span class="op">)&gt;</span> GenLambda<span class="op">(</span><span class="dt">int</span> max<span class="op">)</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">// NG</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">// この関数が返すはクロージャがリファレンスしているmaxはこの関数が終了すると無効になる。</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">[&amp;</span>max<span class="op">](</span><span class="dt">int</span> n<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">&lt;</span> max<span class="op">;</span> <span class="op">};</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>function<span class="op">&lt;</span><span class="dt">bool</span><span class="op">(</span><span class="dt">int</span><span class="op">)&gt;</span> GenLambda<span class="op">()</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// NG</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// この関数が返すクロージャがリファレンスしているmin_はBオブジェクトが終了すると無効になる。</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">[&amp;</span>min <span class="op">=</span> <span class="va">min_</span><span class="op">](</span><span class="dt">int</span> n<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">&gt;</span> min<span class="op">;</span> <span class="op">};</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> <span class="va">min_</span><span class="op">;</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>C++17以降では、
コンパイル時に戻り値が確定するラムダ式の呼び出し式はリテラルにできるため、
そのようなラムダ式を戻り値に持つ関数はconstexprと宣言する。</li>
</ul>
<div class="sourceCode" id="cb129"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 369</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> square1 <span class="op">=</span> <span class="op">[](</span><span class="dt">int32_t</span> n<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">*</span> n<span class="op">;</span> <span class="op">};</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>square1<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// C++17以降、square1(2)はリテラル</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// static_assert(square1(i) == 2);  // iはconstexprではないので、コンパイルエラー</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> j       <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> square2 <span class="op">=</span> <span class="op">[</span>n <span class="op">=</span> j<span class="op">]()</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">*</span> n<span class="op">;</span> <span class="op">};</span>  <span class="co">// constexprの宣言が必要</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>square2<span class="op">()</span> <span class="op">==</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// C++17以降、square2()はリテラル</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> square3 <span class="op">=</span> <span class="op">[</span>n <span class="op">=</span> j<span class="op">]()</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">*</span> n<span class="op">;</span> <span class="op">};</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// static_assert(square3() == 4);  // square3()はリテラルではないので、コンパイルエラー</span></span></code></pre></div>
<div class="sourceCode" id="cb130"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 390</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">int32_t</span> square4<span class="op">(</span><span class="dt">int32_t</span> n<span class="op">)</span>  <span class="co">// OK nがconstexprであれば、ラムダはconstexpr</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">[</span>n<span class="op">]</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">*</span> n<span class="op">;</span> <span class="op">}();</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>square4<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// C++17以降、square4(2)はリテラル</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> square5<span class="op">(</span><span class="dt">int32_t</span> n<span class="op">)</span>  <span class="co">//  OK nがconstexprであれば、ラムダはconstexpr</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// nがconstexprならば、ラムダ式はリテラル</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> f <span class="op">=</span> <span class="op">[</span>n<span class="op">]</span> <span class="op">{</span> <span class="cf">return</span> n <span class="op">*</span> n<span class="op">;</span> <span class="op">};</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// fの戻り値がリテラルならば、gもリテラル</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> g <span class="op">=</span> <span class="op">[</span>f<span class="op">]</span> <span class="op">{</span> <span class="cf">return</span> f<span class="op">();</span> <span class="op">};</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> g<span class="op">;</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>square5<span class="op">(</span><span class="dv">2</span><span class="op">)()</span> <span class="op">==</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// C++17以降、square5(2)はリテラル</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_4_2">演習-ラムダ式</a><br />
</li>
<li><a href="exercise_q.html#SS_19_4_3">演習-ラムダ式のキャプチャ</a></li>
</ul>
<h3 id="マクロの中の文">3.4.9 マクロの中の文 <a id="SS_3_4_9"></a></h3>
<ul>
<li>マクロの中に文がある場合、do-while(0)イデオムを使用する(「<a
href="programming_convention.html#SS_3_6_1">関数型マクロ</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb131"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/syntax_ut.cpp 418</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do-while(0)イデオムによる関数型マクロ</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INIT_ARRAY</span><span class="op">(</span><span class="va">array_</span><span class="op">,</span><span class="pp"> </span><span class="va">x_</span><span class="op">)</span><span class="pp">      </span><span class="op">\</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp">                            </span><span class="op">\</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="kw">auto</span><span class="op">&amp;</span><span class="pp"> </span><span class="va">a_</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="op">(</span><span class="va">array_</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="va">a_</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="op">(</span><span class="va">x_</span><span class="op">);</span><span class="pp">              </span><span class="op">\</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="dt">uint32_t</span> <span class="op">(&amp;</span>a<span class="op">)[</span><span class="dv">10</span><span class="op">])</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// INIT_ARRAYがdo-whileではなく、単なるブロックで囲むと、&quot;;&quot;が余計になる。</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>        INIT_ARRAY<span class="op">(</span>a<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h2 id="演算子">3.5 演算子 <a id="SS_3_5"></a></h2>
<h3 id="優先順位">3.5.1 優先順位 <a id="SS_3_5_1"></a></h3>
<ul>
<li>優先順位が分かりづらい式では、順序を明示するために丸括弧を使う。</li>
</ul>
<div class="sourceCode" id="cb132"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 20</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 論理演算子例</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">&lt;</span> b <span class="op">&amp;&amp;</span> c <span class="op">&lt;</span> d <span class="op">||</span> e <span class="op">&lt;</span> f<span class="op">)</span>  <span class="co">// NG 優先順位がわからない</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(((</span>a <span class="op">&lt;</span> b<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>c <span class="op">&lt;</span> d<span class="op">))</span> <span class="op">||</span> <span class="op">(</span>e <span class="op">&lt;</span> f<span class="op">))</span>  <span class="co">// OK</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// シフト演算子例</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a0 <span class="op">=</span> b <span class="op">&lt;&lt;</span> <span class="dv">16</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>    <span class="co">// NG</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a1 <span class="op">=</span> b <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dv">16</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a2 <span class="op">=</span> <span class="op">(</span>b <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ビット演算ではないが</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> a0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>    <span class="co">// NG</span></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="op">(</span>a1 <span class="op">+</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 三項演算子例</span></span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> e0 <span class="op">=</span> a <span class="op">?</span> b <span class="op">:</span> c <span class="op">=</span> d<span class="op">;</span>      <span class="co">// NG</span></span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> e1 <span class="op">=</span> <span class="op">((</span>a <span class="op">?</span> b <span class="op">:</span> c<span class="op">)</span> <span class="op">=</span> d<span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> e2 <span class="op">=</span> <span class="op">(</span>a <span class="op">?</span> b <span class="op">:</span> <span class="op">(</span>c <span class="op">=</span> d<span class="op">));</span>  <span class="co">// OK 上記NG式と同じ意味</span></span></code></pre></div>
<ul>
<li>[注意]
複合代入式と、それと等価に見える式での演算順序の違いに気を付ける。</li>
</ul>
<div class="sourceCode" id="cb133"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 62</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> a <span class="op">*</span> <span class="dv">3</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">6</span><span class="op">,</span> a<span class="op">);</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>        a <span class="op">*=</span> <span class="dv">3</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// この式は、a = a * 3 / 2と等価ではない</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="dv">4</span><span class="op">,</span> a<span class="op">);</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="代入演算">3.5.2 代入演算 <a id="SS_3_5_2"></a></h3>
<ul>
<li><a
href="term_explanation.html#SS_18_10_7">単純代入</a>のみからなる文を除き、1つの文で複数の代入を行わない。</li>
</ul>
<div class="sourceCode" id="cb134"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 89</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> b <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>              <span class="co">// OK</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    b     <span class="op">=</span> <span class="op">(</span>a <span class="op">+=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span>   <span class="co">// NG</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    b     <span class="op">=</span> <span class="op">(</span>a<span class="op">++)</span> <span class="op">+</span> <span class="op">(</span>c<span class="op">++);</span>  <span class="co">// NG</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> b<span class="op">++;</span>  <span class="co">// NG unary operators assign itself.</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span>a<span class="op">;</span>         <span class="co">// OK</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> i <span class="op">=</span> a<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// OK</span></span></code></pre></div>
<ul>
<li>一部の例外を除き、ifの条件文の中で代入しない。</li>
</ul>
<div class="sourceCode" id="cb135"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 105</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c <span class="op">=</span> b<span class="op">)</span> <span class="op">{</span>  <span class="co">// NG ifの条件文の中で代入</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>fd1 <span class="op">=</span> socket<span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// OK このような場合は代入していることが明確</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="kw">auto</span> fd2 <span class="op">=</span> socket<span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">);</span> fd2 <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// OK C++17</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// fd2を使った処理</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="ビット演算">3.5.3 ビット演算 <a id="SS_3_5_3"></a></h3>
<ul>
<li>オーバーフロー、アンダーフローしたときの符号の扱い方が未定義であるため、
signed変数へのビット演算を使用しない。
(「2の階乗での除算は、ビット演算に置き換えることで実行速度が速くなる」というのは都市伝説である)。</li>
<li>[注意] ビット演算にはstd::bitsetや<a
href="design_pattern.html#SS_9_2">BitmaskType</a>を使用することもできる。</li>
</ul>
<h3 id="論理演算">3.5.4 論理演算 <a id="SS_3_5_4"></a></h3>
<ul>
<li>&amp;&amp;や||の論理演算子の右オペランドで<a
href="term_explanation.html#SS_18_11_4">副作用</a>のある処理をしない。</li>
</ul>
<div class="sourceCode" id="cb136"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 136</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="op">++</span>b <span class="op">&gt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// NG ++bが上記の副作用</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ↑のような記述は、↓とは意味が違う</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">++</span>b<span class="op">;</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> b <span class="op">&gt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// OK 上記NGのif文と同じ意味</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">++</span>b<span class="op">;</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b <span class="op">&gt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="三項演算子">3.5.5 三項演算子 <a id="SS_3_5_5"></a></h3>
<ul>
<li>単純なif文よりも、三項演算子を優先して使用する
(const変数の条件付き初期化は三項演算子でのみ可能である)。</li>
</ul>
<div class="sourceCode" id="cb137"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 168</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="at">const</span> a0<span class="op">{</span>xxx <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> <span class="dv">4</span><span class="op">};</span>  <span class="co">// OK constで定義、初期化</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a1<span class="op">;</span>  <span class="co">// NG a1をconstにできない</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>             <span class="co">//    定義と初期が分離してしまう</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>xxx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_5_1">演習-三項演算子</a></li>
</ul>
<h3 id="メモリアロケーション">3.5.6 メモリアロケーション
<a id="SS_3_5_6"></a></h3>
<h4 id="new">3.5.6.1 new <a id="SS_3_5_6_1"></a></h4>
<ul>
<li>オブジェクトのダイナミックな生成には、特別な理由がない限りnewを使用せず、
std::make_unique&lt;&gt;やstd::make_shared&lt;&gt;を使用する。
また、特別な理由でnewした場合、そのポインタはstd::unique_ptr&lt;&gt;やstd::shared_ptr&lt;&gt;で管理する。</li>
<li>new(nothrow)、プレースメントnewは使用しない。</li>
<li>配列型オブジェクトのダイナミックな生成を避け、
代わりにstd::arrayをダイナミックに生成するか、std::vectorを使用する。</li>
<li>newの戻り値がnullptrであることはない、
もしくはnewがnullptrを返してきた場合、リカバリーすることはできないため、
new演算子の返り値をnullptrと比較しない。
<ul>
<li>operator
newを独自に実装した場合でも、newはnullptrを返してはならない。
メモリが不足した場合、assert(false)させるかstd::bad_allocをthrowする。</li>
</ul></li>
<li>スタック上で生成しても差し支えないオブジェクトをダイナミックに生成しない。</li>
<li>newを禁止したいクラスには、privateなoperator
new()を宣言する(定義は不要)か、= deleteする。</li>
</ul>
<h4 id="delete">3.5.6.2 delete <a id="SS_3_5_6_2"></a></h4>
<ul>
<li><a
href="term_explanation.html#SS_18_1_10">不完全型</a>のオブジェクトへのポインタをdeleteしない。
特に「<a
href="design_pattern.html#SS_9_3">Pimpl</a>」を使用する場合には注意が必要である。</li>
</ul>
<div class="sourceCode" id="cb138"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 202</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deleteA<span class="op">(</span>A<span class="op">*</span> a_ptr<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Aが不完全型だった場合、deleteAは、A::~A()にアクセスできないため、A::~A()は呼び出されない</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// これはリソースリークにつながる</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> a_ptr<span class="op">;</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// やむを得ず、deleteAのような関数を作る場合、下記のようにstatic_assertをdelete行の直前に書く</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// こうすることによりAが不完全型であった場合、コンパイルエラーとなる</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deleteA2<span class="op">(</span>A<span class="op">*</span> a_ptr<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(*</span>a_ptr<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&quot;incomplete type&quot;</span><span class="op">);</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> a_ptr<span class="op">;</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// やむを得ず、deleteAのような関数を作る場合、std::unique_ptr&lt;&gt;を使用することもできる</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// こうすることによりAが不完全型であった場合、コンパイルエラーとなる</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deleteA3<span class="op">(</span>A<span class="op">*</span> a_ptr<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>A<span class="op">&gt;</span> a<span class="op">(</span>a_ptr<span class="op">);</span> <span class="op">}</span></span></code></pre></div>
<ul>
<li>不完全型と同じような不具合が起こるためvoid*をdeleteしない。</li>
</ul>
<div class="sourceCode" id="cb139"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 224</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> delete_ptr<span class="op">(</span><span class="dt">void</span><span class="op">*</span> v_ptr<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NG</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 任意の型のポインタは、キャストすること無しでこの関数に渡すことができる</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// そのポインタがクラス型であった場合でも、void*として扱われるため、</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// そのクラスのデストラクタは呼び出されない</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> v_ptr<span class="op">;</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deleteA4<span class="op">(</span>A<span class="op">*</span> ptr<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>        delete_ptr<span class="op">(</span>ptr<span class="op">);</span>  <span class="co">// NG ptrはvoid*へ暗黙のキャストが行われる</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>                          <span class="co">//    delete_ptrでは、A::~A()は呼び出されない</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>deleteはオペランドがnullptrであった場合、何もしないため、delete対象ポインタをnullptrと比較しない。</li>
</ul>
<div class="sourceCode" id="cb140"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 244</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ptr <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// NG nullptrとの比較は不要</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> ptr<span class="op">;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">delete</span> ptr<span class="op">;</span>  <span class="co">// OK ptrがnullptrでも問題ない</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_5_2">演習-delete</a></li>
</ul>
<h4 id="メモリ制約が強いシステムでのoperator-new">3.5.6.3
メモリ制約が強いシステムでの::operator new <a id="SS_3_5_6_3"></a></h4>
<ul>
<li><p>[注意]このルールは以下のようなソフトウェアを対象とする。</p>
<ul>
<li>使用できるメモリが少なく、且つほとんど再起動されない。</li>
<li>メモリリークの可能性を否定できない3rdパーティライブラリを使っている。</li>
<li>MISRA/AUTOSAR C++等のヒープの使用制限が強い規約を守る必要がある
(ヒープを使った場合の最長処理時間の決定が難しいためリアルタイム性に問題がある)。</li>
</ul>
<p>このようなソフトウェア開発においてはこのルールは重要であるが、
逆にそのような制限のないソフトウェア開発においては不要である。</p></li>
<li><p>デフォルトのグローバルnewを使用しない。</p>
<ul>
<li>リアルタイム性に制約のあるシステムでは、 「<a
href="dynamic_memory_allocation.html#SS_14_2">グローバルnew/deleteのオーバーロード</a>」で述べたようなnewを実装する。</li>
<li>メモリ制限が強いシステムでは、ダイナミックなオブジェクト生成を避け、
やむを得ない場合、「<a
href="dynamic_memory_allocation.html#SS_14_3">クラスnew/deleteのオーバーロード</a>」
で述べたようなクラス毎のnewを実装する。</li>
</ul></li>
<li><p>エクセプションの送出にダイナミックなメモリアロケーションを使用している場合
(多くのコンパイラはmalloc/newを用いてエクセプション送出を行っている)、
エクセプションの送出をしない(「<a
href="dynamic_memory_allocation.html#SS_14_4_4">エクセプション処理機構の変更</a>」参照)。</p></li>
</ul>
<h3 id="sizeof">3.5.7 sizeof <a id="SS_3_5_7"></a></h3>
<ul>
<li>sizeof(型名)とsizeof(インスタンス名)の両方が使える場合、sizeof(インスタンス名)を優先的に使用する。</li>
<li>ポインタ型変数に関して、それが指しているインスタンスのサイズを獲得する場合は、
sizeof(*ポインタ型変数名)を使用する
(そのポインタがnullptrであってもデリファレンスされないので問題ない)。</li>
</ul>
<div class="sourceCode" id="cb141"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 270</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span>  a <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span><span class="op">*</span> b <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">;</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_0</span> <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">uint8_t</span><span class="op">);</span>  <span class="co">// NG aのサイズをs_0に代入したい場合</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_1</span> <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>a<span class="op">);</span>        <span class="co">// OK aのサイズをs_1に代入したい場合</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_2</span> <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(*</span>b<span class="op">);</span>       <span class="co">// OK *bのサイズをs_2に代入したい場合</span></span></code></pre></div>
<ul>
<li>上記例を除き、sizeof演算子のオペランドは一見<a
href="term_explanation.html#SS_18_11_4">副作用</a>を持っているような式を含んではならない。</li>
</ul>
<div class="sourceCode" id="cb142"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 282</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> size_3 <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(++</span>a<span class="op">);</span>  <span class="co">// NG  おそらく意図通りには動かない</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// この行でもa == 0(++aは効果がない)</span></span></code></pre></div>
<ul>
<li>C++03のテンプレートの実装でよく使われたsizeofによるディスパッチを行わない。</li>
</ul>
<div class="sourceCode" id="cb143"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 295</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記のようなsizeofディスパッチはC++03ではよく使われたが、</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// C++11ではtype_traitsを使えば、もっとスマートに実装できる</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> True <span class="op">{</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> temp<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> False <span class="op">{</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> temp<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> True  sizeof_dispatch<span class="op">(</span><span class="dt">int32_t</span><span class="op">);</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> False sizeof_dispatch<span class="op">(...);</span></span></code></pre></div>
<div class="sourceCode" id="cb144"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 312</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>sizeof_dispatch<span class="op">(</span><span class="dt">int</span><span class="op">{}))</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>True<span class="op">),</span> <span class="st">&quot;int32_t is int&quot;</span><span class="op">);</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>sizeof_dispatch<span class="op">(</span><span class="bu">std::</span>string<span class="op">{}))</span> <span class="op">!=</span> <span class="kw">sizeof</span><span class="op">(</span>True<span class="op">),</span> <span class="st">&quot;int32_t is not string&quot;</span><span class="op">);</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 上記はC++11では下記のように実装すべき</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int32_t</span><span class="op">&gt;,</span> <span class="st">&quot;int32_t is int&quot;</span><span class="op">);</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(!</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> <span class="dt">int32_t</span><span class="op">&gt;,</span> <span class="st">&quot;int32_t is not string&quot;</span><span class="op">);</span></span></code></pre></div>
<ul>
<li>一見、配列に見えるポインタをsizeofのオペランドにしない。 (「<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb145"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 327</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">(</span><span class="dt">int8_t</span> arg_array0<span class="op">[</span><span class="dv">5</span><span class="op">],</span> <span class="dt">int8_t</span> arg_array1<span class="op">[],</span> <span class="dt">int8_t</span> <span class="op">(&amp;</span>arg_array2<span class="op">)[</span><span class="dv">5</span><span class="op">])</span> <span class="kw">noexcept</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int8_t</span><span class="op">*</span> ptr<span class="op">;</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int8_t</span>  array<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// arg_array0、arg_array1の型は、int8_t*</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 従って、sizeof(arg_array0)の値は、sizeof(int8_t) * 5ではなく、sizeof(int8_t*)である</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 64bit環境でコンパイルポインタサイズは8バイト</span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="dv">8</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>arg_array0<span class="op">),</span> <span class="st">&quot;arg_array0 is a pointer but an array&quot;</span><span class="op">);</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="dv">8</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>arg_array1<span class="op">),</span> <span class="st">&quot;arg_array1 is a pointer but an array&quot;</span><span class="op">);</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="dv">5</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>arg_array2<span class="op">),</span> <span class="st">&quot;arg_array2 is an array&quot;</span><span class="op">);</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="dv">8</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>ptr<span class="op">),</span> <span class="st">&quot;ptr must be 8 bytes on 64bit environment&quot;</span><span class="op">);</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="dv">5</span> <span class="op">==</span> <span class="kw">sizeof</span><span class="op">(</span>array<span class="op">),</span> <span class="st">&quot;int8_t[5] is 5 bytes&quot;</span><span class="op">);</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_5_3">演習-sizeof</a></li>
</ul>
<h3 id="ポインタ間の演算">3.5.8 ポインタ間の演算
<a id="SS_3_5_8"></a></h3>
<ul>
<li>同一オブジェクト(配列等)の要素を指さないポインタ間の除算や比較をしない。</li>
</ul>
<div class="sourceCode" id="cb146"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 363</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int8_t</span>  a0<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int8_t</span>  a1<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int8_t</span><span class="op">*</span> end0<span class="op">{&amp;</span>a0<span class="op">[</span><span class="dv">5</span><span class="op">]};</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int8_t</span><span class="op">*</span> end1<span class="op">{&amp;</span>a1<span class="op">[</span><span class="dv">5</span><span class="op">]};</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int8_t</span><span class="op">*</span> curr<span class="op">{</span>a0<span class="op">};</span> curr <span class="op">&lt;</span> end0<span class="op">;</span>  <span class="co">// OK currもend0もa0のどこかを指している</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>         <span class="op">++</span>curr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>curr <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int8_t</span><span class="op">*</span> curr<span class="op">{</span>a0<span class="op">};</span> curr <span class="op">&lt;</span> end1<span class="op">;</span>  <span class="co">// NG currとend1は別々のオブジェクトを指している</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>         <span class="op">++</span>curr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>curr <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="rtti">3.5.9 RTTI <a id="SS_3_5_9"></a></h3>
<ul>
<li>[注意] <a href="design_pattern.html#SS_9_9">RAII(scoped
guard)</a>との混乱に気を付ける。</li>
<li><a href="term_explanation.html#SS_18_10_16">Run-time Type
Information</a>を使用したラインタイム時の型による場合分けは、
それ以外に解決方法がない場合や、実装が大幅にシンプルになる場合を除き行わない
(「<a
href="term_explanation.html#SS_18_8_1">等価性のセマンティクス</a>」参照)。
<ul>
<li>単体テストやロギングのでtypeidの使用は問題ない。</li>
<li>派生クラスの型によって異なる動作にしたい場合には、仮想関数を使うか、
<a
href="design_pattern.html#SS_9_20">Visitor</a>パターン等により実現できる。</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb147"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 383</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="op">~</span>Base<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_0 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_1 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// NGの例</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> b_do_something<span class="op">(</span>Base <span class="at">const</span><span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="kw">typeid</span><span class="op">(</span>b<span class="op">).</span>name<span class="op">()};</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bの実際の型を使った場合分けによる最悪のコード</span></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// dynamic_castによる場合分けも、下記のコードより大きく改善するわけではない</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> <span class="st">&quot;4Base&quot;</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// マングリングされたBase</span></span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> <span class="st">&quot;9Derived_0&quot;</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// マングリングされたDerived_0</span></span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> <span class="st">&quot;9Derived_1&quot;</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// マングリングされたDerived_1</span></span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a>            <span class="ot">assert</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb148"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 471</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// OKの例</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 上記のb_do_somethingにポリモーフィズムを適用しリファクタリング</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> DoSomething<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> do_something<span class="op">();</span> <span class="op">}</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> do_something<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_0 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> do_something<span class="op">()</span> <span class="kw">noexcept</span> <span class="kw">override</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived_1 <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">virtual</span> <span class="dt">void</span> do_something<span class="op">()</span> <span class="kw">noexcept</span> <span class="kw">override</span></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// virtual Base::do_something()により醜悪なswitchが消えた</span></span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> b_do_something<span class="op">(</span>Base<span class="op">&amp;</span> b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span> b<span class="op">.</span>DoSomething<span class="op">();</span> <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>コンストラクタやデストラクタ内でRTTIの機能を使わない (「<a
href="programming_convention.html#SS_3_3_2_2">コンストラクタ</a>」、「<a
href="programming_convention.html#SS_3_3_2_6">デストラクタ</a>」参照)</p></li>
<li><p><a
href="exercise_q.html#SS_19_5_4">演習-dynamic_castの削除</a></p></li>
</ul>
<h3 id="キャスト暗黙の型変換">3.5.10 キャスト、暗黙の型変換
<a id="SS_3_5_10"></a></h3>
<ul>
<li>キャストが必要な式等は、設計レベルの問題を内包していることがほとんどであるため、設計を見直す。</li>
<li>Cタイプキャストは使用しない。</li>
<li>const_cast、 dynamic_castはそれ以外に解決方法がない場合や、
実装が大幅にシンプルになる場合を除き使用しない。</li>
<li>reinterpret_castはハードウエアレジスタ等のアドレスを表す目的以外で使用しない。</li>
<li>ダウンキャストを行う目的でstatic_castを使用しない。</li>
</ul>
<div class="sourceCode" id="cb149"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 524</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Base <span class="op">{</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Derived <span class="op">:</span> <span class="kw">public</span> Base <span class="op">{</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span>  d     <span class="op">=</span> Derived<span class="op">{};</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>        Base<span class="op">*</span> b_ptr <span class="op">=</span> <span class="op">&amp;</span>d<span class="op">;</span>  <span class="co">// ここまでは良い</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> d_ptr <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span>Derived<span class="op">*&gt;(</span>b_ptr<span class="op">);</span>  <span class="co">// ダウンキャスト、動作保証はない</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>strnlenや、memcpyのような例を除き、void*への暗黙の型変換を行わない
(これをすると、後にダウンキャストが必要になる)。</li>
</ul>
<div class="sourceCode" id="cb150"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 548</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">()</span> <span class="op">:</span> <span class="va">str_</span><span class="op">{</span><span class="bu">std::</span>make_unique<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;(</span><span class="st">&quot;sample&quot;</span><span class="op">)}</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>A<span class="op">()</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="va">str_</span><span class="op">;</span>  <span class="co">// ~unique_ptr()は~A()から呼ばれる</span></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> B<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb151"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/operator_ut.cpp 576</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span><span class="op">*</span> v <span class="op">=</span> <span class="kw">new</span> A<span class="op">;</span>  <span class="co">// 暗黙の型変換</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                      <span class="co">// これ自体は問題ないが、vをdeleteすると</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>                      <span class="co">// A::~A()が呼び出されないためメモリリークする</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    B<span class="op">*</span> b <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span>B<span class="op">*&gt;(</span>v<span class="op">);</span>  <span class="co">// ダウンキャストの一種で、極めて悪質なことが多い</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// 実際、このコードの中にクラスBの定義はないが</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>                                <span class="co">// このようなことができてしまう</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">delete</span> v<span class="op">;</span>          <span class="co">// このdeleleは、A::~A()を呼び出さない</span></span></code></pre></div>
<ul>
<li><p>strnlenや、memcpyのような例を除き、配列からポインタへの暗黙の型変換をしない。
配列を関数の仮引数にしたい場合は、配列へのリファレンスを使う。
これにより、その関数内でも配列の長さが使用できる (「<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>」、 「<a
href="programming_convention.html#SS_3_5_7">sizeof</a>」、「<a
href="programming_convention.html#SS_3_6_1">関数型マクロ</a>」参照)。</p></li>
<li><p><a href="exercise_q.html#SS_19_5_5">演習-キャスト</a></p></li>
</ul>
<h2 id="プリプロセッサ命令">3.6 プリプロセッサ命令
<a id="SS_3_6"></a></h2>
<ul>
<li>ソースコードの可読性劣化や単体テストの阻害要因となるため、.cpp内での#if/#ifdef等を使用しない。</li>
</ul>
<div class="sourceCode" id="cb152"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 14</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef DEBUG  </span><span class="co">// NG</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="ot">__func__</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;:&quot;</span> <span class="op">&lt;&lt;</span> <span class="ot">__LINE__</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0  </span><span class="co">// NG</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a><span class="co">        return true;</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span>  <span class="co">// NG</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// やむを得ず条件付きコンパイルが必要な場合、下記のように書き、関数ブロックの中に</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// #ifdefは書かない。</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef DEBUG</span></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DEBUG_COUT</span><span class="op">()</span><span class="pp"> </span><span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span><span class="pp"> </span><span class="ot">__func__</span><span class="pp"> </span><span class="op">&lt;&lt;</span><span class="pp"> </span><span class="st">&quot;:&quot;</span><span class="pp"> </span><span class="op">&lt;&lt;</span><span class="pp"> </span><span class="ot">__LINE__</span><span class="pp"> </span><span class="op">&lt;&lt;</span><span class="pp"> </span><span class="bu">std::</span>endl</span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DEBUG_COUT</span><span class="op">()</span></span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> g<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a>        DEBUG_COUT<span class="op">();</span></span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb152-34"><a href="#cb152-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>ヘッダファイル内での#if/#ifdef/#ifndefに関しては、以下の用途以外では使わない。
<ul>
<li>二重インクルードガード(「<a
href="programming_convention.html#SS_3_7_4">二重読み込みの防御</a>」参照)</li>
<li>Cとシェアするヘッダファイルでの下記例</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb153"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor.h 3</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef __cplusplus</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="st">&quot;C&quot;</span> <span class="op">{</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif  </span><span class="co">// __cplusplus</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">bool</span> func_shared_c<span class="op">();</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef __cplusplus</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif  </span><span class="co">// __cplusplus</span></span></code></pre></div>
<ul>
<li>##によるシンボルの生成を使用しない。</li>
</ul>
<div class="sourceCode" id="cb154"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 53</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define GEN_SYMBOL</span><span class="op">(</span><span class="va">x_</span><span class="op">,</span><span class="pp"> </span><span class="va">y_</span><span class="op">)</span><span class="pp"> </span><span class="va">x_</span><span class="op">##</span><span class="va">y_</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> h<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> GEN_SYMBOL<span class="op">(</span>a<span class="op">,</span> b<span class="op">);</span>  <span class="co">// int ab;と同じ</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>        ab <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ab<span class="op">;</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>出荷仕向け等の理由から、やむを得ずプリプロセッサ命令を使わざるを得ない場合、
#if等で囲まれて区間をなるべく短くする。
これによりより多くのコードがコンパイルされるようにできる (「<a
href="programming_convention.html#SS_3_8_3">using宣言/usingディレクティブ</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb155"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 72</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ヘッダファイルでの宣言(NGのパターン)</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> ShippingRegions <span class="op">{</span> Japan<span class="op">,</span> US<span class="op">,</span> EU <span class="op">};</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ShippingData <span class="op">{</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかの宣言</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ShippingDoSomething<span class="op">(</span>ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data<span class="op">);</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>Japan<span class="op">;</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>    ShippingData <span class="at">const</span> region_data<span class="op">{</span></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかのデータ</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>US<span class="op">;</span></span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a>    ShippingData <span class="at">const</span> region_data<span class="op">{</span></span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかのデータ</span></span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>EU<span class="op">;</span></span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a>    ShippingData <span class="at">const</span>        region_data<span class="op">{</span></span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかのデータ</span></span>
<span id="cb155-34"><a href="#cb155-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb155-35"><a href="#cb155-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-36"><a href="#cb155-36" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb155-37"><a href="#cb155-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> <span class="st">&quot;SHIP_TO_JAPAN/US/EU must be defined&quot;</span><span class="op">);</span></span>
<span id="cb155-38"><a href="#cb155-38" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb155-39"><a href="#cb155-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-40"><a href="#cb155-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb155-41"><a href="#cb155-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// .cppファイルでの定義(NGのパターン)</span></span>
<span id="cb155-42"><a href="#cb155-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb155-43"><a href="#cb155-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ShippingDoSomething<span class="op">(</span>ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data<span class="op">)</span></span>
<span id="cb155-44"><a href="#cb155-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb155-45"><a href="#cb155-45" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-46"><a href="#cb155-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかの処理</span></span>
<span id="cb155-47"><a href="#cb155-47" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-48"><a href="#cb155-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかの処理</span></span>
<span id="cb155-49"><a href="#cb155-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; defined(SHIP_TO_EU)  </span><span class="co">// NG</span></span>
<span id="cb155-50"><a href="#cb155-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかの処理</span></span>
<span id="cb155-51"><a href="#cb155-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb155-52"><a href="#cb155-52" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> <span class="st">&quot;SHIP_TO_JAPAN/US/EU must be defined&quot;</span><span class="op">);</span></span>
<span id="cb155-53"><a href="#cb155-53" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb155-54"><a href="#cb155-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb156"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 140</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ヘッダファイルでの宣言(OKのパターン)</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> ShippingRegions <span class="op">{</span> Japan<span class="op">,</span> US<span class="op">,</span> EU <span class="op">};</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ShippingData <span class="op">{</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 何らかの宣言</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ShippingDoSomething<span class="op">(</span>ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data<span class="op">);</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data<span class="op">;</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>Japan<span class="op">;</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>US<span class="op">;</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> ShippingRegions shipping_region <span class="op">=</span> ShippingRegions<span class="op">::</span>EU<span class="op">;</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> <span class="st">&quot;SHIP_TO_JAPAN/US/EU must be defined&quot;</span><span class="op">);</span></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// .cppファイルでの定義(OKのパターン、以下にはプリプロセッサ命令は出てこない)</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ShippingDoSomething<span class="op">(</span>ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data<span class="op">)</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>Japan<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>US<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>EU<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 何らかの処理</span></span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">static_assert</span><span class="op">(</span>shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>Japan</span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>                          <span class="op">||</span> shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>US</span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>                          <span class="op">||</span> shipping_region <span class="op">==</span> ShippingRegions<span class="op">::</span>EU<span class="op">);</span></span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span>ShippingRegions sr<span class="op">&gt;</span></span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>    ShippingData <span class="at">const</span><span class="op">&amp;</span> gen_shipping_data<span class="op">()</span></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>sr <span class="op">==</span> ShippingRegions<span class="op">::</span>Japan<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">static</span> ShippingData <span class="at">const</span> region_data<span class="op">{</span></span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 何らかのデータ</span></span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> region_data<span class="op">;</span></span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>sr <span class="op">==</span> ShippingRegions<span class="op">::</span>US<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">static</span> ShippingData <span class="at">const</span> region_data<span class="op">{</span></span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 何らかのデータ</span></span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> region_data<span class="op">;</span></span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>sr <span class="op">==</span> ShippingRegions<span class="op">::</span>EU<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">static</span> ShippingData <span class="at">const</span> region_data<span class="op">{</span></span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 何らかのデータ</span></span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb156-72"><a href="#cb156-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> region_data<span class="op">;</span></span>
<span id="cb156-73"><a href="#cb156-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-74"><a href="#cb156-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb156-75"><a href="#cb156-75" aria-hidden="true" tabindex="-1"></a>            <span class="kw">static_assert</span><span class="op">(</span>sr <span class="op">==</span> ShippingRegions<span class="op">::</span>Japan <span class="op">||</span> sr <span class="op">==</span> ShippingRegions<span class="op">::</span>US</span>
<span id="cb156-76"><a href="#cb156-76" aria-hidden="true" tabindex="-1"></a>                          <span class="op">||</span> sr <span class="op">==</span> ShippingRegions<span class="op">::</span>EU<span class="op">);</span></span>
<span id="cb156-77"><a href="#cb156-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb156-78"><a href="#cb156-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-79"><a href="#cb156-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-80"><a href="#cb156-80" aria-hidden="true" tabindex="-1"></a>    ShippingData <span class="at">const</span><span class="op">&amp;</span> region_data <span class="op">=</span> gen_shipping_data<span class="op">&lt;</span>shipping_region<span class="op">&gt;();</span></span></code></pre></div>
<h3 id="関数型マクロ">3.6.1 関数型マクロ <a id="SS_3_6_1"></a></h3>
<ul>
<li>関数型マクロ以外に方法がない場合を除き、関数型マクロを定義しない。
その代わりに関数テンプレートを定義する。こうすることで下記のような誤用を防ぐことができる。</li>
</ul>
<div class="sourceCode" id="cb157"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 242</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ARRAY_LENGTH</span><span class="op">(</span><span class="va">array_</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="va">array_</span><span class="op">)</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="kw">sizeof</span><span class="op">(</span><span class="va">array_</span><span class="op">[</span><span class="dv">0</span><span class="op">]))</span><span class="pp">  </span><span class="co">// NG</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="dt">size_t</span> N<span class="op">&gt;</span>  <span class="co">// OK</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">size_t</span> array_length<span class="op">(</span>T <span class="at">const</span> <span class="op">(&amp;)[</span>N<span class="op">])</span> <span class="kw">noexcept</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> N<span class="op">;</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// arrayは配列へのリファレンスだが関数中では配列</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> f0<span class="op">(</span><span class="dt">bool</span> use_macro<span class="op">,</span> <span class="dt">int32_t</span> <span class="op">(&amp;</span>array<span class="op">)[</span><span class="dv">5</span><span class="op">])</span> <span class="kw">noexcept</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>use_macro<span class="op">)</span> <span class="op">{</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ARRAY_LENGTH<span class="op">(</span>array<span class="op">);</span>  <span class="co">// この場合は、関数型マクロでも正しく処理できるが好ましくない</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> array_length<span class="op">(</span>array<span class="op">);</span>  <span class="co">// OK</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// fake_arrayは配列に見えるが実際にはポインタ</span></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> f1<span class="op">(</span><span class="dt">bool</span> use_macro<span class="op">,</span> <span class="dt">int32_t</span> fake_array<span class="op">[</span><span class="dv">5</span><span class="op">])</span> <span class="kw">noexcept</span></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>use_macro<span class="op">)</span> <span class="op">{</span></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ARRAY_LENGTH<span class="op">(</span>fake_array<span class="op">);</span>  <span class="co">// NG 誤用でもコンパイルできてしまい不正値を返す</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">// return  array_length(fake_array); // OK 誤用のためコンパイルエラー</span></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> array <span class="op">=</span> <span class="kw">reinterpret_cast</span><span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">(*)[</span><span class="dv">5</span><span class="op">]&gt;(</span>fake_array<span class="op">);</span>  <span class="co">// 無理やりコンパイル</span></span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> array_length<span class="op">(*</span>array<span class="op">);</span></span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>関数型マクロの中に文がある場合、do-while(0)イデオムを使用する (「<a
href="programming_convention.html#SS_3_4_9">マクロの中の文</a>」参照)。</li>
</ul>
<h3 id="マクロ定数">3.6.2 マクロ定数 <a id="SS_3_6_2"></a></h3>
<ul>
<li>マクロ定数以外に方法がない場合を除き、マクロ定数を定義しない。
その代わりにconstexpr uint32_t等や、enumを定義する。</li>
</ul>
<div class="sourceCode" id="cb158"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/preprocessor_ut.cpp 293</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define XXX_LENGHT </span><span class="dv">5</span><span class="pp">  </span><span class="co">// NG</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">uint32_t</span> YyyLenght<span class="op">{</span><span class="dv">5</span><span class="op">};</span>  <span class="co">// OK</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define XXX_TYPE_A </span><span class="dv">0</span><span class="pp">  </span><span class="co">// NG</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define XXX_TYPE_B </span><span class="dv">1</span><span class="pp">  </span><span class="co">// NG</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define XXX_TYPE_C </span><span class="dv">2</span><span class="pp">  </span><span class="co">// NG</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> XxxType <span class="op">{</span>  <span class="co">// OK</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>        A <span class="op">=</span> <span class="dv">0</span><span class="op">,</span>            <span class="co">//      Aの値が必要だと前提</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>        B<span class="op">,</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>        C</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<h2 id="パッケージとその構成ファイル">3.7 パッケージとその構成ファイル
<a id="SS_3_7"></a></h2>
<h3 id="パッケージの実装と公開">3.7.1 パッケージの実装と公開
<a id="SS_3_7_1"></a></h3>
<ul>
<li>パッケージに関して、以下の構造を持つようにソースコードを構成する
(「<a
href="architecture.html#SS_10_3">アーキテクチャとファイル構造</a>」参照)。
<ul>
<li>ソフトウェアはパッケージに分割される。</li>
<li>パッケージは、複数のヘッダファイルと複数の.cppファイルから作られる。</li>
<li>パッケージを構成するファイルは、このパッケージ専用ディレクトリに保存される。</li>
<li>パッケージは他のパッケージとは排他的な<a
href="programming_convention.html#SS_3_8_2">名前空間</a>を持ち、
パッケージ内で宣言、定義され、外部パッケージに公開される修飾子はその名前空間に包含される。
外部パッケージに公開されない修飾子は、そのパッケージでのみ使用される名前空間か、
無名名前空間に包含されるようにする。</li>
<li>パッケージは、サブパッケージを内包する場合がある。
サブパッケージは、パッケージの要件を満たす。</li>
</ul></li>
<li>上記前提のもと、パッケージが外部にサービスを提供する場合、
そのパッケージで定義されるヘッダファイルは以下のどちらかのみを行うように構成する。
<ul>
<li>外部へ提供するクラス等を公開する(外部公開ヘッダファイル)。</li>
<li>パッケージ内部のみで使用するクラス等の宣言、定義を行う(外部非公開ヘッダファイル)。</li>
</ul></li>
</ul>
<p>
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAsUAAAIkCAIAAAB5scFoAAAAKnRFWHRjb3B5bGVmdABHZW5lcmF0ZWQgYnkgaHR0cHM6Ly9wbGFudHVtbC5jb212zsofAAAB/WlUWHRwbGFudHVtbAABAAAAeJyFU81u00AQvs9TjHJqD3Zjt6laC6HiFJBCAhGhvaKts40tkrVl7wZVVSUc01N7peICEqIgpCJegYdZ5ZC3YB1nMU5S4Yu98/3Mzufdg4STmIvRECLivSEDit3i/QjP4QKWq66qonpi6nHCBkOKNX9LYzUkCfoLxhLLrZv+HHfrr/21hG1N2F4QVPdVEy+KtI36XCFYJcG6h+Br2F8B7VJtr1XbWm0r9RxdyqcnTnREF2viaxahFptHQ0TGwyKQasVaqeT9iokqnEWlH75lqvbPHqAYoCK37yUDCzlFHkYYnqIP5R+V6d308ptMv8r0u0zfy8kVyOyjzDKZvZPZBzn5Iie3MruT6S+Z/pbpNUxvb2bZj+nlz9nNlUwV4zoXUdbHvMeiU63CWmc4T/m5PY/KR1NEZr7Kj8bfRcVq9unzf90syAPTBlYeSLkAfewfFAEZOgINuEtAEw7UVPnFge6QMH7UaeOYxkkQMrRMu27vmI2NnmDYIWdo72J937EaTmMPj141MYc3YeNpt41JKGKPYj9IeBycCK70m9AiY4IvBePBiDr4IqKsdfhMF/AxGwdxyEaUcWgdd0rC7o7hBhx7NFY7weMOHNJTIoZcKbywH7CBo7o/MfagrQ60UEM4SBk0Q+UbnymsB38ATZRnUOM9M2QAAHGJSURBVHja7J0NWBRV3/9NRQXf3w0RUGDV1VZXRYNQV1fDOxJ1VZISpf6UFBYZRUaRkqJUZCTeYqioKCUliYlRkloo2iomBYqKkZJSa626Srl3W97/3+M8z9xz78ICy77MzH4/11xcO7PD7MyZM7/zOTNnzmn1bwAAAACAltEKSQAAAAAA+AQAAAAA4BMAAAAAgE8AAAAAAD4BAAAAAACfAAAAAP6Pmzdvbt26ddmyZcng/3jjjTc+//xzg8EAnwAAAACaxNq1a8+cOaMD/83BgwdfffVVvV4PnwAAAAAah6rjsId6qa6uTk1NhU8AAAAA8IkW8d5779XV1cEnAAAAAPiE5Zw5cyYnJwc+AQAAAPDRJ1rdhf8+cfPmzaSkJPgEAAAA0FKfaMXB1dV12LBh77333o0bN4ToEz/88EO7du3op+kvfW7Kv2zcuFGj0cAnAAAAACv4BPO5oqJi4sSJNJuamipEn0hKSqLf7dSpE/194403mqggmZmZ8AkAAADAaj5BqNVqmh08eDC7ZNWqVbSkdevWffv2Xbhw4ZUrV9ivjh07plKpaHn79u1Hjhz5wQcfmG5z//79Xbp0oVkq7Bvd4MaNGwcOHOjq6jpixIgNGzYY7dvnn3+uUChIFzp37jxu3LiPP/6YeyA3btwYNGjQPffcs3PnTvpLn5t4lyUlJQU+AQAAAFjTJzQaDfPgg13yyiuvkGTQ8nXr1tFXTz75JLP80KFDtFr//v0//fTT2traw4cPz50712ib9JWbm1ubNm3Wrl3b6AYLCgpoduzYsRV3GTNmDHff9u3b17Zt2wceeKCsrOzSpUvz5s2jr8g52M3u2bOHlpBw0GfmLgv9elN8Ijs7u7q6Gj4BAAAAWM0nvvnmG6P7EyzXrl2jrzw8PJhZpsxm70mYbvPDDz9sf5ft27fX+9NGGxw/fjzNfvHFF8xsYWEhd9/IJOjz0aNHmdkLFy7QrK+vL7u1GTNm0JIdO3bQZ/pF+jxz5sym+MTly5fT09PhEwAAAIB1fOL06dNG7SfKy8upVO7bt2/r1q2ZNekD85WrqyvNXrp0qaFturi40N9t27ZxvzKzwe7du9NsbW0tM3vlyhXuvjE/Z0SbNm2Yb6uqqujn3N3dtVotzdJf+kxLSDuaohSrV6+GTwAAAAAt9Qnu+x1paWlsy4PAwEBa/vbbb1+9evW3334zLeBramoa2iZJyT333COVSs+ePct+ZWaDTfGJht7aWL58eav6YBttmCc3N7eiogI+AQAAAFjh/oQpbm5u9O0vv/xCn0tKSrgrT5gwgXmoYWabpCakFJ6ent9++22jG2Sedxw4cKDe5x1BQUH0ud5HJ2Q/3t7e9EPl5eXcGyG0ZODAgU1plUlyY91HHvAJAAAA8In/4O/vT99u2rTphx9+mDRpEndlKvg7dOgwYMCAgoKCn3/+meRgxowZpttcu3Ytleu9e/cuLi42v0GmPSZ5w5kzZ0zbY37xxRft2rXz8vKi3yUdOXHiBG1ZLpfTV7t372ZbYnJhnt3k5+c35RbFypUr4RMAAACATXzi+PHj48aNa9++vYeHx5o1a4xWPnr06MyZM8kVaIURI0bU+74osX79+tatW3fq1Gnv3r3mN8i+Lzp8+HDSBW4LCeKrr756+OGHe/ToQWIxaNCgRx999NChQ7R8+vTptObmzZuNdp6W0PLQ0NCm+MSnn36qVqvhEwAAAIAlPsFbjh07Rjbg5+dnn5+7fv26FYcbhU8AAACATziMBx98cP/+/T///HNpaSnTYILbw4StWblypcFggE8AAAAAwvaJjz/+eNy4ca6urp07dyafyMnJseevHzp0qLi4GD4BAAAACNsnHD7cKCUXfAIAAACAT7SIVatW6fV6+AQAAAAAn7CckydPFhQUwCcAAACA/2L+/PnJoDnMnTt3ddNISUlZvnx5ZWUlfAIAAADuTwDLuXz58jvvvKPVauETAAAA4BPAcm7cuJGWlgafAAAAAJ8ALcK0Iyz4BAAAAPgEgE8AAAAA8An4BAAAAACfgE8AAAAA8An4BAAAAACfAPAJAAAAAD4BnwAAAADgE/AJAAAAAD4BnwAAAADgEwA+AQAAAMAn4BMAAAAAfEI4pKSkwCcAAACImRUrVqC8tykHDx7MysqCTwAAABAzH3300SeffCKIgvnEiROCkwm1Wv3KK68YDAb4BAAAAJGTkZGxYsWKN/kNlcqDBg1avXr1m8Jh1apVqamper3eNM3hEwAAAIADGD9+/IABA4qLi8VxOPAJAAAAwN5s2bKlf//+w4cPj4uLg08AAAAAoNnodDpvb+9+dxkyZIhpWwT4BAAAAAAa4dFHH+33f9x///3ieOQBnwAAAADsx5EjR/rfxdfXl3xi4sSJ4njkAZ8AAAAA7ITBYBg6dCjJxNixYyUSyaBBgwYMGEBLRPDIAz4BAAAA2InExMR+/fpFR0cfO3YsODh49+7dHh4eQ4YMEcEjD/gEAAAAYA+qq6slEklubi59zs/PJ6ugD1lZWe7u7iJ45AGfAAAAAOxBYmJiZWUl8zklJYUdUmvdunUymUzojzzgEwAAAIDN0el0dXV17GxUVFR+fj47W1BQUFJSAp8AAAAAQDNQKpVlZWXcJVzbgE8AAAAAoHF8fHyELhDwCQAAAMCR1NbWymQykR0UfAIAAACwK8XFxSqVCj4BAAAAAMvJysqKj4+HTwAAAADAchITEzMyMuATAAAAALCciIiIoqIi+AQAAAAALEcmk9XU1MAnAAAAAGAhOp1OIpGI77jgEwAAAID9KCkpCQkJgU8AAAAAwHKysrISEhLgEwAAAACwnPj4eFIK+AQAAAAALCckJEStVsMnAAAAAGA5Pj4+Op0OPgEAAAAAC6mpqZHL5aI8NPgEAAAAYCcKCwsjIiLgEwAAAACwnPT09KSkJPgEAAAAACwnKioqPz8fPgEAAAAAy1EoFBUVFfAJAAAAAFhIXV2dl5eXwWCATwAAAADAQkpKSkJDQ8V6dPAJAAAAwB5kZGQkJibCJwAAAABgOVFRUXl5efAJAAAAAFhOQEBAVVUVfAIAAAAAFqLVaiUSiYgPED4BAAAA2JyioqKwsDD4BAAAAAAsJy0tTaw9Y8InAAAAADsRGRlZWFgInwAAAACA5Uil0traWvgEAAAAACyETIJ8QtzHCJ8AAAAAbIuIhymHTwAAAAB2Ijk5OS0tDT4BAAAAAMsJCQkpKSmBTwAAAADAQvR6vY+PT11dHXwCAAAAABZSUlISEhIi+sOETwAAAAA2JDU1NTk5GT4BAAAAAMtRqVSHDh2CTwAAAADAQgwGgzM0noBPAAAAADaktLRUqVQ6w5HCJwAAAABbkZ6enpiYCJ8AAAAAgOWEh4eLexgw+AQAAABgW5jGEzqdDj4BAAAAAAspKytzksYT8AkAAADAVmRmZsbHx8MnAAAAAGA5kZGR+fn58AkAAAAAWI5EItFoNPAJAAAAAFhIaWmpQqFwnuOFTwAAAADWx0mG7YBPAAAAEA8Gg4FvuxQSElJSUgKfAAAAEVQQV72dmoRJ9NPK5Ff79et39uxZ/uQ9rVbr4+PDQ8uBTwAAgAU+seLOv3/A5AwT+cSwYUP5oxR5eXlRUVFOdbnBJwAA8AlMYvCJvQWb+aMUMTExOTk58AkAAIBPYBKYT9Bf/iiFVCqtra2FTwAAAHwCk/B8gidK4WxvisInAADwCUxi8wk+KIWzvSkKnwAAOKlPtGrVyj6FnN1+CBPXJxyuFCEhIWq1Gj4BAADwCcH7xKbNKd99/1mjq92qK2/F4ey5L220P3/9XWXBf93WV9I/1v1e8Yvm+Pmqg8WHc6/UHmuKTzhQKTQajUQicao3ReETAAD4hPFUXvG5j48nsw5D3769FiyY9etvJ/nmE+we3nPPPbST8+Y9XPNTCfvtyJFSKn3pg+Gv8xcvHf7j9hn68Psfp2mdm7fK693guHEjj5/It3h/6H8L9m3O3Lgq6Y0lMTERc+c+NGHCWKnUt3fvHi4ubd9OfYVZLe+TDPoho/+9fqPso4/XmW5z4MAB9O/e3h60naFDfelgly2PbaJPOEopcnNzo6OjnfByg08AAOAT/5nWvPtadPSj3HV+unyUisZHHw3loU+wVf/LV47GxUUFBY1hv+3atbPu5vf0QXvt227dupBzMPLRqZPb18U7Tbf2i+Z4YOCo/D3vW7w/kybdr1CM+3//L4x8ImvLW2+9vbRfv97094fqr27rK9nV9n2W5e8vM/rfa9dPkTfUu2PM9N33n5GF0Gab+LzDgUpBMkFKAZ8AAACn8Ilt2alU5XVzc73/fvn35YXsVw89pNiVt95IBX7+Rd2zZzfm89lzX86ePa1Hj25UYM+a9eDVX0uZ5X8azicmLvb0dKdCdN0/k4yK/BOle9zd+76blmhmC1ToksrQ8kGDBtAWuLrwxooXqI7evXvXxx+fc6uuvF5ZoSq+q2sH5rPm6okBA+41OmrDX+fN2MDqlHja4CuvPG0V1yG/GThwAB216Vdf7N82duwI0+Wp7ySEhk6pd2tr05eRKlVdOGS+/YQZfH19q6qq7JDlDAaDU40pCp8AADi7T8ycObX6x6+pbF6e9PwDD4xmlv/rz3NdunSiurJRaU119169ujOfZbIhBw7m/P7HaSq/Fy9eEBX1CLN8xcoXqHZOZV7tz988/fRj3CL/070bqfK9O/9981t47bWYf/xjIpXEND344Hh2B6igVSoDqZavvfbt/PkzX3jh/5nen6AfffnlRRMnjmOWnPx274QJY5tlAJMnB0ydGmTmv2iH6RCeeWb++PH+ffv2Ij0i+6FDqHdlSgFKkHq/OnzkoxEjhpouJwciHyJ1M3IgUqiOHd1IvOjonnpqXsXpLyzwG8oJ9slyarU6ODjYOS83+AQAwBl9ggpg5nPd7xVstf7QVx+wj/bZ0ppK93nzHqbJdDs3dN95ePzvbXZfXy/ufQ52I+nrllPRqz6+u9494W5h0KABZyr3M5+p1GR3YMgQn8qzReydEi+v/kbtJxi6d+9aXvE589X+ouw5c/7R9OL2199OUiJc+OGrbt26sPdLuBOpQ+fOHUlr1mesIGcig6F/mT17Wnj49Ho3SDtD6dbQkwumhYrpFBQ05uNd/2Rn/75zgfzJ09N967bUmp9KftOe3LQ5xfxjEYf7RHx8fFpaGnwCAACcxSfqnX311ZjXXosxKq379On52GMzqPbMtjqkqjyVl8y3bdq0YZZ36ND+j9tnTH+ILMHoIYKZLbDtDGhT7F5RSc/1htatW5seBe0e7Txtlpn9cOfap59+rOmvVCQmLp46NYg+RETMSnpjiekKZFoXLx02WkhyQ/tm+hjl2vVTLi5tG/p10gL6L3IF0/c+nn12wcsvL+LOyuVSo5awW7a+PWrUMH76hMFgkEql1dXV8AngvDjhq03AGXJUc31i7NgRX339ofmmlFS3puoyFYpUjmqvfcuu5ufnXe/9CapY+/p6vfnW0ka30ND9icGDB1X/+HWjR6G7+T17o4UK3cWLFyxYMIs+78h59+ixXWbKWir+SW6OlHxMn0+f+aJLl06Xao40pZAu+24fyRZrBtypd+8e9G1D/+ju3vfc+QPMAyaVKphVis1ZbyqVgcznXXnrvbz6m94s+f2P0yQrpurGB58oLi5WKpVOe9W3qvcKxORUU3JyIh+G+k1NXY1zgRzlQJ+gop2KUirhzPtEv369P9m94ba+8sIPX82ePY1dbWVynEIxjhaatp+4fOUoOUHyqhfNb+HVV//TfiI4eAK7/N20xClTHqCSvu73CvXx3WyjRe4eUiU+MXHx/ffL2XcyR4wYyuzGnDn/KPx8S0MFLdnA9OnKmTOncps+0IHo/3XWfAlNJTqpANv4w2iaP38m7eefhvpbgNI/Mq+P5u95Xyr1ZZd/e2rvrFkPsm1ZyDlo9xISnpkwYSwlIONkP/+idnNzpaTgoU/ExcVlZmbCJ/7D26mvoqs1J+xazs/Pz7EFALpGFlmOkkqH8EBSm+ETH+/6Z0jIpEZf9SzYt5nKNqoie3q6v7d2GbsalX9U8nl49Lv33j7rM1YYbYQkY+hQX+ZRQkNboBL6qafmde/edeDAAe+seZVWYJ8I0GpDhvhQOTpmzH3sK53chyA9enSj8pt9A+LAwRxauLdgE31+4om5ERGzLl46TGXwD9VfffX1h9zbFS+/vIh+jvtMgURHLpeGhYWwamXU0oJK/bfeXkoeMG3ahIbuE1y/UUZCM27cyJwP0uinjZ59fLF/G+3w9h1rKE0yN64yk5F+vFjcs2e3q7+W0g+NHTuCfnfq1KAlS57g4fMO5mGHs40BBp/AVE/03/PpRscqBXxCfINHO1wpmpWpFi0KZ97n5MNU9t0+KuZb8rom+QTT/wRV6OfM+Ufv3j3atGnTsaMbGQ95D9OOYfp0Zb9+vU0f09T8VEI2EBAg53aQxVhRt25dRo0aFhk5u9FGkaQvZEXDhvm1bdvm0FcfGH27bHksKcWCBbPqfVzCndLXLSf9Ikvz9vaYOHFc9vZ3Gv0Xh/hEcXFxaGioMz/lhE9g+k9XMI5VCviEKAePdqxSNCtTDRo0wLJ3Ea04Pf/841RmU6VcqQy0oBZu1DFXo8pCPtFQ99W36sojImadKito+UHp/3XWAgOw7mQHn3Dyhx3wCUzGXcs5UCngE2IdPNqBSiG4TPVuWqKHR78+fXo++eS85jYRwORAn8DDDvgEpnq6qnWUUsAnRDx4tKOUApkKk3184tChQ07+sKPZPjFv3sNfHtjBzh49tmvatAmmqy1dGp2+bnlTzvFLLz1ZsG8zfXhnzatsD7Wm48vR1phWP/R5y9a3HX7rzPT9Jfbzmcr9584fYFt3C3SoX4cohfnQb928h0xl/8GjHaIU9vcJEUQDK05GL4lcqT1G06xZD9r/crO1T8TExDj5w47m+YTm6gk3N1emJ1q221Tu8DP1xvQTpXvatm3TrVsXmlxc2jLtjdkpKuoRpje0ZctjV6fEN9Rz+8iRUib//fV3lb+/zKg98JAhPgEBcoVi3IQJY5me5rp06USzNNHu9evX29Y51c/PO++TDLbP3U2bUx58cPzpM18wO8yNL9yp3rbTFl+07A5wRwdm2lTTX7bD/6YPpWN/pTAT+q2e95CpbJ2p6h082v5KYX+fEEE0MD/RVfOn4TztMF2PF3746ttTe82sPHHiOG5FkWqPMTERL7+86IMP3xOTT+j1eh8fHyd/2NE8n0h77/XWrVv36tWdJnf3vjdvlRvF9B8vFnt59adQ6+3tQRMVAJ6e7l/s3zZlygNMt7J9+vTUXvuWPjMboal9+3asT9D67HJ2FBmqQdJv7fk0k/0V9fHdtALbVx0T+oODJ8ycOXX6dCUb+mmWppCQSbYO/VRK9e3biw0TZN90vOerDv6iOc6kSasG6N27B7eAbEn4ePjhycOHS4zCxIsvPvnsswvoA9WQqFhtrk/YXynMhH4r5j1kKvtkqoYGj7azUtjZJ4R+4kgUUt9JmDo1iBmTbM6cf5Se/PSOyTCkFLfpgho4cABdCL6+XmaGGaON0GXIvXmjVAZevHSY7bZLHD5RWFioUqn+7fQ01SfISWWyIUwHarU/f9OmTZvXXosxrSNS5mO7cx8xYuj35YVkBkxMpxqh6X2/Ru9PvP76s6Yj2y5aFD579jRu6P/p8lHmxjUT+tmRe67fKDMN/UlvLKGrZcvWt1ueR+t+r6DqCJU0TCWYJrrSHnpIwa0WUGFGBRjtG3f6ZPcGthP+lkyXao488MBoOgtsYclNuvj4p5go1qFDewt8ws5K0VDot3reQ6ayQ6YyM3i0PZWiUZ/AiWOn6h+/Hj16+GOPzfi6eCfl9mPf5H24c+2AAfea6R/iH/+YuH3HmobUhOSGUoC5jpiJHN18bxMC9YmYmJicnBz4RFN9YtPmFHbkut3575O3jh07giTAKKZTHqLaIV02P1R/JZdLmXvOTEwnZTZ1UvM+sTN3befOHdkRbrjdypL2rlr9kgW3pukKuffePu+tXdazZ7et21LvNDA0DvMO1Zp3X2M6caOJjuj9zGSjci4iYhZdftyF06ZNWJkc12jmpmv7iSfmcpeEhk7p3r0re4eGmWgnG6q4UCJvy06ldWhT9XZCl5DwzKuvxjTdJxw+1G9Dod+6eQ+Zyj6ZiieDR5v3CZw47hYCA0cxHVCSAXTs6MY8H6H16Ufr7e37u+8/o0uGuTlBK5Pis17C3HQhmaC/tFfMoPC/aI5/o/7E3b1vQw99BOoTer1eIpFotVr4RJN84uy5LylPUFRl+mV75pn52dvfqTxbRALOjenrM1ZQQKcMREpLX9EHmmV6ij1VVjB06H86VaX/oq3RRPmM9QmK18xCiWQgkyldXTuwY83NmDEl96N0dgtUVND/kkFzq5L19tHGDf1UitCvMD2rkIPTNfPp3o31VlmYTmSPHtvF7jYFHXasHSZ8xMZGjho17OatcrZt0c+/qNu1czHqAabeCvewYX5GTxCp1sI846RwQFWWf/15jv5SlHn88TlG/04XMCULbYHSh+oHDf3KkiVPMLGsKT7R2KWY6qjQb928h0zFk0xlt8EezfgEThx32rhp9aRJ9zOf6VpjB3Bn/pdxEaMmTWFhIcuWPcfuMCUmqyZ01CTopFwqVTBz54ZWZnZg1qwHG+0YQ1g+kZ+fHx4eDploqk98snvDO2tepWjr4+OZmLiYjJ550kzZot7xWrgTW0eka5I7Ig4z0eWxK299Q/cn2BF+qRhwcWlrFN/ZwWaY0L9oUfiYMfdxp2efXcAN/dpr39L+0w+xW6BrmIIIU34Y9QHXtWtnpms5X18vZtwaqjFkbFjJ3ticPl3J3Fd86+2lVHum+gotX7x4AV02jeZsqmSTpLMDCRpNFLYGDx5EH7bvWEM7zK2O0K7ST/Tp05Mq3FS1Snvv9YcfntzQryxcqGI6/RW0T1g97yFT8SFTOdwncOKMpvnzZ7JO8/rrz9KWuSlDB8jObt2WSrtEU6dObvS3b99e9L+0A9waIzOROrBPN1LfSXjuuYX0oejL7ST9ZppcCM4nVCpVQUEBZKLZ74v+ojl+332DqVbHtrGniOzn5031xUZj+q26cioMjFoJzZw59fMvtpp/v4OpIsyd+xBbHhjlRbYqSZ6+dGk0824hExfY0E/X/LhxIydMGGv0v7RluiBN7+bR5VdydBf79td3339G9s0tvegaY942pKrDK688TRFnedLznTt3pMu10QZTI0dKqYxsaIUv9m8bPXo47T9FGbY3fva+6FNPzWPvK6avW24mglCAY+pbRhHk7dRXTB+v8tYnbJf3kKkcmKkc6xM4caYnbsSIoSe//d83NUaNGsa9VUMqExw8gX0x6sEHx5NjLVv23IsvPnnn7tiktHDgwAF0ibFboOnmrXISDqYh6v9E+GXPMTcz/r5zgQ7ZtIdvgfpEVVWVTCbD+MyW+ARFUk9Pd7bFL9MmbsvWt3v06MbIb3T0o0yLX5p69epOgZiN6TSR5LK9uP/628nCz7dIJAOlUt+cD9LM+MSfhvP0o0xzPMqLpP90xTY39NNENUvTy5s2SBJN+0BrmrkhqVCMS3nzZTOZdVfe+latWsnlUvPvYlH4CAmZRJeumZ7vqN7DlJrcEXruNNCtfUMRhC54qmxdvnLUKILQUVAth1kuLJ+wYt5DpnJ4pnL4/QmcOKMTN2nS/UxXQKfKCrp378rtN4LS6oUX/h/zma4aEogbuu/IHi5eOsy90zx1ahBt+XzVQWbJ5qw3yTzYFZ5++rG0915n01A0zzuSkpKSk5NhEpb4RETELLZKx+0DgGSTMVOK6bvz32fzNzem//V3Fa184GBO3icZAwbcS/UAsmAS2Kwtb/2P7S6PpbzItosm4WV/JXv7O+yDvTt3B6rp2bPbZ4VbjEL/sGF+FOWpIKFZqhl4efWnJfU2xTeayKOHDvWlnay3HdNtfSUdMpU3Zl4Qp0uUtvDIIyH+/rLAwFENrUbXIYWPwYMHsc5e70R1DnZcY4sjSFxcFHuvlYkgdJgUFyh8XKo5IqDnHdbNe8hUPMlUfGg/gRPHPXFvrHiBin/amQkTxnLbkFac/oJchOlkgo66b99e9C8kB888M5/7lHDgwAF/3D7D7Yti5Ejp/qJsdlYmG8J9cVQcPqHX66VSaU1NDUyi2T6x5t3XqOZnvk+hhmI6WTapQ3DwBLogtde+/fkXNa3w6KOh7IA3Dd2fYN4V3L5jDWkviTP9YuHnW8iFKaCzdQi2KhkbG8n8er1VSTPTmcr9tBHSGtMWW+PH+z/0kMJMg+RP924kVY+JiaBdpXpG8eFc03WouFq1+iUqlugaM98+i/aEKgeNtuFi7z1yh1dmJ6pSd+3amb2j+EP1V23atCGHMzP2D899wlp5D5mKJ5mKtz7htCeOcjVV8Fq1akWXDPPshg6TKnu0A8uTnuc+H6H6HhkV+3jr7LkvPT3daU2jZk+0Naa7C9ryoa8+6NKlk2OHI7FFlkNLTEt8grJXZORsd/e+Rm/Z1RvTzdxz5r6btGzZcyNGDCVNNuMTtPF77rnHzc21T5+etEG5XEr5mC6Dxx6bMXr0cFaQmdD/3fef+fl5MxtkQz8tp922oF9Yqp3Mnj2NqqSvv/5sQ3WRvE8yaJdo+5s2p5jfOMUXb2+PtPder7fSw21gRcHIzMNUo+nNt5YqlYGmHe1NnhzA3Lpk25lTUn+4c60Q22NaPe8hU/EhU/HZJ5z2xDHvWjOfMzeuomuEnIDb7Vu973KTrL+x4gWj5XRB7cxdy+g4badv317sS1Vi8gm0xLTEJ37RHI+ImGUq7N+oPwkNnWLURIi9aZzzQRpVK6n+x71NzUxz5vwjLCyE24CrXp9gXppqyNzj4qK4of/ZZxcUfbmd7eb29JkvAgNHkZjT1WtZ/is5uou5j9LQtHHT6qQ3ljRFug1/nW/oQLh3YhYtCrdKvzo2uBQd5hNWz3vIVPzIUbz2CZy43/84bf542ZekuKPqGB2CuLMcWmK2tP2EjQaJaeFk/1ePnG3iQ/sJO0/IVPAJTMhyaIkpAJ/ABJ9A6EdwR6bCJNAsh5aY8AlM8AlM8AlMyHJoiQmfwASfwITgbr1MNW/ew9zH/0eP7Zo2bYLpakuXRqevW97oQd3WV9JqzMsR9HnL1ret0obgUs0R00E+uS+4Vpz+AjnKzlkOLTHhE5jgE5jgE/87aa6ecHNzNf8SsqlPnCjd07ZtG6abHBeXtnsLNnHf2Bw5Uso4xF9/V/n7y4zG0mzWIHPstDv//TFj7mvoKMiBPD3dm+I6tEt1v1f8ojl+vupg8eFcy14dR5ZDS0z4BCb4BCb4xH9Nae+93rp1a2boTnf3vlTRN/KJHy8We3n1p2Le29uDJpIPKrm/2L+NeQn5hu67Pn16si+p/XH7DG2E+3al+vhu2jIz3AzrE8HBE2bOnDp9upL1CZqlKSRkEtcnuM2Bb9WVd+zo9kP1V+QuL7+8yKijzCMlH5vpNYudBg4c0Lt3DzoKqdR36FDfVq1acccuQZZDS0zb+UQSJmaaFz4biUCTvXxilVOl6srkVxcsnNes3Bj/8nNiyVGrHOsTTJ9mTIfrtT9/06ZNm9deizG9P1F68tPw8OnM5xEjhn5fXsh2arI2fdnTTz/Grvn668/6+8uMfmXRovDZs6fd+e9OV5m7BYxPkHCw3UlxfaJ79649enSTSAZS2e/r6+Xi0pbMQ6kM5PpE6jsJS5dG08507dq57veKLw/smDhxHP3XwoUqM8Xqd99/Nm7cSKPup+ATaIlpK58ALP369bPKdtLT03NycpCegAuFJH9//6avX1BQIJFI1Go1kq7lPrFpcwqVvuwDhTlz/jF27Aiqshv5xJ+G81SnZzp6ksuldziDzA0fLjlTuZ9ZbWfu2s6dOxp1uUaT7ub3gwYNWLX6peY+79D/6yx5A/0oTZqrJz7du5E7PDozvfTSk2+9vfS55xY++mjo8qTnaYWT3+6l/xow4N5v1J801Icm/ZDRuGLwiWaRlZUVGRmJKws+YYlPWOUhWVlZWchdKioqkKqAobq6ulk+QZBMyGSykpISpF5LfOLsuS979epOJXr+nv/pSf2ZZ+Znb3+n8mxRt25duD6xPmMFyUSrVq2ohKav6APNvpuWSD5xqqyAHZ67+sevXV07sP0/zpgxJfejdHYj5B9ubq5Mz6rs/QnTyXwn7n/fuTB48CDu6Bj/KSbfSSCVeeyxGWxvm1OnBhV+vsW0P5XHH5/TsaPbrFkPkkg99dQ8Z2vFaRWfoOIgICCgtLQUVxZ8otlQuLfifa2cnBwqDBITE+vq6pC2gLRApVI1979IKSQSCdqWt8QnPtm94Z01r1JJ7+PjmZi4+N57+zCtHNa8+5qXV3/uQOSmE3t/IirqkTffWso2lWDdwsWlrZE0lH23j/u8Y9Gi8DFj7uNOzz67oNFBYXI+SDPtPP6G7jt3977z5j3M7XBz+HAJd9xwRkfmz5/p6em+dVtqzU8lv2lPbtqc0rt3j6+Ld8InmkVubq4F1yx8AljfJwitVhsbG0ubRRUTWOYTjFLI5XIohcU+we3N/b77BjMDgjPvd5AN+Pl5V54tatQnbtWVk4gYjUie9MYStot3kgyjXlbZ+xMf7/rn0qXRdxoeZO7ylaOPPz6H+UzFv1wunTo1qHXr1rvy1nM3+MQTc7t06WT0LmvPnt2MlIh8hbZg1JBzy9a3mSG74BNNR6FQIHTDJywkODi4rKzMFgWJLTYLhAUJQVRUlGX/W1VVlZ2djTRsoU9QKU61drZ3B6Y9JhW0PXp0W5/xP/9ofpC56dOVh776gNvYgrbGtPH8+86FiRPHvfLK05b5xJp3X+M29ryh+44U57PCLVx92fNp5uDBg557biGzq3f+bwCwdu1cuP1ekILUe9Pl9z9OkzwxvWXAJ5pCYWGhUqnENQWfsBCqPsJGgY3Izc2NjY1FOjjQJyIiZnFHjGPf7/i+vJB5ZEA+wYxWT1P6uuVcn/jr7ypa+cDBHPbfs7e/M2nS/exszU8lPXt2Y8eoY31i2DA/UgeyE5rt3LkjFfa0xMgnXn550auvxpjZ859/Uffp0/Orrz9csuSJjA0ruT/KtPRk7qAwhnHu/AEyjISEZyZMGEsKwjymoS24ubk6dgxxYfkEyQQpBa4p+ISFZGVl4b0gYCMqKiry8vKQDo7yiTXvvubr62W+P6uGfIKK8E6d3IKDJ9zWV3JfQN2+Y835qoOnygpoU4Wfb3n88TlkCeQKRvcnYmMjmc02dH/i6+KdvXv32JHzrubqCcNf53//4zT94/ET+dxOKZgBmZ97biH3eQf5BDmK+vjuFStfWLx4AbcvDeY5yB+3z4wdO+Ktt5dOnRpELoLnHU2kuLgYNyfgE4JBp9MhEQCwg09QmRoZOdvdva/RG571+oSZ5x3sRP91zz33UHW/T5+etKZcLp04cdz06crHHpsxevTwZ56Zz/WJ777/zM/P++atcq5P0HLaH+42v9i/7cEHx9OP0pZdXTvQtwsWzDI9lpiYiLdTX+EumT9/Zo8e3WbNetCoWShpx+DBg+69t4+3twftXvb2d/g2pDiffUKlUuXm5uKCgk8IAIPBEBQUlJ6ejqQAwNY+8YvmeETErNqfvzFa/o36k9DQKdwl8fFPsQ8scj5IW/Pua6fKCriPSFhB4b5hwZ3OVO6Pi4vi+sSzzy4o+nI7s2TFyhdOn/kiMHBU166dyQwsKCYPHvqAfbsEk418Qq1WBwQEoINt+IRgqK2tDQ0NDQ8P12q1SA3QXOLj46uqqpAOTfEJR01Gr3tgEopPREZGovkzfEJ4dymSk5P9/f3x9gdoLrm5uVSF0mg0SAre+gQmIfpERUWFTCbT6/W4muATwqOgoICyL1rqgeaSlpYWHByM3tLgE5is6BNRUVGZmZm4lOATQqWysjIhIQHpAJpLbGxsZGQkHvTCJzBZxSeqq6ulUiluTsAnrFOu44VjYCNyc3Nra2utu00yCZVKlZKSguSFT2BquU+QoNtndGX4hPg5dOhQWFgY0gHYgoCAAFu0oNRqtQqFAg0p/s8nkt9OXYYJE+UEy25O4E1++IR1sHiEBQAaxeqjwwA7o1ar0SeBiImOjk5LS0M6wCesQ2lpaXBwME92Bg/FRQZVfXAXQdAyQWeQ/iIpxBr85XI5Wk7AJ6wGVR+pEsmHPSkuLg4NDUXTfTHRr18/JIJAqaqqwhCv4obiLW4+wSfE6RMGgyHqLrhLAZ8AjqW6uhoyIW7y8/MxWgd8wsro9XoPDw+e7AyZRFhYWHx8PM6LCKitrZXJZEgHwaHT6YKCgtBborjDfkBAAEaWhk9YH169LFRXV6dQKNC5ijiKJfucx5qaGjioFcnJyUlKSkI6iJiMjIyIiAikA3xC/FDxQPXa4uJiJAVoCgaDQalUortVAJoo+lKptLq6GkkBn3AKSCaokoR0AE2krKyMHBSv0QPQKAl3QTrAJwAA9RN/F6QDAGZgOrDCCM/wCQBAg+h0OplMVlFRgaQAoCEiIyPT09ORDvAJAIA5cnJyQkNDkQ4A1EtJSUlAQAA6sIJPAAAawWAw5OXlof8SC1Cr1VYfuQ3wjeDg4Pz8fKQDfMKGFBYW4i4xsEVlCC+4C8XD0BuB6CHVDgkJQTrAJ2xLbGwsz3tdjY6OLioqwpkSFql3QTrwH7r8w8PDkQ4iRqfTyeXy0tJSJAV8wrYkJyfzvIUO1ZzoYsDbgMIiPj4efSzyH+bmBEoa0V+MePsJPoF65P+SkJAQFxeHkyUg+H/fC/z77s0JlUqFdBAxzDiiqI/BJ+xBWlpaSkoKz3eyrq6OLgk84hUQMTEx6LOS/wQFBeGyEjEGg0GhUGBoN/iE/SooVJXk/34WFRVR7MPLTkKBar0OLKiqq6szMjJwFsxDJwiDTIqb9PR0DNUBn4BP1ENUVBQ6Y4FPNAWmARpeXGqUuro6JIJYYXrDrKmpQVLAJ+xEZWWlUO6GabVaPAUUCjk5OY7t0iAzMzMyMhInAjgtYWFhuEsHnwAAtBS9Xo8euIHTkpeXp1Qq0b0bfAIAYAVwiwI4J8xwNmVlZUgKZ/SJ69evH3IOysvLkSkBblEAYDtiY2MTExORDs7oE+vWrevUqVMrp4GqjLgLB+xD1l2QDsB5YDoAREtbZ/SJ1NRUKmJHjhy5c+dOZ7g/sXjxYjpeUqiWJx2kBAALqKmpgWOJFb1eHxQUVFhYiKRwOp+4fv1627ZtFQqFU52S+++/38PDo4Ubyc7OTkhIQP4GoLmkpaXh2hErVEGNiopCOjijT1B9nSrrDh9D1s79bW/atImO+vDhwy3ZiFarlUql1dXVyOI8RKfTZWZmIh34iVKpVKvVSAfxUVFRIZPJMPS8U/sE/XXsbvj7+9uzz5Nbt2516NBh8eLFLa9mRUdHI4vzkJKSEowKwU9IweVyOdJBfBgMBjJFDJoDn7C5TzANIXniE8T8+fN79ep1+/btlmwErffhE8ACC0fLf1GSlJSEt6PhE8Y+wX0VwtXVlYrM999//86dO7bzCYVCUVlZaQuDYXBxcfH09KS8fvXqVebbzz//3CoPerKysnAJ8ZCioiIejhqAwV+I4OBgDAAmPtRqNZUUWq0WSQGfONRQ2X/x4kWlUtnyFyLM+4Qthlrg/mJdXd3q1atpdurUqcwSg8Hg4eExc+bMFv4KbScgIADxkW/wcFAYZohaJ++vvba2ViKR4MUokUF529/fnyQeSQGfMOcTxOnTp2l26NCh7JI1a9bQktatW/fr1+/JJ5+8efMm+1V5efkjjzxCy9u3bz969Gj2BgB3m1T6du3alWbffPNNZsnYsWPbtWtX7wZ37Njh4+Pj5uY2atSobdu2Ge3b4cOHp0yZ0rlz5y5dugQGBu7bt6+ho7h16xbNduzYkV3y4osvtm3b9tdff225mGPAG/hEU6BdwnhyaMIsPuLj4+Pi4pAO8InGfeL27ds0SyU6u2T58uUkGbR88+bN9FVMTAyz/Pjx466urgMGDPjyyy+p/P72228fffRRo23SV1Sot2nTZuPGjewGx48fv3btWtMNHjx4kGYDAgIu3mXcuHHcfaPdJiGYMGHChQsXrl27FhERQV+Rc9R7f4LchWZpZa76WKsjCsA30tLSUlJS+LZXlZWVMpkMTz2AmCgqKvL390fvVfCJJvlERUWF0f0Jlr/++ou+8vT0ZGaZJyP1Nkpgtrlnz572d9m1axf328LCQqZVo9EGJ02aRLNHjhxhZouLi7n7RnJAn7///ntmVqPR0KxEIuH+IpcOHTqwKzOMHDlyzJgxyKPio+QuPNyx8PDwvLw8nCAgDrRarVwux9u/8Ikm+cSlS5eM2k/8+OOPc+fO7devX+vWrZk16QPzlZubG81eu3atIZ9wcXGhvx999BH3KzMb7NGjB83eunWLmb158yZ335ifM6JNmzb13p946aWXaDY0NNSoFksLrd4UFAAzVxxdUEgHIA6ioqKSkpKQDvCJRnyCfb/jvvvu27BhA/t+x/jx42l5enq6Xq//888/TQv469evN+QTJCX33HPP8OHDr1y5wn5lZoNN8Qn2lY16f5Gdpb2i2U6dOnHX+fXXX9u2bbt06VJkU2A3goKCUJ8DIiA3NxcjksMnmnF/wpSOHTvSt3/88Qd9Lisr4648efJk5qGGmdKd1ISUwtvb+/z5841ukHne8c033zCzRs87FAoFfTZ6dNLQUVy7do1me/XqZbTaww8/3PK+twFoOkVFReizBAidmpoa9L4Dn2ipT9x///30bU5OztWrV6dOncpdmQr+Dh06eHl5HTx4sK6ujuRgzpw5ptvcuHEjKUWfPn1OnjxpfoNMe8yJEydS3jVtj3nkyJF27doNHDiQfvf333+vrKzMzMxk20MYPe948cUXafaxxx4zOhzSEVr+5ZdftjwxdTodHo0D0BAajQaJIBpUKlVGRgbSAT7RIp84c+ZMYGBg+/btPT09169fb7Tyd999N3fuXHIFWmHUqFH1vi9KbNmypXXr1p07dz5w4ID5DTLvi7q6uo4YMYJ0gdtCgjhx4sTMmTN79uxJYuHr67tw4cLjx49zf5FtkOHh4bFo0SLTth23b9/u1q3b/PnzreITEokEQRMAU0j3AwICkA7igEyCfAJPOuATjfsEb2He8Bw8eLB1NxsdHd2pUye2lUZLSExMTE5ORqYHwIicnBz2PXAgaCoqKqRSKTrdgU/w1CcoazY0isxDDz1UUlJSV1d39uxZpsEE28OEtTh8+DBtduvWrVY5ELrS8Cq2w8nMzHTynij5RkJCAkZ8FQEU3AICAhw+JDV8Aj7RIGZGb9q3b19gYKCbm1uXLl0mTpy4e/duW+yAr6/vlClTrLKpqKiorKws5HvHYv8R5oB5goOD8VaLCIiOjo6Pj0c6wCf46xMVFRUKhcKBO7By5UpKh59++qnlm6KgGRQUhHzvWHx8fPh/f0Kv1zvPTRQ6I7hvJ3Sys7OVSiU6eIVP8NonqCpJFUoH7sCPP/5I6UBWYZWt0SWHEcIcS79+/fi/k2lpaQkJCc5wOqqqqtAYU+gwzSYw/Ap8okH27t1L5ei77757yKF89NFH9913n2P3YeTIkZ6engUFBS3f1KeffnoIOBTyCf7vZF5enp+f3/79+0V/OjZs2PD4448Ld//Ly8udvBhDswn4ROOQSbTiB1QAtALAGrRp06Z3796C2NXu3bu7urrilPEfX19fqzwPFShoNgGfaByqjtOlkpaW9pWjIZ9w7A5QNZHSwSr3JwBudzWRN998c/LkyThlPGfTpk2dOnWaNm2ac5ZhaDYBn2gS/Ol/IjU1FXkFWAWdTieUVxMNBoNMJsMzaf7z/PPPt23btt7BicQNmk3AJ4TnEwA4J0lJSegDjf/k5+dTqDx16pRTHTWaTcAn4BMACIaqqirEa/7jnKESzSbgE7hI+EJOTg56VQIAPiFE0GwCPoGLhEckJSWlpKQgHYAzQ0pdVlYGnxAWaDYBn8BFwi8qKyvlcjlG4QPOTG5ubmxsLHxCQOh0OjSbgE/gIuEdwcHBSF7gzKSmporgLp3zhEqq/4SHhyclJSHrwieEepEUFhZWVFSI7/RnZWVhmGY7U3IXpANPSExMzMjIgE8IheTk5LCwMNxVhU8I+CKhTJyeni6+06/VaiUSCUZCsifx8fHZ2dlC3HNRtn2LjY3Nzc2FTwiCvLw8f39/iloII/AJAV8kqXcRZQ6IjIwUQTxFAWaHerwolTo8PLyoqAg+wX8qKipkMpko7xPDJ5zrIklLSxPrqxC1tbV458qexMTEUDVLcLutVquVSqX4TodKpRLB4yfR+4RWq/X39y8oKEAAgU8I/iIRRyNwgAKsJcjl8srKSpGdDqoqiOC1Q3H7hMFgCAsLw8vt8An4BAAi8Ql0WIJQ6aiMFx4ejjaY8AmRXCRFRUURERHILqDlKBQKgdbyKyoqAgICcAYRKu1JXl4e5TqdToezDJ8QyUVSU1ODRovAKmRmZgo3OFJkR4M4hEq7UVZWJpPJxPeUDT6BiwQAyFCmCN6GgE8IAo1GI5fL0QYTPoGLRGAYDAZ0sgQAfII/EUmlUon1LX34BC4SkfuEVCqtra1FUgAAn3A48fHxaLIGn8BFIlTi4uIyMzORDsCpKC4uhk/wjYyMDIVCgX574RO4SAQckkJDQ5EOwKno168ffIJXFBUVyeVy3CuFT+AiETB6vd7Hxwd94wP4BHzCUTCdapeVlSFnwifEfJFkZmaKvqyNiYnJycnBVWE7qqur8eIxr/Dy8oJP8ASNRkMygRc64BPiv0j8/f1ramrEnRvy8vLQBsqmlJSUqFQqoR9FbW2taLqLpesaPsEH6urqlEqlKMecg0/gIjFGuN0aNuuSRuXApoimo1W5XC6CYS/gEzzBYDDQdREXF4cQAZ9wiotEHOMQAscimoFgKPRnZGTAJxAqrUJSUlJYWBhG6IBPwCcAcDqfEM3bQJGRkfAJx5KdnR0UFIS3Q+ETTnSRREdH5+fnI8eAlpCenp6cnCyCA9Hr9RKJBG8DIVS2fM9F8+wMwCeaClUr0TIftJDUu4jjWKKionBFIFS2hMrKSqlUqlarcQbhE851kRQWFmKYO9BCKHSK5qmZaJ7dwCccgkaj8ff3x01f+AQuEgCcHb1ej0RAqLSMurq64ODgtLQ0nDv4BC4SkSOXy9E8CgD4hC0wGAxhYWEJCQk4cfAJXCTih672wsJCpAMA8AmrEx0dHRUVhbdD4RO4SJyCjIyM+Ph4pAMQPeJoDCigUJmYmBgaGoqHZfAJXCTOQkVFRVBQENIBiB70Z2VPMjMz0dUEfAIXidMhk8lEP14JAPAJu5Gfn09RRaPRINfBJ5z9IqHCNSsry3lyRnR0tEB7F6isrIyKipJIJP0AsAFSqTQxMZFXj//57xPFxcWUblVVVSh04RO4SP7nEYBCoXCenEEyIcSel+g0MeGen9UgHx8fnU4npnxSV1dHB+VUj8Orq6uVSmVmZiZCZRMpKyuTyWTotwo+gYvkP/cnxHFrVNyEhobyWYOodiu+NFepVM72ULKwsDA4OBihsilUVVXJ5XIMXAyfwEUCnxAYHh4efL4BIEqfSEtLS0xMdKpsRnlMIpEgVDaKRqMJCgrKzs5GaIJP4CIRf2EgMvh8jsSqpGVlZU74NhCvcho/fYLpBFM0A9YA+AR8AlGe1z7R6i6ODAHW2AGpVFpbW4uchlDJotfrQ0ND0QkmfAIXSf1IJBKRNaZDlLcnFRUVSqXSguI8IiKCubveioOrq6tMJnv//ffv3LnjcJ9o1ttA3KNwcXHx9PSMjIy8evUqcppoQqXBYIi6CzrBhE/gIqkfipjoiQVR3mI0Go1pq7RGi/O///67d+/eS5YsMVr54sWLZCc0u27dOof7ROldLPhFuqBWr15Ns1OnTkVOE0eohEzAJ+AToB4qKyupVo0ob8Mr8C67du2aMGFC9+7de/ToMX369OrqanaFY8eO0Qpffvmladl/+vRpmh06dCi7ZM2aNbSkdevWlA5PPvnkzZs32a/Ky8sfeeQRWt6+ffvRo0ez40Rzt1lSUtK1a1eaffPNNxvd4I4dO3x8fNzc3EaNGrVt2zajfTt8+PCUKVM6d+7cpUuXwMDAffv2NWQwt27dotmOHTvCJ8QRKpketVH1gk/AJ8B/kZWVFRcXhyhva58YMWLEqVOnqLResWIFzU6cOJFd4bXXXqNS+V//+pdpSXz79m2apRKdXbJ8+XKSDFq+efNm+iomJoZZfvz4cVdX1wEDBpCXUPn97bffPvroo0alO31FhXqbNm02btzY6AYPHjxIswEBARfvMm7cOO6+0TXbtm1bMqQLFy5cu3YtIiKCviLnqPf+BLkLzdLK8AkRhErIBHwCPgHqR3ADeQjUJ7755htmlpSCZtu3b8+uIJfLVSpVvTV7OjtG9ydY/vrrL/rK09OTmWWejLD3JEx3YM+ePe3vsmvXrnr302iDkyZNotkjR44ws8XFxdx9Izmgz99//z0zq9FoaJZ9wbKVCR06dGBXRk4TbqjMyMigcKHVahE54RPwCVAPwurSUaA+wdx+IO7cucMtmGtra++5557Nmzeb+sSlS5eM2k/8+OOPc+fOpRRo3bo1syZ9YL5yc3Oj2WvXrjW0Ay4uLvT3o48+4n5lZoM9evSg2Vu3bnE1iN035ueMaNOmTb33J1566SWapUotfELQoZIZ6wvDc8An4BOgQcLCwoqKihDlbeoTDS3ZuHEj+QT7KqbR+x333Xffhg0b2Pc7xo8fT8vT09P1ev2ff/5pWsBfv369oR0gKaEfGj58+JUrV9ivzGywKT7R0CsbRodMe0WznTp1gk8IN1QyY31hBEH4BHwCmCM1NTUlJQVR3iE+MXPmzNGjR5tZmUvHjh3p2z/++OPfd/uY4q48efJk5qGGmR0gNSGl8Pb2Pn/+fKMbZJ53sI9pjJ53KBQKppFpUw752rVrNNurVy/4hEBDZUFBgVwux1hfAD7RvP0pLCx0tixSVFQUFhaGKN9ycnJyqFRuuk/861//olr766+/3kSfuP/+++lb+pWrV69OnTqVuzIV/B06dPDy8jp48GBdXR3txpw5cxq6HdKnT5+TJ0+a3yDTHnPixIlUJWXbY7q5uTFj8B45cqRdu3YDBw6k3/39998rKyszMzPHjBlj+ou0My+++CLNPvbYY/AJIYbKkpISiURCpxilKYBPNK+m7oR9x+p0OgF1v89nn4iNjTXt9MmMT+zfv58+cEdlNO8TZ86cCQwMbN++vaen5/r1641W/u677+bOnUuuQCuMGjWq3vdFiS1btrRu3bpz584HDhwwv0HmfVFXV9cRI0aQLjCPYMLDw5lvT5w4MXPmzJ49e5JY+Pr6Lly48Pjx49xfZBtkeHh4LFq0qN62HchpPA+VlDkxcCiAT1hCRkZGUlISMg2ivGVERUU1a5RF8o/evXv//fff/E/28vJyulQHDx5MhuEkvRjBJyATAD5hOVS5pBCPTIMobxkqlaqkpKTp61O1fsGCBbw9nIceeogOp66u7uzZs0yDiW3btimVyqZ3lImcJtxQSRohkUiKi4sRcwB8Aj6BKM93n+A5+/btCwwMdHNz69Kly8SJE3fv3v3vu90ZpaenI6eJO1RWVVWRTDTrZhuAT8An/guScQG1TIRP8I2AgABuR9qipLCwkG1CgZwmylBJMiGXyyETAD7RIqhyyfZUCBDlm4u/v7/oX9DXarUymQw5TayhEjIB4BPWoba2Fp1hIMpbDEVhZxjvXq/XI6eJMlRCJgB8AliB3NxcQfS9Ibj+rAB8QhChEjIB4BPAOmRmZiYkJCDKA+CEPgGZAPAJYDXUanVwcDCiPADO5hOQCQCfANakrq7Oy8sLUR4Ap/IJyASATwDrExQUxP9e+uETAD4BmQDwCfgEr2lud9GI8k5LXV2d6HvaEL1PQCYAfMK2JCUlabVa58wraWlpycnJiPIWR2cn6TiSKC0tVSqV8AnhhkrIBIBP2JzQ0FAxdZncLDQaTW1tLaK8ZeTm5sbExDhJVtHr9T4+PnV1dfAJIYbKsrIyyASAT9gckQ3BgChvT59wqsFfQkJCxH2liNUnmIG+IBMAPmFzIiMjBdGtE3yCb2RmZiYmJjrPiaCDzcjIQE4TVqhkhiBHiAPwCXtAVUyqaCLfIMo3l9S7OM+JoAouyTdymoBCJSMT9BdhBMAn4BMAPsEXampq5HI5cppQQmVRURFkAsAnUCoAAfiEE5poTEyMiMcGE5NPFBQUSCQSyASAT9iVirsg3yDKNxcK1qLvkgE5TYihkmRCLpdXVVXhnAL4BLAfGo1GoVAgygMgDp/IzMyETAD4BHAMXl5efO5XAD4B4BNNl4mAgADIBIBPAMegVCrLysoQ5QF8QtChMjk5OSgoSKPR4FQC+ARwDFFRUfn5+YjyAD4h3FCZmJgYHBwMmQDwCeBIUlJS+PyGC3wCwCfMYDAYYmJiQkNDxd0bOoBPwCcEQF5eXnR0NKI8aAoVFRVi7WxRiD6h1+ujoqIiIiIgEwA+4Xi0Wm1SUpIz55jS0tLg4GBE+ebiVIN3sBQVFYWFhcEn+BAqySFCQ0PJJwwGA0o+AJ9oEXQVbd68edWqVW+1AJKJWbNmvWUlkpOTi4uL7ZmkLU+ElLu8ZT2smwhWjPJWyTAsDz30kBNmGOteL45KBBH4hEajCQkJSUxMhEwA+ERL0ev18fHxVFvS8Ylr16698cYbdusgyxkSwVpRHhkGiSAanyCZCAoKIg9DgQfgE1bwCarWqNVqHf+4evXqu+++a5/0dIZEsFaUR4ZBIojDJ6qqqmQyWWZmJko7AJ+wjk+Qm+v4SkpKin3S0xkSwVpRHhkGiSACn2CGDOXzC94APiE8n6Dog8joDIlgrSiPDINEELpPMDJRVFSEcg7AJ+ATKB7gE8gw8AlLQiXGHwfwCfgEigf4BDIMfKJFoZI0QiqVQiYAfAI+geIBPoEMA5+wMFQyjzkgEwA+AZ9A8QCfQIaBT1gYKiETAD4Bn0DxAJ9AhoFPtChUbtiwQSqVogEmgE/AJ1A8wCeQYeATlrBv374+ffr4+fnhzgSAT8AnUDzAJ5Bh4BOWh8rWrVuLdeg1AJ+AT6B4gE8gw8AnBBYqAYBP8CUy0g6jeHBgIgjOJ5BheJ4I8AkA4BPNjoytOHTo0MHb2zs6OvrixYvMtwUFBUqlsnPnzv3793/mmWd+/vlnURYP5hOB2Lt3r7+/v/nDdBKfaDSttm/fPnjw4Hbt2tHfHTt2OGGGKSoqUqlU7u7urq6uvr6+L7zwwk8//QSfgE8A+IT4fYL9rNFoTpw4sXDhQoVCwSwJDAz88MMPq6urz507RyEyIiJCrMWDmUQggoKC9u3bB59oNK2oKO3Zs+fHH39MJSj9pc8HDhxwtgwzbty4jIyMkydPXr16tby8/IknnpgwYQJ8Aj4B4BNO5BMMVM2iepXpmrS8e/fuDW1k586dY8eO7dKlS+/evR955JEff/xRoMWDmURo1CcclQiO8gnTtJo1axZ3I6tWrZo9e7bTZhiGmpqaer/icyLAJwCAT7S0pkWVKqpOcavmLKWlpd7e3g1tZMiQIXv37q2trT179uzcuXPnzJkj3OpmQ4nQqE84KhEceH/CKK369+9/6tQpdgX67OHh4bQZ5vr162fOnImOjp4xY4awEgE+AQB8wpLIaIS7uzsFQdM1VSpVYmJiQxs5fPgwO3vhwoUePXoI9HG4mURo1CcclQiOaj9hmlYuLi7cRjb0uV27ds6ZYdivJBIJt32JIBIBPgEAfKJFNa1ff/1VrVZPmzYtPDzcaLXVq1dPnjxZq9U2tBGqijXr2TBvq5tmEqFRn3BUIjjq/oRpWpn6RPv27Z02w/z222/Hjh2bNGnSvHnzhJUI8AkA4BMtiowM58+f79q1K3fJypUrAwMDf/nll6ZvRLjFQ0OJ0BSfcFQiOLb9BDetmv68wxkyDMO5c+c6deokrESATwAAn7BCZKTwx73vumHDBn9//ytXrvCzKLVPIsAnmphWRu0xV69e3VB7TGfIMAzl5eX1fgWfgE8A+IRofYK9c7tw4UJmyZ49e0aPHl1TU2P+f8VUPJgmgvmD4kMiOPx5B5tW+/fv79mz565duy5fvkx/jd4XdZIMo1Ao6MKprq6ura0tKioaN27ckiVLhJUI8AkA4BOWREYWFxcXb29vin3so40uXboYtTvjuoWYigcziWDa/s7JfcJ8WmVnZ/v5+dFXEonEqD8rJ8kwe/funTx5cteuXbt37046np6efuPGDfgEfALAJ0TuE44CwzHoMH4HMgz6s4JPAPgEfALFA3wCGQY+AZ8A8An4BIoH+AQyDBIBPgEAfAKREYkAn0CGgU/AJwB8Aj6B4gE+gQwDn4BPAPgEfALFA3wCGQY+AZ8A8An4BIoH+AQyDBIBPgEAfAKREYkAn0CGgU+gSAPwCfgEigf4BDIMfAI+AeAT8AkUD/AJZBj4BHwCwCfgEw7kzTffRPFgrURwBp9AhrFnIsAnAIBP/BfHjx/Py8vjYVg8c+bMjh077JOezpAI1oryyDBIBGH5RJs2beATAD5hJ+nOz89/7rnnkq3ECy+8YObbZcuWNWUjq1atWrduXV1dnd2S1LqJwOWll15q6KuEhIQ33njDPolgxShvWVotXrw42WaIKcMIKBEE4RN9+vTJzMxEkQbgEwK7iafVaqVS6YULFxpaQSKRUMXOebLR1atXhwwZUlNTU++3tbW1Q4cOXbp0qUajEXeUP3r06KBBgxBWnAG++QTtD+W9wsJCnBoAnxCST+Tk5AwYMOCBBx5oaAV3d3c/P78ZM2ZUV1c7QzbaunXrvffeO27cuIZqjdOnT6cU8/DwCA8Pr6ioEGWUP3LkiJeXF6+KGeBUPkH4+Phs2rQJZwfAJwTjE2FhYVThpqt3586dDd2foG+pdKHLOy0tzWAwiDsbPfXUU3S8Uql09uzZ9R5sZmZmUFAQE/LIKiZMmPDZZ5+JKcp//fXXJEzMASKswCcc5ROMUrz22ms4QQA+IQCf0Gq1dMUyl+6gQYPqLT7ZspMpZceOHatWq0WcjQICApiDHTFiRFxcnOkKtbW1fn5+/TiQVZCT/fOf/9Tr9UKP8p9//jkdDntoCCvwCQf6BBOXIiIirHtlAQCfsD45OTkPPPAAe+k+//zzpus88sgjzLe+vr5U0ri7u9PnJUuW6HQ6UWYjbmk6cuTI9PR003WmT59upBQMgwcPTklJsVbTCvtH+by8vP79+3OPCGEFPuEon/D29lYoFFSH8fLymjJlClV+cKYAfIK/PjF37lyyBIlEwly0VJaYNpJYunQpOQTVEuRy+bp1655++unx48f7+PhQjVx87TQrKys9PT1JKSiWUbLce++9FNcKCgqMVsvMzJw4cSJ9NXbsWEoWG7XNtHOUz87OphM9atSokJAQxhrhE/AJB/rE7NmzKS49/PDD5O6UIceMGeMkTbgAfEJ4PkG+T5ZADkFmQGXn8OHD6aKlYtJotbS0NCpfqaKQlJQUFRXF/feSkpKqqiox5aGcnBwKZMOGDXvggQfKyspeeeUVSp+BAweWlpZyV6utrWWalSQmJjLNKWyhFPaM8kyzXHIpf3//mTNnjhgxglEKhBX4hEN8gq47ugAjIyPp+qLLjf5Onz5dJpMZXYkAwCf4UnaS+FO5qFar6QKmEnHGjBmmDTNzc3NpYWxsrF6vp4LTtLIuJp588kk6WDpNJArMk46rV6+Gh4fL5XKjN0hDQ0OpxGXu0JBp0azVexGwW5SnDEDZgGSRDlyn01GlcOvWrSRV8An4hKN8YsiQIfS5oqKCHIJtPEFiQVGL/uKUAfgEv3xizpw5VB9lGldSrZTKS4PBsGrVKipOuG0jiouL6fImq2AvbxFfz2PGjFGpVPShsLCQNIJdTlUlMiquMVCFiZKlsrKSmU1ISKB/tO7LL/aJ8nQ2s7Ky2PsrdFzR0dF0IBTQ4RPwCUf5xHPPPcfMRkZGkkPgHAH4BH99QqvV+vn5sW9qKJVKKjKZzyUlJdwBiqjIpMubrZ2npqZGRESIMgORRQ0cOJCxJVIHHx8fo1bl3Me3tBq3uycqgKPuYkWlsH+Up52Xy+VMpxorVqyAT8AnHBIq+/bty3ZmReEoICBA9K+pA/iEgH0iPz+f+9pnWFhYcXExO0u1VbYoZd4p5RY5JB+irDHQ2eG+zRESEkKxzMz6ycnJRoWxdZXC/lE+NzeXcgLzmQwSPgGfcMhl2KVLF26oVKlUzP1RAOATfPQJo4f9sbGxZq5YKlm5s1VVVVKpVHxtrcmxuCqQchcz65u+wEYSFhoampCQIMQoT8dOFUGuQnGf+AD4hN1CpYuLCzdUUp5UKBQ4TQA+wVOfMK1q19vRAkNqaqrRkqysLJIMkd2ENHq6QVHMSKSaKGqkFImJiYKL8iSUTNsRFnG3vQW89QnTUKlUKjGcB4BPCMMnMjIykpKSGvq23ne0IiIizFffRaAXPj4+Fry1Qf9C4a/lSmHnKE/7zH3mxdyxQFiBT/AhVJJMUP7EmQLwCQH4BNVNY2NjzRSQpgs1Go1MJhN339thYWFFRUUW/CMlTlBQUAt9y55RHvEaPsHzUGnquwDAJ/hISUmJ0b3uJh6UXC4XcT+46enpFt9mYJQiMzOT/1HetOUEgE/wLVSaPo8DAD7BRyorKy1r8ZScnCziVnulpaUtqbW3UCnsFuURqeET/A+VsF4AnxCGT2i1WqlUalnVNjQ01ExbTkFDR+fj49OSGzAtUQr7RHmEaSAIn2DEV6yd3wD4hHh8oiUxpba2ViaTibVAioyMzM/Pb8kWLFYK+0T5rKwsxGj4hCBCpV6vp1DD9LcGAHyCvz7BdLlt8dHJ5XJR9sNNHhAfH9/CjVjWPNMOUV6n0yFAA6H4BHM9kuLjlAH4BK99Ijg4uCVj96WlpdEWjLpwEAFU1pIKtHw7jFI0q3WnHaJ8cnJyXFwcYgd8QiihkrlFgYHLAXyC1z4RERFh2buRLNHR0WZeOhUuUqnUKrdeSCma1dUVRXmb+hkFZTo0W4y0DgQEM1SNgEJlamqqKOMMgE+IxyeontrCUTmYfpyysrJElrHIk6w1fADTe2ZCQkJTuooKDg5uyeumTTmutLQ0BA4nh4ISr3qzbjRU6nQ6Ufb3D+AT4vGJ1Lu0cCM1NTUymUxk3c5kZ2dbsT7EKEVThg2jZKS4SUphi7sUtHF/f3/xPZ8CzUKr1YaFhbX8wrdzqKQdttYoOQDAJ2xSalrlUbparaZSsLKyUjQZq6qqiopeK26QGYmU4nijnXlTqR8cHNwPANsgkUj4NlZwU0KlRqOhPcejOgCf4CmFhYXWem8wPz9fLpeL6WqXyWQWv/zSkFLEx8eHhoY6pHfRtLQ0NJIHgg6ViXdBcgH4BB8pLS21YDjNhkhPT6eKtQWDafGT2NjY7Oxsq282KSkpKCjIzuJFYiSVSq2rRwDYOVTSVUPZWKfTIcUAfIJ3UAFj3bv6cXFxERER4hijMjc3Nzo62hZbzszMlMlk9nw8RCclIyMD8QIIPVSS5fOq5QeAT8An/oN1X0NnWgk0peEh/2Hamdpo4wUFBVTTsk8jVhKjkJAQDEQORBAqmReecYsCwCf4CBWZ1r33zozuIY6W2P7+/lVVVTbauFqtpsS3dcu42tpair/oDROIJlTGxsbiZhuAT/ARhUJh9cKGeT1SBC2n4uLibNq1BsmKBX1yN4uIiAjcHwZi8gmKVyTieO0ZwCd4R1hYmC32UKfTUUkp9DFI8/Pzbf1OBNOBZnR0tC3asebk5CiVSjzpAGLyiX/fHbHPpt2+AfgEfMISYmNjrdURpGlJKXSlYF55t/WvUE0rJiYmODjYuoOrMU+axdQpCIBPsLco/P39IcoAPsEvUlJSbHc/3IIBsfgG7b99Gh9kZGTI5XK1Wm2VrVGoJUGxxfuuAPAhVKpUKhtVhAB8Aj5hIVlZWTZtOyl0pYiPj7db4y/KKlKp1CotNJOSktB7FRCxT5SUlAQEBOAWBYBP8IiCgoKoqCib/oROpxNu80xKn/DwcLv9XHV1NekXSUxLAmVxcbFcLndIL5wA2C1UqlQqujyRegA+wRfUajUV9rb+FeaNj9jYWMHVJ0iGfHx87LnblFaRkZEWN6eg/yKZENnwbAA+YUphYaFSqUTqAfgEX7B6F5nmi0mq6wuuQ26KWaWlpXb+0YyMDJlM1tzMQ94TEhIi9NdqAHyi6dcmWQUSEMAneAGVQB4eHnb7rbi4OCrwhDVsWGJiokNKaLVaLZfLk5OTm353JD4+Hs0mgPP4BMmEHW6vAvgEfKKpSKVSez5rT01NDQoKsl2/k1anqKgoLCzMIT9N5yU8PJwiZlOefeTm5lLCimY8NgCfaEoVJSAgoKSkBGkI4BO8gAohO/dSkJOTQzVvoUQBKqF9fHwc2B9fenq6TCYjrTGzTllZmZ3HGAOAD6GSNFqlUiENAXyCF9DVaP+ivbi42FrvRtqBkJAQx9pPaWmpv79/fHx8vbcfmDaYeJAMnNAnmFsUGKEGwCd4ge26yDRPdXW1QqGIi4vj/0sfycnJDh8Fg0yCzhSFTqPGobRcqVRihCTgnD5BZGZmotkQgE/wpbB01BsBVBZGREQ0sX2AAykuLuZJs6+CggKZTJaSksI8fyEVU6lU8fHxiAXAaX2CrgW6KHCLAsAnHA9VbR3b2VRT2gc4FgpYPj4+PGnqqNVqo6KigoKC1Gp11F3QSyBwZp9gblHExMQgJQF8wsHk5eU5/FKkotHf35+0hrdFo0ql4tWpLCgoGDhw4KhRo27cuIFAAJzcJ3Q6nVQqra6uRmIC+IQjKSkp4UMDaYoIkZGRSqWSn6+SpqamJicn82d/yL1CQkJIBMnD+HxrBwD7hEq6QmNjY5GYAD7hSEjqAwICeLIzOTk5VM/IyMjg240KtVodHBzMH5kIDQ1lnr8UFxcHBQWRivG8DQoANg2VzC0KYfWVB+ATYvMJug4lEgl/9qempkZ1F/rAn70iv/Hx8aG0cvhucGWCQa/Xp6Wl8dPDALBbqEy8C9ITwCcciYeHhwP7a6oXKhr5VkCGh4c7to8HSoqoqCgjmWCprq6mPQwKCsJgYMA5fUKj0VDVCLcoAHzCkfj7+/PqZgD3RkVwcDBP3gRLT09PSEhw1K+TQ5BMREZGmn/NpKioKCAggFZD2zTgbD7B3KJISUlBkgL4hMOgKq9arebnvuXm5kql0qSkJIe/rklaQ7V/R8kEnaPo6Oim3K3R6/WkPpRoFFgd/oAGAHuGStJoyvnI9gA+4TCoOsvn3pq1Wm1MTIxcLs/Pz3fsnjjkbir9InlMcx8M03/FxsZSomVnZ6NRBXCeUEnZ3uG92QL4hPP6RFxcHP+H0lCr1QqFIiwszIEvlEZFReXl5dnzFysqKsgJMjMzLf53SjHSEbxTCpwkVFZXV9Mlw7cGYQA+4Sw+kXoX/u8n1bOpZGUefzjklibV9e35jjtJgEwmKygoaPl2SClUKlVZWRmiBhB9qIyMjLRYwQF8Aj7R0mJSQGNAaDSauLg4Kmjtfye/qqrK39/fPr9FAZGqWUajf7VExXJzcynR0FQTiD5UVlRUUFbHLQoAn3AA+fn5UVFRwjr3zJ18hUJh5xQmn7D1Axcq+0mY6NCs/tINRVjmRdzY2Fi8VgdEHCrJm/n/DBfAJ0ToEzzpctsCmNcjSSzs9k4plcTZ2dm2275Wq6VzERERYbv3WXQ6XUpKikQiSUxMhFUAUYZKimkUGdASGcAn7A2vuty2oDZPBbxMJqOS3g69aOTl5dnuXk5lZaW/vz8V9naIg2QS5BNSqTQ1NRXv1wHxhUry8tzcXCQvgE/YFaoT86rLbQug2jyVi1Q62rrOzfTBZ6OzYP93Ymtra8nDYBVAfKGyuLhYqVQieQF84r+4efPm1q1bk23JsmXLkm3P66+/fubMGVvXuWUyGVM62ijdbJdWtPMOSbfq6mrWKsjM7JDf7IOt0w3wvOpFPsHnnnUAfMIBF8natWspLOqEz+XLl6nEooq4TVOeKR0VCkVaWhrSzYJ0Q34D4vAJkgncogDwif+Calo6sXDt2jUq5u2Q/vRbSDcLqKurQ7oBcfgEQX5cUlKCRAbwCRH6BGG3vrOQbkg3e6Yb4KFP5ObmCvTlNQCfgE+gXES6wScAX3zCYDAEBARYq184AJ+AT6BcRLoh3YAz+gSRlZUVGRmJdAbwCcR3pBvSDT4Bn7AcvV4vk8ns1uUdgE/AJ1AuIt2QbkCEPvHvu6PhREdHI6kBfALxHemGdINPwCcsp66uTiqVYiQ8AJ9AfEe6Id3gE/CJFkHZIDY2FqkN4BOI70g3pBt8Aj5hOZQTpFIpBsAD8AnEd6Qb0g0+AZ9oEYl3QYID+ATiO9IN6QafgE9YDjOYH/pfB/AJc7Ti0KFDB29v7+jo6IsXLzLfFhQUKJXKzp079+/f/5lnnvn5559RLjYl3Yjt27cPHjy4Xbt29HfHjh1Ityam2969e/39/elb+ATgj08Q8fHxyA8APtFIfGc/k4OfOHFi4cKFCoWCWRIYGPjhhx9WV1efO3dOpVJFRESgXGxKuhUVFfXs2fPjjz/+6aef6C99PnDgANKt0XQjgoKC9u3bB58AfPMJCoNSqZRyBZIdwCcaj+8MVFl0dXU1XZOWd+/evaHtkHaMHDmSapx+fn6bNm1iN06fhw0bRhukmuj69eu5v9vQV4IrF03TbdasWSkpKexXq1atmj17NtKt6fmtUZ8QWboB/vsEERsbm5GRgWQH8Ikm1RdPnjz5xBNPcOuLLKWlpRSI693IRx991K9fv9zc3MuXLx89ejQ0NJTd+IABA6i6WVtbS389PDx2797d6FdCrGcbpVv//v1PnTrFrkCf6QCRbk3Pb+Z9QnzpBgThExUVFTKZTK/XI+UBfKKR59kM7u7uZ86cMV1TpVIlJibWu5GxY8dmZ2fXu/GdO3eyszk5OUFBQY1+Jbh2AKbp5uLiwm1rQp/btWuHdGt6fjPvE+JLNyAInyAiIyMzMzOR8gA+0Uh98ddff1Wr1dOmTQsPDzdabfXq1ZMnT9ZqtfVuxNXVldukjrvxmpoadvbSpUvsExMzXwmunm2abqY+0b59e6Rb0/ObeZ8QX7oBofhEWVlZQECAwWBA4gP4ROPPs8+fP9+1a1fukpUrVwYGBv7yyy8NbYRCszOXi6bp1sTnHUi3evNboz4hvnQDQvEJQqVS5ebmIvEBfKLx+H7u3LkePXqwsxs2bPD3979y5YqZjQQFBW3fvr0p958feOCBRr8SaLnITTej9pirV6+utz0m0s00vzXFJ8SXbkBAPlFSUkI5EIkP4BNNuv+8cOFCZsmePXtGjx7NrdjV+7/79u1zd3f/+OOPSTuOHTs2Y8YMdgVPT09uI7i8vLxGvxLufXs23fbv39+zZ89du3ZdvnyZ/hq9L4p0ayjdzPuEiNMNCMgniODg4MLCQqQ/gE802D7OxcXF29t7yZIl7KONLl26GLWe47oFN+jv2LHjvvvua9++/eDBgzdv3mz6kp6Xl9e6devqfX/P6CvBtSs0TTciOzvbz8+PvpJIJEb9WSHdzKSbUX5zknQDwvIJkgmlUon0B/AJ+2HmrrVlHRY5Sb/RSDdnSzcgLJ8gFApFcXExTgGATyC+I92QbvAJ+ITl5ObmqlQqnAIAn0B8R7oh3eAT8AnLMRgMAQEBpaWlOAsAPiFIME4m0k2U6QYE5xNEVlZWZGQkzgKATyC+I92QbvAJ+ITl6PV6mUxWUVGBEwGfgE8gviPdkG7wCfiE5WRmZsbExOBEwCfgE4jvSDekG3wCPmE5lEmkUml1dTXOBXwCPoH4jnRDusEn4BOWQ5kkLi4O5wI+AZ9AfEe6Id3gE/AJy9FqtRKJRKPR4HTAJ+ATiO9IN6QbfAI+YTmJd8HpgE/AJ4RESkoKykWkm/jSDQjaJzQajVQqpQyDMwKfEPNFsmLFCtEE94P/v72zjW2q7B/wA8LD28CAGN4GBINDiharDqhUGFniwEHFGhZRhzWZEUJiSYgaXgarMChQoQPDsJIlDKYUAgyoGdLoQ0bGqFvIIoMR0YKLbmxQw6QflvTL/ycnafbfRhkv63pOr+sD6ekp55zd9/37neu+z7nP+emnoqKi2FQB5Ua5xbLcQNU+IdhsNkaz8AmNB8mhQ4eOHj2qivTd3NwcZa3f71+1alU4HI5NFaio3KKjlnILBoOJXG6gdp8IBAI6nS4UClEp+ISWg6SwsFB6jVvim7y8vMmTJy9fvrzTtZs2bRL3b21tjWUtqKLcoqOWcluxYsULL7ywefPmRC43ULVPCDk5OW63m0rBJwiSnqe8vNxgMLhcLlpnQiEdO6l3n89HUYCqU2Vtba1er0dD8QmCJC5oaGgwm83Z2dnc2ZQgBINBk8lUXFxMUYAGUqXVai0pKaFe8AmCJC4Ih8O5ublGo5Gn4mse6cmJPubn51MUoI1UWVFRIbmL227wCYIkjigtLdXpdB6Ph5aqYXJycpYuXUo5gJZSpcVikfRF1eATBEkcUVdXl5aWtnLlSq5HahK73W42m+nJgcZSpc/nS09Pp2rwCYIkvgiFQtJ/zcjIqK+vp8lqiaKiIpPJxF0yoMlUKT5RVlZG7eATBEnc4Xa79Xo9paEZJNUaDAYcEbSaKqWFm81magefIEjiEb/fL2cgp9PJ8Ljaqa6uFjusqamhKECrqVLSlNForKiooILwCYIkHmlqarJYLIsXLw4Gg5SGSuFRE5AgqdLj8UiyooLwCYIkThHrt9vtqamp9G7VCI+agMRJlZKs9Ho9k97xCYIkrvF6vTqdjofGqAseNQGJlirdbrfVaqWO8AmCJK65evVqWlqazWZjKqlaWHoXygESJ1VKdtLr9YFAgGrCJwiSuEaZSpqens40gfgnPz/fbDYjf5BoqdLpdEq3h2rCJwgSFeB2u3U6HQUVzxQXF5tMJu6ihQRMlS0tLZKgGhoaqCl8giBRAX6/X6/XSz+AoohDfD6fwWBgyBcSNlXa7fbc3FxqCp8gSNRBZCopz1uMK2pqakT1qqurKQpI2FQp2SklJUX+pbLwCYJEHUSmkjJBK05oaGgwGAw8dRhIlatXr2YAFZ8gSFSGMpWUt5L2OKFQyGQyud1uigJIlYFAQPISo6f4BEGiMpSppLyVtAcJh8MWi4VrxkCqjGCz2QoLC6kvfIIgUV/nmLeS9iDLly/PycnhTStAqoxQW1ur1+vp5OATBIkq4a2kPYLD4TCbzaJ0FAWQKttitVqLioqoMnyCIFElFRUVBoPB5XJRFLHB4/EYjUZuZQdSZUeqq6slOhi3wycIErUi5zbpLmdnZ3MzVHdTXl6u1+uvXr1KUQCpslMsFgt3i+MTBImKkQ5Bbm6u9AyYStp91NXV6XQ6v99PUQCpMopzp6enU2v4BEGibkpLS6X3TOegO2hqapKy9Xq9FAWQKqMjPsFDWfAJgkQLfWiTyfTZZ59xCfMxEgqFJEXu2rWLogBS5X0RmcjIyKDi8AmCRAsnP6vVmpmZyRt6HgtiZosXLxZFoyiAVNlFpFdTUVFB3eETBIkWkM60wWAoLy+nKB6RlStXZmdnM94DpMqu4/F4LBYLdYdPECQaQWRClIJR+kfB5XJlZGTwqAkgVT4Q4t+8aQifIEg0RUNDQ2ZmptVq5Yz4EJSWloqQ8agJIFU+BG63WzIP1YdPECTaQToKq1evNhqNdXV1lEbX8fv9KSkpPGoCSJUPR2trKw9rwScIEg3i8XgktqXDTVF0BUmCOp2OG8qAVPkouFwum81GDeITBInWqK2tNRqNubm53FoYnaamptTU1CNHjlAUQKp8FFpaWsTLA4EAlYhPECRaQ8I7OzvbbDZzT8C9CIVCmZmZTqeTogBS5aPjcDikD0Ml4hMEiTZxuVwGg4HB/I6Ew2Gr1coILZAqHxfSdUlJSaEDg08QJJpFea9VYWEhRdGW1atXZ2VlcT0ISJWPkdzc3Pz8fOoRnyBINEt9fX1GRkZOTg5TSRXErtLS0igNIFU+9lSj0+l4+zE+QZBomdbW1pUrV8pJlDldXq/XYDDwhHIgVXYHNpuNe5LwCYJE+3g8Huk9JPKbM/1+v16v51l+QKrsJgKBgISYdGCoTXyCINE4cipNTU212+0JeOvA1atXDQYD7RBIld2K1Wp1u93UJj5BkGiflpaWxYsXWyyWhLoTW/5Yk8lUUlJCAwBSZXd3WkTcudkZnyBIEgWn0ykx7/f7E+GPbW1tNZvNDoeDegdSZQzIysryeDxUKD5BkCRQ8tLr9YkwMpmTk7N06VJqHPCJ2FBRUWE0GhmiwCcIkgRCmUoq51oNT5602+1ms5nUBvhELJGgKysro07xCYIkgdD2VNKioiKTycSEeMAnYozIRHp6OnWKTxAkCYcmp5JKRjMYDPX19dQv4BOxR3zC5/NRrfgEQZJwqHcqaTAY7PhldXW1Xq+vqamhZgGf6BFKS0stFgvVik8QJImISqeSdpwFGggEDAYDfSPAJ3oQ6ZkYjUbeR4hPECSJS/SppHH45LusrKy2i8Fg0GQyFRcXU5WAT/S461utVmoWnyBIEjqv3WsqabzNLxV7SE5Obqs7ZrOZlxwCPhEPSDzyhHt8giBJdO41lXTKlClxNUSxbdu2kSNHRhZ51ATgE3GF9EAkKqlcfIIgSWiUqaQmk6muri7ypZy842qIYtq0aRGf4FETgE/EYRrR6XSBQID6xScIkkTH4/Ho9frS0tKIT8TPEEUwGBw9erTiEzxqAvCJ+MTpdNpsNuoXnyBI4N+ppEajMTc3V7r+cvKW3kacDFEUFBSMvEvHR03IZ5/PV1NTw3AF4BM9i1i+JI2GhgaqGJ8gSODfjGC1WjMzM5Xz9+TJk+NhiGLmzJnK8Sh3j4pe5OTkpKWlpaSkLF++nLvAAJ+IE+x2u3RIqGJ8giBJdOrq6o4cOSLpIDU1VTl/T5w4cc+ePT17VMFgcMyYMcrxKFc9hHHjxq1ZsyahXsUO+ET8IyEplk9g4hMESYJSU1Njs9kmTJignKojHxQmTZrUs0MUbrd71KhRysEkJydPmTJl9+7dcfh4DABSpSAdEofDQS3jEwRJ4hIMBsvKyj799FOTySSn7bFjx0ZGAuT83YMHNnv2bMUk5MA09uYRwCe0RyAQ0Ol03DGNTxAk8C/hcLi2tvbLL7+cP39+yl16ajxAeYzVW2+9xU0SgE+oBZvN5nQ6qWh8giDpec6fP+9wOOx2++b4YN26dT11MKtWrVq7dm33bX/Dhg2afIE7JE6qDIVC+/fvj590IXz++efPPfdcfn5+Tx3Axo0bT58+zZwvfCLROXjw4K5du6Rf3gLdj5Tzjh07UApQb6qUdHH58uV4i6w///yzZw9Aile6ItxohU8kNOvWreM0H2OlyMvLo+GBSlNlfn4+Udwp169f57ILPpHQOBwOEkGM2b59e7vXlwDgExpg586dhDY+gU9A7Pjll18OHDhA2wN8QmNcuXKlpKSEJodP4BMx5T93UUuaeOxHu379etoe4BMaSxd37tyx2+00OXwCn7hPMCsMGDBgypQpBQUFt2/fVleCuHnz5tq1aydOnNivX7/+/fuPGDHipZdeeixH27Z8+vbtm5yc/N577/3+++9RNrhnzx4e6gea9AltpAuF0tLSBQsWjBo1SuJ60KBB48ePnzdvXvT/snfvXkIbn8AnuhTMtbW1s2fPlkWn06muBLFixQrZo8vlunHjRl1d3b59+6ZPn/4YfUL53NjYmJeXJ4tz5syJssFff/3166+/pvmBVn1C7elCWLZsmex0yZIlFy5caG5urqmpkaQxa9as6P/r2rVrcfJeQ3wCn4h3nxD8fr8sTpo0KfLNpk2b5JvevXtLp/+DDz7466+/IqsqKystFot8369fvxdffPHbb7/tuM3Tp08PGTJEFu12+303+M0330yYMEH6PVOnTpVefrtjO3XqVFpaWlJS0uDBg0UXDh8+HFk1ZswY+eX169e7mLDafqN8lt3JTmXXcgCSMu71fxsaGmRx4MCB0UtV8jLND7TtE+pNF8qP33jjjQe1kH/++Yfnf+MT+ERXE0RTU5Mykhn5ZtWqVZI15PuvvvpKVn300UeROdnyMzmRnzhxQs6yZ8+eXbRoUbttyio59T7xxBM7d+687wa9Xq8sTps2rfYur7zySttj+/777/v06TNz5kzpSfzxxx/vvPOOIgHK2mHDhsmiTqez2Wzfffdd26SjHE+vXr2i+4Sy38uXL8+YMUMW5WA6HZ+QNCeLchjRS7WoqCgQCNACQds+odJ0ofz4hx9+eIiBjf379xPa+AQ+0aUEcf78+XYdjgh///23rEpOTlYWlaHOSCej4zblvN7vLhKBne663QZfe+21tkFeVlbW9tgkNcjnc+fOKYu//fabLE6cOFFZ3Ldv3/DhwyNXdmWnb7/9tvwmcjySpKL7hHSMIj0kWZSD6XjBWKF///6Rw4gyW11yIi0QtO0TKk0XYjayKJ7xED4hfZVdu3bR8PAJfOI+CeLSpUvtLohevHhx4cKFI0aM6N27t/JL+XDfmIzcvSj/ypm+7aooGxw6dKgsSt8lErdtj03ZXTvaWsKtW7eOHz+elZWVlJSkrJ07d27XfaLdfocNG9bp+ITNZuviSCmXPEDbPqHedPEoPsElD3wCn3iAG7ZdLlfkhu1XX31Vvt+2bVtzc7OcsDtGbH19/b22KVmmV69eOp3uypUrkVVRNtiVBBF9YkWkH/Pxxx/LjwcNGhQ5nkgaUiaDRPEJ5Q6JTn1CkL+37ZajUFJSwovHQJM+ofZ08fLLLz/09Q7h0KFDhDY+gU888M3VAwcOlLU3btyQzxUVFW1/PGvWLGWUMso2JddIjhg3btyFCxfuu0FlAPPHH3/sdADTZDLJ53uNhXa83CA/fuqpp5TF//73v5GdCj/99NODXu+IbFn6NG23HIXGxsaCggIaIWh1fEK96eKh78dUELnhkgc+gU88cIJITU2VtXv37hXTnzNnTtsfSyT3799/7NixXq9Xzp0S7W+++WbHbe7cuVNyxNNPP11eXh59g8oNVpIILl++3PEGK+lMiBaMHz9e9iv5paqqSrZsMBiUtdJP+uKLL86ePSvnezkY6evIf1y2bFnbi6nr16+X3sy5c+f0en1Hn5gxY8alS5ci92OeOHGi0+sdn3zyiSxmZWV1Je/w9BtIKJ9QS7oQli5dGpkvevPmzYsXLx44cGD27NldVAquZuIT+MQDJ4iff/55+vTp/fr1S05O3r59e7sfy7l54cKFEvzyg6lTp3Y6AUzYvXt37969k5KSTp48GX2DkQlgzz//vMR/u/sezpw5M3/+/GHDhkmmeOaZZ959911pIcoq+X7SpElPPvlk3759Za18XrNmza1btyLPwJ43b97QoUOHDBkiey8uLu7oE4WFhbJT2bXkoMh94O0GeOWvGD169IcfftjFK6/Hjh3z+/20Q0gQn1BLuoiE54IFC0aOHNmnTx/ZiOzi9ddf76JPyLER2vgEPqEaKisrpQ08++yz6v0TgsHg1q1baYegGZ8gXSjcvn2b143iE/hEXCP9g9OnTzc2NlZXVytXQNsOFagRu90eDodpioBPaCxdbNy4kdDGJ/CJ+OXw4cPTp08fMGDA4MGDJUGUlJS0qByfz1deXk5TBHxCY+nizJkzhDY+gU9ATNmwYQNNEfAJjREKhbgrE5/AJyDWPtHa2kprBHxCY2zevJnQxifwCYgdfr//5MmTtEbAJzTGhQsXvF4vjRCfSAiWLFmSD3HAokWLtnSZjRs3cl0WeiRVvv/++0Rr19m0aVNWVlYX41p+7PF48Al8gvEJiOksU7vdzgN9gfEJjXHs2LG8vDx8Ap/AJyB2NDc379ixgwYM+ITGOH78uCZHKfAJfALiF95hCPgEoY1P4BP4BJB0AJ+ATtDkgzXxCXwC8AnAJ/AJfAKfAHwCnwB8Ap/AJ/AJfAKfAHwC8Al8Ap/AJ/AJwCcAnwB8Ap/AJwCfAHwCn8An8AnAJ/AJwCfwCXwCn8An8AnAJwCfwCfwCXwCnwB8AvAJwCfwCXwC8AnAJ/AJfAKfAHwCnwB8Ap/AJ/AJfKI72bJlC9GrUrZu3UoDBnxCY4RCISlkfAKfUB9VVVVHjx4lhlXHlStXSkpKaMAQ41S5Y8eOxsZGArD7KCws9Hq9+AQ+oUpOnjy5YsWKzaAetmzZsnv3bunH0HohxqmyqampoKDA4XAQho8dpVR9Pp8m2yE+AQCATwDgEwAA+ASpEvAJggQAgFQJ+ARBAgBAqgR8giABAMAnAPAJAAB8glQJ+ARBAgBAqgR8giABACBVAj5BkAAA4BMA+AQAAD5BqgR8giABACBVAj5BkAAAkCoBnyBIAADwCQB8AgAAnwDAJwgSAABSJeATBAkAAKkS8AmCBAAAnwDAJwAA8AkAfIIgAQAgVQI+QZAAAJAqAZ8gSAAA8AkADfpEZWWlBMnevXupJwCAe3Hw4EFJlVVVVRQF4BP3ZO7cuRIn8+fPP3Xq1P8AAOD/IzKRlJTUp0+fO3fucEoDfOKeXLt2LTk5+T8AAHAPhg8f7nQ6OZ8BPnF/qqqq6IUAAHSksrIyHA5zMgN8AgAAAPAJAAAAwCcoAgAAAMAnAAAAoIf5P6UnZDMNMBsUAAAAAElFTkSuQmCC" />
</p>
<ul>
<li>h/PackageBは冗長に見えるが、
h配下にそれを保持するディレクトリ名と同じ名前のディレクトリを持つことは、
可読性の観点から重要である。
このディレクトリため、他のパッケージから識別子をインポートするためのインクルードディレクティブは
以下のように記述されることになる。</li>
</ul>
<div class="sourceCode" id="cb159"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/pkg.cpp 1</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;memory&gt;</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;mutex&gt;</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;PackageA/xxx.h&quot;</span><span class="pp">  </span><span class="co">// PackageAのインクルード</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;PackageB/yyy.h&quot;</span><span class="pp">  </span><span class="co">// PackageBのインクルード</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;internal.h&quot;</span><span class="pp">      </span><span class="co">// パッケージ外部非公開ヘッダのインクルード</span></span></code></pre></div>
<ul>
<li>外部公開ヘッダファイルは、ビルド時に他のパッケージから参照できるディレクトリに配置する。
<ul>
<li>外部公開ヘッダファイルは、外部非公開ヘッダファイルをインクルードしない。</li>
<li>外部非公開ヘッダファイルは、ビルド時に他のパッケージから参照できるディレクトリに配置しない。</li>
</ul></li>
</ul>
<h3 id="識別子の宣言定義">3.7.2 識別子の宣言、定義
<a id="SS_3_7_2"></a></h3>
<ul>
<li><a
href="https://en.cppreference.com/w/cpp/language/definition">ODR</a>を守る。
つまり、一つの識別子は全ソースコード内にただ一つの定義を持つようにする。</li>
<li>一つの.cppファイル内のみで使用される識別子は、
その.cppファイル内の無名名前空間にその定義や宣言を持つ。</li>
<li>ヘッダファイルで宣言された識別子が.cppファイル内に定義をもつ場合、
その.cppファイルにそのヘッダファイルをインクルードさせる。
特に、非メンバ関数や変数の宣言と定義を矛盾させないために、このルールは特に重要である
(「<a
href="programming_convention.html#SS_3_3_1">非メンバ関数</a>」参照)。</li>
</ul>
<h3 id="依存関係">3.7.3 依存関係 <a id="SS_3_7_3"></a></h3>
<ul>
<li>不要/不適切な依存関係(「<a
href="solid.html#SS_8_4">インターフェース分離の原則(ISP)</a>」や 「<a
href="solid.html#SS_8_5">依存関係逆転の原則(DIP)</a>」への違反)を作らない。
<ul>
<li>依存関係を最小にとどめるために、前方宣言を適切に使用する。
<ul>
<li>STLクラス(やクラスのエイリアス)の前方宣言をしない
(例えば、「std::stringをクラス宣言することでstringヘッダファイルへの依存関係を作らない」
といった方法は、std::stringがクラスでないため想定通りに働かない)。</li>
</ul></li>
<li>SOLIDの原則やデザインパターン、イデオム等を適切に使用することにより、依存関係を適切に保つ。
<ul>
<li>依存関係の伝搬を回避したい場合、<a
href="design_pattern.html#SS_9_3">Pimpl</a>イデオムを使い実装の詳細を隠蔽する。</li>
<li>上位概念が下位概念に依存することを避ける場合、 「<a
href="solid.html#SS_8_5">依存関係逆転の原則(DIP)</a>」での例や<a
href="design_pattern.html#SS_9_22">Observer</a>等を適用する。</li>
</ul></li>
<li>パッケージ間の相互、循環依存関係を作らない。</li>
</ul></li>
</ul>
<p>
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcYAAACxCAIAAADRUIqzAAAAKnRFWHRjb3B5bGVmdABHZW5lcmF0ZWQgYnkgaHR0cHM6Ly9wbGFudHVtbC5jb212zsofAAABVmlUWHRwbGFudHVtbAABAAAAeJxtkM1Kw0AUhff3Ke6yXaTYKlK6kLaxKqWRYn/203SMQ5OZkkwqIoIT3CkIgj8bEV24EBSfoD7MtEjfwoklLoqrO/c759w7M9VIklDGgQ9j4o6IR7G9rDU8hTNYpfV/qb2kkEUtK2TekbS2slSm1FcVO1Ns64/VALiQFEmE+0WYT9++bz61utfqVasLnVxq9aQTpc/V/PZ68Xyl1YdWieGz6eP8/WFx9zL7SoDyIaZToGpO6fOg7RMue04LJzSMmOBYLJTWSuuF8oBKUsz1+IiLY46uCMbMpyhZQPOQ2223MBJx6FIcskiGbBBLE85Dk0wIHsQ89VUw7XJdJ4+dRgaxwScsFDygXEKz7yxNuCdkZyzkr3lzw6oziR0amjth34FtekhiX5qoK4aMexXsdXesMrQI92LzNRWkHGxhFoQnRuvADwodpfCyxt/gAAAjOklEQVR4Xu2dCVgUR/qHMd5o4oXKIURRN4LKgkrMemBUdJUoif+48YoJmpjEK4qIi0ZFNEIAY4SgglEMRkSD4qrrfRFRie4qsCremogSFZDDI56z/1+opLatAWYSe3qanu996uHpqaqp7v5m6u2v5sLqvwRBEIRMWIkVBEEQxB+FlEoQBCEbpFSCIAjZIKUSBEHIBimVIAhCNjSl1MLCwoiIiNDQ0PmaIyQkJDY2tqSkRDxngiDUhKaUGhkZmZOTU6xRsrKygoODs7OzxdMmCEI1aEqpyOZED2mOuXPniqdNEIRqIKVWMuLj469evSqeOUEQ6oCUahRbt261srK6dOmS2KA4OTk5sbGx4pkTBKEOtKxU5kFG/fr1Bw8efPHiRWkH41FYqQcOHMDuOnfuLDaUgtMUz5wgCHWgfaUeOXLk3Llze/bscXFx6dOnj7SD8Sis1Pfee69Dhw7PPffc0aNHxbbi4qSkpLNnz4onTxCECtC+UrkHExISqlatmp+fj+2lS5e2a9euRo0a9erVe+utt65cucL6FBYWhoSEtGjRonr16ra2tjNmzNAf6ubNm76+vm5ubhcuXKhgqLy8vHHjxjVq1Kh27doDBgxYsWIFRuCt4eHhrVq1wl7s7e2nTZt269YtVg+uX7/+wgsvJCcnv/rqqxMnTuT1nBs3bixatEg8eYIgVIAFKRXJXZUqVSBEbMfFxW3ZsiU7Oxt9XF1dhwwZwvpMnjy5fv368fHxaEpNTYUuhaGuXbvm5eXVtWvXq1evsqbyhho9ejSkDDOeOnUqJiamSZMmXKlBQUGtW7dev3796dOnN23a5OTkFBAQwO7FBnRwcIDccQ2wsbFh1wABWvsThDqxFKXib7du3Tw9PaUdGImJidbW1kVFRdBlzZo1lyxZIvb4bSgsw93d3fv37488UexRCh8KwkUGCjXzJn9/f6ZUJKHIW3fv3s2bkMA2aNCA38RxwrnYgEwbN268atUq3sTZvHnzsWPHxPMnCMLcaF+p1qUgP/Xw8ICGWNPOnTt79OiBHLBOnTq1atVCN/h037592EBSKR2EwYbCIt3Hx6egoEDaVOZQe/fuxQZSV94N6SpT6v79+/lRMdi9cnNz0S0jI6Nq1ar8GJA1e3t780E4OIbIyEjx/AmCMDfaVyoUlpmZefnyZV4Pr9WtW3f48OFIFY8fPx4bG8tkZ1CpWMsjnTx48CCvL28oplSs63lPLPOlTTt27Mh4Gqz0i0sditaqv/FcKVI1c0JDQx8/fiyGgCAIs6J9peq/Tb9r1y5pCjlv3jwmO4MLfwwVEBAgtWp5Q+Xk5GDhv3LlSj7ClClTWBOyUaSly5cv500c5J5NmzadM2dOuoT27dvzd8mkQM0HDhwQQ0AQhFmxRKWeOXMGCeCkSZNOnDiRmJjo4ODAZFdcmiTCmFBheW9PFZfKsWHDhocOHap4KKS0dnZ2SE4xFMaBK9HEfoJg+vTp2EtcXNzJkyeRn2J3TJpr1qypVq2aNKEGISEhTk5ORUVF0kqAmrCwMDEEBEHIyr1798SqCrFEpYKYmBhbW1tkiz169IDvuAex+g4ODobCIEp7e/uZM2ey/sJQ/v7+3KrlDZWXlzd27Fios3bt2v369UPyiyb2eQMQFRXVtm3bGjVqWFtbd+zYMTo6GpX9+/fv2bMn68DJysrCHTdu3CjUg4iIiAcPHohRUJwFC+ZFLviEChXtlbDP/o7ZvXfvdvFJXz5aVqqqmD17tqOjo1j7bKSnp2/f/jsebBMBper+e5EKFU0WKNW1bRvjrUpKNRXIYZctW5aZmXnixAkkochGsYQXOz0bJSUloaGhYhQUh5RKRcMFSj10eL3xViWlmgoo1cPDAyatVq2as7MzfMre05eXhQsX3r59WwyEspBSqWi4QKn4a7xVSamVm6ysrOTkZDEQykJKpaLhwpSqM9qqpNTKDdb+Zv9yKimVimLlZt6/Hz0+p19vusKVqjPOqqTUSs/ixYvz8/PFWChIBUq9feeEv/9ofvPxk/NXrx1O/S5p8ZK5H300XL9/pS6Yb1v+uVy/vuKCmOhXqr9IH9ZnKcUl/1n37Zf85sNH59577y39brx069Ypv+CYfv3vKrcKM4KCPoKdpZUlt0+cObsHjyAeR2m9VKk6I6xKSq30nD9/PiEhQYyFgpSn1PsPzrz+uvfWbfFt2rRs3bp58+bNHB3tmjRp1K7dn2bMGIf6J7oLG1KWNmpUn5Xnn6/z5z+7oNSqVZP/rVatqnRML6+XoWn9fVVcsKO7905hKkLovDIza+vJUzuFnqg8e26vtKZv3+4vveQsFBeXVhhTuG9g4JjPF34iVAol5+rhb5NjpDURkUHhEUH6PQ0WKyurtm1bs1KlShWhBtusG5pYVFHq1XueHX+dOtaNGzdk23iY9Ac3WDCUfqW0GBm3TZuXubm14Tfv/ZzNj5wVPEYODk15wfNBepMV9jjijvxMeUB4jXRY7BTHv3zFZzikli2dmjWzrV27Fp6fffp0Gz9+5I6dX0sPQFCqzpBVNaXUt99+e75FMmLEiLCnSUtLE6NjMspU6vUbR3v06Lzwi5m60mc2r4d3lsZ+KnSuWvUXb2JusJswAv/btKkN74bZiKEqVsCn8wMgbnv7pra2jTEg87hVKXA05M57jhw5KHHNIuHuqxO/GDHidf1hWfn5/unJk0fZ2DRIWLVAWg99vPiiA/MUNnjRH+HHKwehFWnNq692FtIiI4s0qjVr1tD9FkahlTWxwj2IYxPMzsqFi6kTJ76DKLFz6dixXfSXwdKF9oLPZzA5Pvfcc/rG1B+QlfLihjJu3NvTp4/lEcMRWv3yYxpN2c2xY0fwnnjccTHeuStBf3xWjAwICs7xnXcGISO+c/fkg4dnJ0x4B9d+nCYS1di4+cKw+krVVWhVTSl1vkVmqWWSkpKybt06MUCmoUylIh9c9c3n2EhaG41nM591mDOYMGwbyQLrzJ76Awf27tzZXb/wMZFpSidJmQXzBJOErabx98uYOd27e877dEpG5j+F1+CQHGX9Z5twd0x+qKSoOEt/ZCSwmNKDB/f/6foR/VYM3qBBPWMyaKRFfn5vwhfIjOrXfwFuiooOrvg6UWZBVLt27cgKT8p4DTcImnglgo/VAE/cUKTCXZMUhaP6YtEsPHa4IGFdjIXwsGED+/Xz0j88g1kqLxXEDcPCs+fO72M3kaLiWYEL4d59ifrjfPzxu2++2U+/nhcjA4JnhZ1dk38f2/yPTXF4ekya5Oft3RWPOwo2PvlkvDBsmUrVlW9VUqo2KSkpUezrqmUqlRUkfUgGpQkCRHbxUqrQjYlSOtWl5ZvVC1m3W4UZ1ta1hfuWVzBdX3utJ2aIvg5YgQELbh3Xr8e8TdkYK61BdozsDLpZv2GJfn9W/vXvTZ06tdevF8rXCQtg0vfee+tabrquNOkbOnQAtIX7FhZl6vevoBiZlEHZiAMrTKnSyxVX6vdHUpDRI4nGNnI3qTGR0IXM9ec3UY4d34KUv0uXDq1bN0dKiyQ9IjKouOQ/0j46I+IWt2y+1OljxgyNXDA9IOD9mMUhutIXSfgDgUGwPIflR40ajGsSLw0b1udnbfXL/xb69by4UnkND0jy+sVsO/en77GCeeUVD1yq4VMfn1f9/UfjOSY9Ql2pUivA0bHZ4cOHpdOBlKpZFixYIAbINJSnVOSAmJlID9nzm/kRE4C7EpVHjm5EVoKnOKaH/ghCuXHzX0jr9OvLLEFBH2F9p1/PC46kzPeOP1/4CVap/CYmdu/eXXCEnp5umJlIuKAeOFF4cwPugAt0pR5BWoezwxm1aOGIzsj1WJ/U75KgzsQ1i/7v//6qK01sW7V68fSZ3dieOnWMdJFrTMEhYWHOC2qkN7lBruQc4gXpJ5QqHYQbDStf/jZR+vcbpIuDyz8cwHHym7NmTYBGcUfU43KF3LNuXevAwDF/+lOLS5e/490Mxg2rbIiSHwCW/8u+CsUG4jN8uC8EjbOA/lCDxT7GOfqvf/DBdaXrCfgXg+NoWQ0/5YRVC1jM8/KPLYqaLW3FoyMNDp6cyFgPp6/HVWHatA9wOjgk/Wy6goInvzAdSKmaxbxKPZ6xBc9OaAspQJ061rqnsyrhJk80pO+lcAXzbniuC0aooGDpyl1WZqlevdqDh2fZNuzG1+zbd6zs06cb20Z61aRJoxEjXt+fuoZ3hguQevM+rGBO4o5sG/LCGlbaykrPnq9g/mMcJFzY3apvPn/jjT6sCckRdqR/lwoKD6AQMWmrn9+b/N0qtlFelop6PFJsO/rL4HHj3pbuC9JkG2uSonAvaRo7e/bEQYP66koTcHap0BkXNyS2ODwcAM4dPZFNs/rrN442bWqDpTqzYdLa6O7dPXH8Qkiff75OVHQwH1wnCQhEzAI7evTfcKmTtsK2eKR4z4ePzuFksetP5wfoStPzSZP8Pv74XemOKi6kVAvCvEpFyrPxH3EQIjxob//L+05WklWYdCGme1qp0lQLRapUJDhlZqmbt3yFNaNQibkKtel35sXZ2fH8hf1se0PKUv46HVIt5FNsGxnTqWzxUwG60iPBoXIHQRZYgbKb+QXHkD3p3wWlceOGbOPDD4fFxs3HAUhfzOXaMrLwAEpDJF0Fsw1k6+xtPXazvCyVXfZYGTiwt/SDTUgYue7/8hcPli0ypZ44uQOH/Z8T23WlH5hDxse6GRM3dCi4dRwHgMUEri7SA/D27orDZtt4/rCPAWB8/i4WCmr4NnuPnp0jHkd2aeGXZziUt353YO3Zc3uxjZNCWo10G88xL6+XcRZ40F1dW+GZiYcJWtc/+DILKdWCMK9SWcEMz8zaioxDZyhLXbsumr2Qh1mKJTNav1g0C7MIS0X+iifWejVqVBc+yImbmBX6Hwjt1q1TeWpjZdSowew1O4zQoUPbPXtXs/rCokzhvZd/bIrDuhXTD+vfr5aH6Ur1gSPE8bAOEBDPN7Hf8t6Vhs7YR4gOHV6PE+HW0JW+FNu+/UtsG6mT/n31izFKxUqWfQrN6rcsFbGCZfDXza0N/nbp0oH1x9mxlyByf/q+QYN60hdGkX4OHtyfbdvYNGCJIUJ08VIqdBb22TTWhOsTlMTvpTMibrpSp7PzlSoV10i4WzqUlV6WihohUOyU+cVYennGNY+HC/eSPvewbmDKRqzYswjXV36tNVhIqRaESpT6bXIMW0ValZWlZmT+09fX29HR7pNPxt+4+a+FX8xE7rBr9yq0hoYFOjnZY10mHRC2xV2kNbjjgAG99Hf9/ZEUpLRY0PGMQ3Axe2kCmezf//7h0KEDeD26DR/uK+2JcVjOhYyJ5WvfrF748st/5h3+9jcf9vEGFJwLWvlsx2j8/bHevbugCTcDAt738XmV9ykqznrlFY/lKz7D9rXcdA8PV3iND15eMUap/z62GWZBKHhnnAIUAxvOCZmMBTv/oC4uP3ggoDycCwLCB4Trscg4dnwLu4lrz8FDybpSpUKv06ePZfVIPP/6Vy/hY7kG46YrK03GJQ0PCq5M0s8zGa9UVmbNmoDrR/funvzaUKZSV8SHu7u7YmGBGsQcd5k7b4p0TIOFlGpBqESpmJ/sDV/pM57fvPzDASwkkbtBKEhnxo8feaswg+cUy74KRTK1dVs8v9fMmeOxTLtwMRUTA1mVn9+bnTq113+XlhUs8ZCKwstIDzH/Z8wYJ3RYsnTeCy/URQp25+5J/bvzguQLPTE5YZxmzWxhn6ZNbQ6n//phUigAq34cM7uZfXrXkCGvYRWJ0qKFI64QSNZYE/zi4tLK1rZxYOAY5lm4A7kqzB4c/DHfHXIlWLW8k+KFxxOZIH8hFVKAxPmnzT4L/zuuXq+91hOd9+5LRECQTcOz7I5IluFBljPiXh9+OAzRGDZsIKvBogHXAFwhtm3/9TVilLSD3yIaOGAoj9XjGgCT4jRxUsLH+CuOGytMqY8en7O2rh0y179Hj84ODk3xhMGhojN2x7pJlYpDZVoU3l1kAcFReXt37dXrLxAlDI5VP04HAeGv1bL74lDnfToFh43j598vwHoI2TGeY9JhKy6kVAtCJUr19x/NpqiV5Ls90q/3sIK1HvTKtiE4/rH/c+f3Icni3bDqhBkxE5ABsZyizDeC5C04sI8+Gu7p6YY9QiVTp46Rfg4ME5t/svL3FmTQkA57xUNa1iRFsfd8KijS5JQXSASJPJQHM+Jmv35eSWujoQ9oeuLEdyBQpKgwnfTz+eVdThBYGM3gqxAnT+0MnjOpzHcCK44bK1AqFAlxI1vEU2X3nm/4HvfsXc1fTuFKhaBx6XV2doTuhaHYMwoH88+tK3hlzOIQ5MUYf+DA3qyGKfXS5e8wOPtuq/QrW7g0IkoVvwovLaRUC0INSpV+HkX41JFwk4pQjPnWgMEC3et/cVZVhV0vpa+uSospfgABAQkNC5TWYC/STPx3FVKqBaEGpVKhou1CSrUgSKlUqJi6kFItCFIqFSqmLqRUC4KUSoWKqQsp1YIgpVKhYupCSrUgSKlUqJi6kFItCAWVGrlgQQQVKhZZIoXpQErVLIoplSAIDilVs5BSCUJ5SKmahZRKEMpDStUspFSCUB5SqmYhpRKE8pBSNQsplSCUh5SqWUipBKE8pFTNQkolCOUhpWoWUipBKA8pVbOQUglCeUip2qSkpISUShDKoymlQiI5OTmiXSySlJSUjRs3igEiCMLEaEqpxaWr3fDw8DC5mTdvnlj1zGDMwMBAsfaZ+ayUtLQ0MToEQZgeTSnVROTm5nbo0OHevXtiw7Px+PFjZ2fnmJgYsYEgiEoLKdUwEydOROYr1sqBi4uLnZ3dG2+8IbuvCYIwC6RUA2RlZbm7u9+5c0dskAMvLy/bUl566SXsSGwmCKKyQUo1wKBBgxITE8VamRg2bBhTKnBwcPjiiy/EHgRBVCpIqRWxffv2Xr16PXnyRGyQialTpzo6Otr9BsQ6YMAAehGAICovpNRyefjwYZcuXVJTU8UG+YiMjMSSv0OHDp07d+7bt2+nTp1g1Xbt2h07dkzsShBEZYCUWi7Lli0bMWKEWCsr33zzTfv27V955ZU1a9Z4eHgcP378yJEj48ePd3FxWbdundibIAjVQ0otm8LCQmSLZ8+eFRtkZefOna6urs7OziUlJWvXrh04cCCrx94h9JiYGHoRgCAqF6TUspk1a1ZQUJBYKzdZWVl2dnYjR47E9pMnT7D237Rpk7RDQUGB9CZBECqHlFoGFy9ebNu2bX5+vtggNz/99JOtre369evZzfT0dE9Pz/v37z/diyCISgMptQz8/PwWL14s1pqAx48ft2jRAqt+XjN69Ojo6GhJF4IgKhOkVJFDhw517tz54cOHYoNpCAwMlN68fPmyq6trXl6etJIgiMoCKfUpnjx54u3tvWXLFrHBZOi/AxYSEjJ16lShkiCISgEp9SnWrl3r6+sr1ipLcXFx+/bts7OzxQaCIFQPKfV/3L1718PDIyMjQ2xQnPj4+CFDhoi1BEGoHlLq/4iIiBg/frxYaw4ePXrUvXv3PXv2iA0EQagbUuqv5Obmurq64q/YYCbgU1gVbhUbCIJQMaTUX0F+aqIfRf3DYO0fHx8v1hIEoWJIqb+QkZHh7u5+9+5dscGsZGdnt2/fvri4WGwgCEKtkFJ/wdfXNykpSaxVAVOnTg0JCRFrCYJQK6TU/27evNnb29t0P4r6LNy8edPV1fWHH34QGwiCUCWWrtQHDx68/PLLhw4dEhtUQ1RU1Pvvvy/WEgShSixdqTExMaNGjRJr1cT9+/c7dep05MgRsYEgCPVh0UrNy8vDsvrSpUtig8pISUnp16+fTqcTGwiCUBkWrdTAwMDg4GCxVn1Apj4+Phs2bBAbCIJQGZar1NOnT1eijygdPXq0Y8eOP//8s9hAEISasFylVroP0n/wwQeLFi0SawmCUBMWqtTK+HXPH3/80dXV9ebNm2IDQRCqwRKVyn6UZO/evWKD6pk3b15AQIBYSxCEarBEpa5YsWLo0KFibWWguLjYzc2NfkqVIFSLxSmV/cDzmTNnxIZKwtdff00/pUoQqsXilBocHDxt2jSxtvLw6NEjLy8v+ilVglAnlqXUS5cuKfPfpE1KZXxvjSAsBMtSqmL/TdrUYO2/cuVKsZYgCHNjQUpV+L9JmxT6KVWCUCeWolTl/5u0qQkICJg7d65YSxCEWbEUpSYlJZn9v0nLC/sp1R9//FFsIAjCfFiEUu/cuePu7p6ZmSk2VHIWLVo0ZswYsZYgCPNhEUoNDw+fMGGCWFv5+fnnnzt16nT06FGxgSAIM6F9pV67dk1V/01aXjZs2ODj40M/pUoQKkH7Sh03blxkZKRYqxUg0/79+6ekpIgNBEGYA40r9fjx4x4eHmr7b9LygoU/lv/3798XGwiCUByNK3XgwIHr1q0TazXHmDFjoqKixFqCIBRHy0rdvHlznz591PnfpOWFfkqVIFSCZpWq/v8mLS9z586ln1IlCLOjWaUuXrzYz89PrNUu7EcL6adUCcK8aFOp+fn5bdu2vXjxotigaVauXEk/pUoQ5kUjSs3Ly5PeDAoKmjVrlrTGEmD/AIZ+SpUgzIhGlJqYmMi3z549iyVwUVGRpN1SoJ9SJQjzohGljhw5km+PGDFi2bJlkkbLotL9M22C0BJaUCqSshdffPHBgwfYTk1N7dKlizZ+FPWPQT+lShBmRAtKvXbtmq2tbUZGxpMnT3r16rV9+3axh4URGBg4Z84csZYgCNOjBaWmp6dDqQkJCatXrx40aBCvv337dnJy8rZt2x4/fizprn3y8vJcXV0vX74sNhAEYWK0oNSvv/4aSh01apS7u3tWVhYz6bvvvtumTRtL+DZqmURHR48ePVqsJQjCxGhBqbNnz4ZSW7Zs6evrO3LkSEdHR9zs2LHj6dOnxa4Ww/379z09PZG/iw0EQZgSLSjVz8/PtpR27do5OTnZ29sPHTr03r17Yj8LY9OmTX379rWEnzggCPWgBaVCHEypACnqV199JfawVAYOHLh27VqxliAIk6EFpWKND5na2dkhS7Xkxb4+lvBzsQShKrSg1JYtWzo4ONBiv0zGjx8fEREh1hIEYRoqvVIfPXrUvHnz5cuXiw1EKbm5uR06dKCLDUEoQxlKLSwsRF4TGho6vzIwZ86cgIAAsbYcQkJCYmNjS0pKxHNWAaYLO85arFIWNYedIOSlDKVGRkbm5OQUa5SsrKzg4GAV/q4ohZ0gNEAZSkVaIU4IzTF37lzxtM0NhZ0gNICFKjU+Pv7q1avimZsVCjtBaABFlbp161YrK6tLly6JDYqDJXZsbKx45maFwk4QGsCwUtmEZNSvX3/w4MEXL16UdjAexea29Jhr1arVpUuXtLQ0oQ9OUzxzs6KBsIPTp0/7+fk5ODhUr17dxsbm9ddf379/v7SD2sJOEPJirFKPHDly7ty5PXv2uLi49OnTR9rBeBSb29JjTk9P9/b2dnJyEvokJSWdPXtWPHnzoYGwZ2ZmNm7c2MfHZ9u2bdnZ2d99992UKVP69u0r7aO2sBOEvBirVD4hExISqlatmp+fj+2lS5e2a9euRo0a9erVe+utt65cucL6FBYWhoSEtGjRAqmKra3tjBkz9Ie6efOmr6+vm5vbhQsXKhgqLy9v3LhxjRo1ql279oABA1asWIEReGt4eHirVq2wF3t7+2nTpt26dUt/R+Dbb7/FzRs3brCbDNxctGiRePLmQwNh79WrlyBQwO/FUFvYCUJefrdSkWVUqVIFMxPbcXFxW7ZsQT6CPq6urkOGDGF9Jk+ejLVqfHw8mlJTUzFvhaGuXbvm5eXVtWvXq1evsqbyhho9ejTskJycfOrUqZiYmCZNmvC5HRQU1Lp16/Xr12OxuWnTJuShAQEBwo6wff369ZEjR0IcrEmKqhahlT3sly9fxhFu3LiRjVABqgo7QcjL71Mq/nbr1s3T01PagZGYmGhtbV1UVIR5W7NmzSVLlog9fhvq6NGj7u7u/fv3F9JGDh8KMx+pEBzBm/z9/dnchiiRQO3evZs3IZNq0KAB22Y7si4F8xyrUSxFeU/O5s2bjx07Jp6/majsYd+7dy/6wLO8qTxUFXaCkBdjlcr15OHhgfnAmnbu3NmjRw8bG5s6derUqlUL3TCx9+3bhw1kN9JBGGworBZ9fHwKCgqkTWUOxWYpcijeDXkTm9v79+/nR8Vg98rNzS3+bUfok5GRgaPFwr9NmzbR0dH/218pOIbIyEjx/M1EZQ+78UpVVdgJQl6MVSrmUmZmJhZ3vB4TrG7dusOHD0fOcvz48djYWDbrDM5tLCqR1xw8eJDXlzeU/izFelPatGPHjoynKSws5DuSviGzatWq559/nr/qxwkNDVXJv1Gp7GE3fuFfrKawE4S8GKtU/feLd+3aZSXJZebNm8dmncEVKIYKCAiQTu/yhsrJycEKdOXKlXyEKVOmsCakRciPli9fzpuk6B/z6tWr+WuRUuCIAwcOiCEwBxoIe8+ePfU/lnDl6benGOoJO0HIyx9X6pkzZ6pWrTpp0qQTJ04kJiY6ODiwWVdc+j4Jpi7mZHnvkxSXztKGDRseOnSo4qGQW9nZ2SFLwlAYp2nTpmhi34WfPn069hIXF3fy5EkkStid8B43+wQSBt+2bVvbtm179erFWqUUFRWFhYWJITAHGgg7Ul0bGxv+Iaq0tLRp06bpfwagWE1hJwh5+eNKBTExMba2tkhbevTogYnHJySWgcHBwU5OTpix9vb2M2fOZP2Fofz9/fn0Lm+ovLy8sWPHYg7Xrl27X79+yMLQxJPNqKgouLJGjRrW1tYdO3bkr5ayHTGQnDZp0uTdd9/94YcfWKtARETEgwcPxCgojgbCDmBShBp7r1atGvT6xhtvIBvlrVJUEnaCkBfDSlUVs2fPdnR0FGufjfT09O3bt4tRUBwKO0FoALUrFcnUsmXLMjMzsThFNoS0KCQkROz0bJSUlISGhopRUBwKO0FogEqgVA8PD0xpLCSdnZ0xsdl7+vKycOHC27dvi4FQFgo7QWgAtStVGbKyspKTk8VAKAuFnSA0ACn1F7AInW/ub0lS2AlCA5BSf2Xx4sX5+fliLBSEwk4QGoCU+ivnz59PSEgQYyETGDw2NragoEBskEBhJwgNUIZS33777fkWyYgRI8KeJi0tTYzOH+Xw4cMuLi4ffPDBuXPnxLZSKOymCDtBKEwZSp1vkelSmaSkpKxbt04M0B8FVm3evLmtrW3v3r337NkjtFLYOfKGnSCUhJRaESUlJWGyfm8SVm3VqhXE2qxZMzc3t/j4eP4NIgo7R/awE4RikFINsGDBAjFAzwZ7BaBNmzZIVx0cHJydnWfNmlVQUEBhlyJ72AlCGUipBrBVhBYtWkyYMEHctwVDSiUqKaRUA8g+tylLNQbZw04QykBKNYC8c5teSzUSecNOEIpBSjWAjHOb3vE3HhnDThBKQko1gFxz2+DnUinsUuQKO0EoDCnVALLMbfr21O9FlrAThPKQUg2g2NymsEtRLOwEIS+kVAMoNrcp7FIUCztByAsp1QCKzW0KuxTFwk4Q8kJKNYBic5vCLkWxsBOEvJBSDaDY3KawS1Es7AQhL6RUAyg2tynsUhQLO0HICynVAIrNbQq7FMXCThDyQko1gGJzm8IuRbGwE4S8kFINoNjcprBLUSzsBCEvpFQDKDa3KexSFAs7QcgLKdUAis1tCrsUxcJOEPJCSjWAYnObwi5FsbAThLyQUg2g2NymsEtRLOwEIS+kVAMoNrcp7FIUCztByAsp1QCKzW0KuxTFwk4Q8kJKNYBic5vCLkWxsBOEvJBSDaDY3KawS1Es7AQhL6RUAyg2tynsUhQLO0HICym1IkpKShSb2xR2jpJhJwh5KUOpeDbn5OSIT3OLJCUlZePGjWKATAOFnaNk2AlCXspQanHpsis8PDzMgvmslLS0NDE6JoPCHmaOsBOEvJShVIIgCOKPQUolCIKQDVIqQRCEbJBSCYIgZIOUShAEIRv/D/6H8s567wrxAAAAAElFTkSuQmCC" />
</p>
<h3 id="二重読み込みの防御">3.7.4 二重読み込みの防御
<a id="SS_3_7_4"></a></h3>
<ul>
<li>二重インクルードを防ぐため、
ヘッダファイルには#includeガードを付ける。
ガード用のマクロは、<パス名>_<ファイル名>_H_とする。</li>
</ul>
<div class="sourceCode" id="cb160"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/lib/inc/xxx.h 1</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// lib/inc/xxx.hでの#includeガード</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifndef LIB_INC_XXX_H_</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define LIB_INC_XXX_H_</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">void</span> XxxInitialize<span class="op">();</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif  </span><span class="co">// LIB_INC_XXX_H_</span></span></code></pre></div>
<ul>
<li>コンパイラが#pragma onceをサポートしている場合は、
上記方法ではなく下記をヘッダファイル先頭に記述する。</li>
</ul>
<div class="sourceCode" id="cb161"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/lib/inc/xxx.h 16</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#pragma once</span></span></code></pre></div>
<h3 id="ヘッダファイル内のinclude">3.7.5 ヘッダファイル内の#include
<a id="SS_3_7_5"></a></h3>
<ul>
<li>不要な依存関係を作らないようにするため、
ヘッダファイルは、そのコンパイルに不要なヘッダファイルをインクルードしない。</li>
<li>ヘッダファイルが外部からインポートする型(class、struct、enum)
のデリファレンスがそのヘッダファイル内で不要な場合、前方宣言を使い依存関係を小さくする。</li>
</ul>
<div class="sourceCode" id="cb162"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/header.h 3</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pod0, Pod1の定義は別ファイルでされていると前提。</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Pod0<span class="op">;</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Pod1<span class="op">;</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記関数宣言のコンパイルには、Pod0、Pod1の完全な定義は必要ない。</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">void</span> forward_decl<span class="op">(</span>Pod0 <span class="at">const</span><span class="op">*</span> pod_0<span class="op">,</span> Pod1<span class="op">*</span> pod_1<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> Pod1 forward_decl<span class="op">(</span>Pod0 <span class="at">const</span><span class="op">*</span> pod_0<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">void</span> forward_decl<span class="op">(</span>Pod0 pod_0<span class="op">)</span> <span class="kw">noexcept</span><span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb163"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/header_ut.cpp 12</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pod0, Pod1の定義がなくても宣言があるためコンパイルできる</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    forward_decl<span class="op">(</span><span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 下記のソースコードのコンパイルには、Pod0の定義が必要なのでコンパイルできない</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// forward_decl(nullptr);</span></span></code></pre></div>
<h3 id="includeするファイルの順番">3.7.6 #includeするファイルの順番
<a id="SS_3_7_6"></a></h3>
<ul>
<li>ユーザ定義ヘッダファイルより、システムヘッダファイルの#includeを先に行う。</li>
<li>システムヘッダファイルは、アルファベット順に#includeを行う。</li>
<li>ユーザ定義ヘッダファイルは、アルファベット順に#includeを行う。</li>
</ul>
<h3 id="includeで指定するパス名">3.7.7 #includeで指定するパス名
<a id="SS_3_7_7"></a></h3>
<ul>
<li>ユーザ定義のヘッダファイルは”“で囲み、システムヘッダファイルは、&lt;&gt;で囲む。</li>
<li>他のパッケージの外部非公開ヘッダファイルを読み込まないようにするために、
#includeのパス指定に”../“(ディレクトリ上方向への移動)を使用しない。</li>
</ul>
<div class="sourceCode" id="cb164"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/lib/header.cpp 1</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;string&gt;</span><span class="pp">  </span><span class="co">// OK</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;../h/suppress_warning.h&quot;</span><span class="pp">  </span><span class="co">// NG   上方向へのファイルパスは禁止</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;../header.h&quot;</span><span class="pp">  </span><span class="co">// NG   上方向へのファイルパスは禁止</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;inc/xxx.h&quot;</span><span class="pp">    </span><span class="co">// OK</span></span></code></pre></div>
<ul>
<li>ヘッダファイル以外のファイル(.cppファイル等)をインクルードしない。</li>
</ul>
<h2 id="スコープ">3.8 スコープ <a id="SS_3_8"></a></h2>
<h3 id="スコープの定義と原則">3.8.1 スコープの定義と原則
<a id="SS_3_8_1"></a></h3>
<p>この章で扱うスコープを下記のように定義する(「<a
href="programming_convention.html#SS_3_7_1">パッケージの実装と公開</a>」参照)。</p>
<ol type="1">
<li>グローバル</li>
<li>パッケージ外部公開名前空間</li>
<li>パッケージ外部非公開名前空間</li>
<li>ファイル(無名名前空間と関数外static)</li>
<li>クラス内</li>
<li>関数内</li>
<li>ブロック内</li>
</ol>
<p>リンクの観点からは、2と3の識別子は同じスコープを持つが、
その識別子はパッケージ外部非公開なヘッダファイルに宣言、定義されているため、
パッケージ外から(まともな方法では)アクセスできない。</p>
<ul>
<li>識別子のスコープは最小になるように配置する。
<ul>
<li>1のスコープを持つ識別子を宣言しない(特にグローバルなスコープ内のオブジェクトは定義しない)。</li>
<li>2、3のスコープを持つ静的な変数を宣言しない。</li>
<li>パッケージ外部公開ヘッダファイルでの識別子の宣言、定義を最小にする。</li>
<li>クラス内部でのみ使用される識別子は、privateもしくはprotectedで宣言する。</li>
<li>一つの.cppファイルのみで使用する識別子は、
その.cppファイル内の無名名前空間で宣言、定義する(staticを使用しない)。</li>
<li>単一関数のみで使用する変数は、その関数内で定義する。</li>
<li>自動変数は、使用直前に定義する。</li>
</ul></li>
<li>スコープが重複する「名前のない名前空間内」(例えば、ブロックとそれを内包するブロック)
にある「同一名を持つ識別子」を宣言、定義しない(「<a
href="term_explanation.html#SS_18_4_8">name-hiding</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb165"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope.h 7</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">uint32_t</span> xxx<span class="op">;</span>  <span class="co">// NG 外部から参照可能な静的変数</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="dt">uint64_t</span> yyy<span class="op">;</span>  <span class="co">// NG 同上</span></span></code></pre></div>
<div class="sourceCode" id="cb166"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 18</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> xxx<span class="op">;</span>  <span class="co">// NG 外部から参照可能な静的変数</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> yyy<span class="op">;</span>  <span class="co">// NG 同上</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> f<span class="op">(</span><span class="dt">uint32_t</span> yyy<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> xxx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// NG 関数外xxxと関数内xxxのスコープが重なっており区別が付きづらい</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> xxx <span class="op">+</span> yyy<span class="op">;</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// なお、</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  scope.h内では、  uint64_t yyy;</span></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  scope.cpp内では、uint32_t yyy;</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  となっており、宣言と定義が矛盾している。</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  この問題は、このファイルからscope.hをインクルードすれば防げる。</span></span></code></pre></div>
<h3 id="名前空間">3.8.2 名前空間 <a id="SS_3_8_2"></a></h3>
<ul>
<li>グローバル名前空間には下記以外の識別子を定義、宣言しない。
<ul>
<li>main関数</li>
<li>グローバルnewのオーバーロード</li>
<li>Cとシェアする識別子</li>
</ul></li>
<li>パッケージ毎に名前空間を定義する (「<a
href="programming_convention.html#SS_3_7_1">パッケージの実装と公開</a>」、<a
href="naming_practice.html#SS_6_3_8">名前空間名</a>」参照)。</li>
<li>外部リンケージの不要な識別子は.cpp内の無名名前空間で宣言、定義する。</li>
<li>名前空間Xxx内で定義されたテンプレートやinline関数から参照されるため、
外部公開用ではないにもかかわらずヘッダファイル内に定義が必要な識別子は、
名前空間Xxx::Inner_内で定義する。
名前空間Xxx::Inner_内の識別子は、単体テストを除き他のファイルから参照しない。</li>
</ul>
<div class="sourceCode" id="cb167"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope2.h 9</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">size_t</span> N<span class="op">&gt;</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> StaticString <span class="op">{</span>  <span class="co">// StaticStringは外部公開</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> Inner_ <span class="op">{</span>  <span class="co">// equal_nは外部非公開</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">size_t</span> N<span class="op">&gt;</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">bool</span> equal_n<span class="op">(</span><span class="dt">size_t</span> n<span class="op">,</span> StaticString<span class="op">&lt;</span>N<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> lhs<span class="op">,</span> StaticString<span class="op">&lt;</span>N<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> lhs<span class="op">.</span>String<span class="op">()[</span>n<span class="op">]</span> <span class="op">!=</span> rhs<span class="op">.</span>String<span class="op">()[</span>n<span class="op">]</span> <span class="op">?</span> <span class="kw">false</span> <span class="op">:</span> equal_n<span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> lhs<span class="op">,</span> rhs<span class="op">);</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace Inner_</span></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">size_t</span> N1<span class="op">,</span> <span class="dt">size_t</span> N2<span class="op">&gt;</span>  <span class="co">// operator==は外部公開</span></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>StaticString<span class="op">&lt;</span>N1<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;,</span> StaticString<span class="op">&lt;</span>N2<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;)</span> <span class="kw">noexcept</span></span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">size_t</span> N<span class="op">&gt;</span>  <span class="co">// operator==は外部公開</span></span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>StaticString<span class="op">&lt;</span>N<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> lhs<span class="op">,</span> StaticString<span class="op">&lt;</span>N<span class="op">&gt;</span> <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Inner_<span class="op">::</span>equal_n<span class="op">(</span><span class="dv">0</span><span class="op">,</span> lhs<span class="op">,</span> rhs<span class="op">);</span></span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="using宣言usingディレクティブ">3.8.3
using宣言/usingディレクティブ <a id="SS_3_8_3"></a></h3>
<ul>
<li>識別子のインポートのための<a
href="term_explanation.html#SS_18_4_13">using宣言</a>は下記のような場合のみに使用する
(「<a
href="term_explanation.html#SS_18_2_3">継承コンストラクタ</a>」、「<a
href="term_explanation.html#SS_18_10_1">オーバーライドとオーバーロードの違い</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb168"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 55</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="bu">std::</span>string<span class="op">;</span>  <span class="co">// NG この関数内でのstd::stringの使用箇所が少ないのであれば、</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//    using宣言ではなく、名前修飾する</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_0</span> <span class="op">=</span> string<span class="op">{</span><span class="st">&quot;str&quot;</span><span class="op">};</span>       <span class="co">// NG</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_1</span> <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;str&quot;</span><span class="op">};</span>  <span class="co">// OK</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 大量のstd::stringリテラルを使用する場合</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="bu">std::</span>literals<span class="bu">::</span>string_literals<span class="bu">::</span>operator<span class="bu">&quot;&quot;</span>s<span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_2</span> <span class="op">=</span> <span class="st">&quot;str&quot;</span><span class="bu">s</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="va">s_N</span> <span class="op">=</span> <span class="st">&quot;str&quot;</span><span class="bu">s</span><span class="op">;</span>  <span class="co">// OK</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// クラス内でのusing宣言</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Base <span class="op">{</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f<span class="op">(){};</span></span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Derived <span class="op">:</span> Base <span class="op">{</span></span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> Base<span class="op">::</span>Base<span class="op">;</span>  <span class="co">// OK 継承コンストラクタ</span></span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> Base<span class="op">::</span>f<span class="op">;</span>     <span class="co">// OK B::fのインポート</span></span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> f<span class="op">(</span><span class="dt">int</span><span class="op">){};</span></span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<ul>
<li>下記のような場合を除き、<a
href="term_explanation.html#SS_18_4_14">usingディレクティブ</a>は使用しない。</li>
</ul>
<div class="sourceCode" id="cb169"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 84</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span>  <span class="co">// NG</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> s0 <span class="op">=</span> string<span class="op">{</span><span class="st">&quot;str&quot;</span><span class="op">};</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> s1 <span class="op">=</span> <span class="bu">std::</span>literals<span class="bu">::</span>string_literals<span class="bu">::</span>operator<span class="bu">&quot;&quot;</span>s<span class="op">(</span><span class="st">&quot;str&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// NG</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>s1<span class="op">)&gt;);</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> <span class="bu">std::</span>literals<span class="bu">::</span>string_literals<span class="op">;</span>  <span class="co">// OK 例外的にOK</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> s2 <span class="op">=</span> <span class="st">&quot;str&quot;</span><span class="bu">s</span><span class="op">;</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>s2<span class="op">)&gt;);</span></span></code></pre></div>
<ul>
<li>出荷仕向け等の理由を除き、inline namespaceを使用しない(「<a
href="programming_convention.html#SS_3_6">プリプロセッサ命令</a>」参照)。</li>
</ul>
<div class="sourceCode" id="cb170"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 106</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> XxxLib <span class="op">{</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> OldVersion <span class="op">{</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace OldVersion</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="kw">namespace</span> NewVersion <span class="op">{</span>  <span class="co">// NG inline</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace NewVersion</span></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> g<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f<span class="op">();</span>  <span class="co">// NG NewVersion::f()が呼ばれる。</span></span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb171"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 141</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 例外的にOKな例</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_JAPAN </span><span class="kw">inline</span><span class="pp">                                                 </span><span class="co">// OK</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_US</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_EU</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; defined(SHIP_TO_US) &amp;&amp; !defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_JAPAN</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_US </span><span class="kw">inline</span><span class="pp">  </span><span class="co">// OK</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_EU</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#elif !defined(SHIP_TO_JAPAN) &amp;&amp; !defined(SHIP_TO_US) &amp;&amp; defined(SHIP_TO_EU)  </span><span class="co">// OK</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_JAPAN</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_US</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define INLINE_EU </span><span class="kw">inline</span><span class="pp">  </span><span class="co">// OK</span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> <span class="st">&quot;SHIP_TO_JAPAN/US/EU must be defined&quot;</span><span class="op">);</span></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> Shipping <span class="op">{</span></span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a>    INLINE_JAPAN <span class="kw">namespace</span> Japan  <span class="co">// OK</span></span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> DoSomething<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a>    INLINE_US <span class="kw">namespace</span> US  <span class="co">// OK</span></span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> DoSomething<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>    INLINE_EU <span class="kw">namespace</span> EU  <span class="co">// OK</span></span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> DoSomething<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">2</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace Shipping</span></span></code></pre></div>
<div class="sourceCode" id="cb172"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 183</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SHIP_TO_JAPAN/US/EUを切り替えることで、対応したDoSomethingが呼ばれる</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この例ではSHIP_TO_JAPANが定義されているため、Shipping::Japan::DoSomethingが呼ばれる</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">0</span><span class="op">,</span> Shipping<span class="op">::</span>DoSomething<span class="op">());</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 名前修飾することで、すべてのDoSomethingにアクセスできるため、単体テストも容易</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">0</span><span class="op">,</span> Shipping<span class="op">::</span>Japan<span class="op">::</span>DoSomething<span class="op">());</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">1</span><span class="op">,</span> Shipping<span class="op">::</span>US<span class="op">::</span>DoSomething<span class="op">());</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="dv">2</span><span class="op">,</span> Shipping<span class="op">::</span>EU<span class="op">::</span>DoSomething<span class="op">());</span></span></code></pre></div>
<ul>
<li><a href="exercise_q.html#SS_19_6_1">演習-usingディレクティブ</a></li>
</ul>
<h3 id="adlと名前空間による修飾の省略">3.8.4
ADLと名前空間による修飾の省略 <a id="SS_3_8_4"></a></h3>
<ul>
<li>名前空間の修飾を省略した識別子のアクセスには、
下記のような副作用があるため、<a
href="term_explanation.html#SS_18_4_5">ADL</a>を使用する目的以外で使用しない
(「<a
href="naming_practice.html#SS_6_3">識別子の命名</a>」を順守することで、識別子の偶然の一致を避けることも必要)。</li>
</ul>
<div class="sourceCode" id="cb173"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 200</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> NS_0 <span class="op">{</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> X <span class="op">{};</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>f<span class="op">(</span>X<span class="op">,</span> <span class="dt">int32_t</span><span class="op">)</span>  <span class="co">// 第2引数int32_t</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;in NS_0&quot;</span><span class="op">;</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace NS_0</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> NS_1 <span class="op">{</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>f<span class="op">(</span>NS_0<span class="op">::</span>X<span class="op">,</span> <span class="dt">uint32_t</span><span class="op">)</span>  <span class="co">// 第2引数uint32_t</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;in NS_1&quot;</span><span class="op">;</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>    TEST<span class="op">(</span>ProgrammingConvention<span class="op">,</span> adl<span class="op">)</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// in NS_1</span></span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 下記関数fの探索名前空間には、</span></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">//  * 第1引数の名前空間がNS_0であるため、ADLにより、</span></span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">//  * この関数の宣言がNS_1で行われているため、</span></span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// NS_0、NS_1が含まれる。</span></span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// これにより、下記fの候補は、NS_0::f、NS_1::fになるが、第2引数1がint32_t型であるため、</span></span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 下記は、NS_0::fの呼び出しになる。</span></span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="st">&quot;in NS_0&quot;</span><span class="op">,</span> f<span class="op">(</span>NS_0<span class="op">::</span>X<span class="op">(),</span> <span class="dv">1</span><span class="op">));</span>  <span class="co">// NS_0::fが呼ばれる。</span></span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">(</span><span class="st">&quot;in NS_1&quot;</span><span class="op">,</span> NS_1<span class="op">::</span>f<span class="op">(</span>NS_0<span class="op">::</span>X<span class="op">(),</span> <span class="dv">1</span><span class="op">));</span>  <span class="co">// NS_1::fの呼び出しには名前修飾が必要</span></span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  <span class="co">// namespace NS_1</span></span></code></pre></div>
<h3 id="名前空間のエイリアス">3.8.5 名前空間のエイリアス
<a id="SS_3_8_5"></a></h3>
<ul>
<li>ネストされた長い名前空間を短く簡潔に書くための名前空間エイリアスは、関数スコープで宣言する。</li>
<li>名前空間のエイリアスを<a
href="programming_convention.html#SS_3_8_3">using宣言/usingディレクティブ</a>で使用しない。</li>
</ul>
<div class="sourceCode" id="cb174"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/scope_ut.cpp 238</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> find_files_recursively<span class="op">(</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> path<span class="op">,</span> <span class="bu">std::</span>function<span class="op">&lt;</span><span class="dt">bool</span><span class="op">(</span><span class="bu">std::</span>filesystem<span class="bu">::</span>path<span class="op"> </span><span class="at">const</span><span class="op">&amp;)&gt;</span> condition<span class="op">)</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">namespace</span> fs <span class="op">=</span> <span class="bu">std::</span>filesystem<span class="op">;</span>  <span class="co">// OK 長い名前を短く</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> files  <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;{};</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> parent <span class="op">=</span> fs<span class="op">::</span>path<span class="op">{</span>path<span class="op">.</span>c_str<span class="op">()};</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="kw">namespace</span> fs<span class="op">;</span>  <span class="co">// NG エイリアスをusing namespaceで使用しない</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>for_each<span class="op">(</span>fs<span class="op">::</span>recursive_directory_iterator<span class="op">{</span>parent<span class="op">},</span>  <span class="co">// OK namespaceエイリアス</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>                      fs<span class="op">::</span>recursive_directory_iterator<span class="op">{},</span>        <span class="co">// OK namespaceエイリアス</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a>                      <span class="op">...</span></span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> fs<span class="op">::</span>recursive_directory_iterator<span class="op">;</span>  <span class="co">// NG エイリアスをusing宣言で使用しない</span></span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-20"><a href="#cb174-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>for_each<span class="op">(</span>recursive_directory_iterator<span class="op">{</span>parent<span class="op">},</span>  <span class="co">// NG</span></span>
<span id="cb174-21"><a href="#cb174-21" aria-hidden="true" tabindex="-1"></a>                      recursive_directory_iterator<span class="op">{},</span>        <span class="co">// NG</span></span>
<span id="cb174-22"><a href="#cb174-22" aria-hidden="true" tabindex="-1"></a>                      <span class="op">...</span></span>
<span id="cb174-23"><a href="#cb174-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb174-24"><a href="#cb174-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-25"><a href="#cb174-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> files<span class="op">;</span></span>
<span id="cb174-26"><a href="#cb174-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h2 id="ランタイムの効率">3.9 ランタイムの効率 <a id="SS_3_9"></a></h2>
<ul>
<li>ランタイム効率と、可読性のトレードオフが発生する場合、可読性を優先させる。</li>
<li>やむを得ず可読性を落とすコードオプティマイゼーションを行う場合は、
プロファイリング等を行い、ボトルネックを確定させ、必要最低限に留める。
また、開発早期での可読性を落とすコードオプティマイゼーションは行わない。</li>
</ul>
<h3 id="前置後置演算子の選択">3.9.1 前置/後置演算子の選択
<a id="SS_3_9_1"></a></h3>
<ul>
<li>後置演算子の一般的な動作は、下記のようになるため前置演算子の実行に比べて処理が多い。
どちらを使用してもよい場合は前置演算子を使う。
<ol type="1">
<li>自分(オブジェクト)をコピーする。</li>
<li>自分に前置演算子を実行する。</li>
<li>コピーされたオブジェクトを返す。</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb175"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 14</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>        A<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">++()</span> <span class="kw">noexcept</span>  <span class="co">// 前置++</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">++</span><span class="va">a_</span><span class="op">;</span>  <span class="co">// メンバ変数のインクリメント</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>        A <span class="kw">operator</span><span class="op">++(</span><span class="dt">int</span><span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// 後置++</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>            A old<span class="op">{*</span><span class="kw">this</span><span class="op">};</span>  <span class="co">// リターンするためのオブジェクト</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">++(*</span><span class="kw">this</span><span class="op">);</span>     <span class="co">// 前置++</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> old<span class="op">;</span>    <span class="co">// oldオブジェクトのリターン(オブジェクトのコピー)</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">operator</span> <span class="dt">int</span><span class="op">()</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">a_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">a_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb176"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/h/measure_performance.h 4</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// パフォーマンス測定用</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> FUNC<span class="op">&gt;</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono<span class="bu">::</span>milliseconds<span class="op"> </span>MeasurePerformance<span class="op">(</span><span class="dt">uint32_t</span> count<span class="op">,</span> FUNC f<span class="op">)</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="at">const</span> start <span class="op">=</span> <span class="bu">std::</span>chrono<span class="bu">::</span>system_clock<span class="bu">::</span>now<span class="op">();</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> <span class="dv">0</span><span class="bu">U</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>            f<span class="op">();</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="at">const</span> stop <span class="op">=</span> <span class="bu">std::</span>chrono<span class="bu">::</span>system_clock<span class="bu">::</span>now<span class="op">();</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>chrono<span class="bu">::</span>duration_cast<span class="op">&lt;</span><span class="bu">std::</span>chrono<span class="bu">::</span>milliseconds<span class="op">&gt;(</span>stop <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb177"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 41</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> count <span class="op">=</span> <span class="dv">10000000</span><span class="bu">U</span><span class="op">;</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_post <span class="op">=</span> A<span class="op">{};</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> post   <span class="op">=</span> MeasurePerformance<span class="op">(</span>count<span class="op">,</span> <span class="op">[&amp;</span>a_post<span class="op">]</span> <span class="op">{</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>        a_post<span class="op">++;</span>  <span class="co">// NG 効率が悪い。</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_pre <span class="op">=</span> A<span class="op">{};</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> pre   <span class="op">=</span> MeasurePerformance<span class="op">(</span>count<span class="op">,</span> <span class="op">[&amp;</span>a_pre<span class="op">]</span> <span class="op">{</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">++</span>a_pre<span class="op">;</span>  <span class="co">// OK 上記に比べると効率が良い。</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a>    ASSERT_GT<span class="op">(</span>post<span class="op">,</span> pre<span class="op">);</span>  <span class="co">// 前置++の処理は後置++より効率が良い。</span></span></code></pre></div>
<ul>
<li>ソースコードの統一性のため、このオーバーヘッドがない基本型についても、同じルールを適用する。</li>
</ul>
<h3 id="operator-xoperator-xの選択">3.9.2 operator X、operator x=の選択
<a id="SS_3_9_2"></a></h3>
<ul>
<li>前置/後置演算子と同じような問題が発生するため、どちらを使っても問題ない場合は、
operator Xではなく、operator X=を使う。</li>
</ul>
<div class="sourceCode" id="cb178"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 68</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">explicit</span> A<span class="op">(</span><span class="dt">int32_t</span> a<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">:</span> <span class="va">a_</span><span class="op">{</span>a<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>        A<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">+=(</span>A <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">a_</span> <span class="op">+=</span> rhs<span class="op">.</span><span class="va">a_</span><span class="op">;</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">friend</span> A <span class="kw">operator</span><span class="op">+(</span>A <span class="at">const</span><span class="op">&amp;</span> lhs<span class="op">,</span> A <span class="at">const</span><span class="op">&amp;</span> rhs<span class="op">)</span> <span class="kw">noexcept</span>  <span class="co">// メンバ関数に見えるが、非メンバ関数</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>            A tmp<span class="op">{</span>lhs<span class="op">};</span>  <span class="co">// operator +=に対して、</span></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>            tmp <span class="op">+=</span> rhs<span class="op">;</span>  <span class="co">// 「tmpを作り、それを返す]をしなければならない。</span></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> tmp<span class="op">;</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> a <span class="op">=</span> A<span class="op">{</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> b <span class="op">=</span> A<span class="op">{</span><span class="dv">2</span><span class="op">};</span></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span>                                   <span class="co">// NG 無駄な動作が多い。</span></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">&quot;a:&quot;</span> <span class="op">&lt;&lt;</span> a<span class="op">.</span>GetA<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>  <span class="co">// a:3と表示</span></span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a>        a <span class="op">+=</span> b<span class="op">;</span>                                      <span class="co">// OK</span></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">&quot;a:&quot;</span> <span class="op">&lt;&lt;</span> a<span class="op">.</span>GetA<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>  <span class="co">// a:5と表示</span></span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li>ソースコードの統一性のため、このオーバーヘッドがない基本型についても、同じルー
ルを適用する。</li>
</ul>
<h3 id="関数の戻り値オブジェクト">3.9.3 関数の戻り値オブジェクト
<a id="SS_3_9_3"></a></h3>
<ul>
<li>基本型やenum、 std::unique_ptr&lt;&gt;、std::optional&lt;&gt;
等のサイズの小さいクラス以外のオブジェクトを関数の戻り値にしない。</li>
<li>[注意] ローカルオブジェクトに対して<a
href="term_explanation.html#SS_18_10_12">RVO(Return Value
Optimization)</a>が有効であれば、
そのオブジェクトを戻り値にしても良い。</li>
<li>[注意]
stdのコンテナは、RVOが有効でなくてもmoveが行われるため、関数の戻り値として使用しても良い。</li>
<li>[注意] std::stringについては、RVOに加えて、 <a
href="term_explanation.html#SS_18_10_13">SSO(Small String
Optimization)</a>が使用されていることが多い。
そのようなコンパイラを使用している場合、std::stringは小さいオブジェクトとして扱って良い。</li>
</ul>
<div class="sourceCode" id="cb179"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 115</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> HugeClass <span class="op">{</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> a<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> array<span class="op">[</span><span class="dv">100000</span><span class="op">]{};</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>    HugeClass f<span class="op">()</span> <span class="kw">noexcept</span>  <span class="co">// NG 巨大なオブジェクトのリターン</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> obj <span class="op">=</span> HugeClass<span class="op">{};</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> obj<span class="op">;</span>  <span class="co">// RVOが使えない場合パフォーマンス問題を引き起こす可能性がある。</span></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// RVO、SSOをサポートしているコンパイラを使用している場合、下記の2つのGetNameの</span></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// パフォーマンスに大差はない(ほとんどのC++コンパイラはRVO、SSOをサポートしている)。</span></span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 使い勝手は、std::string GetName()の方が良い。</span></span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="bu">std::</span>string<span class="op"> </span>GetName<span class="op">()</span>  <span class="co">// OK この程度なら問題はない</span></span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;sample&quot;</span><span class="op">;</span></span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">void</span> GetName<span class="op">(</span><span class="bu">std::</span>string<span class="op">&amp;</span> s<span class="op">)</span>  <span class="co">// OK</span></span>
<span id="cb179-28"><a href="#cb179-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb179-29"><a href="#cb179-29" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> <span class="st">&quot;sample&quot;</span><span class="op">;</span></span>
<span id="cb179-30"><a href="#cb179-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb179-31"><a href="#cb179-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<h3 id="move処理">3.9.4 move処理 <a id="SS_3_9_4"></a></h3>
<ul>
<li><a
href="term_explanation.html#SS_18_3_2">ディープコピー</a>の実装を持つクラスへのcopy代入の多くがrvalueから行われるのであれば、
moveコンストラクタや、move代入演算子も実装する。</li>
<li>関数の戻り値にローカルオブジェクトを使用する場合、 <a
href="term_explanation.html#SS_18_10_12">RVO(Return Value
Optimization)</a>の阻害になるため、そのオブジェクトをstd::moveしない。</li>
</ul>
<div class="sourceCode" id="cb180"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 150</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>MakeString<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> ret <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{};</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 文字列操作</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if 0</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="co">        // NG</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="co">        // std::moveのため、RVOが抑止される。</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="co">        // -Wpessimizing-moveを指定してg++/clang++でコンパイルすれば、</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="co">        // &quot;moving a local object in a return statement prevents copy elision&quot;</span></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a><span class="co">        // という警告が出る。</span></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="co">        return std::move(ret);</span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="pp">#else</span></span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// OK</span></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ローカルオブジェクトには通常RVOが行われるため、std::moveするよりも無駄が少ない。</span></span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ret<span class="op">;</span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<h3 id="stdstring-vs-stdstring-const-vs-stdstring_view">3.9.5
std::string vs std::string const&amp; vs std::string_view
<a id="SS_3_9_5"></a></h3>
<ul>
<li>文字列を受け取る関数の仮引数の型に関しては下記のような観点に気を付ける。
以下に示す通り、このような仮引数の型をstd::string
const&amp;にすることが最適であるとは限らない。</li>
</ul>
<div class="sourceCode" id="cb181"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 184</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト０用関数</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f0<span class="op">([[</span><span class="at">maybe_unused</span><span class="op">]]</span> <span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f1<span class="op">([[</span><span class="at">maybe_unused</span><span class="op">]]</span> <span class="bu">std::</span>string<span class="op"> </span>str<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f2<span class="op">([[</span><span class="at">maybe_unused</span><span class="op">]]</span> <span class="bu">std::</span>string_view<span class="op"> </span>str<span class="op">)</span> <span class="op">{}</span></span></code></pre></div>
<div class="sourceCode" id="cb182"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 195</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト０―０</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> str     <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="ot">__func__</span><span class="op">};</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f0_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[&amp;</span>str<span class="op">]</span> <span class="op">{</span> f0<span class="op">(</span>str<span class="op">);</span> <span class="op">});</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f1_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[&amp;</span>str<span class="op">]</span> <span class="op">{</span> f1<span class="op">(</span>str<span class="op">);</span> <span class="op">});</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f2_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[&amp;</span>str<span class="op">]</span> <span class="op">{</span> f2<span class="op">(</span>str<span class="op">);</span> <span class="op">});</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このドキュメントを開発しているPCでは上記の結果は以下の様になる。</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f0 : 50 msec</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f1 :222 msec</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f2 : 55 msec</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// つまり、f0 &lt; f2 &lt; f1であり、f0とf2は大差がなく、f1は極めて非効率である。</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 従って、文字列を関数に渡す場合の引数の型は、</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::string const&amp;か、std::string_viewとするのが効率的である。</span></span></code></pre></div>
<div class="sourceCode" id="cb183"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 219</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト０―１</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f0_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> f0<span class="op">(</span><span class="ot">__func__</span><span class="op">);</span> <span class="op">});</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f1_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> f1<span class="op">(</span><span class="ot">__func__</span><span class="op">);</span> <span class="op">});</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> f2_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> f2<span class="op">(</span><span class="ot">__func__</span><span class="op">);</span> <span class="op">});</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このドキュメントを開発しているPCでは上記の結果は以下の様になる。</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f0 :674 msec</span></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f1 :662 msec</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// f2 :115 msec</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// つまり、f2 &lt; f1 &lt; f0であり、f0、f1は極めて非効率である。</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 従って、文字列を関数に渡す場合の引数の型は、std::string_viewとするのが効率的である。</span></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト０―０、テスト０―１の結果から、</span></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   * 文字列リテラルからstd::string型テンポラリオブジェクトを作るような呼び出しが多い場合、</span></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     std::string_view</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   * 上記のような呼び出しがほとんどない場合、std::string const&amp;</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// を引数型とすべきである。</span></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 使用方法が想定できない場合、極めて非効率なテスト０－１のf0のパターンを避けるため、</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::string_viewを選択すべきだろう。</span></span></code></pre></div>
<div class="sourceCode" id="cb184"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 248</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト１用クラス</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A0 <span class="op">{</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>        A0<span class="op">(</span><span class="bu">std::</span>string<span class="op"> </span><span class="at">const</span><span class="op">&amp;</span> str<span class="op">)</span> <span class="op">:</span> <span class="va">str_</span><span class="op">{</span>str<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="va">str_</span><span class="op">;</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A1 <span class="op">{</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>        A1<span class="op">(</span><span class="bu">std::</span>string<span class="op"> </span>str<span class="op">)</span> <span class="op">:</span> <span class="va">str_</span><span class="op">{</span><span class="bu">std::</span>move<span class="op">(</span>str<span class="op">)}</span> <span class="op">{}</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="va">str_</span><span class="op">;</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A2 <span class="op">{</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>        A2<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>str<span class="op">)</span> <span class="op">:</span> <span class="va">str_</span><span class="op">{</span>str<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span><span class="va">str_</span><span class="op">;</span></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb185"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/runtime_ut.cpp 303</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// テスト１―１</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a0_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> A0 a<span class="op">{</span><span class="ot">__func__</span><span class="op">};</span> <span class="op">});</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a1_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> A1 a<span class="op">{</span><span class="ot">__func__</span><span class="op">};</span> <span class="op">});</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a2_msec <span class="op">=</span> MeasurePerformance<span class="op">(</span><span class="dv">10000000</span><span class="op">,</span> <span class="op">[]</span> <span class="op">{</span> A2 a<span class="op">{</span><span class="ot">__func__</span><span class="op">};</span> <span class="op">});</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このドキュメントを開発しているPCでは上記の結果は以下の様になる。</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A0 :834 msec</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A1 :774 msec</span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A2 :704 msec</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// つまり、A2 &lt; A1 &lt; A0であり、A0の効率がやや悪い。</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 従って、文字列を関数に渡す場合の引数の型は、</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::stringか、std::string_viewとするのが効率的である。</span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// コンストラクタのインターフェースとしては、</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 実引数オブジェクトのライフタイムを考慮しなくて良いため、A0よりもA1の方が優れている。</span></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この観点と、テスト１－０、テスト１－１の結果を総合的に考えれば、</span></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このような場合の引数の型は、std::stringを選択すべきだろう。</span></span></code></pre></div>
<h3 id="extern-template">3.9.6 extern template
<a id="SS_3_9_6"></a></h3>
<ul>
<li>何度もインスタンス化が行われ、
それによりROMの肥大化やビルドの長時間化を引き起こすようなクラステンプレートに対しては、
extern templateを使う。</li>
</ul>
<div class="sourceCode" id="cb186"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_vector.h 4</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// このファイルをインクルードすると、</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// そのファイルでのstd::vector&lt;std::string&gt;のインスタンス化は抑止される。</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">extern</span> <span class="kw">template</span> <span class="kw">class</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;;</span></span></code></pre></div>
<div class="sourceCode" id="cb187"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_vector.cpp 3</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::vector&lt;std::string&gt;はこのファイルでインスタンス化される。</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="kw">class</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;;</span></span></code></pre></div>
<h2 id="標準クラス関数の使用制限">3.10 標準クラス、関数の使用制限
<a id="SS_3_10"></a></h2>
<h3 id="stl">3.10.1 STL <a id="SS_3_10_1"></a></h3>
<ul>
<li>C++のバージョン毎に定められた非推奨の機能、関数、クラスを使わない。
これらについては、<a
href="https://cpprefjp.github.io/">C++日本語リファレンス</a>の
<ul>
<li><a
href="https://cpprefjp.github.io/lang/cpp11.html">C++11の機能変更</a></li>
<li><a
href="https://cpprefjp.github.io/lang/cpp14.html">C++14の機能変更</a></li>
<li><a
href="https://cpprefjp.github.io/lang/cpp17.html">C++17の機能変更</a>
に詳細が書かれている。</li>
</ul></li>
<li><a href="term_explanation.html#SS_18_9_1">g++</a>/<a
href="term_explanation.html#SS_18_9_2">clang++</a>等の優れたコンパイラを適切なオプションで使用することで、
非推奨の機能、関数、クラスの使用を防ぐ。</li>
</ul>
<h4 id="スマートポインタの使用制限">3.10.1.1 スマートポインタの使用制限
<a id="SS_3_10_1_1"></a></h4>
<ul>
<li>std::auto_ptrを使用しない(C++17で廃止)。</li>
<li>ダイナミックに生成したオブジェクトの管理にはstd::unique_ptr&lt;&gt;を使用する。
std::unique_ptr&lt;&gt;では機能が足りない場合のみ、std::shared_ptr&lt;&gt;を使用する。</li>
</ul>
<h4 id="配列系コンテナクラスの使用制限">3.10.1.2
配列系コンテナクラスの使用制限 <a id="SS_3_10_1_2"></a></h4>
<ul>
<li>配列系のコンテナを使用する場合、コンパイル時に要素数の上限が
<ul>
<li>定まるのであれば、std::arrayを使用する。</li>
<li>未定ならば、std::vectorを使用する。</li>
</ul></li>
<li>std::vector&lt;bool&gt;は、std::vectorの特殊化であり、通常のstd::vectorと同じようには扱えない。
std::vector&lt;bool&gt;を使用する場合、その要素へのハンドルがbool&amp;やbool*でないことに注意する。</li>
<li>std::arrayを除くコンテナクラスは、 それ自体でメモリリソースの<a
href="design_pattern.html#SS_9_9">RAII(scoped
guard)</a>を実現しているため、newしない。</li>
</ul>
<h4 id="stdstringの使用制限">3.10.1.3 std::stringの使用制限
<a id="SS_3_10_1_3"></a></h4>
<ul>
<li>std::stringは、 それ自体でメモリリソースの<a
href="design_pattern.html#SS_9_9">RAII(scoped
guard)</a>を実現しているため、newしない。</li>
<li>std::stringの添字演算子[]は領域外アクセスを通知しない (<a
href="https://cpprefjp.github.io/reference/stdexcept.html">std::out_of_range</a>
エクセプションを発生させない)ため、std::string::at() を使用する (「<a
href="template_meta_programming.html#SS_13_2_3">安全な配列型コンテナ</a>」参照)。</li>
<li>std::string.data()は、C++のバージョンによってはNULLターミネイトが保証されていないため、
std::string.c_str() を使用する。</li>
</ul>
<h4 id="stdstring_viewの使用制限">3.10.1.4 std::string_viewの使用制限
<a id="SS_3_10_1_4"></a></h4>
<ul>
<li>std::string_viewが保持するポインタが指す文字列の所有権は、他のオブジェクトが保持しているため、
std::string_viewの初期化や、copy代入の右辺にrvalueを使用しない。</li>
</ul>
<div class="sourceCode" id="cb188"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_view_ut.cpp 11</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> str <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;abc&quot;</span><span class="op">};</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> sv  <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">{</span>str<span class="op">};</span>  <span class="co">// OK lvalueからの初期化</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>sv<span class="op">,</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="st">&quot;abc&quot;</span><span class="op">});</span></span></code></pre></div>
<div class="sourceCode" id="cb189"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_view_ut.cpp 31</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string_view<span class="op"> </span>sv <span class="op">=</span> <span class="bu">std::</span>string<span class="op">{</span><span class="st">&quot;abc&quot;</span><span class="op">};</span>  <span class="co">// NG rvalueからの初期化</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="co">//    この行でstd::string{&quot;abc&quot;}が解放</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>sv<span class="op">,</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="st">&quot;abc&quot;</span><span class="op">});</span>    <span class="co">//    svは無効なポインタを保持</span></span></code></pre></div>
<ul>
<li>文字列リテラルで初期化されたstd::string_viewと文字列リテラルとの微妙な違いに気を付ける。</li>
</ul>
<div class="sourceCode" id="cb190"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_view_ut.cpp 43</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>  <span class="co">// 文字列リテラルを範囲として使用すると、ヌル文字が要素に含まれる</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> oss <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> c <span class="op">:</span> <span class="st">&quot;abc&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>            oss <span class="op">&lt;&lt;</span> c<span class="op">;</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>string<span class="op">{</span><span class="ch">&#39;a&#39;</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span><span class="op">,</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">}),</span> oss<span class="op">.</span>str<span class="op">());</span>  <span class="co">// ヌル文字が入る</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>  <span class="co">// string_viewを使用すると、ヌル文字が要素に含まれない</span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> oss <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> c <span class="op">:</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="st">&quot;abc&quot;</span><span class="op">})</span> <span class="op">{</span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a>            oss <span class="op">&lt;&lt;</span> c<span class="op">;</span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a>        ASSERT_EQ<span class="op">((</span><span class="bu">std::</span>string<span class="op">{</span><span class="ch">&#39;a&#39;</span><span class="op">,</span> <span class="ch">&#39;b&#39;</span><span class="op">,</span> <span class="ch">&#39;c&#39;</span><span class="op">}),</span> oss<span class="op">.</span>str<span class="op">());</span>  <span class="co">// ヌル文字は入らない</span></span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb191"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/string_view_ut.cpp 65</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="at">const</span> a<span class="op">[]{</span><span class="st">&quot;123&quot;</span><span class="op">};</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span>       b <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">{</span><span class="st">&quot;01234&quot;</span><span class="op">}.</span>substr<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// インデックス1 - 3</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>a<span class="op">,</span> b<span class="op">);</span>  <span class="co">// a == bが成り立つ</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> oss_a <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    oss_a <span class="op">&lt;&lt;</span> a<span class="op">;</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> oss_b <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>    oss_b <span class="op">&lt;&lt;</span> b<span class="op">;</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span>oss_a<span class="op">.</span>str<span class="op">(),</span> oss_b<span class="op">.</span>str<span class="op">());</span>  <span class="co">// ここまでは予想通り</span></span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bをインデックスアクセスすると以下のようになる。</span></span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> b<span class="op">[-</span><span class="dv">1</span><span class="op">]);</span> ASSERT_EQ<span class="op">(</span><span class="ch">&#39;1&#39;</span><span class="op">,</span> b<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> ASSERT_EQ<span class="op">(</span><span class="ch">&#39;2&#39;</span><span class="op">,</span>  b<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="ch">&#39;3&#39;</span><span class="op">,</span>  b<span class="op">[</span><span class="dv">2</span><span class="op">]);</span> ASSERT_EQ<span class="op">(</span><span class="ch">&#39;4&#39;</span><span class="op">,</span> b<span class="op">[</span><span class="dv">3</span><span class="op">]);</span> ASSERT_EQ<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">,</span> b<span class="op">[</span><span class="dv">4</span><span class="op">]);</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 上記の結果から、以下の結果になることには注意が必要</span></span>
<span id="cb191-21"><a href="#cb191-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> oss_b_cstr <span class="op">=</span> <span class="bu">std::</span>ostringstream<span class="op">{};</span></span>
<span id="cb191-22"><a href="#cb191-22" aria-hidden="true" tabindex="-1"></a>    oss_b_cstr <span class="op">&lt;&lt;</span> b<span class="op">.</span>data<span class="op">();</span>  <span class="co">// data()は文字列リテラルへのポインタを指す。</span></span>
<span id="cb191-23"><a href="#cb191-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-24"><a href="#cb191-24" aria-hidden="true" tabindex="-1"></a>    ASSERT_NE<span class="op">(</span>oss_a<span class="op">.</span>str<span class="op">(),</span> oss_b_cstr<span class="op">.</span>str<span class="op">());</span></span>
<span id="cb191-25"><a href="#cb191-25" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="st">&quot;123&quot;</span><span class="op">,</span> oss_a<span class="op">.</span>str<span class="op">());</span></span>
<span id="cb191-26"><a href="#cb191-26" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ<span class="op">(</span><span class="st">&quot;1234&quot;</span><span class="op">,</span> oss_b_cstr<span class="op">.</span>str<span class="op">());</span></span></code></pre></div>
<h3 id="posix系関数">3.10.2 POSIX系関数 <a id="SS_3_10_2"></a></h3>
<h4 id="使用禁止関数一覧">3.10.2.1 使用禁止関数一覧
<a id="SS_3_10_2_1"></a></h4>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">禁止関数</th>
<th style="text-align: left;">代替え</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">alloca()</td>
<td style="text-align: left;">コンテナ</td>
</tr>
<tr class="even">
<td style="text-align: left;">asctime()</td>
<td style="text-align: left;">strftime()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">asctime_r()</td>
<td style="text-align: left;">strftime()</td>
</tr>
<tr class="even">
<td style="text-align: left;">bcmp()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">bcopy()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">brk()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">bzero()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ctermid()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ctime()</td>
<td style="text-align: left;">strftime()</td>
</tr>
<tr class="even">
<td style="text-align: left;">ctime_r()</td>
<td style="text-align: left;">strftime()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cuserid()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ecvt()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">execl()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="even">
<td style="text-align: left;">execlp()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">execv()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="even">
<td style="text-align: left;">execvp()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fattach()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">fcvt()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">fdetach()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ftw()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">gcvt()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">getc()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">getchar()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">getgrgid()</td>
<td style="text-align: left;">getgrgir_r()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">getgrnam()</td>
<td style="text-align: left;">getgrnam_r()</td>
</tr>
<tr class="even">
<td style="text-align: left;">getitimer()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">getlogin()</td>
<td style="text-align: left;">getlogin_r()</td>
</tr>
<tr class="even">
<td style="text-align: left;">getmsg()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">getopt()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">getpmsg()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">getpwuid()</td>
<td style="text-align: left;">getpwuid_r()</td>
</tr>
<tr class="even">
<td style="text-align: left;">getpwnam()</td>
<td style="text-align: left;">getpwnam_r()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gets()</td>
<td style="text-align: left;">fgets()</td>
</tr>
<tr class="even">
<td style="text-align: left;">getitimer()</td>
<td style="text-align: left;">timer_gettime()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gettimeofday()</td>
<td
style="text-align: left;">clock_gettime()（戻り値を確認すること）</td>
</tr>
<tr class="even">
<td style="text-align: left;">getw()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">getwd()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">gmtime()</td>
<td style="text-align: left;">gmtime_r()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">index()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ioctl()
（stropts.hに定義されているもの）</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">isascii()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">isastream()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">localtime()</td>
<td style="text-align: left;">localtime_r()</td>
</tr>
<tr class="even">
<td style="text-align: left;">_longjmp()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">mktemp()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">popen()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pthread_getconsurrency()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">pthread_setconcurrency()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">putc()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">putchar()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">putenv() に autoな変数のポインタ</td>
<td style="text-align: left;">setenv()</td>
</tr>
<tr class="even">
<td style="text-align: left;">putmsg()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">putpmsg()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">rand()</td>
<td style="text-align: left;">srand()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rand_r()</td>
<td style="text-align: left;">srand()</td>
</tr>
<tr class="even">
<td style="text-align: left;">readdir()</td>
<td style="text-align: left;">readdir_r()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rindex()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">sbrk()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">scanf()</td>
<td style="text-align: left;">sscanf()</td>
</tr>
<tr class="even">
<td style="text-align: left;">_setjmp()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">setpgrp()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">settimer()</td>
<td style="text-align: left;">timer_settimer()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sighold()</td>
<td style="text-align: left;">pthread_sigmask() または
sigprocmask()</td>
</tr>
<tr class="even">
<td style="text-align: left;">sigignore()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">siginterrupt()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">signal()</td>
<td style="text-align: left;">signalfd()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sigpause()</td>
<td style="text-align: left;">sigsuspend()</td>
</tr>
<tr class="even">
<td style="text-align: left;">sigrelse()</td>
<td style="text-align: left;">pthread_sigmask() または
sigprocmask()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sigset()</td>
<td style="text-align: left;">sigaction()</td>
</tr>
<tr class="even">
<td style="text-align: left;">sigstack()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">strcpy()</td>
<td style="text-align: left;">strncpy()</td>
</tr>
<tr class="even">
<td style="text-align: left;">strcat()</td>
<td style="text-align: left;">strncat()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">strlen()</td>
<td style="text-align: left;">strnlen()</td>
</tr>
<tr class="even">
<td style="text-align: left;">strtok()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">sprintf()</td>
<td style="text-align: left;">snprintf()</td>
</tr>
<tr class="even">
<td style="text-align: left;">system()</td>
<td style="text-align: left;">execle(), execve()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tempnam()</td>
<td style="text-align: left;">tmpfile(), mkdtemp(), mkstemp()</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmpnam()</td>
<td style="text-align: left;">tmpfile(), mkdtemp(), mkstemp()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toascii()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">_tolower()</td>
<td style="text-align: left;">tolower()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">_toupper()</td>
<td style="text-align: left;">toupper()</td>
</tr>
<tr class="even">
<td style="text-align: left;">ttyname()</td>
<td style="text-align: left;">ttyname_r()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ttyslot()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ulimit()</td>
<td style="text-align: left;">getrlimit(), setrlimit()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utime()</td>
<td style="text-align: left;">utimensat()</td>
</tr>
<tr class="even">
<td style="text-align: left;">utimes()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">valloc()</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">vfork()</td>
<td style="text-align: left;">fork()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vsprintf()</td>
<td style="text-align: left;">vsnprintf()</td>
</tr>
<tr class="even">
<td style="text-align: left;">wcscat()</td>
<td style="text-align: left;">wcsncat()</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wcscpy()</td>
<td style="text-align: left;">wcsncpy()</td>
</tr>
</tbody>
</table>
<h4 id="使用禁止関数の理由や注意点">3.10.2.2 使用禁止関数の理由や注意点
<a id="SS_3_10_2_2"></a></h4>
<h5 id="バッファオーバーランを引き起こしやすい関数">3.10.2.2.1
バッファオーバーランを引き起こしやすい関数
<a id="SS_3_10_2_2_1"></a></h5>
<ul>
<li>以下の関数は、バッファオーバーフロー等のバグを引き起こしやすい。</li>
</ul>
<pre><code>    gets(), scanf(), strcpy(), strcat(), sprintf(), vsprintf(), wcscat(), wcscpy()</code></pre>
<h5 id="コマンドインジェクション防止">3.10.2.2.2
コマンドインジェクション防止 <a id="SS_3_10_2_2_2"></a></h5>
<ul>
<li>以下の関数は、外部コマンドの実行時に環境変数に依存してしまう。</li>
</ul>
<pre><code>    execl(), execlp(), execv(), execvp(), popen(), system()</code></pre>
<h5 id="obsolete関数">3.10.2.2.3 obsolete関数
<a id="SS_3_10_2_2_3"></a></h5>
<ul>
<li>以下の関数は、すでにメンテナンスがされなくなった(obsolete)。</li>
</ul>
<pre><code>    asc_time(), asctime_r(), ctime(), ctime_r(), fattach(), fdetach(), ftw(), getitimer(),
    getmsg(), getpmsg(), gets(), settimer(), gettimeofday(), ioctl() in stropts.h for stream,
    isascii(), isastream(), _longjmp(),
    pthread_getconsurrency(), pthread_setconcurrency(), putmsg(), putpmsg(), rand_r(),
    _setjmp(), settimer(),
    setpgrp(), sighold(), sigignore(), siginterrupt(), sigpause(), sigrelse(), sigset(),
    strlen(), _tolower(), _toupper(), tempnam(), tmpnam(), toascii(), ulimit(), utime()</code></pre>
<h5 id="legacy関数">3.10.2.2.4 LEGACY関数
<a id="SS_3_10_2_2_4"></a></h5>
<ul>
<li>以下の関数は、すでに役目を終えた。</li>
</ul>
<pre><code>    sigstack(), cuserid(), getopt(), getw(), ttyslot(), valloc(), ecvt(), fcvt(), 
    gcvt(), mktemp(), bcmp(), bcopy(), bzero(), index(), rindex(), utimes(), getwd(),
    brk(), sbrk(), rand()</code></pre>
<h5 id="スレッドセーフでない関数">3.10.2.2.5 スレッドセーフでない関数
<a id="SS_3_10_2_2_5"></a></h5>
<ul>
<li>以下の関数は、スレッドセーフでない。</li>
</ul>
<pre><code>    asctime(), ctime(), getgrgid(), getgrnam(), getlogin(), getpwuid(), getpwnam(), gmtime(),
    localtime(), ttyname(), 
    ctermid(), tmpnam() (引数がNULLのとき、非リエントラントになる)</code></pre>
<h5 id="標準外関数等">3.10.2.2.6 標準外関数等
<a id="SS_3_10_2_2_6"></a></h5>
<ul>
<li>可変長配列や、alloca()は、標準外である。</li>
</ul>
<h5 id="扱いが難しい関数">3.10.2.2.7 扱いが難しい関数
<a id="SS_3_10_2_2_7"></a></h5>
<ul>
<li>signalの扱いは極めて難しく、安定動作をさせるのは困難である。
「シグナルのリエントラント問題を解決でき、使用できる関数に制限がない」という利点があるため、
signal()の代わりに、 signalfd() を使用する。</li>
<li>排他的にファイルをオープンできないため、tmpfile()を使用しない。代わりにmkstemp()を使用する。</li>
</ul>
<h4 id="典型的な注意点">3.10.2.3 典型的な注意点
<a id="SS_3_10_2_3"></a></h4>
<h5 id="リソースリークを引き起こしやすい関数">3.10.2.3.1
リソースリークを引き起こしやすい関数 <a id="SS_3_10_2_3_1"></a></h5>
<ul>
<li>open()/close()、fopen()/fclose()はリソースリークを引き起こしやすい。
「<a href="#8.9">RAII(scoped
guard)</a>」で例示したコードやstd::fstreamを使うことでその問題を回避する。</li>
</ul>
<h5 id="シンボリックリンクの検査">3.10.2.3.2 シンボリックリンクの検査
<a id="SS_3_10_2_3_2"></a></h5>
<ul>
<li><p>シンボリックリンクはlstat()のみで検査せず、以下のように検査する。</p>
<ol type="1">
<li>ファイル名をlstat()</li>
<li>ファイルをopen()</li>
<li>2で取得したファイル記述子に対してfstat()</li>
<li>1, 3の情報を照合して同一ファイルであることを確認</li>
</ol></li>
</ul>
<h5 id="strncpy-strncatの終端">3.10.2.3.3 strncpy(), strncat()の終端
<a id="SS_3_10_2_3_3"></a></h5>
<ul>
<li>下記のような問題を回避するために文字列操作にはstd::stringを使用する。
<ul>
<li>sizeof(dst) &lt;= strlen(src) の場合、strncpy(dst, src, sizeof(dst)
- 1)の呼び出しは、 dstの文字列を’\0’終端しない。</li>
<li>コピーすべきデータが無くなると、dstの残りを’\0’で埋めるので性能上の問題がある。</li>
<li>strncpy(), strncat()ともに、 sizeof(dst) &lt; strlen(src)
のときにsrcの文字列が切り捨てられたことを判別できない。</li>
</ul></li>
</ul>
<h5 id="toctou-time-of-check-time-of-use">3.10.2.3.4 TOCTOU (Time Of
Check, Time Of Use) <a id="SS_3_10_2_3_4"></a></h5>
<ul>
<li>open()前にaccess()でファイルの存在を確認する等、チェックして使用するパターンでは、
この動作がアトミックに行われないため問題が発生する。
この問題回避の一般解はないが「ファイルの存在確認後、read-open」のような場合では、
「いきなりread-openし、エラーした場合に対処」することでアトミックな処理にできる。</li>
</ul>
<h5 id="メモリアロケーション-1">3.10.2.3.5 メモリアロケーション
<a id="SS_3_10_2_3_5"></a></h5>
<ul>
<li>new/deleteとmalloc/freeの混在を避けるため下記の使用をしない。
newしたオブジェクトのポインタをfreeした場合、そのオブジェクトのデストラクタが呼び出されず、
リソースリークしてしまうことがある。</li>
</ul>
<pre><code>    malloc(), realloc(), free()</code></pre>
<h5 id="非同期シグナル">3.10.2.3.6 非同期シグナル
<a id="SS_3_10_2_3_6"></a></h5>
<ul>
<li>プロセス監視のSIGCHLDや、accept()でのブロッキングの中断等、シグナルでしか処理できない場合を除き、
非同期シグナルを使用しない。</li>
<li>使用してもよいシグナルは、以下に限られる。
<ul>
<li>SIGHUP : デーモン制御</li>
<li>SIGINT : 端末の割り込みキー</li>
<li>SIGILL : 不正なハードウェア命令</li>
<li>SIGBUS : ハードウェアフォルト</li>
<li>SIGFPE : 算術演算例外</li>
<li>SIGSEGV : 不正なメモリ参照</li>
<li>SIGALRM : タイムアウト検知</li>
<li>SIGTERM : killで送られるデフォルト終了シグナル</li>
<li>SIGCHLD : プロセス監視</li>
</ul></li>
<li>上記シグナルを扱う場合であっても、シグナル処理専用スレッドでsigwait()を用いることで、
非同期シグナルを同期的に扱うようにする。</li>
</ul>
<h2 id="その他">3.11 その他 <a id="SS_3_11"></a></h2>
<h3 id="assertion">3.11.1 assertion <a id="SS_3_11_1"></a></h3>
<ul>
<li>論理的にありえない状態(特に論理的に到達しないはずの条件文への到達)を検出するために、
assert()を使用する(「<a
href="programming_convention.html#SS_3_4_2">switch文</a>」、「<a
href="programming_convention.html#SS_3_4_3">if文</a>」参照)。</li>
<li>assert()はコンパイルオプションにより無効化されることがあるため、
assert()の引数に<a
href="term_explanation.html#SS_18_11_4">副作用</a>のある式を入れない。</li>
<li>ランタイムでなく、コンパイル時に判断できる論理矛盾や使用制限には、static_assertを使用する。</li>
</ul>
<div class="sourceCode" id="cb198"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/etc.cpp 12</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="dt">uint32_t</span> SIZE<span class="op">&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> POD <span class="op">{</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>        POD<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>  <span class="co">// 何らかの理由で、10を超えるSIZEをサポートしたくない。</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">static_assert</span><span class="op">(</span>SIZE <span class="op">&lt;</span> <span class="dv">10</span><span class="op">,</span> <span class="st">&quot;too big&quot;</span><span class="op">);</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> mem<span class="op">[</span>SIZE<span class="op">];</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> f<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>        POD<span class="op">&lt;</span><span class="dv">3</span><span class="op">&gt;</span> p3<span class="op">;</span>             <span class="co">// コンパイル可能</span></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span>   p4 <span class="op">=</span> POD<span class="op">&lt;</span><span class="dv">4</span><span class="op">&gt;{};</span>  <span class="co">// コンパイル可能</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// POD&lt;10&gt; p10;        // static assertion failed: too big でコンパイルエラー</span></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// POD&lt;11&gt; p11;        // static assertion failed: too big でコンパイルエラー</span></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<ul>
<li><p>static_assert、assert両方が使える場合には、static_assertを優先して使用する。</p></li>
<li><p><a
href="exercise_q.html#SS_19_7_1">演習-アサーションの選択</a><br />
</p></li>
<li><p><a
href="exercise_q.html#SS_19_7_2">演習-assert/static_assert</a></p></li>
</ul>
<h3 id="アセンブラ">3.11.2 アセンブラ <a id="SS_3_11_2"></a></h3>
<ul>
<li>アセンブラ関数は、.asm等で定義し、ヘッダファイルでCの関数として宣言する。</li>
<li>アセンブラ関数も、関数/メンバ関数のルールに従う(「<a
href="programming_convention.html#SS_3_3">非メンバ関数/メンバ関数</a>」参照)。</li>
<li>インラインアセンブラや、それを含む<a
href="programming_convention.html#SS_3_6_1">関数型マクロ</a>がソースコード全域に広がらないようにする。</li>
</ul>
<h3 id="言語拡張機能">3.11.3 言語拡張機能 <a id="SS_3_11_3"></a></h3>
<ul>
<li>#pragma once以外で、且つそれ以外に実装方法がない場合を除き、
コンパイラ独自の言語拡張機能を使用しない。</li>
<li>オブジェクトのアライメントが必要な場合、
<ul>
<li>alignas、alignofを使用する(「<a
href="dynamic_memory_allocation.html#SS_14_2_1">固定長メモリプール</a>」参照)。</li>
<li>コンパイラ独自のアライメント機能(#pragma等)の使用を避ける。</li>
</ul></li>
<li>繰り返し使用する#pragmaに関しては、_Pragma演算子とマクロを組み合わせて使用する。
コンパイラの警告には従うべきであるが、ごく稀に無視せざるを得ない場合がある。
そういった場合、その警告は下記例のような方法で抑止する。</li>
</ul>
<div class="sourceCode" id="cb199"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// @@@ example/programming_convention/etc.cpp 38</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if defined(__clang__)</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_CLANG_UNUSED_PRIVATE_FIELD </span><span class="op">\</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">_Pragma</span><span class="op">(</span><span class="st">&quot;clang diagnostic ignored </span><span class="sc">\&quot;</span><span class="st">-Wunused-private-field</span><span class="sc">\&quot;</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#else</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_CLANG_UNUSED_PRIVATE_FIELD</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_GCC_BEGIN </span><span class="ot">_Pragma</span><span class="op">(</span><span class="st">&quot;GCC diagnostic push&quot;</span><span class="op">)</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_GCC_END </span><span class="ot">_Pragma</span><span class="op">(</span><span class="st">&quot;GCC diagnostic pop&quot;</span><span class="op">)</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_GCC_NOT_EFF_CPP </span><span class="ot">_Pragma</span><span class="op">(</span><span class="st">&quot;GCC diagnostic ignored </span><span class="sc">\&quot;</span><span class="st">-Weffc++</span><span class="sc">\&quot;</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SUPPRESS_WARN_GCC_UNUSED_VAR </span><span class="ot">_Pragma</span><span class="op">(</span><span class="st">&quot;GCC diagnostic ignored </span><span class="sc">\&quot;</span><span class="st">-Wunused-variable</span><span class="sc">\&quot;</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a>    SUPPRESS_WARN_GCC_BEGIN<span class="op">;</span></span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a>    SUPPRESS_WARN_GCC_UNUSED_VAR<span class="op">;</span></span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a>    SUPPRESS_WARN_GCC_NOT_EFF_CPP<span class="op">;</span></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>    SUPPRESS_WARN_CLANG_UNUSED_PRIVATE_FIELD<span class="op">;</span></span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> A <span class="op">{</span></span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a>        A<span class="op">()</span> <span class="kw">noexcept</span></span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 警告: &#39;PragmaSample::A::b_&#39; should be initialized in</span></span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">//       the member initialization list [-Weffc++]</span></span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 警告: unused variable &#39;c&#39; [-Wunused-variable]</span></span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>            <span class="co">// のようなワーニングが出力される。</span></span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int32_t</span> c<span class="op">;</span></span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">b_</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb199-38"><a href="#cb199-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">a_</span><span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb199-39"><a href="#cb199-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> <span class="va">b_</span><span class="op">;</span></span>
<span id="cb199-40"><a href="#cb199-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb199-41"><a href="#cb199-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-42"><a href="#cb199-42" aria-hidden="true" tabindex="-1"></a>    SUPPRESS_WARN_GCC_END<span class="op">;</span></span></code></pre></div>
<h2 id="特に重要なプログラミング規約">3.12 特に重要なプログラミング規約
<a id="SS_3_12"></a></h2>
<p>本章で取り上げた規約は、重要度という観点で様々なレベルのものが混在するため量も多く、
すぐに実践することが難しいかもしれない。
そういった場合には、まずは特に重要な下記リストを守ることから始めるのが良いだろう。</p>
<ul>
<li>浮動小数点型をなるべく使わない(<a
href="programming_convention.html#SS_3_1_1_5">浮動小数点型</a>)。</li>
<li>const/constexprを積極的に使用する(<a
href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a>,
<a href="programming_convention.html#SS_3_3_2">メンバ関数</a>)。</li>
<li>すべてのインスタンスは定義と同時に初期化する(<a
href="programming_convention.html#SS_3_1_12">インスタンスの初期化</a>)。</li>
<li>クラスのpublicメンバ関数は最大7個(<a
href="programming_convention.html#SS_3_2_2_2">メンバの数</a>)。</li>
<li>クラスのメンバ変数は最大4個(<a
href="programming_convention.html#SS_3_2_2_2">メンバの数</a>)。</li>
<li>クラスのメンバ変数はprivateのみ(<a
href="programming_convention.html#SS_3_2_3">アクセスレベルと隠蔽化</a>)。</li>
<li>クラスのメンバ変数はコンストラクタ終了時までに初期化する(<a
href="programming_convention.html#SS_3_2_5">非静的なメンバ変数/定数の初期化</a>)。</li>
<li>friendは使用しない(<a
href="programming_convention.html#SS_3_2_3">アクセスレベルと隠蔽化</a>)。</li>
<li>派生は最大2回(<a
href="programming_convention.html#SS_3_2_4">継承/派生</a>)。</li>
<li>関数は小さくする(<a
href="programming_convention.html#SS_3_3_3_1">サイクロマティック複雑度</a>)。</li>
<li>関数の仮引数は最大4個(<a
href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a>)。</li>
<li>グローバルなインスタンスは使わない(<a
href="programming_convention.html#SS_3_8">スコープ</a>)。</li>
<li>throw, try-catchは控えめに使用する(<a
href="programming_convention.html#SS_3_3_3_10">エクセプション処理</a>)。</li>
<li>構文に関しては以下に気を付ける。
<ul>
<li>if, else, for, while, do後には{}を使う(<a
href="programming_convention.html#SS_3_4_1">複合文</a>)。</li>
<li>switchでのフォールスルーをしない(<a
href="programming_convention.html#SS_3_4_2">switch文</a>)。</li>
<li>switchにはdefaultラベルを入れる(<a
href="programming_convention.html#SS_3_4_2">switch文</a>)。</li>
<li>範囲for文を積極的に使う(<a
href="programming_convention.html#SS_3_4_4">範囲for文</a>)。</li>
<li>gotoを使用しない(<a
href="programming_convention.html#SS_3_4_7">goto文</a>)。</li>
</ul></li>
<li>オブジェクトのダイナミックな生成にはstd::make_unique&lt;&gt;を使用する
(<a
href="programming_convention.html#SS_3_5_6">メモリアロケーション</a>)。</li>
<li>Cタイプのキャストは使用しない(<a
href="programming_convention.html#SS_3_5_10">キャスト、暗黙の型変換</a>)。</li>
</ul>
</body>
</html>
