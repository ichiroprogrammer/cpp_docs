<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Comprehensive Knowledge of C++(V18.03)</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

    body {
        margin: 0 auto;
        max-width: none;
        width: 1000px;
        padding-left: 50px;
        padding-right: 50px;
        padding-top: 50px;
        padding-bottom: 50px;
        hyphens: auto;
        overflow-wrap: break-word;
        text-rendering: optimizeLegibility;
        font-kerning: normal;
    }

    table {
        border-collapse: collapse;
    }

    table, th, td {
        border: 2px solid black;
    }

    header {
        margin-bottom: 4em;
        text-align: center;
        color: white;
        background-color: lightblue;
    }

    h1:not(:first-of-type) {
        page-break-before: always;
    }

  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Comprehensive Knowledge of C++(V18.03)</h1>
<p class="author">autor:ichiroprogrammer</p>
</header>
<!-- ./md/exercise_q.md -->
<h1 id="演習">演習 <a id="SS_19"></a></h1>
<p>本章では、これまで解説した内容の復習やより深い理解のために、 解選択問題とプログラミング記述問題を提供する。</p>
<p>多くのプログラミング記述問題は、 google testを含むC++のソースコードと以下のようなコードコメントで与えれらる。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">// 以下のXXXをせよ。</span></span></code></pre></div>
<h2 id="プログラミング規約型">プログラミング規約(型) <a id="SS_19_1"></a></h2>
<h3 id="演習-汎整数型の選択">演習-汎整数型の選択 <a id="SS_19_1_1"></a></h3>
<ul>
<li><p>問題<br />
汎整数型には、特に理由がない限りに、int32_tを使用するべきであるが、 値が負にならない場合は、(A)を使用するべきである。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>int32_t</li>
<li>unsigned long</li>
<li>uint32_t</li>
<li>uint16_t</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_1_1">解答-汎整数型の選択</a></p></li>
</ul>
<h3 id="演習-汎整数型の演算">演習-汎整数型の演算 <a id="SS_19_1_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 7</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, GeneralInteger)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>        <span class="co">// 以下の組み込み型の使用方法は、その下のテストコードを(環境依存で)パスするが、</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        <span class="co">// 適切であるとは言えない。適切な型に修正せよ。</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>        <span class="kw">auto</span> b = <span class="kw">true</span>;</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>        <span class="dt">int</span>  i{b};</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>        <span class="dt">char</span> c{-<span class="dv">1</span>};</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>        ASSERT_EQ(i * c, -<span class="dv">1</span>);</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_1">算術型</a></li>
<li><a href="exercise_a.html#SS_20_1_2">解答例-汎整数型の演算</a></li>
</ul>
<h3 id="演習-浮動小数点型">演習-浮動小数点型 <a id="SS_19_1_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 21</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span class="dt">double</span> f(<span class="dt">double</span> a) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">1</span> / a; }</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, Float)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>        <span class="co">// 以下の両辺を同一と判定するための関数を作り、その関数の単体テストを行え。</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>        ASSERT_FALSE(<span class="fl">1.0</span> == <span class="dv">1</span> + <span class="fl">0.001</span> - <span class="fl">0.001</span>);</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>        <span class="co">// 以下の0除算を捕捉するためのコードを書け。</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>        f(<span class="fl">0.0</span>);</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_1_5">浮動小数点型</a></li>
<li><a href="exercise_a.html#SS_20_1_3">解答例-浮動小数点型</a></li>
</ul>
<h3 id="演習-定数列挙">演習-定数列挙 <a id="SS_19_1_4"></a></h3>
<ul>
<li><p>問題<br />
特に理由がない限り、一連の定数の列挙には(A)を定義して使用する。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>マクロ定数</li>
<li>static const定数</li>
<li>非スコープドenum</li>
<li>スコープドenum</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_1_4">解答-定数列挙</a></p></li>
</ul>
<h3 id="演習-enum">演習-enum <a id="SS_19_1_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 36</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    <span class="co">// 以下のマクロ引数を型安全なenumに修正せよ</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    <span class="pp">#define COLOR_RED </span><span class="dv">0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="pp">#define COLOR_GREEN </span><span class="dv">1</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>    <span class="pp">#define COLOR_BLUE </span><span class="dv">2</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    <span class="bu">std::</span>string GetString(<span class="dt">int</span> color)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>    {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        <span class="cf">switch</span> (color) {</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>        <span class="cf">case</span> COLOR_RED:</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;Red&quot;</span>;</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>        <span class="cf">case</span> COLOR_GREEN:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;Green&quot;</span>;</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>        <span class="cf">case</span> COLOR_BLUE:</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;Blue&quot;</span>;</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>        <span class="cf">default</span>:</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>            <span class="ot">assert</span>(<span class="kw">false</span>);</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span>;</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>        }</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>    }</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, Enum)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>    {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>        ASSERT_EQ(<span class="bu">std::</span>string{<span class="st">&quot;Red&quot;</span>}, GetString(COLOR_RED));</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>        ASSERT_EQ(<span class="bu">std::</span>string{<span class="st">&quot;Green&quot;</span>}, GetString(COLOR_GREEN));</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>        ASSERT_EQ(<span class="bu">std::</span>string{<span class="st">&quot;Blue&quot;</span>}, GetString(COLOR_BLUE));</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_2">enum</a></li>
<li><a href="exercise_a.html#SS_20_1_5">解答例-enum</a></li>
</ul>
<h3 id="演習-配列の範囲for文">演習-配列の範囲for文 <a id="SS_19_1_6"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 67</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    <span class="dt">int32_t</span> array_value() <span class="kw">noexcept</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">int32_t</span> i;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>        <span class="cf">return</span> i++;</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, Array)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>    {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>        <span class="co">// 以下の配列の値の設定を範囲for文を使って書き直せ</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>        <span class="dt">int32_t</span> array[<span class="dv">10</span>];</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; i &lt; <span class="kw">sizeof</span>(array) / <span class="kw">sizeof</span>(array[<span class="dv">0</span>]); ++i) {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>            array[i] = array_value();</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>        }</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">0</span>, array[<span class="dv">0</span>]);</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">3</span>, array[<span class="dv">3</span>]);</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">9</span>, array[<span class="dv">9</span>]);</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_7">配列</a></li>
<li><a href="exercise_a.html#SS_20_1_6">解答例-配列の範囲for文</a></li>
</ul>
<h3 id="演習-エイリアス">演習-エイリアス <a id="SS_19_1_7"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 91</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    <span class="co">// 以下のtypedefをC++11から導入された新しい形式のエイリアスに直せ。</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    <span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="ex">uchar</span>;</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    <span class="kw">typedef</span> <span class="dt">bool</span> (*<span class="dt">func_type</span>)(<span class="dt">int32_t</span>);</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>    <span class="co">// template引数で与えられた型のオブジェクトをstd::vectorで保持するエイリアスtemplateを</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>    <span class="co">// 定義し、その単体テストを行え。</span></span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_8">型エイリアス</a></li>
<li><a href="exercise_a.html#SS_20_1_7">解答例-エイリアス</a></li>
</ul>
<h3 id="演習-constの意味">演習-constの意味 <a id="SS_19_1_8"></a></h3>
<ul>
<li>問題<br />
初期化後に変更されない変数はconstと宣言すべきであるが、 以下のコードの2つのconstの意味にふさわしいものを選択せよ。</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>    <span class="dt">char</span> <span class="at">const</span>* <span class="at">const</span> country = <span class="st">&quot;japan&quot;</span>;</span></code></pre></div>
<ul>
<li>選択肢
<ol type="1">
<li>左側のconstはcountryが指す先が不変。右側のconstは、country自体が不変。</li>
<li>左側のconstはcountry自体が不変。右側のconstは、countryが指す先が不変。</li>
<li>左右ともconstはcountry自体が不変。</li>
<li>上記のどれでもない。</li>
</ol></li>
<li><a href="exercise_a.html#SS_20_1_8">解答-constの意味</a></li>
</ul>
<h3 id="演習-constconstexpr">演習-const/constexpr <a id="SS_19_1_9"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 103</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    <span class="co">// 下記のStringHolderに「const/constexprを付加する」等を行い、より良いコードに修正せよ。</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="kw">class</span> StringHolder {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        StringHolder() = <span class="cf">default</span>;</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="dt">void</span> Add(<span class="bu">std::</span>string str)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">vector_len_max_</span> &gt; <span class="va">strings_</span>.size()) {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>                <span class="va">strings_</span>.push_back(str);</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>            }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>        }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; GetStrings() <span class="at">const</span> { <span class="cf">return</span> <span class="va">strings_</span>; }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a>        <span class="dt">size_t</span>                   <span class="va">vector_len_max_</span>{<span class="dv">3</span>};</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="va">strings_</span>{};</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a>    };</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, ConstConstexpr)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a>    {</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a>        <span class="kw">auto</span> sh = StringHolder{};</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true"></a>        ASSERT_EQ(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{}, sh.GetStrings());</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true"></a>        sh.Add(<span class="st">&quot;a&quot;</span>);</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true"></a>        sh.Add(<span class="bu">std::</span>string{<span class="st">&quot;bc&quot;</span>});</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;a&quot;</span>, <span class="st">&quot;bc&quot;</span>}), sh.GetStrings());</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true"></a>        sh.Add(<span class="st">&quot;def&quot;</span>);</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true"></a>        sh.Add(<span class="bu">std::</span>string{<span class="st">&quot;g&quot;</span>});</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;a&quot;</span>, <span class="st">&quot;bc&quot;</span>, <span class="st">&quot;def&quot;</span>}), sh.GetStrings());</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a></li>
<li><a href="exercise_a.html#SS_20_1_9">解答例-const/constexpr</a></li>
</ul>
<h3 id="演習-危険なconst_cast">演習-危険なconst_cast <a id="SS_19_1_10"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 140</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>    <span class="co">// 下記の&quot;DISABLED_&quot;を削除し、何が起こるのか、なぜそうなるのかを確かめた上で、</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    <span class="co">// nameの型やその初期化を行っているコードを修正せよ。</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    TEST(DISABLED_ProgrammingConventionQ, ConstConstexpr2)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>        <span class="dt">char</span>* name = <span class="kw">const_cast</span>&lt;<span class="dt">char</span>*&gt;(<span class="st">&quot;abcdef&quot;</span>);</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; name[i] != <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span>; ++i) {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>            name[i] = <span class="bu">std::</span>toupper(name[i]);</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>        }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;ABCDEF&quot;</span>, name);</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;ABCDEF&quot;</span>, <span class="bu">std::</span>string{name});</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_9">const/constexprインスタンス</a></li>
<li><a href="exercise_a.html#SS_20_1_10">解答例-危険なconst_cast</a></li>
</ul>
<h3 id="演習-リテラル">演習-リテラル <a id="SS_19_1_11"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 157</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    <span class="dt">int32_t</span> literal_test(<span class="dt">int64_t</span>) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span>; }</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    <span class="dt">int32_t</span> literal_test(<span class="dt">int32_t</span>*) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">1</span>; }</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    <span class="co">// 下記変数の初期化コードをコメントに基づき適切に修正せよ。</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, Literal)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>        <span class="dt">int32_t</span>* p{NULL};                <span class="co">// NULLは使用不可</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>        <span class="dt">uint64_t</span> a{<span class="bn">0x1234567890abcdef</span>};  <span class="co">// 適切なセパレータを挿入</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>        <span class="dt">int32_t</span>  b{<span class="bn">0x715</span>};               <span class="co">// ビット表現に修正</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>        <span class="co">// 下記resultはfalseになるが、その理由を述べ、trueになるようにコードを修正せよ。</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>        <span class="dt">bool</span> <span class="at">const</span> result{(literal_test(NULL) == literal_test(p))};</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>        ASSERT_FALSE(result);</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>        ASSERT_EQ(<span class="bn">0x1234567890abcdef</span>, a);</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>        ASSERT_EQ(b, <span class="bn">0x715</span>);</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li><p>参照 <a href="programming_convention.html#SS_3_1_10">リテラル</a></p></li>
<li><p><a href="exercise_a.html#SS_20_1_11">解答例-リテラル</a></p></li>
</ul>
<h3 id="演習-適切なautoの使い方">演習-適切なautoの使い方 <a id="SS_19_1_12"></a></h3>
<ul>
<li><p>問題<br />
以下のコードのautoの中で、使い方が好ましくないものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>auto s0 = std::string(“xxx”);</li>
<li>auto s1(std::string(“xxx”));</li>
<li>auto s2 = s0; // s0は上記に定義されたもの</li>
<li>auto s3 = get_name(); // get_name()は離れた場所に宣言</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_1_12">解答-適切なautoの使い方</a></p></li>
</ul>
<h3 id="演習-ポインタの初期化">演習-ポインタの初期化 <a id="SS_19_1_13"></a></h3>
<ul>
<li><p>問題<br />
初期値が定まらないポインタ変数の初期化方法にふさわしいものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>0を代入する。</li>
<li>NULLを代入する。</li>
<li>nullptrを代入する。</li>
<li>何もしない。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_1_13">解答-ポインタの初期化</a></p></li>
</ul>
<h3 id="演習-vector初期化">演習-vector初期化 <a id="SS_19_1_14"></a></h3>
<ul>
<li>問題<br />
以下のコード実行後のvecの状態を選べ。</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>    vector&lt;<span class="dt">int32_t</span>&gt; vec{<span class="dv">10</span>};</span></code></pre></div>
<ul>
<li>選択肢
<ol type="1">
<li>vec.size()が1で、vec[0]は10</li>
<li>vec.size()が10で、vec[0] ～ vec[9]は不定</li>
<li>vec.size()が1で、vec[0]は不定</li>
<li>vec.size()が10で、vec[0] ～ vec[9]は0</li>
</ol></li>
<li><a href="exercise_a.html#SS_20_1_14">解答-vector初期化</a></li>
</ul>
<h3 id="演習-インスタンスの初期化">演習-インスタンスの初期化 <a id="SS_19_1_15"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/type.cpp 179</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>    TEST(ProgrammingConventionTypeQ, Initialization)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>    {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>        <span class="co">// 変数a、b、v、wの定義と初期化を1文で行え。</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>        {</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>            <span class="dt">int32_t</span> a[<span class="dv">3</span>];</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; r : a) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>                r = <span class="dv">1</span>;</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>            }</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, a[<span class="dv">0</span>]);</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, a[<span class="dv">1</span>]);</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, a[<span class="dv">2</span>]);</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a>        }</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a>        {</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a>            <span class="dt">int32_t</span> b[<span class="dv">3</span>];</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; r : b) {</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a>                r = <span class="dv">0</span>;</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a>            }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, b[<span class="dv">0</span>]);</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, b[<span class="dv">1</span>]);</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, b[<span class="dv">2</span>]);</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>        }</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a>        {</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>            <span class="kw">auto</span> v = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="dv">3</span>};</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; r : v) {</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>                r = <span class="st">&quot;1&quot;</span>;</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a>            }</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1&quot;</span>, v[<span class="dv">0</span>]);</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1&quot;</span>, v[<span class="dv">1</span>]);</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1&quot;</span>, v[<span class="dv">2</span>]);</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>        }</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a>        {</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>            <span class="kw">auto</span> w = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span>; i &lt; <span class="dv">3</span>; ++i) {</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a>                w.emplace_back(<span class="bu">std::</span>to_string(i));</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a>            }</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;0&quot;</span>, w[<span class="dv">0</span>]);</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1&quot;</span>, w[<span class="dv">1</span>]);</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;2&quot;</span>, w[<span class="dv">2</span>]);</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true"></a>        }</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_1_12">インスタンスの初期化</a>、<a href="term_explanation.html#SS_18_2_7">一様初期化</a></li>
<li><a href="exercise_a.html#SS_20_1_15">解答例-インスタンスの初期化</a></li>
</ul>
<h2 id="プログラミング規約クラス">プログラミング規約(クラス) <a id="SS_19_2"></a></h2>
<h3 id="演習-凝集度の意味">演習-凝集度の意味 <a id="SS_19_2_1"></a></h3>
<ul>
<li><p>問題<br />
クラスの凝集度とはLack of Cohesion in Methodsというメトリクスで計測される。 この凝集度やメトリクスの説明として正しくないものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>クラスは凝集度を高くするように設計すべきである。</li>
<li>このメトリクス値が1に近ければ凝集度は低く、この値が0に近ければ凝集度は高い。</li>
<li>メンバ変数やメンバ関数が多くなれば、凝集度は低くなりやすい。</li>
<li>setterやgetterを使用することで、凝集度を高く保つことができる。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_2_1">解答-凝集度の意味</a></p></li>
</ul>
<h3 id="演習-凝集度の向上">演習-凝集度の向上 <a id="SS_19_2_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/class.cpp 7</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>    <span class="co">// 以下のクラスABCの凝集度が高くなるように、ABC、HasRealNumberSolutionをリファクタリングせよ。</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>    <span class="co">// その時に、他の問題があればそれも併せて修正せよ。</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>    <span class="kw">class</span> ABC {  <span class="co">// 2次方程式のパラメータ保持</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>        ABC(<span class="dt">int32_t</span> a, <span class="dt">int32_t</span> b, <span class="dt">int32_t</span> c) <span class="kw">noexcept</span> : <span class="va">a_</span>{a}, <span class="va">b_</span>{b}, <span class="va">c_</span>{c} {}</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetA() <span class="at">const</span> { <span class="cf">return</span> <span class="va">a_</span>; }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetB() <span class="at">const</span> { <span class="cf">return</span> <span class="va">b_</span>; }</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetC() <span class="at">const</span> { <span class="cf">return</span> <span class="va">c_</span>; }</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>        <span class="dt">void</span>    SetA(<span class="dt">int32_t</span> a) { <span class="va">a_</span> = a; }</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>        <span class="dt">void</span>    SetB(<span class="dt">int32_t</span> b) { <span class="va">b_</span> = b; }</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a>        <span class="dt">void</span>    SetC(<span class="dt">int32_t</span> c) { <span class="va">c_</span> = c; }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">a_</span>;</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">b_</span>;</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">c_</span>;</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>    };</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>    <span class="dt">bool</span> HasRealNumberSolution(ABC abc)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>    {</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> discriminant = abc.GetB() * abc.GetB() - <span class="dv">4</span> * abc.GetA() * abc.GetC();  <span class="co">// 判定式</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a>        <span class="cf">return</span> <span class="dv">0</span> &lt;= discriminant;</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a>    }</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a>    TEST(ProgrammingConventionClassQ, Cohision)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a>    {</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a>        {</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true"></a>            <span class="kw">auto</span> abc = ABC{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>};</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true"></a>            ASSERT_TRUE(HasRealNumberSolution(abc));</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true"></a>        }</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true"></a>        {</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true"></a>            <span class="kw">auto</span> abc = ABC{<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>};</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true"></a>            ASSERT_FALSE(HasRealNumberSolution(abc));</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true"></a>        }</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_2_2_3">凝集度</a></li>
<li><a href="exercise_a.html#SS_20_2_2">解答例-凝集度の向上</a></li>
</ul>
<h3 id="演習-メンバ変数の初期化方法の選択">演習-メンバ変数の初期化方法の選択 <a id="SS_19_2_3"></a></h3>
<ul>
<li><p>問題<br />
非静的なメンバ変数の初期化には下記の3つの方法がある。 これらの説明として誤っているものを下記選択肢より選べ。</p>
<ul>
<li>初期化方法０: 非静的メンバ変数の初期化子による初期化</li>
<li>初期化方法１: コンストラクタの非静的メンバ初期化子による初期化</li>
<li>初期化方法２: コンストラクタ内での非静的なメンバ変数の初期化</li>
</ul></li>
<li><p>選択肢</p>
<ol type="1">
<li>初期化方法０を優先して使う。</li>
<li>どの方法も優劣はないので、任意に選択してよい。</li>
<li>初期化方法０が使えない場合は、なるべく初期化方法１を使う。</li>
<li>初期化方法０、１が使えない場合のみ初期化方法２を使う。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_2_3">解答-メンバ変数の初期化方法の選択</a></p></li>
</ul>
<h3 id="演習-メンバの型">演習-メンバの型 <a id="SS_19_2_4"></a></h3>
<ul>
<li>問題<br />
以下のA::strの意味を表すものを選べ。</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>    <span class="kw">class</span> A {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>        ...</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>        <span class="bu">std::</span>string str();     <span class="co">// &lt;- この意味</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    };</span></code></pre></div>
<ul>
<li>選択肢
<ol type="1">
<li>デフォルト初期化されたstd::stringオブジェクト</li>
<li>初期化されていないstd::stringオブジェクト</li>
<li>std::stringオブジェクトを返す関数</li>
<li>以上のいずれでもない</li>
</ol></li>
<li><a href="exercise_a.html#SS_20_2_4">解答-メンバの型</a></li>
</ul>
<h3 id="演習-メンバ変数の初期化">演習-メンバ変数の初期化 <a id="SS_19_2_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/class.cpp 51</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>    <span class="co">// 以下のMemberInitのメンバ変数を適切な方法で初期化せよ。</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>    <span class="kw">class</span> MemberInit {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>        MemberInit() <span class="kw">noexcept</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>        {</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>            <span class="va">a_</span>    = <span class="dv">0</span>;</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>            <span class="va">b_</span>[<span class="dv">0</span>] = <span class="dv">1</span>;</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>            <span class="va">b_</span>[<span class="dv">1</span>] = <span class="dv">1</span>;</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>            <span class="va">c_</span>    = <span class="dv">2</span>;</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>        }</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a>        <span class="kw">explicit</span> MemberInit(<span class="dt">int</span> a) <span class="kw">noexcept</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>        {</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a>            <span class="va">a_</span>    = a;</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>            <span class="va">b_</span>[<span class="dv">0</span>] = a;</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>            <span class="va">b_</span>[<span class="dv">1</span>] = <span class="dv">99</span>;</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>            <span class="va">c_</span>    = <span class="dv">2</span>;</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>        }</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>        <span class="dt">int32_t</span>       GetA() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">a_</span>; }</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>        <span class="dt">int32_t</span>*      GetB() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">b_</span>; }</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a>        <span class="dt">int32_t</span>       GetC() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">c_</span>; }</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">size_t</span> b_len;</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">a_</span>;</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">b_</span>[<span class="dv">2</span>];</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">c_</span>;</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true"></a>    };</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true"></a>    <span class="dt">size_t</span> MemberInit::b_len = <span class="dv">2</span>;</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true"></a>    TEST(ProgrammingConventionClassQ, MemberInit)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true"></a>    {</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true"></a>        {</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true"></a>            <span class="kw">auto</span> mi = MemberInit{};</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, mi.GetA());</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, mi.GetB()[<span class="dv">0</span>]);</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, mi.GetB()[<span class="dv">1</span>]);</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">2</span>, mi.GetC());</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true"></a>        }</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true"></a>        {</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true"></a>            <span class="kw">auto</span> mi = MemberInit{<span class="dv">1</span>};</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, mi.GetA());</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">1</span>, mi.GetB()[<span class="dv">0</span>]);</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">99</span>, mi.GetB()[<span class="dv">1</span>]);</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">2</span>, mi.GetC());</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true"></a>        }</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_2_5">非静的なメンバ変数/定数の初期化</a></li>
<li><a href="exercise_a.html#SS_20_2_5">解答例-メンバ変数の初期化</a></li>
</ul>
<h3 id="演習-スライシング">演習-スライシング <a id="SS_19_2_6"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/class.cpp 106</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>    <span class="co">// 以下のクラスBaseはオブジェクトのスライシングを引き起こす。</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>    <span class="co">// このような誤用を起こさないようにするために、Baseオブジェクトのコピーを禁止せよ。</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>    <span class="co">// 合わせてクラスDerivedも含め、不十分な記述を修正せよ。</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>    <span class="kw">class</span> Base {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>        Base(<span class="dt">char</span> <span class="at">const</span>* name = <span class="kw">nullptr</span>) <span class="kw">noexcept</span> : <span class="va">name_</span>{name == <span class="kw">nullptr</span> ? <span class="st">&quot;Base&quot;</span> : name} {}</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>        ~Base() = <span class="cf">default</span>;</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">char</span> <span class="at">const</span>* Name0() { <span class="cf">return</span> <span class="st">&quot;Base&quot;</span>; }</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>*         Name1() { <span class="cf">return</span> <span class="va">name_</span>; }</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* <span class="va">name_</span>;</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true"></a>    };</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true"></a>    <span class="kw">class</span> Derived <span class="kw">final</span> : <span class="kw">public</span> Base {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true"></a>        Derived() <span class="kw">noexcept</span> : Base{<span class="st">&quot;Derived&quot;</span>} {}</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* Name0() { <span class="cf">return</span> <span class="st">&quot;Derived&quot;</span>; }</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true"></a>    };</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true"></a>    TEST(ProgrammingConventionClassQ, Slicing)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true"></a>    {</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true"></a>        <span class="kw">auto</span>  b     = Base{};</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true"></a>        <span class="kw">auto</span>  d     = Derived{};</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true"></a>        Base&amp; d_ref = d;</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true"></a>        <span class="co">// 以下はBase、Derivedの単純なテスト</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Base&quot;</span>, b.Name0());</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Base&quot;</span>, b.Name1());</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Derived&quot;</span>, d_ref.Name0());</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Derived&quot;</span>, d_ref.Name1());</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true"></a>        <span class="co">// 以下はbがスライスされたオブジェクトであることのテスト</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true"></a>        <span class="co">// こういった誤用を防ぐためにBaseのコピーを禁止せよ。</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true"></a>        b = d_ref;</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Base&quot;</span>, b.Name0());     <span class="co">// vtblはBaseになるから</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;Derived&quot;</span>, b.Name1());  <span class="co">// name_はコピーされるから</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_2_8">スライシング</a></li>
<li><a href="exercise_a.html#SS_20_2_6">解答例-スライシング</a></li>
</ul>
<h3 id="演習-オブジェクトの所有権">演習-オブジェクトの所有権 <a id="SS_19_2_7"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/class.cpp 151</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>    <span class="kw">class</span> A {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>        <span class="kw">explicit</span> A(<span class="dt">int32_t</span> n) <span class="kw">noexcept</span> : <span class="va">num_</span>{n} { <span class="va">last_constructed_num_</span> = <span class="va">num_</span>; }</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>        ~A() { <span class="va">last_destructed_num_</span> = <span class="va">num_</span>; }</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetNum() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">num_</span>; }</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">int32_t</span> LastConstructedNum() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">last_constructed_num_</span>; }</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">int32_t</span> LastDestructedNum() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">last_destructed_num_</span>; }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>        <span class="dt">int32_t</span>        <span class="va">num_</span>;</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">int32_t</span> <span class="va">last_constructed_num_</span>;</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">int32_t</span> <span class="va">last_destructed_num_</span>;</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a>    };</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a>    <span class="dt">int32_t</span> A::<span class="va">last_constructed_num_</span> = -<span class="dv">1</span>;</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a>    <span class="dt">int32_t</span> A::<span class="va">last_destructed_num_</span>  = -<span class="dv">1</span>;</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a>    <span class="kw">class</span> X <span class="kw">final</span> {</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a>        <span class="dt">void</span> Move(<span class="bu">std::</span>unique_ptr&lt;A&gt;&amp;&amp; ptr) <span class="kw">noexcept</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a>        {</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a>            <span class="va">ptr_</span> = <span class="bu">std::</span>move(ptr);  <span class="co">// ptr-&gt;ptr_へ所有権の移動</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>        }</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>        <span class="bu">std::</span>unique_ptr&lt;A&gt; Release() <span class="kw">noexcept</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true"></a>        {</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true"></a>            <span class="cf">return</span> <span class="bu">std::</span>move(<span class="va">ptr_</span>);  <span class="co">// ptr_から外部への所有権の移動</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true"></a>        }</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true"></a>        A <span class="at">const</span>* GetA() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">ptr_</span>.get(); }</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true"></a>        X()  = <span class="cf">default</span>;</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true"></a>        ~X() = <span class="cf">default</span>;</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true"></a>        <span class="bu">std::</span>unique_ptr&lt;A&gt; <span class="va">ptr_</span>{};</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true"></a>    };</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true"></a>    TEST(ProgrammingConventionClassQ, Ownership)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true"></a>    {</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true"></a>        <span class="co">// 以下の単体テストを完成させよ。</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true"></a>        <span class="co">// ?はインスタンスが入り、?????はTRUEかFALSEが入る。</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true"></a>        ASSERT_EQ(-<span class="dv">1</span>, A::LastConstructedNum());     <span class="co">// まだ、A::A()は呼ばれてない</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true"></a>        ASSERT_EQ(-<span class="dv">1</span>, A::LastDestructedNum());      <span class="co">// まだ、A::~A()は呼ばれてない</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true"></a>        <span class="kw">auto</span> a0 = <span class="bu">std::</span>make_unique&lt;A&gt;(<span class="dv">0</span>);           <span class="co">// a0はA(0)を所有</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true"></a>        <span class="kw">auto</span> a1 = <span class="bu">std::</span>make_unique&lt;A&gt;(<span class="dv">1</span>);           <span class="co">// a1はA(1)を所有</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true"></a>        <span class="kw">auto</span> x = X {};</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true"></a></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, A::LastConstructedNum());      // A(1)は生成された</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, A::LastDestructedNum());       // まだ、A::~A()は呼ばれてない</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, a0-&gt;GetNum());                 // a0はA(0)を所有</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true"></a>        x.Move(<span class="bu">std::</span>move(a0));                      <span class="co">// a0からxへA(0)の所有権の移動</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true"></a>    <span class="co">//  ASSERT_?????(a0);                           // a0は何も所有していない</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true"></a></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, a1-&gt;GetNum());                 // a1はA(1)を所有</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true"></a>        x.Move(<span class="bu">std::</span>move(a1));                      <span class="co">// xによるA(0)の解放</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true"></a>                                                    <span class="co">// a1からxへA(1)の所有権の移動</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, A::LastDestructedNum());       // A(0)は解放された</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true"></a>    <span class="co">//  ASSERT_?????(a1);                           // a1は何も所有していない</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, x.GetA()-&gt;GetNum());           // xはA(1)を所有</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true"></a>        <span class="bu">std::</span>unique_ptr&lt;A&gt; a2{x.Release()};         <span class="co">// xからa2へA(1)の所有権の移動</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, x.GetA());                     // xは何も所有していない</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, a2-&gt;GetNum());                 // a2はA(1)を所有</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true"></a>        {</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true"></a>            <span class="bu">std::</span>unique_ptr&lt;A&gt; a3{<span class="bu">std::</span>move(a2)};</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true"></a>    <span class="co">//      ASSERT_?????(a2);                       // a2は何も所有していない</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true"></a>    <span class="co">//      ASSERT_EQ(?, a3-&gt;GetNum());             // a3はA(1)を所有</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true"></a>        }                                           <span class="co">// a3によるA(1)の解放</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true"></a>    <span class="co">//  ASSERT_EQ(?, A::LastDestructedNum());</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_2_9">オブジェクトの所有権</a></li>
<li><a href="exercise_a.html#SS_20_2_7">解答例-オブジェクトの所有権</a></li>
</ul>
<h2 id="プログラミング規約関数">プログラミング規約(関数) <a id="SS_19_3"></a></h2>
<h3 id="演習-非メンバ関数の宣言">演習-非メンバ関数の宣言 <a id="SS_19_3_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 5</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    <span class="at">extern</span> <span class="st">&quot;C&quot;</span> <span class="dt">double</span> cos(<span class="dt">double</span> x);</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, NonMemberFunc)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>        <span class="co">// 適切な#includeを追加し、上記のextern宣言がなくとも下記がコンパイルできるようにせよ。</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">1</span>, cos(<span class="dv">0</span>));</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_1">非メンバ関数</a></li>
<li><a href="exercise_a.html#SS_20_3_1">解答例-非メンバ関数の宣言</a></li>
</ul>
<h3 id="演習-メンバ関数の修飾">演習-メンバ関数の修飾 <a id="SS_19_3_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 17</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>    <span class="co">// 下記のクラスAのメンバ関数の不正確な記述を修正せよ。</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>    <span class="co">// また、単体テストを同様に修正せよ。</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>    <span class="kw">class</span> A {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>        A() : <span class="va">strings_</span>{GetStringsDefault()} {}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a>        <span class="dt">void</span> SetStrings(<span class="dt">size_t</span> index, <span class="bu">std::</span>string str)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a>        {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a>            <span class="cf">if</span> (index &lt; max_len) {</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true"></a>                <span class="va">strings_</span>[index] = str;</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true"></a>            }</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true"></a>        }</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;&amp; GetStrings() { <span class="cf">return</span> <span class="va">strings_</span>; }</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;  GetStrings() <span class="at">const</span> { <span class="cf">return</span> <span class="va">strings_</span>; }</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true"></a>        <span class="dt">size_t</span>                    MaxLen() { <span class="cf">return</span> max_len; }</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;&amp; GetStringsDefault()</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true"></a>        {</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true"></a>            <span class="at">static</span> <span class="kw">auto</span> strings_default = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{max_len, <span class="st">&quot;&quot;</span>};</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true"></a>            <span class="cf">return</span> strings_default;</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true"></a>        }</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="va">strings_</span>;</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">size_t</span>  max_len{<span class="dv">3</span>};</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true"></a>    };</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, MemberFunc)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true"></a>    {</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true"></a>        <span class="kw">auto</span> a = A{};</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true"></a>        <span class="kw">auto</span> strings_default = a.GetStringsDefault();</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings_default[<span class="dv">0</span>]);</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings_default[<span class="dv">1</span>]);</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings_default[<span class="dv">2</span>]);</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">3</span>, a.MaxLen());</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true"></a>        <span class="kw">auto</span> strings = a.GetStrings();</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings[<span class="dv">0</span>]);</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings[<span class="dv">1</span>]);</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings[<span class="dv">2</span>]);</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true"></a></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true"></a>        a.SetStrings(<span class="dv">1</span>, <span class="st">&quot;TEST&quot;</span>);</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings[<span class="dv">0</span>]);</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true"></a>        <span class="co">// [Q]</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true"></a>        <span class="co">// このテストをASSERT_EQでパスできるようにせよ</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true"></a>        ASSERT_NE(<span class="st">&quot;TEST&quot;</span>, strings[<span class="dv">1</span>]);</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true"></a></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, strings[<span class="dv">2</span>]);</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2">メンバ関数</a></li>
<li><a href="exercise_a.html#SS_20_3_2">解答例-メンバ関数の修飾</a></li>
</ul>
<h3 id="演習-特殊メンバ関数の削除">演習-特殊メンバ関数の削除 <a id="SS_19_3_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 75</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>    <span class="co">// 下記クラスAutoGenのコンパイラが自動生成するメンバ関数を生成しないようにせよ。</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>    <span class="kw">class</span> AutoGen {};</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2_1">特殊メンバ関数</a></li>
<li><a href="exercise_a.html#SS_20_3_3">解答例-特殊メンバ関数の削除</a></li>
</ul>
<h3 id="演習-委譲コンストラクタ">演習-委譲コンストラクタ <a id="SS_19_3_4"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 82</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>    <span class="co">// 下記クラスDelConstructorの2つのコンストラクタのコードクローンをできるだけ排除せよ。</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>    <span class="co">// また、不正確な記述を修正せよ。</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>    <span class="kw">class</span> DelConstructor {</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>        DelConstructor(<span class="bu">std::</span>string <span class="at">const</span>&amp; str) : <span class="va">str0_</span>{str + <span class="st">&quot;0&quot;</span>}, <span class="va">str1_</span>{str + <span class="st">&quot;1&quot;</span>}, <span class="va">str2_</span>{str + <span class="st">&quot;2&quot;</span>} {}</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a>        DelConstructor(<span class="dt">int32_t</span> num)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>            : <span class="va">str0_</span>{<span class="bu">std::</span>to_string(num) + <span class="st">&quot;_0&quot;</span>},</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>              <span class="va">str1_</span>{<span class="bu">std::</span>to_string(num) + <span class="st">&quot;_1&quot;</span>},</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a>              <span class="va">str2_</span>{<span class="bu">std::</span>to_string(num) + <span class="st">&quot;_2&quot;</span>}</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>        {</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a>        }</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a>        <span class="bu">std::</span>string&amp; GetString0() { <span class="cf">return</span> <span class="va">str0_</span>; }</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a>        <span class="bu">std::</span>string&amp; GetString1() { <span class="cf">return</span> <span class="va">str1_</span>; }</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a>        <span class="bu">std::</span>string&amp; GetString2() { <span class="cf">return</span> <span class="va">str2_</span>; }</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">str0_</span>;</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">str1_</span>;</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">str2_</span>;</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true"></a>    };</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, Constructor)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true"></a>    {</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true"></a>        {</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true"></a>            <span class="kw">auto</span> dc = DelConstructor{<span class="st">&quot;hehe&quot;</span>};</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;hehe0&quot;</span>, dc.GetString0());</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;hehe1&quot;</span>, dc.GetString1());</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;hehe2&quot;</span>, dc.GetString2());</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true"></a>        }</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true"></a>        {</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true"></a>            <span class="kw">auto</span> dc = DelConstructor{<span class="dv">123</span>};</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;123_0&quot;</span>, dc.GetString0());</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;123_1&quot;</span>, dc.GetString1());</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;123_2&quot;</span>, dc.GetString2());</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true"></a>        }</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2_2">コンストラクタ</a></li>
<li><a href="exercise_a.html#SS_20_3_4">解答例-委譲コンストラクタ</a></li>
</ul>
<h3 id="演習-copyコンストラクタ">演習-copyコンストラクタ <a id="SS_19_3_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 127</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>    <span class="co">// 下記クラスIngeter、IntegerHolderに適切にcopyコンストラクタ、copy代入演算子を追加して、</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>    <span class="co">// 単体テストを行え(DISABLED_削除)。</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a>    <span class="kw">class</span> Integer {</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a>        <span class="kw">explicit</span> Integer(<span class="dt">int32_t</span> i) <span class="kw">noexcept</span> : <span class="va">i_</span>{i} {}</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetValue() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">i_</span>; }</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>        <span class="dt">int32_t</span> <span class="va">i_</span>;</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>    };</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a>    <span class="kw">class</span> IntegerHolder {</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a>        <span class="kw">explicit</span> IntegerHolder(<span class="dt">int32_t</span> i) : <span class="va">integer_</span>{<span class="kw">new</span> Integer{i}} {}</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true"></a>        <span class="dt">int32_t</span> GetValue() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">integer_</span>-&gt;GetValue(); }</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true"></a>        ~IntegerHolder() { <span class="kw">delete</span> <span class="va">integer_</span>; }</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true"></a>        Integer* <span class="va">integer_</span>;</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true"></a>    };</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true"></a>    <span class="pp">#ifndef __clang_analyzer__</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true"></a>    TEST(DISABLED_ProgrammingConventionFuncQ, Constructor2)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true"></a>    {</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true"></a>        {</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true"></a>            <span class="kw">auto</span> i = Integer{<span class="dv">3</span>};</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, i.GetValue());</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true"></a>            <span class="kw">auto</span> j = Integer{i};</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, j.GetValue());</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true"></a>            <span class="kw">auto</span> k = Integer{<span class="dv">0</span>};</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, k.GetValue());</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true"></a>            k = i;</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, k.GetValue());</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true"></a>        }</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true"></a>        {</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true"></a>            <span class="kw">auto</span> i = IntegerHolder{<span class="dv">3</span>};</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, i.GetValue());</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true"></a></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true"></a>            <span class="kw">auto</span> j = IntegerHolder{i};</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, j.GetValue());</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true"></a>            <span class="kw">auto</span> k = IntegerHolder{<span class="dv">0</span>};</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">0</span>, k.GetValue());</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true"></a></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true"></a>            k = i;</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">3</span>, k.GetValue());</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true"></a>        }</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true"></a>    }</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true"></a>    <span class="pp">#endif</span></span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2_2">コンストラクタ</a></li>
<li><a href="exercise_a.html#SS_20_3_5">解答例-copyコンストラクタ</a></li>
</ul>
<h3 id="演習-moveコンストラクタ">演習-moveコンストラクタ <a id="SS_19_3_6"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 186</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>    <span class="co">// 上記問題を解決したIntegerHolderにmoveコンストラクタ、move演算子を追加した</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>    <span class="co">// クラスIntegerHolder2を作成し、単体テストを行え。</span></span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2_4">moveコンストラクタ、move代入演算子</a></li>
<li><a href="exercise_a.html#SS_20_3_6">解答例-moveコンストラクタ</a></li>
</ul>
<h3 id="演習-関数分割">演習-関数分割 <a id="SS_19_3_7"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 192</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>    <span class="co">// 下記PrimeNumbersは引数で与えられた整数以下の素数を返す関数である。</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>    <span class="co">// PrimeNumbersの単体テストを作成し、その後、行数を短くする等のリファクタリングを行え。</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; PrimeNumbers(<span class="dt">uint32_t</span> max_number)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>    {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>        <span class="kw">auto</span> result = <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{};</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>        <span class="cf">if</span> (max_number &gt;= <span class="dv">2</span>) {</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>            <span class="kw">auto</span> prime_num    = <span class="dv">2</span><span class="bu">U</span>;                                       <span class="co">// 最初の素数</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>            <span class="kw">auto</span> is_num_prime = <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;(max_number + <span class="dv">1</span>, <span class="kw">true</span>);  <span class="co">// falseなら素数でない。</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>            is_num_prime[<span class="dv">0</span>] = is_num_prime[<span class="dv">1</span>] = <span class="kw">false</span>;</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>            <span class="cf">do</span> {</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>                result.emplace_back(prime_num);</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a>                <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">2</span> * prime_num; i &lt; is_num_prime.size(); i += prime_num) {</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true"></a>                    is_num_prime[i] = <span class="kw">false</span>;</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true"></a>                }</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true"></a>                <span class="cf">do</span> {  <span class="co">// 次の素数の探索</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true"></a>                    ++prime_num;</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true"></a>                } <span class="cf">while</span> (!is_num_prime[prime_num] &amp;&amp; (prime_num &lt; is_num_prime.size()));</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true"></a>            } <span class="cf">while</span> (prime_num &lt; is_num_prime.size());</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true"></a>            <span class="cf">return</span> result;</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true"></a>        }</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true"></a>        <span class="cf">else</span> {</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true"></a>            <span class="cf">return</span> result;</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true"></a>        }</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true"></a>    }</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, Lines)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true"></a>    {</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{}), PrimeNumbers(<span class="dv">0</span>));</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true"></a>        <span class="co">// 以下に単体テストを追加</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_3_2">行数</a></li>
<li><a href="exercise_a.html#SS_20_3_7">解答例-関数分割</a></li>
</ul>
<h3 id="演習-オーバーライド関数の修飾">演習-オーバーライド関数の修飾 <a id="SS_19_3_8"></a></h3>
<ul>
<li><p>問題<br />
オーバーライドしたメンバ関数は、virtualと(A)を使用して宣言する。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>final</li>
<li>override</li>
<li>overload</li>
<li>const</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_3_8">解答-オーバーライド関数の修飾</a></p></li>
</ul>
<h3 id="演習-オーバーライドオーバーロード">演習-オーバーライド/オーバーロード <a id="SS_19_3_9"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 233</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>    <span class="co">// 下記クラスBase、Derivedの単体テストを完成せよ。</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>    <span class="kw">class</span> Base {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Base() = <span class="cf">default</span>;</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>        <span class="dt">int32_t</span> f() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span>; }</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> g() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span>; }</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>    };</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a>    <span class="kw">class</span> Derived : <span class="kw">public</span> Base {</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a>        <span class="dt">int32_t</span> f() <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">1</span>; }</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">int32_t</span> g() <span class="kw">noexcept</span> <span class="kw">override</span> { <span class="cf">return</span> <span class="dv">1</span>; }</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a>    };</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, Overload)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a>    {</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a>        <span class="kw">auto</span>  b     = Base{};</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a>        <span class="kw">auto</span>  d     = Derived{};</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true"></a>        Base&amp; d_ref = d;</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true"></a><span class="co">        // 下記?は0もしくは1が入る</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, b.f());</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, b.g());</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, d.f());</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, d.g());</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, d_ref.f());</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true"></a><span class="co">        ASSERT_EQ(?, d_ref.g());</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_2_7">オーバーライド</a></li>
<li><a href="exercise_a.html#SS_20_3_9">解答例-オーバーライド/オーバーロード</a></li>
</ul>
<h3 id="演習-オーバーロードによる誤用防止">演習-オーバーロードによる誤用防止 <a id="SS_19_3_10"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 272</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    <span class="co">// 下記関数Squareは、引数が浮動小数点となることを想定していない。</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    <span class="co">// 誤用を防ぐために、引数に浮動小数点を指定された場合、コンパイルできないようにせよ。</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>    <span class="dt">int32_t</span> Square(<span class="dt">int32_t</span> a) <span class="kw">noexcept</span> { <span class="cf">return</span> a * a; }</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, Overload2)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    {</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">9</span>, Square(<span class="dv">3</span>));</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">4</span>, Square(<span class="fl">2.5</span>));  <span class="co">// この誤用を防ぐためにコンパイルエラーにせよ。</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_3_3">オーバーロード</a></li>
<li><a href="exercise_a.html#SS_20_3_10">解答例-オーバーロードによる誤用防止</a></li>
</ul>
<h3 id="演習-仮引数の修飾">演習-仮引数の修飾 <a id="SS_19_3_11"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 285</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>    <span class="co">// 下記AddStringsの仮引数等を適切に修正せよ。</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>    <span class="kw">using</span> Strings = <span class="bu">std::</span>list&lt;<span class="bu">std::</span>string&gt;;</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>    <span class="dt">void</span> AddStrings(Strings a, Strings* b, Strings* ret)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>    {</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>        *ret = a;</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a>        <span class="cf">if</span> (b == <span class="kw">nullptr</span>) {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a>        }</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true"></a>        ret-&gt;insert(ret-&gt;end(), b-&gt;begin(), b-&gt;end());</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true"></a>    }</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, Parameter)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true"></a>    {</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true"></a>        <span class="kw">auto</span> a = Strings{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;d&quot;</span>};</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true"></a>        <span class="kw">auto</span> b = Strings{<span class="st">&quot;e&quot;</span>, <span class="st">&quot;fgh&quot;</span>, <span class="st">&quot;i&quot;</span>};</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true"></a>        <span class="kw">auto</span> ret = Strings{};</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true"></a>        AddStrings(a, <span class="kw">nullptr</span>, &amp;ret);</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true"></a>        ASSERT_EQ(ret, (Strings{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;d&quot;</span>}));</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true"></a>        AddStrings(a, &amp;b, &amp;ret);</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true"></a>        ASSERT_EQ(ret, (Strings{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;fgh&quot;</span>, <span class="st">&quot;i&quot;</span>}));</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_3_5">実引数/仮引数</a></li>
<li><a href="exercise_a.html#SS_20_3_11">解答例-仮引数の修飾</a></li>
</ul>
<h3 id="演習-constexpr関数">演習-constexpr関数 <a id="SS_19_3_12"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/func.cpp 314</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>    <span class="co">// 下記Factorialをconstexpr関数にせよ。</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>    <span class="dt">uint32_t</span> Factorial(<span class="dt">uint32_t</span> a) <span class="kw">noexcept</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>    {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>        <span class="cf">if</span> (a == <span class="dv">0</span> || a == <span class="dv">1</span>) {</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>            <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>        }</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a>        <span class="kw">auto</span> fact = <span class="dv">1</span><span class="bu">U</span>;</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">2</span><span class="bu">U</span>; i &lt;= a; ++i) {</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true"></a>            fact *= i;</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true"></a>        }</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true"></a>        <span class="cf">return</span> fact;</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true"></a>    }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true"></a>    TEST(ProgrammingConventionFuncQ, ConstexprFunc)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true"></a>    {</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true"></a>    <span class="pp">#if 0  </span><span class="co">// Factorialはconstexpr関数でないため、下記はコンパイルできない。</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true"></a><span class="co">        static_assert(1 == Factorial(0), &quot;Factorial fail&quot;);</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">1</span>, Factorial(<span class="dv">0</span>));</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">6</span>, Factorial(<span class="dv">3</span>));</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">120</span>, Factorial(<span class="dv">5</span>));</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">3628800</span>, Factorial(<span class="dv">10</span>));</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_3_3_8">constexpr関数</a></li>
<li><a href="exercise_a.html#SS_20_3_12">解答例-constexpr関数</a></li>
</ul>
<h3 id="演習-エクセプションの型">演習-エクセプションの型 <a id="SS_19_3_13"></a></h3>
<ul>
<li><p>問題<br />
try-catchでエクセプションを捕捉する場合、 catchの中で宣言するエクセプション補足用の変数は(A)として定義する。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>constポインタ</li>
<li>constリファレンス</li>
<li>非constオブジェクト</li>
<li>constオブジェクト</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_3_13">解答-エクセプションの型</a></p></li>
</ul>
<h2 id="プログラミング規約構文">プログラミング規約(構文) <a id="SS_19_4"></a></h2>
<h3 id="演習-コンテナの範囲for文">演習-コンテナの範囲for文 <a id="SS_19_4_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/syntax.cpp 8</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a>    <span class="co">// 下記Accumlateのfor文を</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>    <span class="co">//  * イテレータを使ったfor文を使用したAccumlate2</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a>    <span class="co">//  * 範囲for文を使用したAccumlate3</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>    <span class="co">// を作り、それらの単体テストを行え。また、その時にその他の不具合があれば合わせて修正せよ。</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a>    <span class="bu">std::</span>string Accumlate(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; strings) <span class="kw">noexcept</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a>    {</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a>        <span class="kw">auto</span> ret = <span class="bu">std::</span>string{};</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; i &lt; strings.size(); ++i) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a>            ret += strings[i];</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a>        }</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true"></a>    }</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true"></a>    TEST(ProgrammingConventionSyntaxQ, RangeFor)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true"></a>    {</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;abcd&quot;</span>, Accumlate(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;cd&quot;</span>}));</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_4_4">範囲for文</a></li>
<li><a href="exercise_a.html#SS_20_4_1">解答例-コンテナの範囲for文</a></li>
</ul>
<h3 id="演習-ラムダ式">演習-ラムダ式 <a id="SS_19_4_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/syntax.cpp 32</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a>    <span class="co">// 下記のcopy_ifの第4引数をラムダ式を使って書き直せ。</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a>    <span class="dt">bool</span> is_not_size0(<span class="bu">std::</span>string <span class="at">const</span>&amp; s) <span class="kw">noexcept</span> { <span class="cf">return</span> s.size() != <span class="dv">0</span>; }</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>    TEST(ProgrammingConventionSyntaxQ, Lambda)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>    {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;&quot;</span>, <span class="st">&quot;abc&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;d&quot;</span>};</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a>        <span class="kw">auto</span> ret = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a>        <span class="bu">std::</span>copy_if(data.cbegin(), data.cend(), <span class="bu">std::</span>back_inserter(ret), is_not_size0);</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;d&quot;</span>}), ret);</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_4_8">ラムダ式</a></li>
<li><a href="exercise_a.html#SS_20_4_2">解答例-ラムダ式</a></li>
</ul>
<h3 id="演習-ラムダ式のキャプチャ">演習-ラムダ式のキャプチャ <a id="SS_19_4_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/syntax.cpp 48</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a>    <span class="co">// 下記Lambda::GetNameLessThan()のラムダ式の問題点を修正し、単体テストを行え。</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a>    <span class="kw">class</span> Lambda {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>        <span class="kw">explicit</span> Lambda(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;&amp;&amp; strs) : <span class="va">strs_</span>{<span class="bu">std::</span>move(strs)} {}</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; GetNameLessThan(<span class="dt">uint32_t</span> length) <span class="at">const</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>        {</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>            <span class="bu">std::</span>copy_if(<span class="va">strs_</span>.cbegin(), <span class="va">strs_</span>.cend(), <span class="bu">std::</span>back_inserter(ret),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>                         [=](<span class="kw">auto</span> <span class="at">const</span>&amp; str) <span class="kw">noexcept</span> { <span class="cf">return</span> (<span class="va">strs_</span>.size() &lt; length); });</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true"></a>            <span class="cf">return</span> ret;</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true"></a>        }</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="va">strs_</span>;</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true"></a>    };</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true"></a>    TEST(ProgrammingConventionSyntaxQ, Lambda2)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true"></a>    {</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true"></a>        <span class="kw">auto</span> lambda = Lambda{{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;abcdef&quot;</span>, <span class="st">&quot;a&quot;</span>}};</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true"></a>        <span class="co">// 以下に単体テストを追加。</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_4_8">ラムダ式</a></li>
<li><a href="exercise_a.html#SS_20_4_3">解答例-ラムダ式のキャプチャ</a></li>
</ul>
<h2 id="プログラミング規約演算子">プログラミング規約(演算子) <a id="SS_19_5"></a></h2>
<h3 id="演習-三項演算子">演習-三項演算子 <a id="SS_19_5_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/operator.cpp 6</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>    <span class="co">// 下記whichのif文を三項演算子を使用して書き直せ。</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>    <span class="dt">int32_t</span> which(<span class="dt">bool</span> left, <span class="dt">int32_t</span> lhs, <span class="dt">int32_t</span> rhs) <span class="kw">noexcept</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a>    {</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>        <span class="cf">if</span> (left) {</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a>            <span class="cf">return</span> lhs;</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a>        }</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a>        <span class="cf">else</span> {</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true"></a>            <span class="cf">return</span> rhs;</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true"></a>        }</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true"></a>    }</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true"></a>    TEST(ProgrammingConventionOperatorQ, OoOperator)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true"></a>    {</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">3</span>, which(<span class="kw">true</span>, <span class="dv">3</span>, <span class="dv">4</span>));</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">4</span>, which(<span class="kw">false</span>, <span class="dv">3</span>, <span class="dv">4</span>));</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_5_5">三項演算子</a></li>
<li><a href="exercise_a.html#SS_20_5_1">解答例-三項演算子</a></li>
</ul>
<h3 id="演習-delete">演習-delete <a id="SS_19_5_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/operator.cpp 26</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a>    <span class="co">// 下記DeleteProblemのメモリ管理の問題を修正し、単体テストを行え(DISABLED_削除)。</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a>    <span class="co">// また、他の問題があれば、合わせて修正せよ。</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a>    <span class="kw">class</span> DeleteProblem {</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a>        DeleteProblem(<span class="dt">char</span> <span class="at">const</span>* str0 = <span class="kw">nullptr</span>, <span class="dt">char</span> <span class="at">const</span>* str1 = <span class="kw">nullptr</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a>        {</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a>            <span class="cf">if</span> (str0 != <span class="kw">nullptr</span>) {</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a>                <span class="va">str0_</span> = <span class="kw">new</span> <span class="bu">std::</span>string{str0};</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>            }</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a>            <span class="cf">if</span> (str1 != <span class="kw">nullptr</span>) {</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a>                <span class="va">str1_</span> = <span class="kw">new</span> <span class="bu">std::</span>string{str1};</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a>            }</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a>        }</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>* GetStr0() { <span class="cf">return</span> <span class="va">str0_</span>; }</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>* GetStr1() { <span class="cf">return</span> <span class="va">str1_</span>; }</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a>        ~DeleteProblem()</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a>        {</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true"></a>            delete_str(<span class="va">str0_</span>);</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true"></a>            delete_str(<span class="va">str1_</span>);</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true"></a>        }</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">void</span> delete_str(<span class="dt">void</span>* str)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true"></a>        {</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true"></a>            <span class="cf">if</span> (str != <span class="kw">nullptr</span>) {</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true"></a>                <span class="kw">delete</span> str;</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true"></a>            }</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true"></a>        }</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true"></a>        <span class="bu">std::</span>string* <span class="va">str0_</span> = <span class="kw">nullptr</span>;</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true"></a>        <span class="bu">std::</span>string* <span class="va">str1_</span> = <span class="kw">nullptr</span>;</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true"></a>    };</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true"></a>    TEST(DISABLED_ProgrammingConventionOperatorQ, Delete)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true"></a>    {</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true"></a>        <span class="co">// この単体テストはメモリリークを起こす</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true"></a>        <span class="co">// このメモリリークはmake san-utで検出される</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true"></a>        {</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true"></a>            <span class="kw">auto</span> dp = DeleteProblem{};</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true"></a>            ASSERT_EQ(<span class="kw">nullptr</span>, dp.GetStr0());</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true"></a>            ASSERT_EQ(<span class="kw">nullptr</span>, dp.GetStr1());</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true"></a>        }</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true"></a>        {</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true"></a>            <span class="kw">auto</span> dp = DeleteProblem{<span class="st">&quot;abc&quot;</span>};</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;abc&quot;</span>, *dp.GetStr0());</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true"></a>            ASSERT_EQ(<span class="kw">nullptr</span>, dp.GetStr1());</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true"></a>        }</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true"></a>        {</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true"></a>            <span class="kw">auto</span> dp = DeleteProblem{<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;de&quot;</span>};</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true"></a></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;abc&quot;</span>, *dp.GetStr0());</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;de&quot;</span>, *dp.GetStr1());</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true"></a>        }</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_5_6_2">delete</a></li>
<li><a href="exercise_a.html#SS_20_5_2">解答例-delete</a></li>
</ul>
<h3 id="演習-sizeof">演習-sizeof <a id="SS_19_5_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/operator.cpp 88</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>    <span class="co">// 下記Size1() - Size4()の単体テストを作れ。</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>    <span class="dt">size_t</span> Size0(<span class="dt">int32_t</span> a) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="kw">sizeof</span>(a); }</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a>    <span class="dt">size_t</span> Size1(<span class="dt">int32_t</span> a[<span class="dv">10</span>]) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="kw">sizeof</span>(a); }</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true"></a>    <span class="dt">size_t</span> Size2(<span class="dt">int32_t</span> a[]) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="kw">sizeof</span>(a); }</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true"></a>    <span class="dt">size_t</span> Size3(<span class="dt">int32_t</span>* a) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="kw">sizeof</span>(a); }</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true"></a>    <span class="dt">size_t</span> Size4(<span class="dt">int32_t</span> (&amp;a)[<span class="dv">10</span>]) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="kw">sizeof</span>(a); }</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true"></a>    TEST(ProgrammingConventionOperatorQ, Sizeof)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true"></a>    {</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true"></a>        <span class="dt">int32_t</span> array[<span class="dv">10</span>]{};</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true"></a>        <span class="co">// Size1() - Size4()の単体テスト</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true"></a>        ASSERT_EQ(<span class="kw">sizeof</span>(<span class="dt">void</span>*), Size3(array));</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_5_7">sizeof</a></li>
<li><a href="exercise_a.html#SS_20_5_3">解答例-sizeof</a></li>
</ul>
<h3 id="演習-dynamic_castの削除">演習-dynamic_castの削除 <a id="SS_19_5_4"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/operator.cpp 110</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>    <span class="co">// 下記クラスX、Y、ZとGetNameをdynamic_castを使わずに書き直せ。</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>    <span class="kw">class</span> X {</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>        <span class="kw">virtual</span> ~X() = <span class="cf">default</span>;</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a>    };</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a>    <span class="kw">class</span> Y : <span class="kw">public</span> X {};</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>    <span class="kw">class</span> Z : <span class="kw">public</span> X {};</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>    <span class="bu">std::</span>string GetName(X* x)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a>    {</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="kw">dynamic_cast</span>&lt;Y*&gt;(x) != <span class="kw">nullptr</span>) {</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;Y&quot;</span>;</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a>        }</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="kw">dynamic_cast</span>&lt;Z*&gt;(x) != <span class="kw">nullptr</span>) {</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;Z&quot;</span>;</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true"></a>        }</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="kw">dynamic_cast</span>&lt;X*&gt;(x) != <span class="kw">nullptr</span>) {</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;X&quot;</span>;</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true"></a>        }</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true"></a>        <span class="ot">assert</span>(<span class="kw">false</span>);</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;UnKnown&quot;</span>;</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true"></a>    }</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true"></a>    TEST(ProgrammingConventionOperatorQ, Cast)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true"></a>    {</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true"></a>        <span class="kw">auto</span> x = X{};</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true"></a>        <span class="kw">auto</span> y = Y{};</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true"></a>        <span class="kw">auto</span> z = Z{};</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;X&quot;</span>, GetName(&amp;x));</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;Y&quot;</span>, GetName(&amp;y));</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;Z&quot;</span>, GetName(&amp;z));</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_5_10">キャスト、暗黙の型変換</a></li>
<li><a href="exercise_a.html#SS_20_5_4">解答例-dynamic_castの削除</a></li>
</ul>
<h3 id="演習-キャスト">演習-キャスト <a id="SS_19_5_5"></a></h3>
<ul>
<li><p>問題<br />
キャストは避けるべきだが、やむを得ず使用する場合であっても、 Cタイプキャスト、(A)、 dynamic_castは使用しない。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>static_cast</li>
<li>reinterpret_cast</li>
<li>const_cast</li>
<li>該当なし</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_5_5">解答-キャスト</a></p></li>
</ul>
<h2 id="プログラミング規約スコープ">プログラミング規約(スコープ) <a id="SS_19_6"></a></h2>
<h3 id="演習-usingディレクティブ">演習-usingディレクティブ <a id="SS_19_6_1"></a></h3>
<ul>
<li><p>問題<br />
usingディレクティブ(using namespace NS)の使用上の注意として相応しいものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>usingディレクティブは、関数先頭でのみ使用してよい。</li>
<li>ヘッダファイルでusingディレクティブをすると便利である。</li>
<li>ファイルスコープでusingディレクティブをすると便利である。</li>
<li>using宣言よりusingディレクティブを優先するべきである。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_6_1">解答-usingディレクティブ</a></p></li>
</ul>
<h2 id="プログラミング規約その他">プログラミング規約(その他) <a id="SS_19_7"></a></h2>
<h3 id="演習-アサーションの選択">演習-アサーションの選択 <a id="SS_19_7_1"></a></h3>
<ul>
<li><p>問題<br />
論理的にありえない(switchでそのcaseやdefaultを通過することはあり得ない等) 状態を検知するために積極的に(A)を使用する。<br />
(A)に相応しいものを下記より選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>assert()</li>
<li>static_assert</li>
<li>while(1);</li>
<li>abort()</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_7_1">解答-アサーションの選択</a></p></li>
</ul>
<h3 id="演習-assertstatic_assert">演習-assert/static_assert <a id="SS_19_7_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/programming_convention_q/etc.cpp 4</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>    <span class="co">// 下記FloatingPointは、Tが浮動小数点型、Tのインスタンスは非０であることを前提としている。</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>    <span class="co">// 適切にアサーションを挿入して誤用を防げ。</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>    <span class="kw">template</span> &lt;<span class="kw">typename</span> T&gt;</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>    <span class="kw">class</span> FloatingPoint {</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a>        FloatingPoint(T num) <span class="kw">noexcept</span> : <span class="va">num_</span>{num} {}</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true"></a>        T Get() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">num_</span>; }</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true"></a>        T Reciprocal() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">1</span> / <span class="va">num_</span>; }</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true"></a>        T <span class="va">num_</span>;</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true"></a>    };</span></code></pre></div>
<ul>
<li>参照 <a href="programming_convention.html#SS_3_11_1">assertion</a></li>
<li><a href="exercise_a.html#SS_20_7_2">解答例-assert/static_assert</a></li>
</ul>
<h2 id="solid">SOLID <a id="SS_19_8"></a></h2>
<p>以下の演習問題の単体テストで使用される</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>    TEST_F(Xxx, Yyy)</span></code></pre></div>
<p>のような記述のXxyは、以下のように宣言・定義されている。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/h/solid_ut.h 7</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a>    <span class="kw">class</span> SolidFixture : <span class="kw">public</span> ::testing::Test {</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a>    <span class="kw">protected</span>:</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">test_score_org_</span>     = <span class="st">&quot;../ut_data2/test_score_org.csv&quot;</span>;</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">test_score_org_f_</span>   = <span class="st">&quot;../ut_data2/test_score_org_f.csv&quot;</span>;</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">test_score_act_</span>     = <span class="st">&quot;../ut_data2/test_score_act.csv&quot;</span>;</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">test_score_exp_</span>     = <span class="st">&quot;../ut_data2/test_score_exp.csv&quot;</span>;</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">test_score_exp_err_</span> = <span class="st">&quot;../ut_data2/test_score_exp_err.csv&quot;</span>;</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> SetUp() <span class="kw">noexcept</span> <span class="kw">override</span> { remove_file(<span class="va">test_score_act_</span>); }</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> TearDown() <span class="kw">noexcept</span> <span class="kw">override</span> { remove_file(<span class="va">test_score_act_</span>); }</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">void</span> remove_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename) <span class="kw">noexcept</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true"></a>        {</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="bu">std::</span>filesystem<span class="bu">::</span>exists(filename)) {</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true"></a>                <span class="bu">std::</span>filesystem<span class="bu">::</span>remove(filename);</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true"></a>            }</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true"></a>        }</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true"></a>    };</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true"></a>    <span class="kw">class</span> SolidSRP_Q : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true"></a>    <span class="kw">class</span> SolidOCP_Q : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true"></a>    <span class="kw">class</span> SolidLSP_Q : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true"></a>    <span class="kw">class</span> SolidISP_Q : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true"></a>    <span class="kw">class</span> SolidDIP_Q : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true"></a>    <span class="kw">class</span> SolidSRP_A : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true"></a>    <span class="kw">class</span> SolidOCP_A : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true"></a>    <span class="kw">class</span> SolidLSP_A : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true"></a>    <span class="kw">class</span> SolidISP_A : <span class="kw">public</span> SolidFixture {};</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true"></a>    <span class="kw">class</span> SolidDIP_A : <span class="kw">public</span> SolidFixture {};</span></code></pre></div>
<h3 id="演習-srp">演習-SRP <a id="SS_19_8_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/srp_test_score.h 8</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a>    <span class="co">// 下記クラスTestScoreはメンバにする必要のない関数までメンバにしてるため、</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a>    <span class="co">// インターフェースが肥大化してしまい、少なくともSRPに反している。</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a>    <span class="co">// メンバにする必要のないStoreCSVを外部関数にせよ。</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a>    <span class="co">// また、受験者の平均点を求める</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a>    <span class="co">//      TestScore::ScoreOne_t Average(TestScore const&amp; test_score);</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a>    <span class="co">// を同様の方法で作り、単体テストを行え。</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a>    <span class="kw">class</span> TestScore {</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true"></a>        TestScore()                            = <span class="cf">default</span>;</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true"></a>        TestScore(TestScore <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreAll_t</span> = <span class="bu">std::</span>map&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreOne_t</span> = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true"></a>        <span class="dt">void</span>                        AddScore(<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score);</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; GetScore(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true"></a>        {</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">test_score_row_</span>.at(name);</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true"></a>        }</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true"></a>        <span class="dt">void</span> StoreCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename) <span class="at">const</span>;</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true"></a>        <span class="dt">void</span> LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator begin() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.begin(); }</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator end() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.end(); }</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、-1は未受験、それ以外は不正データ</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true"></a>        <span class="dt">void</span>       validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span>;</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span> <span class="va">test_score_row_</span>{};</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true"></a>    };</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts);</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/srp_test_score.cpp 10</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a>    <span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt; parse_line(<span class="bu">std::</span>string <span class="at">const</span>&amp; line)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a>    {</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> csv_sep = <span class="bu">std::</span>regex{<span class="st">R&quot;( *, *)&quot;</span>};</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true"></a>        <span class="kw">auto</span>       name    = <span class="bu">std::</span>string{};</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true"></a>        <span class="kw">auto</span>       score   = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true"></a>        <span class="kw">auto</span> end = <span class="bu">std::</span>sregex_token_iterator{};</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> it = <span class="bu">std::</span>sregex_token_iterator{line.begin(), line.end(), csv_sep, -<span class="dv">1</span>}; it != end;</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true"></a>             ++it) {</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true"></a>            <span class="cf">if</span> (name.length() == <span class="dv">0</span>) {</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true"></a>                name = *it;</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true"></a>            }</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true"></a>            <span class="cf">else</span> {</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true"></a>                <span class="kw">auto</span> s = <span class="bu">std::</span>stoi(*it);</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true"></a>                score.emplace_back(s);</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true"></a>            }</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true"></a>        }</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true"></a>        <span class="cf">return</span> {<span class="bu">std::</span>move(name), <span class="bu">std::</span>move(score)};</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true"></a>    }</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true"></a>    {</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true"></a>        <span class="kw">auto</span> highest = <span class="dv">100</span>;</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true"></a>        <span class="kw">auto</span> lowest  = <span class="dv">0</span>;</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true"></a>        <span class="kw">auto</span> invalid = -<span class="dv">1</span>;</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true"></a>        <span class="cf">if</span> (lowest &lt;= score &amp;&amp; score &lt;= highest) {</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true"></a>            ;  <span class="co">// do notihng</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true"></a>        }</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true"></a>        <span class="cf">else</span> <span class="cf">if</span> (invalid == score) {</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true"></a>            ;  <span class="co">// do notihng</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true"></a>        }</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true"></a>        <span class="cf">else</span> {</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true"></a>            <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true"></a>        }</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true"></a>    }</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::AddScore(TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true"></a>    {</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true"></a>            validate_score(pair.second);</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true"></a>        }</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">test_score_row_</span>.size() == <span class="dv">0</span>) {</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[one_test_score[<span class="dv">0</span>].first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true"></a>        }</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true"></a></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true"></a>            pair.second.push_back(-<span class="dv">1</span>);</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true"></a>        }</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true"></a></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true"></a>        <span class="kw">auto</span> curr_test_count = <span class="va">test_score_row_</span>.begin()-&gt;second.size();</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true"></a></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">test_score_row_</span>.find(pair.first) == <span class="va">test_score_row_</span>.end()) {</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true"></a>                <span class="va">test_score_row_</span>[pair.first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;(curr_test_count, -<span class="dv">1</span>);</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true"></a>            }</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true"></a></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[pair.first].back() = pair.second;</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true"></a>        }</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true"></a>    }</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true"></a></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true"></a>    {</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true"></a></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true"></a>        <span class="kw">auto</span> test_score_raw = <span class="dt">ScoreAll_t</span>{};</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true"></a>        <span class="kw">auto</span> line           = <span class="bu">std::</span>string{};</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true"></a>        <span class="cf">while</span> (<span class="bu">std::</span>getline(data, line)) {</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true"></a>            <span class="co">// std::pair&lt;TestScore::ScoreAll_t::iterator, bool&gt;</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true"></a>            <span class="kw">auto</span> ret = test_score_raw.insert(parse_line(line));</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true"></a>            <span class="ot">assert</span>(ret.second);</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true"></a>        }</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true"></a></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score_raw) {</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true"></a>                validate_score(s);</span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true"></a>            }</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true"></a>        }</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true"></a></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true"></a>        <span class="va">test_score_row_</span>.swap(test_score_raw);</span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true"></a>    }</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true"></a></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::StoreCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename) <span class="at">const</span></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true"></a>    {</span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ofstream{filename};</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true"></a>        <span class="kw">auto</span> ss   = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true"></a></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true"></a>            ss &lt;&lt; pair.first;</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true"></a>                ss &lt;&lt; <span class="st">&quot;, &quot;</span> &lt;&lt; s;</span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true"></a>            }</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true"></a>        }</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true"></a></span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true"></a>        data &lt;&lt; ss.str();</span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true"></a>    }</span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true"></a></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts)</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true"></a>    {</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true"></a>        <span class="kw">auto</span> ss = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true"></a></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : ts) {</span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true"></a>            ss &lt;&lt; pair.first &lt;&lt; <span class="ch">&#39;:&#39;</span>;</span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; s : pair.second) {</span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true"></a>                ss &lt;&lt; <span class="ch">&#39; &#39;</span> &lt;&lt; s;</span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true"></a>            }</span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true"></a>        }</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true"></a></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true"></a>        <span class="cf">return</span> ss.str();</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/srp_test_score_ut.cpp 13</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a>    TEST_F(SolidSRP_Q, TestScore_LoadCSV)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a>    {</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true"></a>        };</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true"></a>    }</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true"></a>    <span class="bu">std::</span>string whole_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true"></a>    {</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true"></a>        <span class="kw">auto</span> ifs = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{ifs}, <span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{}};</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true"></a>    }</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true"></a>    TEST_F(SolidSRP_Q, TestScore_AddScore)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true"></a>    {</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">70</span>),</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, -<span class="dv">1</span>),</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, <span class="dv">100</span>),</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, <span class="dv">90</span>),</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true"></a>        };</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true"></a>        ts.AddScore(one_score);</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">50</span>}),</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">40</span>}),</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">70</span>}),</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">1</span>}),</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>, -<span class="dv">1</span>}),</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">5</span>}),</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">100</span>}),</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">90</span>}),</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true"></a>        };</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true"></a></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score_err = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;野村&quot;</span>, -<span class="dv">2</span>),</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;衣笠&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true"></a>        };</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true"></a></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true"></a>        <span class="co">// 不正データロード</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true"></a>        ASSERT_THROW(ts.AddScore(one_score_err), <span class="bu">std::</span>out_of_range);</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true"></a>    }</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true"></a></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true"></a>    TEST_F(SolidSRP_Q, TestScore_GetScore)</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true"></a>    {</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true"></a></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_0 = ts.GetScore(<span class="st">&quot;堂林&quot;</span>);</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}), score_0);</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true"></a></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_1 = ts.GetScore(<span class="st">&quot;広輔&quot;</span>);</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}), score_1);</span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true"></a></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_2 = ts.GetScore(<span class="st">&quot;會澤&quot;</span>);</span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}), score_2);</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true"></a></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_3 = ts.GetScore(<span class="st">&quot;松山&quot;</span>);</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}), score_3);</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true"></a></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_4 = ts.GetScore(<span class="st">&quot;菊池&quot;</span>);</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}), score_4);</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true"></a></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_5 = ts.GetScore(<span class="st">&quot;鈴木&quot;</span>);</span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}), score_5);</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true"></a></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true"></a>        ASSERT_THROW(ts.GetScore(<span class="st">&quot;西川&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true"></a>    }</span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true"></a>    TEST_F(SolidSRP_Q, TestScore_StoreCSV)</span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true"></a>    {</span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true"></a>        ts.StoreCSV(<span class="va">test_score_act_</span>);</span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true"></a></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true"></a>        <span class="kw">auto</span> content_act = whole_file(<span class="va">test_score_act_</span>);</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true"></a>        <span class="kw">auto</span> content_exp = whole_file(<span class="va">test_score_exp_</span>);</span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true"></a></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true"></a>        ASSERT_EQ(content_exp, content_act);</span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true"></a></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true"></a>        <span class="co">// 不正ファイルロード</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true"></a>        ASSERT_THROW(ts.LoadCSV(<span class="va">test_score_exp_err_</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true"></a></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true"></a>    }</span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="solid.html#SS_8_1">単一責任の原則(SRP)</a></li>
<li><a href="exercise_a.html#SS_20_8_1">解答例-SRP</a></li>
</ul>
<h3 id="演習-ocp">演習-OCP <a id="SS_19_8_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/ocp_test_score.h 8</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a>    <span class="co">// 下記クラスTestScoreは、</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a>    <span class="co">//      * テスト受講者とその点数を保持/提供する。</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a>    <span class="co">//      * テスト受講者とその点数をCSVファイルからロードする。</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a>    <span class="co">// 責任を持つ。サポートするファイル形式が増えた場合、このクラスを修正せざるを得ないため、</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a>    <span class="co">// 機能拡張に対して開いていない。つまり、OCPに反していると言える</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a>    <span class="co">// (実際にはこの程度の違反が問題になることは稀である)。</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a>    <span class="co">// サポートしているファイル形式はCSVのみであったが、TSVを追加することになった。</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a>    <span class="co">// 今後もサポートするファイル形式を増やす必要があるため、OCPに従った方が良いと判断し、</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true"></a>    <span class="co">// TestScoreの責務から「ファイルのロード」を外し、その機能を外部関数として定義することにした。</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true"></a>    <span class="co">// これに従い、下記クラスTestScoreを修正し、外部関数</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true"></a>    <span class="co">//      void LoadCSV(std::string const&amp; filename, TestScore&amp; test_score);</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true"></a>    <span class="co">// を作り、単体テストを行え。</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true"></a>    <span class="kw">class</span> TestScore {</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true"></a>        TestScore()                            = <span class="cf">default</span>;</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true"></a>        TestScore(TestScore <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreAll_t</span> = <span class="bu">std::</span>map&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreOne_t</span> = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true"></a></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true"></a>        <span class="dt">void</span>                        AddScore(<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score);</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; GetScore(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true"></a>        {</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">test_score_row_</span>.at(name);</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true"></a>        }</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true"></a></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true"></a>        <span class="dt">void</span> LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator begin() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.begin(); }</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator end() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.end(); }</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、-1は未受験、それ以外は不正データ</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true"></a>        <span class="dt">void</span>       validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span>;</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span> <span class="va">test_score_row_</span>{};</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true"></a>    };</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true"></a></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true"></a>    <span class="bu">std::</span>string           ToString(TestScore <span class="at">const</span>&amp; ts);</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true"></a>    <span class="dt">void</span>                  StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score);</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/ocp_test_score.cpp 10</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a>    <span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt; parse_line(<span class="bu">std::</span>string <span class="at">const</span>&amp; line)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a>    {</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> csv_sep = <span class="bu">std::</span>regex{<span class="st">R&quot;( *, *)&quot;</span>};</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a>        <span class="kw">auto</span>       name    = <span class="bu">std::</span>string{};</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a>        <span class="kw">auto</span>       score   = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true"></a>        <span class="kw">auto</span> end = <span class="bu">std::</span>sregex_token_iterator{};</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> it = <span class="bu">std::</span>sregex_token_iterator{line.begin(), line.end(), csv_sep, -<span class="dv">1</span>}; it != end;</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true"></a>             ++it) {</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true"></a>            <span class="cf">if</span> (name.length() == <span class="dv">0</span>) {</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true"></a>                name = *it;</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true"></a>            }</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true"></a>            <span class="cf">else</span> {</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true"></a>                <span class="kw">auto</span> s = <span class="bu">std::</span>stoi(*it);</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true"></a>                score.emplace_back(s);</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true"></a>            }</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true"></a>        }</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true"></a>        <span class="cf">return</span> {<span class="bu">std::</span>move(name), <span class="bu">std::</span>move(score)};</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true"></a>    }</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true"></a>    <span class="dt">bool</span> is_valid_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span> &lt;= score &amp;&amp; score &lt;= <span class="dv">100</span>; }</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true"></a>    <span class="dt">bool</span> not_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> score == -<span class="dv">1</span>; }</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true"></a>    {</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true"></a>        <span class="cf">if</span> (is_valid_score(score) || not_score(score)) {</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true"></a>        }</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true"></a></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true"></a>        <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true"></a>    }</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true"></a></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::AddScore(TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true"></a>    {</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true"></a>            validate_score(pair.second);</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true"></a>        }</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true"></a></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">test_score_row_</span>.size() == <span class="dv">0</span>) {</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[one_test_score[<span class="dv">0</span>].first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true"></a>        }</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true"></a></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true"></a>            pair.second.push_back(-<span class="dv">1</span>);</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true"></a>        }</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true"></a></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true"></a>        <span class="kw">auto</span> curr_test_count = <span class="va">test_score_row_</span>.begin()-&gt;second.size();</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true"></a></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">test_score_row_</span>.find(pair.first) == <span class="va">test_score_row_</span>.end()) {</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true"></a>                <span class="va">test_score_row_</span>[pair.first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;(curr_test_count, -<span class="dv">1</span>);</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true"></a>            }</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true"></a></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[pair.first].back() = pair.second;</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true"></a>        }</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true"></a>    }</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true"></a>    {</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true"></a></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true"></a>        <span class="kw">auto</span> test_score_raw = TestScore::<span class="dt">ScoreAll_t</span>{};</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true"></a>        <span class="kw">auto</span> line           = <span class="bu">std::</span>string{};</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true"></a>        <span class="cf">while</span> (<span class="bu">std::</span>getline(data, line)) {</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true"></a>            <span class="co">// std::pair&lt;TestScore::ScoreAll_t::iterator, bool&gt;</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true"></a>            <span class="kw">auto</span> ret = test_score_raw.insert(parse_line(line));</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true"></a>            <span class="ot">assert</span>(ret.second);</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true"></a>        }</span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true"></a></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score_raw) {</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true"></a>                validate_score(s);</span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true"></a>            }</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true"></a>        }</span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true"></a></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true"></a>        <span class="va">test_score_row_</span>.swap(test_score_raw);</span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true"></a>    }</span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true"></a></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true"></a>    <span class="dt">void</span> StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true"></a>    {</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ofstream{filename};</span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true"></a>        <span class="kw">auto</span> ss   = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true"></a></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true"></a>            ss &lt;&lt; pair.first;</span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true"></a>                ss &lt;&lt; <span class="st">&quot;, &quot;</span> &lt;&lt; s;</span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true"></a>            }</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true"></a>        }</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true"></a></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true"></a>        data &lt;&lt; ss.str();</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true"></a>    }</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true"></a></span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts)</span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true"></a>    {</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true"></a>        <span class="kw">auto</span> ss = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true"></a></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : ts) {</span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true"></a>            ss &lt;&lt; pair.first &lt;&lt; <span class="ch">&#39;:&#39;</span>;</span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true"></a>                ss &lt;&lt; <span class="ch">&#39; &#39;</span> &lt;&lt; s;</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true"></a>            }</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true"></a>        }</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true"></a></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true"></a>        <span class="cf">return</span> ss.str();</span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true"></a>    }</span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true"></a></span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score)</span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true"></a>    {</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true"></a>        <span class="kw">auto</span> ret = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true"></a></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true"></a>            <span class="kw">auto</span> sum         = <span class="dv">0</span>;</span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true"></a>            <span class="kw">auto</span> valid_count = <span class="dv">0</span><span class="bu">U</span>;</span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true"></a>                <span class="cf">if</span> (is_valid_score(s)) {</span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true"></a>                    sum += s;</span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true"></a>                    ++valid_count;</span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true"></a>                }</span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true"></a>            }</span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true"></a>            ret.emplace_back(<span class="bu">std::</span>make_pair(pair.first, valid_count == <span class="dv">0</span> ? -<span class="dv">1</span> : sum / valid_count));</span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true"></a>        }</span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true"></a></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/ocp_test_score_ut.cpp 13</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a>    TEST_F(SolidOCP_Q, TestScore_LoadCSV)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a>    {</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true"></a>        };</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true"></a>    }</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true"></a>    <span class="bu">std::</span>string whole_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true"></a>    {</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true"></a>        <span class="kw">auto</span> ifs = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{ifs}, <span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{}};</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true"></a>    }</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true"></a></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true"></a>    TEST_F(SolidOCP_Q, TestScore_AddScore)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true"></a>    {</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">70</span>),</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, -<span class="dv">1</span>),</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, <span class="dv">100</span>),</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, <span class="dv">90</span>),</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true"></a>        };</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true"></a></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true"></a>        ts.AddScore(one_score);</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">50</span>}),</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">40</span>}),</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">70</span>}),</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">1</span>}),</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>, -<span class="dv">1</span>}),</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">5</span>}),</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">100</span>}),</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">90</span>}),</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true"></a>        };</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true"></a></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true"></a></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score_err = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;野村&quot;</span>, -<span class="dv">2</span>),</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;衣笠&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true"></a>        };</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true"></a>        <span class="co">// 不正データロード</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true"></a>        ASSERT_THROW(ts.AddScore(one_score_err), <span class="bu">std::</span>out_of_range);</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true"></a></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true"></a>    }</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true"></a></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true"></a>    TEST_F(SolidOCP_Q, TestScore_GetScore)</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true"></a>    {</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true"></a></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_0 = ts.GetScore(<span class="st">&quot;堂林&quot;</span>);</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}), score_0);</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true"></a></span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_1 = ts.GetScore(<span class="st">&quot;広輔&quot;</span>);</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}), score_1);</span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true"></a></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_2 = ts.GetScore(<span class="st">&quot;會澤&quot;</span>);</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}), score_2);</span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true"></a></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_3 = ts.GetScore(<span class="st">&quot;松山&quot;</span>);</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}), score_3);</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true"></a></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_4 = ts.GetScore(<span class="st">&quot;菊池&quot;</span>);</span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}), score_4);</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true"></a></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_5 = ts.GetScore(<span class="st">&quot;鈴木&quot;</span>);</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}), score_5);</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true"></a></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true"></a>        ASSERT_THROW(ts.GetScore(<span class="st">&quot;西川&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true"></a>    }</span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true"></a></span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true"></a>    TEST_F(SolidOCP_Q, TestScore_StoreCSV)</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true"></a>    {</span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true"></a>        StoreCSV(ts, <span class="va">test_score_act_</span>);</span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true"></a></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true"></a>        <span class="kw">auto</span> content_act = whole_file(<span class="va">test_score_act_</span>);</span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true"></a>        <span class="kw">auto</span> content_exp = whole_file(<span class="va">test_score_exp_</span>);</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true"></a></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true"></a>        ASSERT_EQ(content_exp, content_act);</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true"></a></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true"></a>        <span class="co">// 不正ファイルロード</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true"></a>        ASSERT_THROW(ts.LoadCSV(<span class="va">test_score_exp_err_</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true"></a></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true"></a>    }</span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true"></a></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true"></a>    TEST_F(SolidOCP_Q, TestScore_Average)</span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true"></a>    {</span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true"></a>        ts.LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true"></a></span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">65</span>),</span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">26</span>),</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">53</span>),</span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">73</span>),</span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">60</span>),</span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true"></a>        };</span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true"></a>        <span class="kw">auto</span> act = Average(ts);</span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true"></a></span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true"></a>        ASSERT_EQ(act, exp);</span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true"></a>    }</span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="solid.html#SS_8_2">オープン・クローズドの原則(OCP)</a></li>
<li><a href="exercise_a.html#SS_20_8_2">解答例-OCP</a></li>
</ul>
<h3 id="演習-lsp">演習-LSP <a id="SS_19_8_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/lsp_test_score.h 8</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true"></a>    <span class="co">// 下記クラスTestScoreが管理するテストのスコアの値は、</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true"></a>    <span class="co">//      * 0～100   テストのスコア</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true"></a>    <span class="co">//      *-1        未受験</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true"></a>    <span class="co">//      * それ以外 不正値であるため、このデータを入力すると</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true"></a>    <span class="co">//                 std::out_of_rangeエクセプションが発生する。</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true"></a>    <span class="co">// を表すが、未受講を許可しない仕様(受験できない場合のスコアは0点)の</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true"></a>    <span class="co">// TestScoreForceも必要になったため下記のように定義した。</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true"></a>    <span class="co">//      * TestScoreForceが管理するテストのスコアの値は</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true"></a>    <span class="co">//           * 0～100   テストのスコア</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true"></a>    <span class="co">//           * それ以外 不正値であるため、このデータを入力すると</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true"></a>    <span class="co">//                      std::out_of_rangeエクセプションが発生する。</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true"></a>    <span class="co">//      * それ以外の動作はTestScoreと同じ。</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true"></a>    <span class="co">//  これは、事前条件(「-1～100を受け入れる」から「0～100を受け入れる」)の強化であるため、</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true"></a>    <span class="co">//  LSPに反する。</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true"></a>    <span class="co">//  これにより起こる問題点を単体テストを用いて指摘せよ。</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true"></a>    <span class="co">// 上記問題を解決するため、クラスTestScoreForceFixedを作り単体テストを行え。</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true"></a>    <span class="kw">class</span> TestScore {</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true"></a>        TestScore()                            = <span class="cf">default</span>;</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true"></a>        <span class="kw">virtual</span> ~TestScore()                   = <span class="cf">default</span>;</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true"></a>        TestScore(TestScore <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore&amp;&amp;)      = <span class="cf">default</span>;</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true"></a></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreAll_t</span> = <span class="bu">std::</span>map&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreOne_t</span> = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true"></a></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true"></a>        <span class="dt">void</span>                        AddScore(<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score);</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; GetScore(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true"></a>        {</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">test_score_row_</span>.at(name);</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true"></a>        }</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator begin() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.begin(); }</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator end() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.end(); }</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、-1は未受験、それ以外は不正データ</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span>;</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>   <span class="va">test_score_row_</span>{};</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true"></a>    };</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true"></a></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true"></a>    <span class="kw">class</span> TestScoreForce : <span class="kw">public</span> TestScore {</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、それ以外は不正データ</span></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true"></a>    };</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true"></a>    <span class="bu">std::</span>string           ToString(TestScore <span class="at">const</span>&amp; ts);</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true"></a>    <span class="dt">void</span>                  LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename, TestScore&amp; test_score);</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true"></a>    <span class="dt">void</span>                  StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score);</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/lsp_test_score.cpp 10</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true"></a>    <span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt; parse_line(<span class="bu">std::</span>string <span class="at">const</span>&amp; line)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true"></a>    {</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> csv_sep = <span class="bu">std::</span>regex{<span class="st">R&quot;( *, *)&quot;</span>};</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true"></a>        <span class="kw">auto</span>       name    = <span class="bu">std::</span>string{};</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true"></a>        <span class="kw">auto</span>       score   = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true"></a>        <span class="kw">auto</span> end = <span class="bu">std::</span>sregex_token_iterator{};</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> it = <span class="bu">std::</span>sregex_token_iterator{line.begin(), line.end(), csv_sep, -<span class="dv">1</span>}; it != end;</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true"></a>             ++it) {</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true"></a>            <span class="cf">if</span> (name.length() == <span class="dv">0</span>) {</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true"></a>                name = *it;</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true"></a>            }</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true"></a>            <span class="cf">else</span> {</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true"></a>                <span class="kw">auto</span> s = <span class="bu">std::</span>stoi(*it);</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true"></a>                score.emplace_back(s);</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true"></a>            }</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true"></a>        }</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true"></a>        <span class="cf">return</span> {<span class="bu">std::</span>move(name), <span class="bu">std::</span>move(score)};</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true"></a>    }</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true"></a>    <span class="dt">bool</span> is_valid_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span> &lt;= score &amp;&amp; score &lt;= <span class="dv">100</span>; }</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true"></a>    <span class="dt">bool</span> not_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> score == -<span class="dv">1</span>; }</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true"></a>    {</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true"></a>        <span class="cf">if</span> (is_valid_score(score) || not_score(score)) {</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true"></a>        }</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true"></a></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true"></a>        <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true"></a>    }</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true"></a></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true"></a>    <span class="dt">void</span> TestScoreForce::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true"></a>    {</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true"></a>        <span class="cf">if</span> (is_valid_score(score)) {</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true"></a>        }</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true"></a></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true"></a>        <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true"></a>    }</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true"></a></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::AddScore(TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score)</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true"></a>    {</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true"></a>            validate_score(pair.second);</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true"></a>        }</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true"></a></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">test_score_row_</span>.size() == <span class="dv">0</span>) {</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[one_test_score[<span class="dv">0</span>].first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true"></a>        }</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true"></a>            pair.second.push_back(-<span class="dv">1</span>);</span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true"></a>        }</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true"></a></span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true"></a>        <span class="kw">auto</span> curr_test_count = <span class="va">test_score_row_</span>.begin()-&gt;second.size();</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true"></a></span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">test_score_row_</span>.find(pair.first) == <span class="va">test_score_row_</span>.end()) {</span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true"></a>                <span class="va">test_score_row_</span>[pair.first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;(curr_test_count, -<span class="dv">1</span>);</span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true"></a>            }</span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true"></a></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[pair.first].back() = pair.second;</span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true"></a>        }</span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true"></a>    }</span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true"></a></span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true"></a>    <span class="dt">void</span> LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename, TestScore&amp; test_score)</span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true"></a>    {</span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true"></a></span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true"></a>        <span class="kw">auto</span> test_score_raw = TestScore::<span class="dt">ScoreAll_t</span>{};</span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true"></a>        <span class="kw">auto</span> line           = <span class="bu">std::</span>string{};</span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true"></a>        <span class="cf">while</span> (<span class="bu">std::</span>getline(data, line)) {</span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true"></a>            <span class="co">// std::pair&lt;TestScore::ScoreAll_t::iterator, bool&gt;</span></span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true"></a>            <span class="kw">auto</span> ret = test_score_raw.insert(parse_line(line));</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true"></a>            <span class="ot">assert</span>(ret.second);</span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true"></a>        }</span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true"></a></span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true"></a>        <span class="kw">auto</span> one_test = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score_raw) {</span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true"></a>            one_test.emplace_back(<span class="bu">std::</span>make_pair(pair.first, <span class="dv">0</span>));</span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true"></a>        }</span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true"></a></span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> score_count = test_score_raw.begin()-&gt;second.size();</span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true"></a>        <span class="kw">auto</span>       ts          = TestScore{};</span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true"></a></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; i &lt; score_count; ++i) {</span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : one_test) {</span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true"></a>                pair.second = test_score_raw[pair.first][i];</span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true"></a>            }</span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true"></a>            ts.AddScore(one_test);</span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true"></a>        }</span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true"></a></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true"></a>        test_score = <span class="bu">std::</span>move(ts);</span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true"></a>    }</span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true"></a></span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true"></a>    <span class="dt">void</span> StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true"></a>    {</span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ofstream{filename};</span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true"></a>        <span class="kw">auto</span> ss   = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true"></a></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true"></a>            ss &lt;&lt; pair.first;</span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true"></a>                ss &lt;&lt; <span class="st">&quot;, &quot;</span> &lt;&lt; s;</span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true"></a>            }</span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true"></a>        }</span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true"></a></span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true"></a>        data &lt;&lt; ss.str();</span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true"></a>    }</span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true"></a></span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts)</span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true"></a>    {</span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true"></a>        <span class="kw">auto</span> ss = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true"></a></span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : ts) {</span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true"></a>            ss &lt;&lt; pair.first &lt;&lt; <span class="ch">&#39;:&#39;</span>;</span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true"></a>                ss &lt;&lt; <span class="ch">&#39; &#39;</span> &lt;&lt; s;</span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true"></a>            }</span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true"></a>        }</span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true"></a></span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true"></a>        <span class="cf">return</span> ss.str();</span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true"></a>    }</span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true"></a></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score)</span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true"></a>    {</span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true"></a>        <span class="kw">auto</span> ret = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true"></a></span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true"></a>            <span class="kw">auto</span> sum         = <span class="dv">0</span>;</span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true"></a>            <span class="kw">auto</span> valid_count = <span class="dv">0</span><span class="bu">U</span>;</span>
<span id="cb46-141"><a href="#cb46-141" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb46-142"><a href="#cb46-142" aria-hidden="true"></a>                <span class="cf">if</span> (is_valid_score(s)) {</span>
<span id="cb46-143"><a href="#cb46-143" aria-hidden="true"></a>                    sum += s;</span>
<span id="cb46-144"><a href="#cb46-144" aria-hidden="true"></a>                    ++valid_count;</span>
<span id="cb46-145"><a href="#cb46-145" aria-hidden="true"></a>                }</span>
<span id="cb46-146"><a href="#cb46-146" aria-hidden="true"></a>            }</span>
<span id="cb46-147"><a href="#cb46-147" aria-hidden="true"></a>            ret.emplace_back(<span class="bu">std::</span>make_pair(pair.first, valid_count == <span class="dv">0</span> ? -<span class="dv">1</span> : sum / valid_count));</span>
<span id="cb46-148"><a href="#cb46-148" aria-hidden="true"></a>        }</span>
<span id="cb46-149"><a href="#cb46-149" aria-hidden="true"></a></span>
<span id="cb46-150"><a href="#cb46-150" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb46-151"><a href="#cb46-151" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/lsp_test_score_ut.cpp 13</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a>    TEST_F(SolidLSP_Q, TestScore_LoadCSV)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a>    {</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a>        LoadCSV(<span class="va">test_score_org_</span>, ts);</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true"></a>        };</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true"></a>        <span class="kw">auto</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true"></a>    }</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true"></a>    <span class="bu">std::</span>string whole_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true"></a>    {</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true"></a>        <span class="kw">auto</span> ifs = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{ifs}, <span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{}};</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true"></a>    }</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true"></a>    TEST_F(SolidLSP_Q, TestScore_AddScore)</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true"></a>    {</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true"></a>        LoadCSV(<span class="va">test_score_org_</span>, ts);</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">70</span>),</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, -<span class="dv">1</span>),</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, <span class="dv">100</span>),</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, <span class="dv">90</span>),</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true"></a>        };</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true"></a></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true"></a>        ts.AddScore(one_score);</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true"></a></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">50</span>}),</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">40</span>}),</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">70</span>}),</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">1</span>}),</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>, -<span class="dv">1</span>}),</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">5</span>}),</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">100</span>}),</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">90</span>}),</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true"></a>        };</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true"></a></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score_err = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;野村&quot;</span>, -<span class="dv">2</span>),</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;衣笠&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true"></a>        };</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true"></a></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true"></a>        <span class="co">// 不正データロード</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true"></a>        ASSERT_THROW(ts.AddScore(one_score_err), <span class="bu">std::</span>out_of_range);</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true"></a></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true"></a>    }</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true"></a></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true"></a>    TEST_F(SolidLSP_Q, TestScore_GetScore)</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true"></a>    {</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true"></a>        LoadCSV(<span class="va">test_score_org_</span>, ts);</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true"></a></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_0 = ts.GetScore(<span class="st">&quot;堂林&quot;</span>);</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}), score_0);</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true"></a></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_1 = ts.GetScore(<span class="st">&quot;広輔&quot;</span>);</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}), score_1);</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true"></a></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_2 = ts.GetScore(<span class="st">&quot;會澤&quot;</span>);</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}), score_2);</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true"></a></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_3 = ts.GetScore(<span class="st">&quot;松山&quot;</span>);</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}), score_3);</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true"></a></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_4 = ts.GetScore(<span class="st">&quot;菊池&quot;</span>);</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}), score_4);</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true"></a></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_5 = ts.GetScore(<span class="st">&quot;鈴木&quot;</span>);</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}), score_5);</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true"></a></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true"></a>        ASSERT_THROW(ts.GetScore(<span class="st">&quot;西川&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true"></a>    }</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true"></a>    TEST_F(SolidLSP_Q, TestScore_StoreCSV)</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true"></a>    {</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true"></a>        LoadCSV(<span class="va">test_score_org_</span>, ts);</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true"></a>        StoreCSV(ts, <span class="va">test_score_act_</span>);</span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true"></a></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true"></a>        <span class="kw">auto</span> content_act = whole_file(<span class="va">test_score_act_</span>);</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true"></a>        <span class="kw">auto</span> content_exp = whole_file(<span class="va">test_score_exp_</span>);</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true"></a></span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true"></a>        ASSERT_EQ(content_exp, content_act);</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true"></a></span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true"></a>        <span class="co">// 不正ファイルロード</span></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true"></a>        ASSERT_THROW(LoadCSV(<span class="va">test_score_exp_err_</span>, ts2), <span class="bu">std::</span>out_of_range);</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true"></a></span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true"></a>    }</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true"></a></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true"></a>    TEST_F(SolidLSP_Q, TestScore_Average)</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true"></a>    {</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true"></a>        <span class="kw">auto</span> ts = TestScore{};</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true"></a>        LoadCSV(<span class="va">test_score_org_</span>, ts);</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">65</span>),</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">26</span>),</span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">53</span>),</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">73</span>),</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">60</span>),</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true"></a>        };</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true"></a>        <span class="kw">auto</span> act = Average(ts);</span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true"></a></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true"></a>        ASSERT_EQ(act, exp);</span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true"></a>    }</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="solid.html#SS_8_3">リスコフの置換原則(LSP)</a></li>
<li><a href="exercise_a.html#SS_20_8_3">解答例-LSP</a></li>
</ul>
<h3 id="演習-isp">演習-ISP <a id="SS_19_8_4"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/isp_test_score.h 8</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true"></a>    <span class="co">// 下記クラスTestScoreの管理データの内、受験者とその平均スコア、</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true"></a>    <span class="co">// 平均スコアの高い順でソートされた受験者リストを扱うクラスが必要になったため、</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true"></a>    <span class="co">// 下記のようにイミュータブルなクラスTestScoreAverageを作成した。</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true"></a>    <span class="co">// 現在のファイル構成では、TestScoreAverageのみを使うクラスや関数にも、</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true"></a>    <span class="co">// このファイル全体への依存を強いる(つまり、TestScoreやLoadCSV等に依存させる)ため、</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true"></a>    <span class="co">// ISPに反する。</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true"></a>    <span class="co">// TestScoreAverageを使うクラスや関数に余計な依存関係が発生しないようにリファクタリングを</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true"></a>    <span class="co">// 行え。</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true"></a>    <span class="kw">class</span> TestScore {</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true"></a>        TestScore()                            = <span class="cf">default</span>;</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true"></a>        TestScore(TestScore <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore&amp;&amp;)      = <span class="cf">default</span>;</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreAll_t</span> = <span class="bu">std::</span>map&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreOne_t</span> = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true"></a>        <span class="dt">void</span>                        AddScore(<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score);</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; GetScore(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true"></a>        {</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">test_score_row_</span>.at(name);</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true"></a>        }</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator begin() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.begin(); }</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator end() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.end(); }</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、-1は未受験、それ以外は不正データ</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true"></a>        <span class="dt">void</span>       validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span>;</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span> <span class="va">test_score_row_</span>{};</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true"></a>    };</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true"></a>    <span class="bu">std::</span>string           ToString(TestScore <span class="at">const</span>&amp; ts);</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true"></a>    TestScore             LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true"></a>    <span class="dt">void</span>                  StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score);</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true"></a></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true"></a>    <span class="kw">class</span> TestScoreAverage {</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true"></a>        <span class="kw">explicit</span> TestScoreAverage(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true"></a>        <span class="dt">uint32_t</span>                        GetAverage(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span>;</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="at">const</span>&amp; DescendingOrder() <span class="at">const</span>;</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true"></a></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true"></a>        TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>      <span class="va">average_</span>;</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true"></a>        <span class="at">mutable</span> <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="va">desending_order_</span>{};</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true"></a>    };</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/isp_test_score.cpp 10</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a>    <span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt; parse_line(<span class="bu">std::</span>string <span class="at">const</span>&amp; line)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a>    {</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> csv_sep = <span class="bu">std::</span>regex{<span class="st">R&quot;( *, *)&quot;</span>};</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a>        <span class="kw">auto</span>       name    = <span class="bu">std::</span>string{};</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a>        <span class="kw">auto</span>       score   = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true"></a>        <span class="kw">auto</span> end = <span class="bu">std::</span>sregex_token_iterator{};</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> it = <span class="bu">std::</span>sregex_token_iterator{line.begin(), line.end(), csv_sep, -<span class="dv">1</span>}; it != end;</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true"></a>             ++it) {</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true"></a>            <span class="cf">if</span> (name.length() == <span class="dv">0</span>) {</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true"></a>                name = *it;</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true"></a>            }</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true"></a>            <span class="cf">else</span> {</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true"></a>                <span class="kw">auto</span> s = <span class="bu">std::</span>stoi(*it);</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true"></a>                score.emplace_back(s);</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true"></a>            }</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true"></a>        }</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true"></a>        <span class="cf">return</span> {<span class="bu">std::</span>move(name), <span class="bu">std::</span>move(score)};</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true"></a>    }</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true"></a>    <span class="dt">bool</span> is_valid_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span> &lt;= score &amp;&amp; score &lt;= <span class="dv">100</span>; }</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true"></a>    <span class="dt">bool</span> not_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> score == -<span class="dv">1</span>; }</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true"></a></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true"></a>    {</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true"></a>        <span class="cf">if</span> (is_valid_score(score) || not_score(score)) {</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true"></a>        }</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true"></a>        <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true"></a>    }</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true"></a></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::AddScore(TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true"></a>    {</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true"></a>            validate_score(pair.second);</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true"></a>        }</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true"></a></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">test_score_row_</span>.size() == <span class="dv">0</span>) {</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[one_test_score[<span class="dv">0</span>].first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true"></a>        }</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true"></a>            pair.second.push_back(-<span class="dv">1</span>);</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true"></a>        }</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true"></a>        <span class="kw">auto</span> curr_test_count = <span class="va">test_score_row_</span>.begin()-&gt;second.size();</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true"></a></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">test_score_row_</span>.find(pair.first) == <span class="va">test_score_row_</span>.end()) {</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true"></a>                <span class="va">test_score_row_</span>[pair.first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;(curr_test_count, -<span class="dv">1</span>);</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true"></a>            }</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true"></a></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[pair.first].back() = pair.second;</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true"></a>        }</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true"></a>    }</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true"></a></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true"></a>    TestScore LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true"></a>    {</span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true"></a></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true"></a>        <span class="kw">auto</span> test_score_raw = TestScore::<span class="dt">ScoreAll_t</span>{};</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true"></a>        <span class="kw">auto</span> line           = <span class="bu">std::</span>string{};</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true"></a>        <span class="cf">while</span> (<span class="bu">std::</span>getline(data, line)) {</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true"></a>            <span class="co">// std::pair&lt;TestScore::ScoreAll_t::iterator, bool&gt;</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true"></a>            <span class="kw">auto</span> ret = test_score_raw.insert(parse_line(line));</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true"></a>            <span class="ot">assert</span>(ret.second);</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true"></a>        }</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true"></a></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true"></a>        <span class="kw">auto</span> one_test = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score_raw) {</span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true"></a>            one_test.emplace_back(<span class="bu">std::</span>make_pair(pair.first, <span class="dv">0</span>));</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true"></a>        }</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true"></a></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> score_count = test_score_raw.begin()-&gt;second.size();</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true"></a>        <span class="kw">auto</span>       ts          = TestScore{};</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true"></a></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; i &lt; score_count; ++i) {</span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : one_test) {</span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true"></a>                pair.second = test_score_raw[pair.first][i];</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true"></a>            }</span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true"></a>            ts.AddScore(one_test);</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true"></a>        }</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true"></a></span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true"></a>        <span class="cf">return</span> ts;</span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true"></a>    }</span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true"></a></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true"></a>    <span class="dt">void</span> StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true"></a>    {</span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ofstream{filename};</span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true"></a>        <span class="kw">auto</span> ss   = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true"></a></span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true"></a>            ss &lt;&lt; pair.first;</span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true"></a>                ss &lt;&lt; <span class="st">&quot;, &quot;</span> &lt;&lt; s;</span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true"></a>            }</span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true"></a>        }</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true"></a></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true"></a>        data &lt;&lt; ss.str();</span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true"></a>    }</span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true"></a></span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts)</span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true"></a>    {</span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true"></a>        <span class="kw">auto</span> ss = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true"></a></span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : ts) {</span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true"></a>            ss &lt;&lt; pair.first &lt;&lt; <span class="ch">&#39;:&#39;</span>;</span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true"></a>                ss &lt;&lt; <span class="ch">&#39; &#39;</span> &lt;&lt; s;</span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true"></a>            }</span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true"></a>        }</span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true"></a></span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true"></a>        <span class="cf">return</span> ss.str();</span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true"></a>    }</span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true"></a></span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score)</span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true"></a>    {</span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true"></a>        <span class="kw">auto</span> ret = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true"></a></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true"></a>            <span class="kw">auto</span> sum         = <span class="dv">0</span>;</span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true"></a>            <span class="kw">auto</span> valid_count = <span class="dv">0</span><span class="bu">U</span>;</span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true"></a>                <span class="cf">if</span> (is_valid_score(s)) {</span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true"></a>                    sum += s;</span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true"></a>                    ++valid_count;</span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true"></a>                }</span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true"></a>            }</span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true"></a>            ret.emplace_back(<span class="bu">std::</span>make_pair(pair.first, valid_count == <span class="dv">0</span> ? -<span class="dv">1</span> : sum / valid_count));</span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true"></a>        }</span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true"></a></span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true"></a>    }</span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true"></a></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> get_average(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true"></a>    {</span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true"></a>        TestScore ts = LoadCSV(filename);</span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true"></a></span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true"></a>        <span class="cf">return</span> Average(ts);</span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true"></a>    }</span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true"></a></span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true"></a>    TestScoreAverage::TestScoreAverage(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename) : <span class="va">average_</span>{get_average(filename)} {}</span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true"></a></span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true"></a>    <span class="dt">uint32_t</span> TestScoreAverage::GetAverage(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true"></a>    {</span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true"></a>        <span class="kw">auto</span> pos = <span class="bu">std::</span>find_if(<span class="va">average_</span>.cbegin(), <span class="va">average_</span>.cend(),</span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true"></a>                                [&amp;name](<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; pair) <span class="kw">noexcept</span> {</span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true"></a>                                    <span class="cf">return</span> name == pair.first;</span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true"></a>                                });</span>
<span id="cb49-161"><a href="#cb49-161" aria-hidden="true"></a></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true"></a>        <span class="cf">if</span> (pos == <span class="va">average_</span>.cend()) {</span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true"></a>            <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;no member&quot;</span>};</span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true"></a>        }</span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true"></a></span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true"></a>        <span class="cf">return</span> pos-&gt;second;</span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true"></a>    }</span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true"></a></span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; <span class="at">const</span>&amp; TestScoreAverage::DescendingOrder() <span class="at">const</span></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true"></a>    {</span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">desending_order_</span>.size() != <span class="dv">0</span>) {</span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">desending_order_</span>;</span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true"></a>        }</span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true"></a></span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true"></a>        <span class="kw">auto</span> ave = <span class="va">average_</span>;</span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true"></a>        <span class="bu">std::</span>sort(ave.begin(), ave.end(),</span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true"></a>                  [](<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; lhs, <span class="kw">auto</span> <span class="at">const</span>&amp; rhs) <span class="kw">noexcept</span> {</span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true"></a>                      <span class="cf">return</span> lhs.second &gt; rhs.second;</span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true"></a>                  });</span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true"></a></span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : ave) {</span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true"></a>            <span class="va">desending_order_</span>.emplace_back(<span class="bu">std::</span>move(pair.first));</span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true"></a>        }</span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true"></a></span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">desending_order_</span>;</span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/isp_test_score_ut.cpp 13</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScore_LoadCSV)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true"></a>    {</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true"></a>        };</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true"></a>        <span class="kw">auto</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true"></a>    }</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true"></a></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true"></a>    <span class="bu">std::</span>string whole_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true"></a>    {</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true"></a>        <span class="kw">auto</span> ifs = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{ifs}, <span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{}};</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true"></a>    }</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true"></a></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScore_AddScore)</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true"></a>    {</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true"></a></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">70</span>),</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, -<span class="dv">1</span>),</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, <span class="dv">100</span>),</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, <span class="dv">90</span>),</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true"></a>        };</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true"></a></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true"></a>        ts.AddScore(one_score);</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true"></a></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">50</span>}),</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">40</span>}),</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">70</span>}),</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">1</span>}),</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>, -<span class="dv">1</span>}),</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">5</span>}),</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">100</span>}),</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">90</span>}),</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true"></a>        };</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true"></a></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true"></a></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score_err = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;野村&quot;</span>, -<span class="dv">2</span>),</span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;衣笠&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true"></a>        };</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true"></a></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true"></a>        <span class="co">// 不正データロード</span></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true"></a>        ASSERT_THROW(ts.AddScore(one_score_err), <span class="bu">std::</span>out_of_range);</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true"></a></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true"></a>    }</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true"></a></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScore_GetScore)</span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true"></a>    {</span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true"></a></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_0 = ts.GetScore(<span class="st">&quot;堂林&quot;</span>);</span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}), score_0);</span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true"></a></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_1 = ts.GetScore(<span class="st">&quot;広輔&quot;</span>);</span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}), score_1);</span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true"></a></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_2 = ts.GetScore(<span class="st">&quot;會澤&quot;</span>);</span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}), score_2);</span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true"></a></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_3 = ts.GetScore(<span class="st">&quot;松山&quot;</span>);</span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}), score_3);</span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true"></a></span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_4 = ts.GetScore(<span class="st">&quot;菊池&quot;</span>);</span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}), score_4);</span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true"></a></span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_5 = ts.GetScore(<span class="st">&quot;鈴木&quot;</span>);</span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}), score_5);</span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true"></a></span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true"></a>        ASSERT_THROW(ts.GetScore(<span class="st">&quot;西川&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true"></a>    }</span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true"></a></span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScore_StoreCSV)</span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true"></a>    {</span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb50-104"><a href="#cb50-104" aria-hidden="true"></a>        StoreCSV(ts, <span class="va">test_score_act_</span>);</span>
<span id="cb50-105"><a href="#cb50-105" aria-hidden="true"></a></span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true"></a>        <span class="kw">auto</span> content_act = whole_file(<span class="va">test_score_act_</span>);</span>
<span id="cb50-107"><a href="#cb50-107" aria-hidden="true"></a>        <span class="kw">auto</span> content_exp = whole_file(<span class="va">test_score_exp_</span>);</span>
<span id="cb50-108"><a href="#cb50-108" aria-hidden="true"></a></span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true"></a>        ASSERT_EQ(content_exp, content_act);</span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true"></a></span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true"></a>        <span class="co">// 不正ファイルロード</span></span>
<span id="cb50-112"><a href="#cb50-112" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb50-113"><a href="#cb50-113" aria-hidden="true"></a>        ASSERT_THROW(ts2 = LoadCSV(<span class="va">test_score_exp_err_</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb50-114"><a href="#cb50-114" aria-hidden="true"></a></span>
<span id="cb50-115"><a href="#cb50-115" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb50-116"><a href="#cb50-116" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb50-117"><a href="#cb50-117" aria-hidden="true"></a>    }</span>
<span id="cb50-118"><a href="#cb50-118" aria-hidden="true"></a></span>
<span id="cb50-119"><a href="#cb50-119" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScore_Average)</span>
<span id="cb50-120"><a href="#cb50-120" aria-hidden="true"></a>    {</span>
<span id="cb50-121"><a href="#cb50-121" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb50-122"><a href="#cb50-122" aria-hidden="true"></a></span>
<span id="cb50-123"><a href="#cb50-123" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb50-124"><a href="#cb50-124" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">65</span>),</span>
<span id="cb50-125"><a href="#cb50-125" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">26</span>),</span>
<span id="cb50-126"><a href="#cb50-126" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">53</span>),</span>
<span id="cb50-127"><a href="#cb50-127" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">73</span>),</span>
<span id="cb50-128"><a href="#cb50-128" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb50-129"><a href="#cb50-129" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">60</span>),</span>
<span id="cb50-130"><a href="#cb50-130" aria-hidden="true"></a>        };</span>
<span id="cb50-131"><a href="#cb50-131" aria-hidden="true"></a>        <span class="kw">auto</span> act = Average(ts);</span>
<span id="cb50-132"><a href="#cb50-132" aria-hidden="true"></a></span>
<span id="cb50-133"><a href="#cb50-133" aria-hidden="true"></a>        ASSERT_EQ(act, exp);</span>
<span id="cb50-134"><a href="#cb50-134" aria-hidden="true"></a>    }</span>
<span id="cb50-135"><a href="#cb50-135" aria-hidden="true"></a></span>
<span id="cb50-136"><a href="#cb50-136" aria-hidden="true"></a>    TEST_F(SolidISP_Q, TestScoreAverage)</span>
<span id="cb50-137"><a href="#cb50-137" aria-hidden="true"></a>    {</span>
<span id="cb50-138"><a href="#cb50-138" aria-hidden="true"></a>        <span class="kw">auto</span> tsa = TestScoreAverage{<span class="va">test_score_org_</span>};</span>
<span id="cb50-139"><a href="#cb50-139" aria-hidden="true"></a></span>
<span id="cb50-140"><a href="#cb50-140" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;堂林&quot;</span>), <span class="dv">65</span>);</span>
<span id="cb50-141"><a href="#cb50-141" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;広輔&quot;</span>), <span class="dv">26</span>);</span>
<span id="cb50-142"><a href="#cb50-142" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;會澤&quot;</span>), <span class="dv">53</span>);</span>
<span id="cb50-143"><a href="#cb50-143" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;松山&quot;</span>), <span class="dv">73</span>);</span>
<span id="cb50-144"><a href="#cb50-144" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;菊池&quot;</span>), <span class="dv">50</span>);</span>
<span id="cb50-145"><a href="#cb50-145" aria-hidden="true"></a>        ASSERT_EQ(tsa.GetAverage(<span class="st">&quot;鈴木&quot;</span>), <span class="dv">60</span>);</span>
<span id="cb50-146"><a href="#cb50-146" aria-hidden="true"></a></span>
<span id="cb50-147"><a href="#cb50-147" aria-hidden="true"></a>        ASSERT_THROW(tsa.GetAverage(<span class="st">&quot;野村&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb50-148"><a href="#cb50-148" aria-hidden="true"></a></span>
<span id="cb50-149"><a href="#cb50-149" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{</span>
<span id="cb50-150"><a href="#cb50-150" aria-hidden="true"></a>            <span class="st">&quot;松山&quot;</span>, <span class="st">&quot;堂林&quot;</span>, <span class="st">&quot;鈴木&quot;</span>, <span class="st">&quot;會澤&quot;</span>, <span class="st">&quot;菊池&quot;</span>, <span class="st">&quot;広輔&quot;</span>,</span>
<span id="cb50-151"><a href="#cb50-151" aria-hidden="true"></a>        };</span>
<span id="cb50-152"><a href="#cb50-152" aria-hidden="true"></a></span>
<span id="cb50-153"><a href="#cb50-153" aria-hidden="true"></a>        ASSERT_EQ(tsa.DescendingOrder(), exp);</span>
<span id="cb50-154"><a href="#cb50-154" aria-hidden="true"></a>        ASSERT_EQ(tsa.DescendingOrder(), exp);  <span class="co">// キャッシュのテスト</span></span>
<span id="cb50-155"><a href="#cb50-155" aria-hidden="true"></a>    }</span>
<span id="cb50-156"><a href="#cb50-156" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="solid.html#SS_8_4">インターフェース分離の原則(ISP)</a></li>
<li><a href="exercise_a.html#SS_20_8_4">解答例-ISP</a></li>
</ul>
<h3 id="演習-dip">演習-DIP <a id="SS_19_8_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score.h 9</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a>    <span class="co">// クラスTestScoreClientは、</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a>    <span class="co">//      * dip_test_score_client.h</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a>    <span class="co">//      * dip_test_score_client.cpp</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true"></a>    <span class="co">// で宣言・定義され、</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true"></a>    <span class="co">// クラスTestScoreLoaderは、</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true"></a>    <span class="co">//      * dip_test_score.h(このファイル)</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true"></a>    <span class="co">//      * dip_test_score.cpp</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true"></a>    <span class="co">// で宣言・定義されされている。</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true"></a>    <span class="co">// TestScoreLoaderは宣言・定義の中にTestScoreClientを使用しているため、</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true"></a>    <span class="co">//      * dip_test_score.cpp -&gt; dip_test_score_client.h</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true"></a>    <span class="co">// の依存関係が発生してる(dip_test_score.h -&gt; dip_test_score_client.hの依存関係は、</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true"></a>    <span class="co">// dip_test_score.h内のTestScoreClientの前方宣言で回避)。</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true"></a>    <span class="co">// クラスの名前からもわかる通り、</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true"></a>    <span class="co">//      * TestScoreClientはTestScoreLoaderのクライアント</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true"></a>    <span class="co">//      * TestScoreLoaderはTestScoreClientのサーバ</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true"></a>    <span class="co">// であるため、この依存関係</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true"></a>    <span class="co">//      * TestScoreLoader -&gt; TestScoreClient(逆の依存関係もあるため、双方向依存)</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true"></a>    <span class="co">//      * dip_test_score.cpp -&gt; dip_test_score_client.h</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true"></a>    <span class="co">// はDIPに反し、機能拡張(や、場合よっては単体テスト可能なパッケージ構成維持)</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true"></a>    <span class="co">// に多大な悪影響がある(TestScoreLoaderを使うTestScoreClient2を新たに定義したときに</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true"></a>    <span class="co">// TestScoreLoaderがどのように修正されるかを考えればこの問題に気づくだろう)。</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true"></a>    <span class="co">// この問題に対処せよ。</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true"></a>    <span class="kw">class</span> TestScore {</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true"></a>        TestScore()                            = <span class="cf">default</span>;</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true"></a>        TestScore(TestScore <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true"></a>        TestScore&amp; <span class="kw">operator</span>=(TestScore&amp;&amp;)      = <span class="cf">default</span>;</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true"></a></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreAll_t</span> = <span class="bu">std::</span>map&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true"></a>        <span class="kw">using</span> <span class="dt">ScoreOne_t</span> = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="dt">int32_t</span>&gt;&gt;;</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true"></a>        <span class="dt">void</span>                        AddScore(<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score);</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt; <span class="at">const</span>&amp; GetScore(<span class="bu">std::</span>string <span class="at">const</span>&amp; name) <span class="at">const</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true"></a>        {</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">test_score_row_</span>.at(name);</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true"></a>        }</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true"></a></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator begin() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.begin(); }</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span>::const_iterator end() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_row_</span>.end(); }</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true"></a></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true"></a>        <span class="co">// int32_t score: 0～100はスコア、-1は未受験、それ以外は不正データ</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true"></a>        <span class="dt">void</span>       validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span>;</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true"></a>        <span class="dt">ScoreAll_t</span> <span class="va">test_score_row_</span>{};</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true"></a>    };</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true"></a></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true"></a>    <span class="bu">std::</span>string           ToString(TestScore <span class="at">const</span>&amp; ts);</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true"></a>    TestScore             LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true"></a>    <span class="dt">void</span>                  StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename);</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score);</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true"></a></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true"></a>    <span class="kw">class</span> TestScoreClient;</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true"></a>    <span class="kw">class</span> TestScoreLoader {</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true"></a>        TestScoreLoader() {}</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true"></a>        ~TestScoreLoader();</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true"></a>        <span class="dt">void</span>      LoadCSV_Async(<span class="bu">std::</span>string&amp;&amp; filename, TestScoreClient&amp; client);</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true"></a>        TestScore LoadCSV_Get() { <span class="cf">return</span> <span class="va">future_</span>.get(); }</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true"></a></span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true"></a>        <span class="bu">std::</span>future&lt;TestScore&gt; <span class="va">future_</span>{};</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true"></a>    };</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score.cpp 11</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true"></a>    <span class="bu">std::</span>pair&lt;<span class="bu">std::</span>string, <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;&gt; parse_line(<span class="bu">std::</span>string <span class="at">const</span>&amp; line)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true"></a>    {</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> csv_sep = <span class="bu">std::</span>regex{<span class="st">R&quot;( *, *)&quot;</span>};</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true"></a>        <span class="kw">auto</span>       name    = <span class="bu">std::</span>string{};</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true"></a>        <span class="kw">auto</span>       score   = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true"></a>        <span class="kw">auto</span> end = <span class="bu">std::</span>sregex_token_iterator{};</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> it = <span class="bu">std::</span>sregex_token_iterator{line.begin(), line.end(), csv_sep, -<span class="dv">1</span>}; it != end;</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true"></a>             ++it) {</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true"></a>            <span class="cf">if</span> (name.length() == <span class="dv">0</span>) {</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true"></a>                name = *it;</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true"></a>            }</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true"></a>            <span class="cf">else</span> {</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true"></a>                <span class="kw">auto</span> s = <span class="bu">std::</span>stoi(*it);</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true"></a>                score.emplace_back(s);</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true"></a>            }</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true"></a>        }</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true"></a>        <span class="cf">return</span> {<span class="bu">std::</span>move(name), <span class="bu">std::</span>move(score)};</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true"></a>    }</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true"></a>    <span class="dt">bool</span> is_valid_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="dv">0</span> &lt;= score &amp;&amp; score &lt;= <span class="dv">100</span>; }</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true"></a>    <span class="dt">bool</span> not_score(<span class="dt">int32_t</span> score) <span class="kw">noexcept</span> { <span class="cf">return</span> score == -<span class="dv">1</span>; }</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::validate_score(<span class="dt">int32_t</span> score) <span class="at">const</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true"></a>    {</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true"></a>        <span class="cf">if</span> (is_valid_score(score) || not_score(score)) {</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true"></a>        }</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true"></a>        <span class="cf">throw</span> <span class="bu">std::</span>out_of_range{<span class="st">&quot;Invalid Score&quot;</span>};</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true"></a>    }</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true"></a></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true"></a>    <span class="dt">void</span> TestScore::AddScore(TestScore::<span class="dt">ScoreOne_t</span> <span class="at">const</span>&amp; one_test_score)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true"></a>    {</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true"></a>            validate_score(pair.second);</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true"></a>        }</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true"></a></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">test_score_row_</span>.size() == <span class="dv">0</span>) {</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[one_test_score[<span class="dv">0</span>].first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;{};</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true"></a>        }</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : <span class="va">test_score_row_</span>) {</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true"></a>            pair.second.push_back(-<span class="dv">1</span>);</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true"></a>        }</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true"></a>        <span class="kw">auto</span> curr_test_count = <span class="va">test_score_row_</span>.begin()-&gt;second.size();</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true"></a></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : one_test_score) {</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">test_score_row_</span>.find(pair.first) == <span class="va">test_score_row_</span>.end()) {</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true"></a>                <span class="va">test_score_row_</span>[pair.first] = <span class="bu">std::</span>vector&lt;<span class="dt">int32_t</span>&gt;(curr_test_count, -<span class="dv">1</span>);</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true"></a>            }</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true"></a>            <span class="va">test_score_row_</span>[pair.first].back() = pair.second;</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true"></a>        }</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true"></a>    }</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true"></a></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true"></a>    TestScore LoadCSV(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true"></a>    {</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true"></a></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true"></a>        <span class="kw">auto</span> test_score_raw = TestScore::<span class="dt">ScoreAll_t</span>{};</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true"></a>        <span class="kw">auto</span> line           = <span class="bu">std::</span>string{};</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true"></a>        <span class="cf">while</span> (<span class="bu">std::</span>getline(data, line)) {</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true"></a>            <span class="co">// std::pair&lt;TestScore::ScoreAll_t::iterator, bool&gt;</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true"></a>            <span class="kw">auto</span> ret = test_score_raw.insert(parse_line(line));</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true"></a>            <span class="ot">assert</span>(ret.second);</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true"></a>        }</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true"></a></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true"></a>        <span class="kw">auto</span> one_test = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score_raw) {</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true"></a>            one_test.emplace_back(<span class="bu">std::</span>make_pair(pair.first, <span class="dv">0</span>));</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true"></a>        }</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true"></a></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> score_count = test_score_raw.begin()-&gt;second.size();</span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true"></a>        <span class="kw">auto</span>       ts          = TestScore{};</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true"></a></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">0</span><span class="bu">U</span>; i &lt; score_count; ++i) {</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span>&amp; pair : one_test) {</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true"></a>                pair.second = test_score_raw[pair.first][i];</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true"></a>            }</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true"></a>            ts.AddScore(one_test);</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true"></a>        }</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true"></a></span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true"></a>        <span class="cf">return</span> ts;</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true"></a>    }</span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true"></a></span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true"></a>    <span class="dt">void</span> StoreCSV(TestScore <span class="at">const</span>&amp; test_score, <span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true"></a>    {</span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true"></a>        <span class="kw">auto</span> data = <span class="bu">std::</span>ofstream{filename};</span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true"></a>        <span class="kw">auto</span> ss   = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true"></a></span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true"></a>            ss &lt;&lt; pair.first;</span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true"></a>                ss &lt;&lt; <span class="st">&quot;, &quot;</span> &lt;&lt; s;</span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true"></a>            }</span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true"></a>        }</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true"></a></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true"></a>        data &lt;&lt; ss.str();</span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true"></a>    }</span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true"></a></span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true"></a>    <span class="bu">std::</span>string ToString(TestScore <span class="at">const</span>&amp; ts)</span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true"></a>    {</span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true"></a>        <span class="kw">auto</span> ss = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true"></a></span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : ts) {</span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true"></a>            ss &lt;&lt; pair.first &lt;&lt; <span class="ch">&#39;:&#39;</span>;</span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true"></a>                ss &lt;&lt; <span class="ch">&#39; &#39;</span> &lt;&lt; s;</span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true"></a>            }</span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true"></a>            ss &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true"></a>        }</span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true"></a></span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true"></a>        <span class="cf">return</span> ss.str();</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true"></a>    }</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true"></a></span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true"></a>    TestScore::<span class="dt">ScoreOne_t</span> Average(TestScore <span class="at">const</span>&amp; test_score)</span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true"></a>    {</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true"></a>        <span class="kw">auto</span> ret = TestScore::<span class="dt">ScoreOne_t</span>{};</span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true"></a></span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; pair : test_score) {</span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true"></a>            <span class="kw">auto</span> sum         = <span class="dv">0</span>;</span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true"></a>            <span class="kw">auto</span> valid_count = <span class="dv">0</span><span class="bu">U</span>;</span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span> s : pair.second) {</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true"></a>                <span class="cf">if</span> (is_valid_score(s)) {</span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true"></a>                    sum += s;</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true"></a>                    ++valid_count;</span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true"></a>                }</span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true"></a>            }</span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true"></a>            ret.emplace_back(<span class="bu">std::</span>make_pair(pair.first, valid_count == <span class="dv">0</span> ? -<span class="dv">1</span> : sum / valid_count));</span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true"></a>        }</span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true"></a></span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true"></a>    }</span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true"></a></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true"></a>    TestScoreLoader::~TestScoreLoader()</span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true"></a>    {</span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">future_</span>.valid()) {</span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true"></a>            <span class="va">future_</span>.get();</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true"></a>        }</span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true"></a>    }</span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true"></a></span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true"></a>    <span class="dt">void</span> TestScoreLoader::LoadCSV_Async(<span class="bu">std::</span>string&amp;&amp; filename, TestScoreClient&amp; client)</span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true"></a>    {</span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">future_</span>.valid()) {</span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true"></a>            <span class="va">future_</span>.get();</span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true"></a>        }</span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true"></a></span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true"></a>        <span class="va">future_</span> = <span class="bu">std::</span>async(<span class="bu">std::</span>launch<span class="bu">::</span>async, [&amp;client, filename = <span class="bu">std::</span>move(filename)]() {</span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true"></a>            <span class="kw">auto</span> test_score = LoadCSV(filename);</span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true"></a>            client.Done();</span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true"></a>            <span class="cf">return</span> test_score;</span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true"></a>        });</span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score_ut.cpp 13</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestScore_LoadCSV)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true"></a>    {</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true"></a>        };</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true"></a>        <span class="kw">auto</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true"></a>    }</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true"></a>    <span class="bu">std::</span>string whole_file(<span class="bu">std::</span>string <span class="at">const</span>&amp; filename)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true"></a>    {</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true"></a>        <span class="kw">auto</span> ifs = <span class="bu">std::</span>ifstream{filename};</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true"></a></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{ifs}, <span class="bu">std::</span>istreambuf_iterator&lt;<span class="dt">char</span>&gt;{}};</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true"></a>    }</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true"></a></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestScore_AddScore)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true"></a>    {</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true"></a></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">70</span>),</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, -<span class="dv">1</span>),</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, <span class="dv">100</span>),</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, <span class="dv">90</span>),</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true"></a>        };</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true"></a></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true"></a>        ts.AddScore(one_score);</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true"></a></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">50</span>}),</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">40</span>}),</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">70</span>}),</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">1</span>}),</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>, -<span class="dv">1</span>}),</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">5</span>}),</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;田中&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">100</span>}),</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;西川&quot;</span>, {-<span class="dv">1</span>, -<span class="dv">1</span>, -<span class="dv">1</span>, <span class="dv">90</span>}),</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true"></a>        };</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true"></a></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> one_score_err = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;野村&quot;</span>, -<span class="dv">2</span>),</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;衣笠&quot;</span>, <span class="dv">40</span>),</span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true"></a>        };</span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true"></a></span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true"></a>        <span class="co">// 不正データロード</span></span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true"></a>        ASSERT_THROW(ts.AddScore(one_score_err), <span class="bu">std::</span>out_of_range);</span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true"></a></span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true"></a>    }</span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true"></a></span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestScore_GetScore)</span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true"></a>    {</span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true"></a></span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_0 = ts.GetScore(<span class="st">&quot;堂林&quot;</span>);</span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}), score_0);</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true"></a></span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_1 = ts.GetScore(<span class="st">&quot;広輔&quot;</span>);</span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}), score_1);</span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true"></a></span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_2 = ts.GetScore(<span class="st">&quot;會澤&quot;</span>);</span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}), score_2);</span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true"></a></span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_3 = ts.GetScore(<span class="st">&quot;松山&quot;</span>);</span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}), score_3);</span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true"></a></span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_4 = ts.GetScore(<span class="st">&quot;菊池&quot;</span>);</span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}), score_4);</span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true"></a></span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; score_5 = ts.GetScore(<span class="st">&quot;鈴木&quot;</span>);</span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector{<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}), score_5);</span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true"></a></span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true"></a>        ASSERT_THROW(ts.GetScore(<span class="st">&quot;西川&quot;</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true"></a>    }</span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true"></a></span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestScore_StoreCSV)</span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true"></a>    {</span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true"></a>        StoreCSV(ts, <span class="va">test_score_act_</span>);</span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true"></a></span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true"></a>        <span class="kw">auto</span> content_act = whole_file(<span class="va">test_score_act_</span>);</span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true"></a>        <span class="kw">auto</span> content_exp = whole_file(<span class="va">test_score_exp_</span>);</span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true"></a></span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true"></a>        ASSERT_EQ(content_exp, content_act);</span>
<span id="cb53-110"><a href="#cb53-110" aria-hidden="true"></a></span>
<span id="cb53-111"><a href="#cb53-111" aria-hidden="true"></a>        <span class="co">// 不正ファイルロード</span></span>
<span id="cb53-112"><a href="#cb53-112" aria-hidden="true"></a>        <span class="kw">auto</span> ts2 = ts;</span>
<span id="cb53-113"><a href="#cb53-113" aria-hidden="true"></a>        ASSERT_THROW(ts2 = LoadCSV(<span class="va">test_score_exp_err_</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb53-114"><a href="#cb53-114" aria-hidden="true"></a></span>
<span id="cb53-115"><a href="#cb53-115" aria-hidden="true"></a>        <span class="co">// エクセプション 強い保証</span></span>
<span id="cb53-116"><a href="#cb53-116" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), ts2.begin()));</span>
<span id="cb53-117"><a href="#cb53-117" aria-hidden="true"></a>    }</span>
<span id="cb53-118"><a href="#cb53-118" aria-hidden="true"></a></span>
<span id="cb53-119"><a href="#cb53-119" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestScore_Average)</span>
<span id="cb53-120"><a href="#cb53-120" aria-hidden="true"></a>    {</span>
<span id="cb53-121"><a href="#cb53-121" aria-hidden="true"></a>        TestScore ts = LoadCSV(<span class="va">test_score_org_</span>);</span>
<span id="cb53-122"><a href="#cb53-122" aria-hidden="true"></a></span>
<span id="cb53-123"><a href="#cb53-123" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreOne_t</span>{</span>
<span id="cb53-124"><a href="#cb53-124" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, <span class="dv">65</span>),</span>
<span id="cb53-125"><a href="#cb53-125" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, <span class="dv">26</span>),</span>
<span id="cb53-126"><a href="#cb53-126" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, <span class="dv">53</span>),</span>
<span id="cb53-127"><a href="#cb53-127" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, <span class="dv">73</span>),</span>
<span id="cb53-128"><a href="#cb53-128" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, <span class="dv">50</span>),</span>
<span id="cb53-129"><a href="#cb53-129" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreOne_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, <span class="dv">60</span>),</span>
<span id="cb53-130"><a href="#cb53-130" aria-hidden="true"></a>        };</span>
<span id="cb53-131"><a href="#cb53-131" aria-hidden="true"></a>        <span class="kw">auto</span> act = Average(ts);</span>
<span id="cb53-132"><a href="#cb53-132" aria-hidden="true"></a></span>
<span id="cb53-133"><a href="#cb53-133" aria-hidden="true"></a>        ASSERT_EQ(act, exp);</span>
<span id="cb53-134"><a href="#cb53-134" aria-hidden="true"></a>    }</span>
<span id="cb53-135"><a href="#cb53-135" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score_client.h 11</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true"></a>    <span class="kw">class</span> TestScoreClient {</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true"></a>        <span class="dt">void</span>             LoadAsync(<span class="bu">std::</span>string&amp;&amp; filename);</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true"></a>        <span class="dt">void</span>             Done();</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true"></a>        <span class="dt">void</span>             Wait();</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true"></a>        TestScore <span class="at">const</span>&amp; GetTestScore() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">test_score_</span>; }</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true"></a>        <span class="bu">std::</span>condition_variable <span class="va">condition_</span>{};</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true"></a>        <span class="bu">std::</span>mutex              <span class="va">mutex_</span>{};</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true"></a>        TestScore               <span class="va">test_score_</span>{};</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true"></a>        TestScoreLoader         <span class="va">loader_</span>{};</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true"></a>        <span class="dt">bool</span>                    <span class="va">loaded_</span>{<span class="kw">false</span>};</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true"></a>    };</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score_client.cpp 5</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true"></a>    <span class="dt">void</span> TestScoreClient::LoadAsync(<span class="bu">std::</span>string&amp;&amp; filename)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true"></a>    {</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true"></a>        <span class="va">loader_</span>.LoadCSV_Async(<span class="bu">std::</span>move(filename), *<span class="kw">this</span>);</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true"></a>    }</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true"></a>    <span class="dt">void</span> TestScoreClient::Done()</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true"></a>    {</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true"></a>        {</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true"></a>            <span class="kw">auto</span> lock = <span class="bu">std::</span>lock_guard{<span class="va">mutex_</span>};</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true"></a>            <span class="va">loaded_</span>   = <span class="kw">true</span>;</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true"></a>        }</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true"></a>        <span class="va">condition_</span>.notify_all();</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true"></a>    }</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true"></a>    <span class="dt">void</span> TestScoreClient::Wait()</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true"></a>    {</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true"></a>        <span class="kw">auto</span> lock = <span class="bu">std::</span>unique_lock{<span class="va">mutex_</span>};</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true"></a>        <span class="va">condition_</span>.wait(lock, [&amp;loaded = <span class="va">loaded_</span>] { <span class="cf">return</span> loaded; });</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true"></a>        <span class="va">test_score_</span> = <span class="va">loader_</span>.LoadCSV_Get();</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/solid_q/dip_test_score_client_ut.cpp 9</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true"></a>    TEST_F(SolidDIP_Q, TestStoreClient_LoadAsync)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true"></a>    {</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true"></a>        <span class="kw">auto</span> tsc = TestScoreClient{};</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true"></a>        tsc.LoadAsync(<span class="st">&quot;../ut_data2/test_score_org.csv&quot;</span>);</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp = TestScore::<span class="dt">ScoreAll_t</span>{</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;堂林&quot;</span>, {-<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">80</span>}),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;広輔&quot;</span>, {<span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">10</span>}),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;會澤&quot;</span>, {<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">70</span>}),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;松山&quot;</span>, {<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">50</span>}),</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;菊池&quot;</span>, {<span class="dv">50</span>, <span class="dv">20</span>, <span class="dv">80</span>}),</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true"></a>            TestScore::<span class="dt">ScoreAll_t</span>::<span class="dt">value_type</span>(<span class="st">&quot;鈴木&quot;</span>, {<span class="dv">0</span>, <span class="dv">80</span>, <span class="dv">100</span>}),</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true"></a>        };</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true"></a>        <span class="co">// ここで何か別のことをして終わったら</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true"></a>        tsc.Wait();</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; ts = tsc.GetTestScore();</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true"></a>        ASSERT_TRUE(<span class="bu">std::</span>equal(ts.begin(), ts.end(), exp.begin()));</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> exp_str = <span class="bu">std::</span>string{</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true"></a>            <span class="st">&quot;堂林: -1 50 80</span><span class="sc">\n</span><span class="st">広輔: 40 30 10</span><span class="sc">\n</span><span class="st">會澤: 30 60 70</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true"></a>            <span class="st">&quot;松山: 80 90 50</span><span class="sc">\n</span><span class="st">菊池: 50 20 80</span><span class="sc">\n</span><span class="st">鈴木: 0 80 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true"></a>        ASSERT_EQ(ToString(ts), exp_str);</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true"></a>    }</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="solid.html#SS_8_5">依存関係逆転の原則(DIP)</a></li>
<li><a href="exercise_a.html#SS_20_8_5">解答例-DIP</a></li>
</ul>
<h3 id="演習-solidの定義">演習-SOLIDの定義 <a id="SS_19_8_6"></a></h3>
<ul>
<li><p>問題<br />
下記原則群と説明群を結びつけよ。</p></li>
<li><p>原則群</p>
<ul>
<li>SRP</li>
<li>OCP</li>
<li>LIP</li>
<li>ISP</li>
<li>DIP</li>
</ul></li>
<li><p>説明群</p>
<ol type="1">
<li>一つのクラスは、ただ一つの責任(機能)を持つようにしなければならない。</li>
<li>クラスは拡張に対して開いていて、 クラスは修正に対して閉じていなければならない。</li>
<li>事前条件を派生クラスで強めることはできず、事後条件を派生クラスで弱めることはできない。</li>
<li>クラスは、そのクライアントが使用しないメソッドへの依存をそのクライアントに強制するべきではない。</li>
<li>上位レベルのモジュールは下位レベルのモジュールに依存すべきではない。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_8_6">解答-SOLIDの定義</a></p></li>
</ul>
<h2 id="デザインパターン">デザインパターン <a id="SS_19_9"></a></h2>
<h3 id="演習-ガード節">演習-ガード節 <a id="SS_19_9_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/guard.cpp 7</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a>    <span class="co">// 以下の関数PrimeNumbersをガード節や、関数の括りだし等によってリファクタリングせよ。</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a>    <span class="bu">std::</span>optional&lt;<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;&gt; PrimeNumbers(<span class="dt">uint32_t</span> max_number)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a>    {</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a>        <span class="cf">if</span> (max_number &lt; <span class="dv">65536</span>) {  <span class="co">// 演算コストが高いためエラーにする</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a>            <span class="kw">auto</span> result = <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{};</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a>            <span class="cf">if</span> (max_number &gt;= <span class="dv">2</span>) {</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true"></a>                <span class="kw">auto</span> prime_num    = <span class="dv">2</span><span class="bu">U</span>;                                       <span class="co">// 最初の素数</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true"></a>                <span class="kw">auto</span> is_num_prime = <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;(max_number + <span class="dv">1</span>, <span class="kw">true</span>);  <span class="co">// falseなら素数でない</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true"></a>                is_num_prime[<span class="dv">0</span>] = is_num_prime[<span class="dv">1</span>] = <span class="kw">false</span>;</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true"></a>                <span class="cf">do</span> {</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true"></a>                    result.emplace_back(prime_num);</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true"></a>                    <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">2</span> * prime_num; i &lt; is_num_prime.size(); i += prime_num) {</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true"></a>                        is_num_prime[i] = <span class="kw">false</span>;  <span class="co">// 次の倍数は素数ではない</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true"></a>                    }</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true"></a>                    <span class="cf">do</span> {  <span class="co">// 次の素数の探索</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true"></a>                        ++prime_num;</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true"></a>                    } <span class="cf">while</span> (!is_num_prime[prime_num] &amp;&amp; (prime_num &lt; is_num_prime.size()));</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true"></a>                } <span class="cf">while</span> (prime_num &lt; is_num_prime.size());</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true"></a>            }</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true"></a>            <span class="cf">return</span> result;</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true"></a>        }</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true"></a></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>nullopt;</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true"></a>    }</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true"></a></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true"></a>    TEST(DesignPatternQ, Guard)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true"></a>    {</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true"></a>        <span class="kw">auto</span> result = PrimeNumbers(<span class="dv">1</span>);</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true"></a>        ASSERT_TRUE(result);</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{}), *result);</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true"></a></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true"></a>        result = PrimeNumbers(<span class="dv">2</span>);</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true"></a>        ASSERT_TRUE(result);</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>}), *result);</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true"></a></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true"></a>        result = PrimeNumbers(<span class="dv">30</span>);</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true"></a>        ASSERT_TRUE(result);</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">29</span>}), *result);</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true"></a></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true"></a>        ASSERT_FALSE(PrimeNumbers(<span class="dv">65536</span>));</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_1">ガード節</a></li>
<li><a href="exercise_a.html#SS_20_9_1">解答例-ガード節</a></li>
</ul>
<h3 id="演習-bitmasktype">演習-BitmaskType <a id="SS_19_9_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/enum_bitmask.cpp 5</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true"></a>    <span class="co">// 下記関数ColorMask2Strはuint32_t型のビットマスクを引数に取る。</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true"></a>    <span class="co">// これはユーザが使用間違いを起こしやすい脆弱なインターフェースである。</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true"></a>    <span class="co">// enumによるビットマスク表現を使用しこの問題に対処せよ。</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> COLOR_RED    = <span class="bn">0b0001</span><span class="bu">U</span>;</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> COLOR_YELLOW = <span class="bn">0b0010</span><span class="bu">U</span>;</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> COLOR_GREEN  = <span class="bn">0b0100</span><span class="bu">U</span>;</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> COLOR_BLUE   = <span class="bn">0b1000</span><span class="bu">U</span>;</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true"></a>    <span class="bu">std::</span>string ColorMask2Str(<span class="dt">uint32_t</span> color)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true"></a>    {</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true"></a>        <span class="kw">auto</span> ret = <span class="bu">std::</span>string{};</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true"></a>        <span class="cf">if</span> (COLOR_RED &amp; color) {</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true"></a>            ret += <span class="st">&quot;RED&quot;</span>;</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true"></a>        }</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true"></a>        <span class="cf">if</span> (COLOR_YELLOW &amp; color) {</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true"></a>            <span class="cf">if</span> (ret.size() != <span class="dv">0</span>) {</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true"></a>                ret += <span class="ch">&#39;,&#39;</span>;</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true"></a>            }</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true"></a>            ret += <span class="st">&quot;YELLOW&quot;</span>;</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true"></a>        }</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true"></a>        <span class="cf">if</span> (COLOR_GREEN &amp; color) {</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true"></a>            <span class="cf">if</span> (ret.size() != <span class="dv">0</span>) {</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true"></a>                ret += <span class="ch">&#39;,&#39;</span>;</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true"></a>            }</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true"></a>            ret += <span class="st">&quot;GREEN&quot;</span>;</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true"></a>        }</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true"></a>        <span class="cf">if</span> (COLOR_BLUE &amp; color) {</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true"></a>            <span class="cf">if</span> (ret.size() != <span class="dv">0</span>) {</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true"></a>                ret += <span class="ch">&#39;,&#39;</span>;</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true"></a>            }</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true"></a>            ret += <span class="st">&quot;BLUE&quot;</span>;</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true"></a>        }</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true"></a></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true"></a>    }</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true"></a></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true"></a>    TEST(DesignPatternQ, EnumBitmask)</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true"></a>    {</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;RED&quot;</span>, ColorMask2Str(COLOR_RED));</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;RED,YELLOW&quot;</span>, ColorMask2Str(COLOR_RED | COLOR_YELLOW));</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;YELLOW&quot;</span>, ColorMask2Str(COLOR_YELLOW));</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;YELLOW,GREEN,BLUE&quot;</span>, ColorMask2Str(COLOR_YELLOW | COLOR_GREEN | COLOR_BLUE));</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true"></a></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, ColorMask2Str(<span class="bn">0b10000</span>));  <span class="co">// 想定していない使用法</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_2">BitmaskType</a></li>
<li><a href="exercise_a.html#SS_20_9_2">解答例-BitmaskType</a></li>
</ul>
<h3 id="演習-pimpl">演習-Pimpl <a id="SS_19_9_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/pimpl.cpp 5</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a>    <span class="co">// [Q] 下記クラスCollectionの宣言はクラスWidgetの宣言に依存している。</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a>    <span class="co">// Pimplパターンを使用し、Collectionの宣言がWidgetの宣言に依存しないようにせよ。</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true"></a>    <span class="kw">class</span> Widget {</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true"></a>        <span class="kw">explicit</span> Widget(<span class="dt">char</span> <span class="at">const</span>* name) : <span class="va">name_</span>{name} {}</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* Name() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name_</span>; }</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* <span class="va">name_</span>;</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true"></a>    };</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true"></a>    <span class="kw">class</span> Collection {</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* Name(<span class="dt">size_t</span> i) <span class="at">const</span> { <span class="cf">return</span> <span class="va">widgets_</span>.at(i).Name(); }</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true"></a>        <span class="dt">void</span>        AddName(<span class="dt">char</span> <span class="at">const</span>* name) { <span class="va">widgets_</span>.emplace_back(name); }</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true"></a>        <span class="dt">size_t</span> Count() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">widgets_</span>.size(); }</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;Widget&gt; <span class="va">widgets_</span>{};</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true"></a>    };</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true"></a></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true"></a>    TEST(DesignPatternQ, Pimpl)</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true"></a>    {</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true"></a>        <span class="kw">auto</span> c = Collection{};</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true"></a></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">0</span>, c.Count());</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true"></a>        ASSERT_THROW(c.Name(<span class="dv">0</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true"></a></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true"></a>        c.AddName(<span class="st">&quot;n0&quot;</span>);</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true"></a>        c.AddName(<span class="st">&quot;n1&quot;</span>);</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true"></a>        c.AddName(<span class="st">&quot;n2&quot;</span>);</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">3</span>, c.Count());</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;n0&quot;</span>, c.Name(<span class="dv">0</span>));</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;n1&quot;</span>, c.Name(<span class="dv">1</span>));</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;n2&quot;</span>, c.Name(<span class="dv">2</span>));</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true"></a>        ASSERT_THROW(c.Name(<span class="dv">4</span>), <span class="bu">std::</span>out_of_range);</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_3">Pimpl</a></li>
<li><a href="exercise_a.html#SS_20_9_3">解答例-Pimpl</a></li>
</ul>
<h3 id="演習-accessorの副作用">演習-Accessorの副作用 <a id="SS_19_9_4"></a></h3>
<ul>
<li><p>問題<br />
Accessor(特にセッター)には重大な副作用がある。その副作用を下記から選択せよ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>クラスのカプセル化の破壊</li>
<li>SRPへの違反</li>
<li>関数の巨大化</li>
<li>クラスの巨大化</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_9_4">解答-Accessorの副作用</a></p></li>
</ul>
<h3 id="演習-accessor">演習-Accessor <a id="SS_19_9_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/accessor.cpp 5</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a>    <span class="co">// 下記クラスPrimeNumbersはAccessorの多用により、クラスのカプセル化が破壊されている例である。</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a>    <span class="co">// これにより、このクラスは凝集性が低く、誤用を誘発しやすい。</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a>    <span class="co">// この問題を解決するため、クラスPrimeNumbersや関数GetPrimeNumbersを修正せよ。</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true"></a>    <span class="co">// また、別の問題があれば合わせて修正せよ。</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true"></a>    <span class="kw">class</span> PrimeNumbers {</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true"></a>        <span class="dt">uint32_t</span> GetMaxNumber() <span class="at">const</span> { <span class="cf">return</span> <span class="va">max_number_</span>; }</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true"></a>        <span class="dt">void</span>     SetMaxNumber(<span class="dt">uint32_t</span> max_number) { <span class="va">max_number_</span> = max_number; }</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true"></a>        <span class="dt">bool</span>     HasCache() <span class="at">const</span> { <span class="cf">return</span> <span class="va">cached_</span>; }</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true"></a>        <span class="dt">void</span>     Cashed(<span class="dt">bool</span> cached) { <span class="va">cached_</span> = cached; }</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;&amp; GetPrimeNumbers() { <span class="cf">return</span> <span class="va">prime_numbers_</span>; }</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true"></a>        <span class="dt">uint32_t</span>              <span class="va">max_number_</span>;</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true"></a>        <span class="dt">bool</span>                  <span class="va">cached_</span>;</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; <span class="va">prime_numbers_</span>;</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true"></a>    };</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true"></a>    <span class="kw">inline</span> <span class="dt">uint32_t</span> next_prime_num(<span class="dt">uint32_t</span> curr_prime_num, <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;&amp; is_num_prime)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true"></a>    {</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">2</span> * curr_prime_num; i &lt; is_num_prime.size(); i += curr_prime_num) {</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true"></a>            is_num_prime[i] = <span class="kw">false</span>;  <span class="co">// 次の倍数は素数ではない</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true"></a>        }</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true"></a></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true"></a>        <span class="kw">auto</span> prime_num = curr_prime_num;</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true"></a></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true"></a>        <span class="cf">do</span> {  <span class="co">// 次の素数の探索</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true"></a>            ++prime_num;</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true"></a>        } <span class="cf">while</span> (!is_num_prime[prime_num] &amp;&amp; (prime_num &lt; is_num_prime.size()));</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true"></a></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true"></a>        <span class="cf">return</span> prime_num;</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true"></a>    }</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true"></a>    <span class="kw">inline</span> <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; get_prime_numbers(<span class="dt">uint32_t</span> max_number)</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true"></a>    {</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true"></a>        <span class="kw">auto</span> result       = <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{};</span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true"></a>        <span class="kw">auto</span> prime_num    = <span class="dv">2</span><span class="bu">U</span>;                                       <span class="co">// 最初の素数</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true"></a>        <span class="kw">auto</span> is_num_prime = <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;(max_number + <span class="dv">1</span>, <span class="kw">true</span>);  <span class="co">// falseなら素数でない。</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true"></a>        is_num_prime[<span class="dv">0</span>] = is_num_prime[<span class="dv">1</span>] = <span class="kw">false</span>;</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true"></a></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true"></a>        <span class="cf">do</span> {</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true"></a>            result.emplace_back(prime_num);</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true"></a>            prime_num = next_prime_num(prime_num, is_num_prime);</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true"></a>        } <span class="cf">while</span> (prime_num &lt; is_num_prime.size());</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true"></a></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true"></a>        <span class="cf">return</span> result;</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true"></a>    }</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true"></a></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true"></a>    <span class="dt">void</span> GetPrimeNumbers(PrimeNumbers&amp; pm)</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true"></a>    {</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true"></a>        <span class="cf">if</span> (pm.HasCache()) {</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true"></a>        }</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true"></a></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true"></a>        <span class="cf">if</span> (pm.GetMaxNumber() &lt; <span class="dv">2</span>) {  <span class="co">// ガード節。2未満の素数はない。</span></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true"></a>            pm.GetPrimeNumbers().clear();</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true"></a>            <span class="cf">return</span>;</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true"></a>        }</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true"></a></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true"></a>        pm.GetPrimeNumbers() = get_prime_numbers(pm.GetMaxNumber());</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true"></a>    }</span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true"></a></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true"></a>    TEST(DesignPatternQ, Accessor)</span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true"></a>    {</span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true"></a>        <span class="kw">auto</span> pm = PrimeNumbers{};</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true"></a></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">1</span>);</span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true"></a>        pm.Cashed(<span class="kw">false</span>);</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true"></a>        GetPrimeNumbers(pm);</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true"></a>        pm.Cashed(<span class="kw">true</span>);</span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{}), pm.GetPrimeNumbers());</span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true"></a></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">3</span>);</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true"></a>        pm.Cashed(<span class="kw">false</span>);</span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true"></a>        GetPrimeNumbers(pm);</span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true"></a>        pm.Cashed(<span class="kw">true</span>);</span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true"></a></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>}), pm.GetPrimeNumbers());</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true"></a></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">30</span>);</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true"></a>        pm.Cashed(<span class="kw">false</span>);</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true"></a>        GetPrimeNumbers(pm);</span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true"></a>        pm.Cashed(<span class="kw">true</span>);</span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true"></a></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">29</span>}), pm.GetPrimeNumbers());</span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true"></a></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">3</span>);</span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true"></a>        GetPrimeNumbers(pm);  <span class="co">// pm.Cashed(false);しないので前のまま。</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true"></a>                              <span class="co">// このような用途は考えづらいので、おそらく仕様のバグ。</span></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true"></a></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">29</span>}), pm.GetPrimeNumbers());</span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_4">Accessor</a></li>
<li><a href="exercise_a.html#SS_20_9_5">解答例-Accessor</a></li>
</ul>
<h3 id="演習-copy-and-swap">演習-Copy-And-Swap <a id="SS_19_9_6"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/copy_and_swap.cpp 5</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true"></a>    <span class="co">// 以下のクラスCopyAndSwapの</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true"></a>    <span class="co">//  * copyコンストラクタ</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true"></a>    <span class="co">//  * copy代入演算子</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true"></a>    <span class="co">//  * moveコンストラクタ</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true"></a>    <span class="co">//  * move代入演算子</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true"></a>    <span class="co">// をCopy-And-Swapイデオムを使用して実装し、単体テストを行え。</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true"></a>    <span class="kw">class</span> CopyAndSwap <span class="kw">final</span> {</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true"></a>        <span class="kw">explicit</span> CopyAndSwap(<span class="dt">char</span> <span class="at">const</span>* name0, <span class="dt">char</span> <span class="at">const</span>* name1)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true"></a>            : <span class="va">name0_</span>{name0 == <span class="kw">nullptr</span> ? <span class="st">&quot;&quot;</span> : name0}, <span class="va">name1_</span>{name1 == <span class="kw">nullptr</span> ? <span class="st">&quot;&quot;</span> : name1}</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true"></a>        {</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true"></a>        }</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true"></a>        CopyAndSwap(CopyAndSwap <span class="at">const</span>&amp; rhs)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true"></a>        {</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true"></a>            <span class="co">// この関数の実装</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true"></a>        }</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true"></a>        CopyAndSwap(CopyAndSwap&amp;&amp; rhs) <span class="kw">noexcept</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true"></a>        {</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true"></a>            <span class="co">// この関数の実装</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true"></a>        }</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true"></a>        CopyAndSwap&amp; <span class="kw">operator</span>=(CopyAndSwap <span class="at">const</span>&amp; rhs)</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true"></a>        {</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true"></a>            <span class="co">// この関数の実装</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true"></a>            <span class="cf">return</span> *<span class="kw">this</span>;</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true"></a>        }</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true"></a></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true"></a>        CopyAndSwap&amp; <span class="kw">operator</span>=(CopyAndSwap&amp;&amp; rhs) <span class="kw">noexcept</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true"></a>        {</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true"></a>            <span class="co">// この関数の実装</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true"></a>            <span class="cf">return</span> *<span class="kw">this</span>;</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true"></a>        }</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true"></a></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true"></a>        <span class="dt">void</span> Swap(CopyAndSwap&amp; rhs) <span class="kw">noexcept</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true"></a>        {</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true"></a>            <span class="co">// この関数の実装</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true"></a>        }</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* GetName0() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name0_</span>; }</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true"></a></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName1() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name1_</span>; }</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true"></a></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true"></a>        ~CopyAndSwap() = <span class="cf">default</span>;</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true"></a></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true"></a>        <span class="dt">char</span> <span class="at">const</span>* <span class="va">name0_</span>;</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name1_</span>;</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true"></a>    };</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true"></a></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true"></a>    TEST(DesignPatternQ, CopyAndSwap)</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true"></a>    {</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true"></a>        <span class="co">// test for explicit CopyAndSwap(char const* name0, char const* name1)</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true"></a>        <span class="kw">auto</span> n = CopyAndSwap{<span class="kw">nullptr</span>, <span class="kw">nullptr</span>};</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;&quot;</span>, n.GetName0());</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, n.GetName1());</span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true"></a></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true"></a>        <span class="kw">auto</span> a = CopyAndSwap{<span class="st">&quot;a0&quot;</span>, <span class="st">&quot;a1&quot;</span>};</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true"></a>        ASSERT_STREQ(<span class="st">&quot;a0&quot;</span>, a.GetName0());</span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;a1&quot;</span>, a.GetName1());</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_5">Copy-And-Swap</a></li>
<li><a href="exercise_a.html#SS_20_9_6">解答例-Copy-And-Swap</a></li>
</ul>
<h3 id="演習-immutable">演習-Immutable <a id="SS_19_9_7"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/immutable.cpp 5</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true"></a>    <span class="co">// 下記クラスPrimeNumbersはSetMaxNumberにより状態が変わってしまうことがある。</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true"></a>    <span class="co">// 状態変更が必要ない場合、こういった仕様はない方が良い。</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true"></a>    <span class="co">// PrimeNumbersからSetMaxNumberを削除し、このクラスをimmutableにせよ。</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true"></a>    <span class="kw">class</span> PrimeNumbers {</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true"></a>        PrimeNumbers() = <span class="cf">default</span>;</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true"></a>        PrimeNumbers(PrimeNumbers <span class="at">const</span>&amp;)            = <span class="cf">default</span>;</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true"></a>        PrimeNumbers&amp; <span class="kw">operator</span>=(PrimeNumbers <span class="at">const</span>&amp;) = <span class="cf">default</span>;</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true"></a>        <span class="dt">uint32_t</span> GetMaxNumber() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">max_number_</span>; }</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true"></a>        <span class="dt">void</span>     SetMaxNumber(<span class="dt">uint32_t</span> max_number) <span class="kw">noexcept</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true"></a>        {</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true"></a>            <span class="cf">if</span> (max_number != <span class="va">max_number_</span>) {</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true"></a>                <span class="va">cached_</span>     = <span class="kw">false</span>;</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true"></a>                <span class="va">max_number_</span> = max_number;</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true"></a>            }</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true"></a>        }</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; <span class="at">const</span>&amp; GeneratePrimeNumbers();</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true"></a>        <span class="dt">uint32_t</span>              <span class="va">max_number_</span>{<span class="dv">0</span>};</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true"></a>        <span class="dt">bool</span>                  <span class="va">cached_</span>{<span class="kw">false</span>};</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; <span class="va">prime_numbers_</span>{};</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true"></a></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true"></a>        <span class="at">static</span> <span class="dt">uint32_t</span>              next_prime_num(<span class="dt">uint32_t</span>           curr_prime_num,</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true"></a>                                                    <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;&amp; is_num_prime) <span class="kw">noexcept</span>;</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; get_prime_numbers(<span class="dt">uint32_t</span> max_number);</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true"></a>    };</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true"></a>    <span class="dt">uint32_t</span> PrimeNumbers::next_prime_num(<span class="dt">uint32_t</span>           curr_prime_num,</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true"></a>                                          <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;&amp; is_num_prime) <span class="kw">noexcept</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true"></a>    {</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i = <span class="dv">2</span> * curr_prime_num; i &lt; is_num_prime.size(); i += curr_prime_num) {</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true"></a>            is_num_prime[i] = <span class="kw">false</span>;  <span class="co">// 次の倍数は素数ではない</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true"></a>        }</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true"></a>        <span class="kw">auto</span> prime_num = curr_prime_num;</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true"></a></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true"></a>        <span class="cf">do</span> {  <span class="co">// 次の素数の探索</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true"></a>            ++prime_num;</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true"></a>        } <span class="cf">while</span> (!is_num_prime[prime_num] &amp;&amp; (prime_num &lt; is_num_prime.size()));</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true"></a></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true"></a>        <span class="cf">return</span> prime_num;</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true"></a>    }</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true"></a></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; PrimeNumbers::get_prime_numbers(<span class="dt">uint32_t</span> max_number)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true"></a>    {</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true"></a>        <span class="kw">auto</span> result       = <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{};</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true"></a>        <span class="kw">auto</span> prime_num    = <span class="dv">2</span><span class="bu">U</span>;                                       <span class="co">// 最初の素数</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true"></a>        <span class="kw">auto</span> is_num_prime = <span class="bu">std::</span>vector&lt;<span class="dt">bool</span>&gt;(max_number + <span class="dv">1</span>, <span class="kw">true</span>);  <span class="co">// falseなら素数でない。</span></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true"></a>        is_num_prime[<span class="dv">0</span>] = is_num_prime[<span class="dv">1</span>] = <span class="kw">false</span>;</span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true"></a></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true"></a>        <span class="cf">do</span> {</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true"></a>            result.emplace_back(prime_num);</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true"></a>            prime_num = next_prime_num(prime_num, is_num_prime);</span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true"></a>        } <span class="cf">while</span> (prime_num &lt; is_num_prime.size());</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true"></a></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true"></a>        <span class="cf">return</span> result;</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true"></a>    }</span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true"></a></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt; <span class="at">const</span>&amp; PrimeNumbers::GeneratePrimeNumbers()</span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true"></a>    {</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">cached_</span>) {</span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">prime_numbers_</span>;</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true"></a>        }</span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true"></a></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="va">max_number_</span> &lt; <span class="dv">2</span>) {  <span class="co">// ガード節。2未満の素数はない。</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true"></a>            <span class="va">prime_numbers_</span>.clear();</span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true"></a>        }</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true"></a>        <span class="cf">else</span> {</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true"></a>            <span class="va">prime_numbers_</span> = get_prime_numbers(<span class="va">max_number_</span>);</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true"></a>        }</span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true"></a></span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true"></a>        <span class="va">cached_</span> = <span class="kw">true</span>;</span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">prime_numbers_</span>;</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true"></a>    }</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true"></a></span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true"></a>    TEST(DesignPatternQ, Immutable)</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true"></a>    {</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true"></a>        <span class="kw">auto</span> pm = PrimeNumbers{};</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true"></a></span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">1</span>);</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{}), pm.GeneratePrimeNumbers());</span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true"></a></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">3</span>);</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>}), pm.GeneratePrimeNumbers());</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">30</span>);</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">29</span>}),</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true"></a>                  pm.GeneratePrimeNumbers());</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true"></a></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">29</span>}),</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true"></a>                  pm.GeneratePrimeNumbers());</span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true"></a></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true"></a>        pm.SetMaxNumber(<span class="dv">3</span>);</span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>}), pm.GeneratePrimeNumbers());</span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true"></a></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true"></a>        <span class="kw">auto</span> pm3_copy = PrimeNumbers{pm};</span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>}), pm3_copy.GeneratePrimeNumbers());</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true"></a></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true"></a>        <span class="kw">auto</span> pm5 = PrimeNumbers{};</span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true"></a>        pm5.SetMaxNumber(<span class="dv">5</span>);</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true"></a>        pm = pm5;</span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true"></a>        ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">uint32_t</span>&gt;{<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>}), pm.GeneratePrimeNumbers());</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_6">Immutable</a></li>
<li><a href="exercise_a.html#SS_20_9_7">解答例-Immutable</a></li>
</ul>
<h3 id="演習-clone">演習-Clone <a id="SS_19_9_8"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/clone.cpp 5</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true"></a>    <span class="co">// </span><span class="al">TEST</span><span class="co">(DesignPatternQ, Clone)に記述したように、オブジェクトのスライシングによる影響で、</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true"></a>    <span class="co">// Base型ポインタに代入されたDerivedインスタンスへのコピーは部分的にしか行われない。</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true"></a>    <span class="co">// Cloneパターンを使用してこの問題を修正せよ。</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true"></a>    <span class="co">// また、その他の問題があれば合わせて修正せよ。</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true"></a>    <span class="kw">class</span> Base {</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true"></a>        <span class="kw">explicit</span> Base(<span class="bu">std::</span>string name) : <span class="va">name1_</span>{name} {}</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Base() = <span class="cf">default</span>;</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName() { <span class="cf">return</span> <span class="va">name1_</span>; }</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name1_</span>;</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true"></a>    };</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true"></a>    <span class="kw">class</span> Derived <span class="kw">final</span> : <span class="kw">public</span> Base {</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true"></a>        <span class="kw">explicit</span> Derived(<span class="bu">std::</span>string name1 = <span class="st">&quot;&quot;</span>, <span class="bu">std::</span>string name2 = <span class="st">&quot;&quot;</span>) : Base{name1}, <span class="va">name2_</span>{name2} {}</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Derived() = <span class="cf">default</span>;</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName() { <span class="cf">return</span> <span class="va">name2_</span>; }</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true"></a></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name2_</span>;</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true"></a>    };</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true"></a>    TEST(DesignPatternQ, Clone)</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true"></a>    {</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true"></a>        Derived d1{<span class="st">&quot;name1&quot;</span>, <span class="st">&quot;name2&quot;</span>};</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true"></a></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name1&quot;</span>, d1.Base::GetName());</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name2&quot;</span>, d1.GetName());</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true"></a></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true"></a>        Derived d2{d1};</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name1&quot;</span>, d2.Base::GetName());</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name2&quot;</span>, d2.GetName());</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true"></a></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true"></a>        Derived d3;</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true"></a>        Base*   b3 = &amp;d3;</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true"></a>        *b3 = d1;  <span class="co">// d1からd3へコピーしたつもりだが、スライスによりうまく行かない。</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true"></a></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name1&quot;</span>, b3-&gt;Base::GetName());</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true"></a><span class="co">        ASSERT_EQ(&quot;name2&quot;, b3-&gt;GetName());   // スライスの影響でname2_がコピーされていない。</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true"></a><span class="co">    </span><span class="pp">#else</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;&quot;</span>, d3.GetName());</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true"></a>    <span class="pp">#endif</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_7">Clone(仮想コンストラクタ)</a></li>
<li><a href="exercise_a.html#SS_20_9_8">解答例-Clone</a></li>
</ul>
<h3 id="演習-nvi">演習-NVI <a id="SS_19_9_9"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/nvi.cpp 7</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true"></a>    <span class="co">// 下記クラスBase、Derived、DerivedDerivedの前処理はクローンコードになっている。</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true"></a>    <span class="co">// NVIを用いて、この問題に対処せよ。</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true"></a>    <span class="kw">class</span> Base {</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true"></a>        <span class="kw">explicit</span> Base(<span class="bu">std::</span>string name) : <span class="va">name1_</span>{name} {}</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Base() = <span class="cf">default</span>;</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName1() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name1_</span>; }</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">bool</span> IsEqual(Base <span class="at">const</span>&amp; rhs) <span class="at">const</span> <span class="kw">noexcept</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true"></a>        {</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="kw">this</span> == &amp;rhs) {</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">true</span>;</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true"></a>            }</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="kw">typeid</span>(*<span class="kw">this</span>) != <span class="kw">typeid</span>(rhs)) {</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">false</span>;</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true"></a>            }</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">name1_</span> == rhs.<span class="va">name1_</span>;</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true"></a>        }</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name1_</span>;</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true"></a>    };</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true"></a></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true"></a>    <span class="kw">class</span> Derived : <span class="kw">public</span> Base {</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true"></a>        <span class="kw">explicit</span> Derived(<span class="bu">std::</span>string name1 = <span class="st">&quot;&quot;</span>, <span class="bu">std::</span>string name2 = <span class="st">&quot;&quot;</span>) : Base{name1}, <span class="va">name2_</span>{name2} {}</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Derived() <span class="kw">override</span> = <span class="cf">default</span>;</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName2() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name2_</span>; }</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">bool</span> IsEqual(Base <span class="at">const</span>&amp; rhs) <span class="at">const</span> <span class="kw">noexcept</span> <span class="kw">override</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true"></a>        {</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="kw">this</span> == &amp;rhs) {</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">true</span>;</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true"></a>            }</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true"></a></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true"></a>            <span class="cf">if</span> (!Base::IsEqual(rhs)) {</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">false</span>;</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true"></a>            }</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true"></a>            <span class="kw">auto</span> rhs_d = <span class="kw">dynamic_cast</span>&lt;Derived <span class="at">const</span>*&gt;(&amp;rhs);</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true"></a>            <span class="cf">return</span> (rhs_d != <span class="kw">nullptr</span>) &amp;&amp; (<span class="va">name2_</span> == rhs_d-&gt;<span class="va">name2_</span>);</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true"></a>        }</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true"></a></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name2_</span>;</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true"></a>    };</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true"></a></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true"></a>    <span class="kw">class</span> DerivedDerived : <span class="kw">public</span> Derived {</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true"></a>        <span class="kw">explicit</span> DerivedDerived(<span class="bu">std::</span>string name1 = <span class="st">&quot;&quot;</span>, <span class="bu">std::</span>string name2 = <span class="st">&quot;&quot;</span>, <span class="bu">std::</span>string name3 = <span class="st">&quot;&quot;</span>)</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true"></a>            : Derived{name1, name2}, <span class="va">name3_</span>{name3}</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true"></a>        {</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true"></a>        }</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true"></a>        <span class="kw">virtual</span> ~DerivedDerived() <span class="kw">override</span> = <span class="cf">default</span>;</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName3() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name3_</span>; }</span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">bool</span> IsEqual(Base <span class="at">const</span>&amp; rhs) <span class="at">const</span> <span class="kw">noexcept</span> <span class="kw">override</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true"></a>        {</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="kw">this</span> == &amp;rhs) {</span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">true</span>;</span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true"></a>            }</span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true"></a></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true"></a>            <span class="cf">if</span> (!Derived::IsEqual(rhs)) {</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true"></a>                <span class="cf">return</span> <span class="kw">false</span>;</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true"></a>            }</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true"></a>            <span class="kw">auto</span> rhs_d = <span class="kw">dynamic_cast</span>&lt;DerivedDerived <span class="at">const</span>*&gt;(&amp;rhs);</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true"></a></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true"></a>            <span class="cf">return</span> (rhs_d != <span class="kw">nullptr</span>) &amp;&amp; (<span class="va">name3_</span> == rhs_d-&gt;<span class="va">name3_</span>);</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true"></a>        }</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true"></a></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name3_</span>;</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true"></a>    };</span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true"></a></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true"></a>    TEST(DesignPatternQ, NVI)</span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true"></a>    {</span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true"></a>        <span class="kw">auto</span> b1 = Base{<span class="st">&quot;b1&quot;</span>};</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true"></a></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true"></a>        ASSERT_TRUE(b1.IsEqual(Base{b1}));</span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true"></a>        ASSERT_TRUE(b1.IsEqual(Base{<span class="st">&quot;b1&quot;</span>}));</span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true"></a>        ASSERT_FALSE(b1.IsEqual(Base{<span class="st">&quot;b2&quot;</span>}));</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true"></a>        ASSERT_FALSE(b1.IsEqual(Derived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>}));</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true"></a></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true"></a>        <span class="kw">auto</span> d1 = Derived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>};</span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true"></a></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true"></a>        ASSERT_FALSE(d1.IsEqual(Base{<span class="st">&quot;b1&quot;</span>}));</span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true"></a>        ASSERT_TRUE(d1.IsEqual(d1));</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true"></a>        ASSERT_TRUE(d1.IsEqual(Derived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>}));</span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true"></a>        ASSERT_FALSE(d1.IsEqual(Derived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d2&quot;</span>}));</span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true"></a>        ASSERT_FALSE(d1.IsEqual(DerivedDerived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>, <span class="st">&quot;dd2&quot;</span>}));</span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true"></a></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true"></a>        <span class="kw">auto</span> dd1 = DerivedDerived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>, <span class="st">&quot;dd1&quot;</span>};</span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true"></a></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true"></a>        ASSERT_FALSE(dd1.IsEqual(Base{<span class="st">&quot;b1&quot;</span>}));</span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true"></a>        ASSERT_FALSE(dd1.IsEqual(Derived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>}));</span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true"></a>        ASSERT_TRUE(dd1.IsEqual(dd1));</span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true"></a>        ASSERT_TRUE(dd1.IsEqual(DerivedDerived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>, <span class="st">&quot;dd1&quot;</span>}));</span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true"></a>        ASSERT_FALSE(dd1.IsEqual(DerivedDerived{<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;d1&quot;</span>, <span class="st">&quot;dd2&quot;</span>}));</span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_8">NVI(non virtual interface)</a></li>
<li><a href="exercise_a.html#SS_20_9_9">解答例-NVI</a></li>
</ul>
<h3 id="演習-raiiの効果">演習-RAIIの効果 <a id="SS_19_9_10"></a></h3>
<ul>
<li><p>問題<br />
RAIIにはどのような効果があるか？　下記より相応しいものを選択せよ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>リソースリークの防止</li>
<li>使用リソースの削減</li>
<li>クラスの実装を隠ぺい</li>
<li>LIPの順守</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_9_10">解答-RAIIの効果</a></p></li>
</ul>
<h3 id="演習-raii">演習-RAII <a id="SS_19_9_11"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/raii.cpp 5</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true"></a>    <span class="co">// 下記クラスBase、Derivedはクローンパターンをしているが、Clone関数はnewしたオブジェクトであるため、</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true"></a>    <span class="co">// メモリーリークを起こしやすい。std::unique_ptrを使用してこの問題に対処せよ。</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true"></a>    <span class="kw">class</span> Base {</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true"></a>        <span class="kw">explicit</span> Base(<span class="bu">std::</span>string name) : <span class="va">name1_</span>{<span class="bu">std::</span>move(name)} {}</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Base() = <span class="cf">default</span>;</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">name1_</span>; }</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true"></a>        <span class="kw">virtual</span> Base* Clone() <span class="at">const</span> { <span class="cf">return</span> <span class="kw">new</span> Base(<span class="va">name1_</span>); }</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true"></a>        Base(Base <span class="at">const</span>&amp;)            = <span class="kw">delete</span>;</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true"></a>        Base&amp; <span class="kw">operator</span>=(Base <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true"></a></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name1_</span>;</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true"></a>    };</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true"></a>    <span class="kw">class</span> Derived <span class="kw">final</span> : <span class="kw">public</span> Base {</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true"></a>        <span class="kw">explicit</span> Derived(<span class="bu">std::</span>string name1 = <span class="st">&quot;&quot;</span>, <span class="bu">std::</span>string name2 = <span class="st">&quot;&quot;</span>)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true"></a>            : Base{<span class="bu">std::</span>move(name1)}, <span class="va">name2_</span>{<span class="bu">std::</span>move(name2)}</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true"></a>        {</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true"></a>        }</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Derived() <span class="kw">override</span> = <span class="cf">default</span>;</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; GetName() <span class="at">const</span> <span class="kw">noexcept</span> <span class="kw">override</span> { <span class="cf">return</span> <span class="va">name2_</span>; }</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true"></a>        <span class="kw">virtual</span> Derived* Clone() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> <span class="kw">new</span> Derived{Base::GetName(), <span class="va">name2_</span>}; }</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true"></a></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">name2_</span>;</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true"></a>    };</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true"></a></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true"></a>    TEST(DesignPatternQ, RAII)</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true"></a>    {</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true"></a>        Derived  d1{<span class="st">&quot;name1&quot;</span>, <span class="st">&quot;name2&quot;</span>};</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true"></a>        Derived* d2{d1.Clone()};</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name1&quot;</span>, d2-&gt;Base::GetName());</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name2&quot;</span>, d2-&gt;GetName());</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true"></a></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true"></a>        <span class="kw">delete</span> d2;</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true"></a></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true"></a>        Base* b3 = d1.Clone();</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true"></a></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name1&quot;</span>, b3-&gt;Base::GetName());</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;name2&quot;</span>, b3-&gt;GetName());</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true"></a></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true"></a>        <span class="kw">delete</span> b3;</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_9">RAII(scoped guard)</a></li>
<li><a href="exercise_a.html#SS_20_9_11">解答例-RAII</a></li>
</ul>
<h3 id="演習-future">演習-Future <a id="SS_19_9_12"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/future.cpp 24</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a>    <span class="co">// 下記のfind_files_concurrentlyはスレッドの出力の結果をキャプチャリファレンスで受け取るため、</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a>    <span class="co">// 入出力の関係が明確でない。Futureパターンを使用しそれを明確にするリファクタリングを行え。</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; find_files_concurrently()</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true"></a>    {</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true"></a>        <span class="kw">auto</span> pca = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true"></a>        <span class="kw">auto</span> pcq = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true"></a>        <span class="kw">auto</span> th0 = <span class="bu">std::</span>thread{[&amp;pca] { pca = find_files(<span class="st">&quot;../programming_convention_a/&quot;</span>); }};</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true"></a>        <span class="kw">auto</span> th1 = <span class="bu">std::</span>thread{[&amp;pcq] { pcq = find_files(<span class="st">&quot;../programming_convention_q/&quot;</span>); }};</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true"></a>        th0.join();</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true"></a>        th1.join();</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true"></a>        pca.insert(pca.end(), pcq.begin(), pcq.end());</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true"></a>        <span class="cf">return</span> pca;</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true"></a>    }</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true"></a>    TEST(DesignPatternQ, Future)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true"></a>    {</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true"></a>        <span class="kw">auto</span> files = find_files_concurrently();</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true"></a>        ASSERT_GT(files.size(), <span class="dv">10</span>);</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_10">Future</a></li>
<li><a href="exercise_a.html#SS_20_9_12">解答例-Future</a></li>
</ul>
<h3 id="演習-di">演習-DI <a id="SS_19_9_13"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/di.cpp 10</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true"></a>    <span class="co">// CppFilesはLsCppを直に生成するため、LsCpp::FileList()がエラーした場合の単体テスト実施が</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true"></a>    <span class="co">// 困難である。CppFilesにDIパターンを適用するとともに、LsCppを適切に変更することによって、</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true"></a>    <span class="co">// LsCpp::FileList()がエラーした場合のCppFilesの単体テストを行え。</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true"></a>    <span class="kw">class</span> LsCpp {</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; FileList()</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true"></a>        {</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">files_</span>.size() != <span class="dv">0</span>) {  <span class="co">// キャッシュを使う</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">files_</span>;</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true"></a>            }</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true"></a>            <span class="kw">auto</span> stream</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true"></a>                = <span class="bu">std::</span>unique_ptr&lt;<span class="dt">FILE</span>, <span class="kw">decltype</span>(&amp;fclose)&gt;{popen(<span class="st">&quot;ls ../ut_data/*.cpp&quot;</span>, <span class="st">&quot;r&quot;</span>), fclose};</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true"></a>            <span class="cf">if</span> (stream.get() == NULL) {</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true"></a>                <span class="cf">throw</span> <span class="bu">std::</span>exception{};</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true"></a>            }</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true"></a></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true"></a>            <span class="dt">char</span> buff[<span class="dv">256</span>];</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true"></a>            <span class="cf">while</span> (fgets(buff, <span class="kw">sizeof</span>(buff) - <span class="dv">1</span>, stream.get()) != NULL) {</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true"></a>                <span class="va">files_</span> += buff;</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true"></a>            }</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true"></a></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">files_</span>;</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true"></a>        }</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true"></a></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">files_</span>{};</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true"></a>    };</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true"></a></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true"></a>    <span class="kw">class</span> CppFiles {</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true"></a>        <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; FileList() <span class="at">const</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true"></a>        {</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true"></a>            <span class="kw">auto</span> files  = <span class="bu">std::</span>string{};</span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true"></a>            <span class="kw">auto</span> ls_cpp = LsCpp{};</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true"></a></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true"></a>            <span class="cf">try</span> {</span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true"></a>                files = ls_cpp.FileList();</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true"></a>            }</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true"></a>            <span class="cf">catch</span> (...) {</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true"></a>                ;  <span class="co">// 例外発生時には空のベクタを返すので何もしない。</span></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true"></a>            }</span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true"></a></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true"></a>            <span class="cf">return</span> split_cr(files);</span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true"></a>        }</span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true"></a></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; split_cr(<span class="bu">std::</span>string <span class="at">const</span>&amp; str)</span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true"></a>        {</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true"></a>            <span class="kw">auto</span> ss  = <span class="bu">std::</span>stringstream{str};</span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true"></a></span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="bu">std::</span>string line; <span class="bu">std::</span>getline(ss, line);) {</span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true"></a>                ret.emplace_back(line);</span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true"></a>            }</span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true"></a></span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true"></a>            <span class="cf">return</span> ret;</span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true"></a>        }</span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true"></a>    };</span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true"></a></span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true"></a>    TEST(DesignPatternQ, DI)</span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true"></a>    {</span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true"></a>        <span class="kw">auto</span>        files = CppFiles{};</span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; act   = files.FileList();</span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true"></a>        <span class="kw">auto</span>        exp   = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;../ut_data/a.cpp&quot;</span>, <span class="st">&quot;../ut_data/abc.cpp&quot;</span>,</span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true"></a>                                                     <span class="st">&quot;../ut_data/efghij.cpp&quot;</span>};</span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true"></a></span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true"></a>        ASSERT_EQ(exp, act);</span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_11">DI(dependency injection)</a></li>
<li><a href="exercise_a.html#SS_20_9_13">解答例-DI</a></li>
</ul>
<h3 id="演習-singleton">演習-Singleton <a id="SS_19_9_14"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/singleton.cpp 5</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true"></a>    <span class="co">// 下記AppConfigはアプリケーション全体の設定を管理するためのクラスである。</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true"></a>    <span class="co">// 目的上、そのインスタンスAppConfigは広域のアクセスが必要であり、</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true"></a>    <span class="co">// グローバルインスタンスとして実装している。</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true"></a>    <span class="co">// グローバルインスタンスは、初期化の順番が標準化されておらず、</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true"></a>    <span class="co">// 多くの処理系ではリンクの順番に依存しているため、</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true"></a>    <span class="co">// アプリケーション立ち上げ時に様々な問題を起こすことがある。</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true"></a>    <span class="co">// こういった問題を回避するため、AppConfigをSingleton化せよ。</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true"></a>    <span class="co">// また他の問題があれば合わせて修正せよ。</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true"></a>    <span class="kw">class</span> AppConfig {</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true"></a>        <span class="kw">enum</span> BaseColor { Red, Green, Black };</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true"></a>        <span class="dt">void</span>      SetBaseColor(BaseColor color) <span class="kw">noexcept</span> { <span class="va">color_</span> = color; }</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true"></a>        BaseColor GetBaseColor() { <span class="cf">return</span> <span class="va">color_</span>; }</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true"></a></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true"></a>        <span class="dt">void</span>         SetUserName(<span class="bu">std::</span>string_view username) { <span class="va">username_</span> = username; }</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true"></a>        <span class="bu">std::</span>string&amp; GetUserName() { <span class="cf">return</span> <span class="va">username_</span>; }</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true"></a>        <span class="dt">void</span> Logging(<span class="dt">bool</span> is_logging) { <span class="va">is_logging_</span> = is_logging; }</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true"></a>        <span class="dt">bool</span> IsLoggin() { <span class="cf">return</span> <span class="va">is_logging_</span>; }</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true"></a>        <span class="co">// 他の設定値は省略</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true"></a>        <span class="dt">void</span> SetDefault()</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true"></a>        {</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true"></a>            SetBaseColor(Red);</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true"></a>            SetUserName(<span class="st">&quot;No Name&quot;</span>);</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true"></a>            Logging(<span class="kw">false</span>);</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true"></a>        }</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true"></a>        BaseColor   <span class="va">color_</span>{Red};</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">username_</span>{<span class="st">&quot;No Name&quot;</span>};</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true"></a>        <span class="dt">bool</span>        <span class="va">is_logging_</span>{<span class="kw">false</span>};</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true"></a>    };</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true"></a>    AppConfig AppConfig;</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true"></a></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true"></a>    <span class="kw">class</span> DesignPatternQ_F : <span class="kw">public</span> ::testing::Test {</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true"></a>    <span class="kw">protected</span>:</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> SetUp() <span class="kw">override</span> { AppConfig.SetDefault(); }</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true"></a></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="dt">void</span> TearDown() <span class="kw">override</span> { AppConfig.SetDefault(); }</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true"></a>    };</span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true"></a></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true"></a>    TEST_F(DesignPatternQ_F, Singleton)</span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true"></a>    {</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true"></a>        ASSERT_EQ(AppConfig::Red, AppConfig.GetBaseColor());</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;No Name&quot;</span>, AppConfig.GetUserName());</span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true"></a>        ASSERT_FALSE(AppConfig.IsLoggin());</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true"></a></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true"></a>        AppConfig.SetBaseColor(AppConfig::Green);</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true"></a>        ASSERT_EQ(AppConfig::Green, AppConfig.GetBaseColor());</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true"></a></span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true"></a>        AppConfig.SetUserName(<span class="st">&quot;Stroustrup&quot;</span>);</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;Stroustrup&quot;</span>, AppConfig.GetUserName());</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true"></a></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true"></a>        AppConfig.Logging(<span class="kw">true</span>);</span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true"></a>        ASSERT_TRUE(AppConfig.IsLoggin());</span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true"></a></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true"></a>        AppConfig.SetDefault();</span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true"></a>        ASSERT_EQ(AppConfig::Red, AppConfig.GetBaseColor());</span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;No Name&quot;</span>, AppConfig.GetUserName());</span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true"></a>        ASSERT_FALSE(AppConfig.IsLoggin());</span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_12">Singleton</a></li>
<li><a href="exercise_a.html#SS_20_9_14">解答例-Singleton</a></li>
</ul>
<h3 id="演習-state">演習-State <a id="SS_19_9_15"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/state.cpp 5</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true"></a>    <span class="co">// 下記クラスGreetingにはlang_に対する同型のswitch文が3個ある。</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true"></a>    <span class="co">// これは機能追加時にバグが混入しやすいアンチパターンであるため、</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true"></a>    <span class="co">// Stateパターンを用いリファクタリングせよ。</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true"></a>    <span class="co">// また、他の問題があれば合わせて修正せよ。</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true"></a>    <span class="kw">enum</span> <span class="kw">class</span> Language { English, Japanese, French };</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true"></a>    <span class="kw">class</span> Greeting {</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true"></a>        <span class="kw">explicit</span> Greeting(Language lang = Language::English) <span class="kw">noexcept</span> : <span class="va">lang_</span>{lang} {}</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true"></a>        <span class="dt">void</span> SetLanguage(Language lang) <span class="kw">noexcept</span> { <span class="va">lang_</span> = lang; }</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodMorning()</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true"></a>        {</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true"></a>            <span class="cf">switch</span> (<span class="va">lang_</span>) {</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true"></a>            <span class="cf">case</span> Language::Japanese:</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;おはよう&quot;</span>;</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true"></a>            <span class="cf">case</span> Language::French:</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;Bonjour&quot;</span>;</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true"></a>            <span class="cf">case</span> Language::English:</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true"></a>            <span class="cf">default</span>:</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;good morning&quot;</span>;</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true"></a>            }</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true"></a>        }</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true"></a>        <span class="bu">std::</span>string Hello()</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true"></a>        {</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true"></a>            <span class="cf">switch</span> (<span class="va">lang_</span>) {</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true"></a>            <span class="cf">case</span> Language::Japanese:</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;こんにちは&quot;</span>;</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true"></a>            <span class="cf">case</span> Language::French:</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;Bonjour&quot;</span>;</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true"></a>            <span class="cf">case</span> Language::English:</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true"></a>            <span class="cf">default</span>:</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;hello&quot;</span>;</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true"></a>            }</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true"></a>        }</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true"></a></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodEvening()</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true"></a>        {</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true"></a>            <span class="cf">switch</span> (<span class="va">lang_</span>) {</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true"></a>            <span class="cf">case</span> Language::Japanese:</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;こんばんは&quot;</span>;</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true"></a>            <span class="cf">case</span> Language::French:</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;bonne soirée&quot;</span>;</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true"></a>            <span class="cf">case</span> Language::English:</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true"></a>            <span class="cf">default</span>:</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">u8&quot;good evening&quot;</span>;</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true"></a>            }</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true"></a>        }</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true"></a></span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true"></a>        Language <span class="va">lang_</span>;</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true"></a>    };</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true"></a></span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true"></a>    TEST(DesignPatternQ, State)</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true"></a>    {</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true"></a>        <span class="kw">auto</span> greeting = Greeting{};</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true"></a></span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good morning&quot;</span>, greeting.GoodMorning());</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;hello&quot;</span>, greeting.Hello());</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good evening&quot;</span>, greeting.GoodEvening());</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true"></a></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true"></a>        greeting.SetLanguage(Language::Japanese);</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;おはよう&quot;</span>, greeting.GoodMorning());</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;こんにちは&quot;</span>, greeting.Hello());</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;こんばんは&quot;</span>, greeting.GoodEvening());</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true"></a></span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true"></a>        greeting.SetLanguage(Language::French);</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;Bonjour&quot;</span>, greeting.GoodMorning());</span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;Bonjour&quot;</span>, greeting.Hello());</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;bonne soirée&quot;</span>, greeting.GoodEvening());</span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true"></a></span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true"></a>        greeting.SetLanguage(Language::English);</span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good morning&quot;</span>, greeting.GoodMorning());</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;hello&quot;</span>, greeting.Hello());</span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good evening&quot;</span>, greeting.GoodEvening());</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_13">State</a></li>
<li><a href="exercise_a.html#SS_20_9_15">解答例-State</a></li>
</ul>
<h3 id="演習-null-object">演習-Null Object <a id="SS_19_9_16"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/null_object.cpp 38</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a>    <span class="co">// 下記クラスPersonにはgreeting_のヌルチェックを行う三項演算子が3つある。</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a>    <span class="co">// これはヌルポインタアクセスを起こしやすいアンチパターンであるため、</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a>    <span class="co">// Null Objectパターンを用いリファクタリングせよ。</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a>    <span class="co">// また、他の問題があれば合わせて修正せよ。</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a>    <span class="kw">class</span> Greeting {</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a>        <span class="kw">explicit</span> Greeting(Language lang = Language::English) : <span class="va">state_</span>{new_state(lang)} {}</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a>        <span class="dt">void</span> SetLanguage(Language lang) { <span class="va">state_</span> = new_state(lang); }</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodMorning() <span class="at">const</span> { <span class="cf">return</span> <span class="va">state_</span>-&gt;GoodMorning(); }</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true"></a>        <span class="bu">std::</span>string Hello() <span class="at">const</span> { <span class="cf">return</span> <span class="va">state_</span>-&gt;Hello(); }</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodEvening() <span class="at">const</span> { <span class="cf">return</span> <span class="va">state_</span>-&gt;GoodEvening(); }</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true"></a>        <span class="bu">std::</span>unique_ptr&lt;GreetingState&gt; <span class="va">state_</span>;</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>unique_ptr&lt;GreetingState&gt; new_state(Language lang)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true"></a>        {</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true"></a>            <span class="cf">switch</span> (lang) {</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true"></a>            <span class="cf">case</span> Language::Japanese:</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true"></a>                <span class="cf">return</span> <span class="bu">std::</span>make_unique&lt;GreetingState_Japanese&gt;();</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true"></a>            <span class="cf">case</span> Language::French:</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true"></a>                <span class="cf">return</span> <span class="bu">std::</span>make_unique&lt;GreetingState_French&gt;();</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true"></a>            <span class="cf">case</span> Language::English:</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true"></a>            <span class="cf">default</span>:</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true"></a>                <span class="cf">return</span> <span class="bu">std::</span>make_unique&lt;GreetingState_English&gt;();</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true"></a>            }</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true"></a>        }</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true"></a>    };</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true"></a>    <span class="kw">class</span> Person {</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true"></a>        <span class="kw">explicit</span> Person(Language lang, <span class="dt">bool</span> silent = <span class="kw">false</span>)</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true"></a>            : <span class="va">greeting_</span>{silent ? <span class="bu">std::</span>unique_ptr&lt;Greeting&gt;{} : <span class="bu">std::</span>make_unique&lt;Greeting&gt;(lang)}</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true"></a>        {</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true"></a>        }</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true"></a></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodMorning() { <span class="cf">return</span> <span class="va">greeting_</span> ? <span class="va">greeting_</span>-&gt;GoodMorning() : <span class="st">&quot;&quot;</span>; }</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true"></a>        <span class="bu">std::</span>string Hello() { <span class="cf">return</span> <span class="va">greeting_</span> ? <span class="va">greeting_</span>-&gt;Hello() : <span class="st">&quot;&quot;</span>; }</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true"></a>        <span class="bu">std::</span>string GoodEvening() { <span class="cf">return</span> <span class="va">greeting_</span> ? <span class="va">greeting_</span>-&gt;GoodEvening() : <span class="st">&quot;&quot;</span>; }</span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true"></a></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true"></a>        <span class="bu">std::</span>unique_ptr&lt;Greeting&gt; <span class="va">greeting_</span>;</span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true"></a>    };</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true"></a>    TEST(DesignPatternQ, NullObject)</span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true"></a>    {</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true"></a>        <span class="kw">auto</span> e = Person{Language::English};</span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true"></a></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good morning&quot;</span>, e.GoodMorning());</span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;hello&quot;</span>, e.Hello());</span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;good evening&quot;</span>, e.GoodEvening());</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true"></a></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true"></a>        <span class="kw">auto</span> j = Person{Language::Japanese};</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;おはよう&quot;</span>, j.GoodMorning());</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;こんにちは&quot;</span>, j.Hello());</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;こんばんは&quot;</span>, j.GoodEvening());</span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true"></a></span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true"></a>        <span class="kw">auto</span> f = Person{Language::French};</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;Bonjour&quot;</span>, f.GoodMorning());</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;Bonjour&quot;</span>, f.Hello());</span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;bonne soirée&quot;</span>, f.GoodEvening());</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true"></a></span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true"></a>        <span class="kw">auto</span> e_s = Person{Language::English, <span class="kw">true</span>};</span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true"></a></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;&quot;</span>, e_s.GoodMorning());</span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;&quot;</span>, e_s.Hello());</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">u8&quot;&quot;</span>, e_s.GoodEvening());</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_14">Null Object</a></li>
<li><a href="exercise_a.html#SS_20_9_16">解答例-Null Object</a></li>
</ul>
<h3 id="演習-templateメソッド">演習-Templateメソッド <a id="SS_19_9_17"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/template_method.cpp 5</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a>    <span class="co">// 下記クラスXxxDataFormatterXml、XxxDataFormatterCsvは同様の処理を行い、</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a>    <span class="co">// それぞれのフォーマットで文字列を出力する。このような処理のクローンはTemplate Method</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a>    <span class="co">// パターンにより排除できる。</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a>    <span class="co">// このパターンを用い、下記2クラスをリファクタリングせよ。</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true"></a>    <span class="co">// また、他の問題があれば合わせて修正せよ。</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true"></a>    <span class="kw">struct</span> XxxData {</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true"></a>        <span class="dt">int</span> a;</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true"></a>        <span class="dt">int</span> b;</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true"></a>        <span class="dt">int</span> c;</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true"></a>    };</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true"></a></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterXml {</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true"></a>        XxxDataFormatterXml() = <span class="cf">default</span>;</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true"></a>        {</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true"></a>            <span class="kw">auto</span> body = <span class="bu">std::</span>string{<span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true"></a></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true"></a>            body += <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true"></a>            body += <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true"></a>            body += <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.c) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true"></a>            body += <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true"></a></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">header_</span> + body + <span class="va">footer_</span>;</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true"></a>        }</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true"></a></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(<span class="bu">std::</span>vector&lt;XxxData&gt; <span class="at">const</span>&amp; xxx_datas) <span class="at">const</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true"></a>        {</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>string{<span class="va">header_</span>};</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true"></a></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; xxx_data : xxx_datas) {</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true"></a>                ret += <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true"></a>                ret += <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true"></a>                ret += <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true"></a>                ret += <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.c) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true"></a>                ret += <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true"></a>            }</span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true"></a></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true"></a>            <span class="cf">return</span> ret + <span class="va">footer_</span>;</span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true"></a>        }</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true"></a></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">header_</span> = <span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">footer_</span> = <span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true"></a>    };</span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true"></a></span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterCsv {</span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true"></a>        XxxDataFormatterCsv() = <span class="cf">default</span>;</span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true"></a></span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true"></a>        {</span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true"></a>            <span class="kw">auto</span> body = <span class="bu">std::</span>string{<span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;, &quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b)</span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true"></a>                                    + <span class="st">&quot;, &quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true"></a></span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">header_</span> + body;</span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true"></a>        }</span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true"></a></span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(<span class="bu">std::</span>vector&lt;XxxData&gt; <span class="at">const</span>&amp; xxx_datas) <span class="at">const</span></span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true"></a>        {</span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>string{<span class="va">header_</span>};</span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true"></a></span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; xxx_data : xxx_datas) {</span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true"></a>                ret += <span class="bu">std::</span>string{<span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;, &quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;, &quot;</span></span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true"></a>                                   + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true"></a>            }</span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true"></a></span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true"></a>            <span class="cf">return</span> ret;</span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true"></a>        }</span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true"></a></span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">header_</span> = <span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true"></a>    };</span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true"></a></span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true"></a>    TEST(DesignPatternQ, TemplateMethod)</span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true"></a>    {</span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true"></a>        <span class="kw">auto</span> xml = XxxDataFormatterXml{};</span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true"></a>        {</span>
<span id="cb71-83"><a href="#cb71-83" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_scalar = <span class="bu">std::</span>string{</span>
<span id="cb71-84"><a href="#cb71-84" aria-hidden="true"></a>                <span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-85"><a href="#cb71-85" aria-hidden="true"></a>                <span class="st">&quot;&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-86"><a href="#cb71-86" aria-hidden="true"></a>                <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-87"><a href="#cb71-87" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">1</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-88"><a href="#cb71-88" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">100</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-89"><a href="#cb71-89" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">10</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-90"><a href="#cb71-90" aria-hidden="true"></a>                <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-91"><a href="#cb71-91" aria-hidden="true"></a>                <span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-92"><a href="#cb71-92" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_scalar = xml.ToString({<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>});</span>
<span id="cb71-93"><a href="#cb71-93" aria-hidden="true"></a>            ASSERT_EQ(expect_scalar, actual_scalar);</span>
<span id="cb71-94"><a href="#cb71-94" aria-hidden="true"></a></span>
<span id="cb71-95"><a href="#cb71-95" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_array = <span class="bu">std::</span>string{</span>
<span id="cb71-96"><a href="#cb71-96" aria-hidden="true"></a>                <span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-97"><a href="#cb71-97" aria-hidden="true"></a>                <span class="st">&quot;&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-98"><a href="#cb71-98" aria-hidden="true"></a>                <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-99"><a href="#cb71-99" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">1</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-100"><a href="#cb71-100" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">100</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-101"><a href="#cb71-101" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">10</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-102"><a href="#cb71-102" aria-hidden="true"></a>                <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-103"><a href="#cb71-103" aria-hidden="true"></a>                <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-104"><a href="#cb71-104" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">2</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-105"><a href="#cb71-105" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">200</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-106"><a href="#cb71-106" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">20</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-107"><a href="#cb71-107" aria-hidden="true"></a>                <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-108"><a href="#cb71-108" aria-hidden="true"></a>                <span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-109"><a href="#cb71-109" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_array = xml.ToString({{<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>}, {<span class="dv">2</span>, <span class="dv">200</span>, <span class="dv">20</span>}});</span>
<span id="cb71-110"><a href="#cb71-110" aria-hidden="true"></a>            ASSERT_EQ(expect_array, actual_array);</span>
<span id="cb71-111"><a href="#cb71-111" aria-hidden="true"></a>        }</span>
<span id="cb71-112"><a href="#cb71-112" aria-hidden="true"></a></span>
<span id="cb71-113"><a href="#cb71-113" aria-hidden="true"></a>        <span class="kw">auto</span> csv = XxxDataFormatterCsv{};</span>
<span id="cb71-114"><a href="#cb71-114" aria-hidden="true"></a>        {</span>
<span id="cb71-115"><a href="#cb71-115" aria-hidden="true"></a>            <span class="kw">auto</span> expect_scalar = <span class="bu">std::</span>string{</span>
<span id="cb71-116"><a href="#cb71-116" aria-hidden="true"></a>                <span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-117"><a href="#cb71-117" aria-hidden="true"></a>                <span class="st">&quot;1, 100, 100</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-118"><a href="#cb71-118" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_scalar = csv.ToString({<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>});</span>
<span id="cb71-119"><a href="#cb71-119" aria-hidden="true"></a>            ASSERT_EQ(expect_scalar, actual_scalar);</span>
<span id="cb71-120"><a href="#cb71-120" aria-hidden="true"></a></span>
<span id="cb71-121"><a href="#cb71-121" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_array = <span class="bu">std::</span>string{</span>
<span id="cb71-122"><a href="#cb71-122" aria-hidden="true"></a>                <span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-123"><a href="#cb71-123" aria-hidden="true"></a>                <span class="st">&quot;1, 100, 100</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb71-124"><a href="#cb71-124" aria-hidden="true"></a>                <span class="st">&quot;2, 200, 200</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb71-125"><a href="#cb71-125" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_array = csv.ToString({{<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>}, {<span class="dv">2</span>, <span class="dv">200</span>, <span class="dv">20</span>}});</span>
<span id="cb71-126"><a href="#cb71-126" aria-hidden="true"></a>            ASSERT_EQ(expect_array, actual_array);</span>
<span id="cb71-127"><a href="#cb71-127" aria-hidden="true"></a>        }</span>
<span id="cb71-128"><a href="#cb71-128" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_15">Templateメソッド</a></li>
<li><a href="exercise_a.html#SS_20_9_17">解答例-Templateメソッド</a></li>
</ul>
<h3 id="演習-factory">演習-Factory <a id="SS_19_9_18"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/factory_lib.h 6</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true"></a>    <span class="co">// 下記クラスXxxDataFormatterXml、XxxDataFormatterCsvはヘッダファイルで宣言・定義を行ったために</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true"></a>    <span class="co">// 他の.cppファイルから直接アクセスできてしまう。</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true"></a>    <span class="co">// Factoryパターンを用いて、XxxDataFormatterXml、XxxDataFormatterCsvを他の.cppファイルから</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true"></a>    <span class="co">// 直接アクセスできないようにせよ。</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true"></a>    <span class="kw">struct</span> XxxData {</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true"></a>        <span class="dt">int</span> a;</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true"></a>        <span class="dt">int</span> b;</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true"></a>        <span class="dt">int</span> c;</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true"></a>    };</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterIF {</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true"></a>        XxxDataFormatterIF() <span class="kw">noexcept</span>                            = <span class="cf">default</span>;</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true"></a>        <span class="kw">virtual</span> ~XxxDataFormatterIF()                            = <span class="cf">default</span>;</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true"></a>        XxxDataFormatterIF(XxxDataFormatterIF <span class="at">const</span>&amp;)            = <span class="kw">delete</span>;</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true"></a>        XxxDataFormatterIF&amp; <span class="kw">operator</span>=(XxxDataFormatterIF <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true"></a>        {</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true"></a>            <span class="cf">return</span> header() + body(xxx_data) + footer();</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true"></a>        }</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true"></a></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(<span class="bu">std::</span>vector&lt;XxxData&gt; <span class="at">const</span>&amp; xxx_datas) <span class="at">const</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true"></a>        {</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true"></a>            <span class="kw">auto</span> ret = header();</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; xxx_data : xxx_datas) {</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true"></a>                ret += body(xxx_data);</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true"></a>            }</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true"></a></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true"></a>            <span class="cf">return</span> ret + footer();</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true"></a>        }</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true"></a></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; header() <span class="at">const</span>                      = <span class="dv">0</span>;</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; footer() <span class="at">const</span>                      = <span class="dv">0</span>;</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string        body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span> = <span class="dv">0</span>;</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true"></a>    };</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true"></a></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterXml <span class="kw">final</span> : <span class="kw">public</span> XxxDataFormatterIF {</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true"></a>        XxxDataFormatterXml()                   = <span class="cf">default</span>;</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true"></a>        <span class="kw">virtual</span> ~XxxDataFormatterXml() <span class="kw">override</span> = <span class="cf">default</span>;</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true"></a></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; header() <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; footer() <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string        body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true"></a>    };</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true"></a></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterCsv <span class="kw">final</span> : <span class="kw">public</span> XxxDataFormatterIF {</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true"></a>        XxxDataFormatterCsv()                   = <span class="cf">default</span>;</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true"></a>        <span class="kw">virtual</span> ~XxxDataFormatterCsv() <span class="kw">override</span> = <span class="cf">default</span>;</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true"></a></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; header() <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; footer() <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string        body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span> <span class="kw">override</span>;</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true"></a>    };</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/factory_lib.cpp 5</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true"></a>    <span class="bu">std::</span>string <span class="at">const</span>&amp; XxxDataFormatterXml::header() <span class="at">const</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true"></a>    {</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> header</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true"></a>            = <span class="bu">std::</span>string{<span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true"></a>        <span class="cf">return</span> header;</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true"></a>    }</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true"></a>    <span class="bu">std::</span>string <span class="at">const</span>&amp; XxxDataFormatterXml::footer() <span class="at">const</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true"></a>    {</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> footer = <span class="bu">std::</span>string{<span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true"></a>        <span class="cf">return</span> footer;</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true"></a>    }</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true"></a>    <span class="bu">std::</span>string XxxDataFormatterXml::body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true"></a>    {</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true"></a>        <span class="kw">auto</span> content = <span class="bu">std::</span>string{<span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true"></a></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true"></a>        content += <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true"></a>        content += <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true"></a>        content += <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">&quot;</span> + <span class="bu">std::</span>to_string(xxx_data.c) + <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true"></a>        <span class="cf">return</span> content + <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>;</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true"></a>    }</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true"></a>    <span class="bu">std::</span>string <span class="at">const</span>&amp; XxxDataFormatterCsv::header() <span class="at">const</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true"></a>    {</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> header = <span class="bu">std::</span>string{<span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true"></a></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true"></a>        <span class="cf">return</span> header;</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true"></a>    }</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true"></a>    <span class="bu">std::</span>string <span class="at">const</span>&amp; XxxDataFormatterCsv::footer() <span class="at">const</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true"></a>    {</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> footer = <span class="bu">std::</span>string{};</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true"></a></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true"></a>        <span class="cf">return</span> footer;</span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true"></a>    }</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true"></a></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true"></a>    <span class="bu">std::</span>string XxxDataFormatterCsv::body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true"></a>    {</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">std::</span>string{<span class="bu">std::</span>to_string(xxx_data.a) + <span class="st">&quot;, &quot;</span> + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;, &quot;</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true"></a>                           + <span class="bu">std::</span>to_string(xxx_data.b) + <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/factory.cpp 9</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true"></a>    TEST(DesignPatternQ, Factory)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true"></a>    {</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true"></a>        <span class="kw">auto</span> xml = XxxDataFormatterXml{};</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true"></a>        {</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_scalar = <span class="bu">std::</span>string{</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true"></a>                <span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true"></a>                <span class="st">&quot;&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true"></a>                <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">1</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">100</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">10</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true"></a>                <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true"></a>                <span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_scalar = xml.ToString({<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>});</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true"></a>            ASSERT_EQ(expect_scalar, actual_scalar);</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true"></a>        }</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true"></a>        <span class="kw">auto</span> csv = XxxDataFormatterCsv{};</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true"></a>        {</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_array = <span class="bu">std::</span>string{</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true"></a>                <span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true"></a>                <span class="st">&quot;1, 100, 100</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true"></a>                <span class="st">&quot;2, 200, 200</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_array = csv.ToString({{<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>}, {<span class="dv">2</span>, <span class="dv">200</span>, <span class="dv">20</span>}});</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true"></a>            ASSERT_EQ(expect_array, actual_array);</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true"></a>        }</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_16">Factory</a></li>
<li><a href="exercise_a.html#SS_20_9_18">解答例-Factory</a></li>
</ul>
<h3 id="演習-named-constructor">演習-Named Constructor <a id="SS_19_9_19"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/named_constructor_lib.h 14</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true"></a>    <span class="co">// 下記関数XxxDataFormatterFactoryはインターフェースクラスXxxDataFormatterIFのファクトリ関数</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true"></a>    <span class="co">// である。これをnamed constructorパターンで実装しなおせ。</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true"></a>    <span class="kw">class</span> XxxDataFormatterIF {</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true"></a>        XxxDataFormatterIF() <span class="kw">noexcept</span>                            = <span class="cf">default</span>;</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true"></a>        <span class="kw">virtual</span> ~XxxDataFormatterIF()                            = <span class="cf">default</span>;</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true"></a>        XxxDataFormatterIF(XxxDataFormatterIF <span class="at">const</span>&amp;)            = <span class="kw">delete</span>;</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true"></a>        XxxDataFormatterIF&amp; <span class="kw">operator</span>=(XxxDataFormatterIF <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true"></a>        {</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true"></a>            <span class="cf">return</span> header() + body(xxx_data) + footer();</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true"></a>        }</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true"></a>        <span class="bu">std::</span>string ToString(<span class="bu">std::</span>vector&lt;XxxData&gt; <span class="at">const</span>&amp; xxx_datas) <span class="at">const</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true"></a>        {</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true"></a>            <span class="kw">auto</span> ret = header();</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> <span class="at">const</span>&amp; xxx_data : xxx_datas) {</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true"></a>                ret += body(xxx_data);</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true"></a>            }</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true"></a></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true"></a>            <span class="cf">return</span> ret + footer();</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true"></a>        }</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true"></a></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; header() <span class="at">const</span>                      = <span class="dv">0</span>;</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string <span class="at">const</span>&amp; footer() <span class="at">const</span>                      = <span class="dv">0</span>;</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string        body(XxxData <span class="at">const</span>&amp; xxx_data) <span class="at">const</span> = <span class="dv">0</span>;</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true"></a>    };</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true"></a></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true"></a>    <span class="kw">enum</span> <span class="kw">class</span> XxxDataFormatterType { Xml, Csv, Table };</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true"></a></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true"></a>    XxxDataFormatterIF <span class="at">const</span>&amp; XxxDataFormatterFactory(XxxDataFormatterType type) <span class="kw">noexcept</span>;</span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/named_constructor_lib.cpp 114</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true"></a>    XxxDataFormatterIF <span class="at">const</span>&amp; XxxDataFormatterFactory(XxxDataFormatterType type) <span class="kw">noexcept</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true"></a>    {</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> xml   = XxxDataFormatterXml{};</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> csv   = XxxDataFormatterCsv{};</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true"></a>        <span class="at">static</span> <span class="kw">auto</span> <span class="at">const</span> table = XxxDataFormatterTable{};</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true"></a>        <span class="cf">switch</span> (type) {</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true"></a>        <span class="cf">case</span> XxxDataFormatterType::Xml:</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true"></a>            <span class="cf">return</span> xml;</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true"></a>        <span class="cf">case</span> XxxDataFormatterType::Csv:</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true"></a>            <span class="cf">return</span> csv;</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true"></a>        <span class="cf">case</span> XxxDataFormatterType::Table:</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true"></a>            <span class="cf">return</span> table;</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true"></a>        <span class="cf">default</span>:</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true"></a>            <span class="ot">assert</span>(<span class="st">&quot;unknown type&quot;</span>);</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true"></a>            <span class="cf">return</span> csv;</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true"></a>        }</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true"></a>    }</span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/named_constructor.cpp 9</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true"></a>    TEST(DesignPatternQ, NamedConstructor)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true"></a>    {</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; xml = XxxDataFormatterFactory(XxxDataFormatterType::Xml);</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true"></a>        {</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_scalar = <span class="bu">std::</span>string{</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true"></a>                <span class="st">&quot;&lt;?xml version=</span><span class="sc">\&quot;</span><span class="st">1.0</span><span class="sc">\&quot;</span><span class="st"> encoding=</span><span class="sc">\&quot;</span><span class="st">UTF-8</span><span class="sc">\&quot;</span><span class="st"> ?&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true"></a>                <span class="st">&quot;&lt;XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true"></a>                <span class="st">&quot;&lt;Item&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData a=</span><span class="sc">\&quot;</span><span class="st">1</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData b=</span><span class="sc">\&quot;</span><span class="st">100</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true"></a>                <span class="st">&quot;    &lt;XxxData c=</span><span class="sc">\&quot;</span><span class="st">10</span><span class="sc">\&quot;</span><span class="st">&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true"></a>                <span class="st">&quot;&lt;/Itemp&gt;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true"></a>                <span class="st">&quot;&lt;/XxxDataFormatterXml&gt;</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_scalar = xml.ToString({<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>});</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true"></a>            ASSERT_EQ(expect_scalar, actual_scalar);</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true"></a>        }</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true"></a></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; csv = XxxDataFormatterFactory(XxxDataFormatterType::Csv);</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true"></a>        {</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_array = <span class="bu">std::</span>string{</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true"></a>                <span class="st">&quot;a, b, c</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true"></a>                <span class="st">&quot;1, 100, 100</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true"></a>                <span class="st">&quot;2, 200, 200</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_array = csv.ToString({{<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10</span>}, {<span class="dv">2</span>, <span class="dv">200</span>, <span class="dv">20</span>}});</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true"></a></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true"></a>            ASSERT_EQ(expect_array, actual_array);</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true"></a>        }</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span>&amp; table = XxxDataFormatterFactory(XxxDataFormatterType::Table);</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true"></a>        {</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> expect_array = <span class="bu">std::</span>string{</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true"></a>                <span class="st">&quot;+--------|--------|--------+</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true"></a>                <span class="st">&quot;| a      | b      | c      |</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true"></a>                <span class="st">&quot;+--------|--------|--------+</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true"></a>                <span class="st">&quot;| 3      | 300    | 30     |</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true"></a>                <span class="st">&quot;+--------|--------|--------+</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true"></a>                <span class="st">&quot;| 4      | 400    | 40     |</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true"></a>                <span class="st">&quot;+--------|--------|--------+</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true"></a>            <span class="kw">auto</span> <span class="at">const</span> actual_array = table.ToString({{<span class="dv">3</span>, <span class="dv">300</span>, <span class="dv">30</span>}, {<span class="dv">4</span>, <span class="dv">400</span>, <span class="dv">40</span>}});</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true"></a></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true"></a>            ASSERT_EQ(expect_array, actual_array);</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true"></a>        }</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_17">Named Constructor</a></li>
<li><a href="exercise_a.html#SS_20_9_19">解答例-Named Constructor</a></li>
</ul>
<h3 id="演習-proxy">演習-Proxy <a id="SS_19_9_20"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/proxy.cpp 7</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true"></a>    <span class="co">// 下記クラスLsDirのFileListはlsコマンドをpopenにより実行し、その戻り値をstd::stringで返す。</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true"></a>    <span class="co">// popenはコストの高いコールなので、パフォーマンスを上げるためにlsの戻り値をキャッシュしたいが、</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true"></a>    <span class="co">// 現行のLsDirも必要である。</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true"></a>    <span class="co">// Proxyパターンを使い、この問題に対処するためのLsDirCachedを作れ。</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true"></a>    <span class="kw">class</span> LsDir {</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true"></a>        LsDir()  = <span class="cf">default</span>;</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true"></a>        ~LsDir() = <span class="cf">default</span>;</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true"></a>        <span class="dt">void</span>               SetArgs(<span class="bu">std::</span>string_view args) { <span class="va">args_</span> = args; }</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; GetArgs() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">args_</span>; }</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true"></a>        <span class="bu">std::</span>string FileList() <span class="at">const</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true"></a>        {</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true"></a>            <span class="kw">auto</span> cmd      = <span class="bu">std::</span>string{<span class="st">&quot;ls &quot;</span>} + GetArgs();</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true"></a>            <span class="kw">auto</span> to_close = [](<span class="dt">FILE</span>* f) { fclose(f); };</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true"></a>            <span class="kw">auto</span> stream = <span class="bu">std::</span>unique_ptr&lt;<span class="dt">FILE</span>, <span class="kw">decltype</span>(to_close)&gt;{popen(cmd.c_str(), <span class="st">&quot;r&quot;</span>), to_close};</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true"></a></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true"></a>            <span class="kw">auto</span> files = <span class="bu">std::</span>string{};</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true"></a>            <span class="dt">char</span> buff[<span class="dv">256</span>];</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true"></a>            <span class="cf">while</span> (fgets(buff, <span class="kw">sizeof</span>(buff) - <span class="dv">1</span>, stream.get()) != NULL) {</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true"></a>                files += buff;</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true"></a>            }</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true"></a></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true"></a>            <span class="cf">return</span> files;</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true"></a>        }</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true"></a></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="va">args_</span>{};</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true"></a>    };</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true"></a></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true"></a>    TEST(DesignPatternQ, Proxy)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true"></a>    {</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true"></a>        <span class="kw">auto</span> ld = LsDir{};</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true"></a></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true"></a>        {</span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true"></a>            ld.SetArgs(<span class="st">&quot;../ut_data/&quot;</span>);</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true"></a>            <span class="kw">auto</span> exp = <span class="bu">std::</span>string{<span class="st">&quot;a.cpp</span><span class="sc">\n</span><span class="st">a.h</span><span class="sc">\n</span><span class="st">abc.cpp</span><span class="sc">\n</span><span class="st">abc.h</span><span class="sc">\n</span><span class="st">d</span><span class="sc">\n</span><span class="st">efghij.cpp</span><span class="sc">\n</span><span class="st">efghij.h</span><span class="sc">\n</span><span class="st">lib</span><span class="sc">\n</span><span class="st">o</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true"></a>            <span class="kw">auto</span> act = ld.FileList();</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true"></a>            ASSERT_EQ(exp, act);</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true"></a>            ASSERT_EQ(act, ld.FileList());</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true"></a>        }</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true"></a>        {</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true"></a>            ld.SetArgs(<span class="st">&quot;../ut_data/lib/&quot;</span>);</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true"></a></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true"></a>            <span class="kw">auto</span> exp = <span class="bu">std::</span>string{<span class="st">&quot;lib.cpp</span><span class="sc">\n</span><span class="st">lib.h</span><span class="sc">\n</span><span class="st">&quot;</span>};</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true"></a>            <span class="kw">auto</span> act = ld.FileList();</span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true"></a></span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true"></a>            ASSERT_EQ(exp, act);</span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true"></a>            ASSERT_EQ(act, ld.FileList());</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true"></a>        }</span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_18">Proxy</a></li>
<li><a href="exercise_a.html#SS_20_9_20">解答例-Proxy</a></li>
</ul>
<h3 id="演習-strategy">演習-Strategy <a id="SS_19_9_21"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/strategy.cpp 11</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true"></a>    <span class="co">// 下記find_filesは醜悪であるだけでなく、拡張性もない。</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true"></a>    <span class="co">// Strategyパターンを用い、この問題に対処せよ。</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true"></a>    <span class="kw">enum</span> <span class="kw">class</span> FindCondition {</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true"></a>        File,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true"></a>        Dir,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true"></a>        FileCpp,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true"></a>    };</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true"></a>    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; find_files(<span class="bu">std::</span>string <span class="at">const</span>&amp; path, FindCondition condition)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true"></a>    {</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true"></a>        <span class="kw">namespace</span> fs = <span class="bu">std::</span>filesystem;</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true"></a>        <span class="kw">auto</span> files = <span class="bu">std::</span>vector&lt;fs::path&gt;{};</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true"></a>        <span class="co">// recursive_directory_iteratorはファイルシステム依存するため、その依存を排除する他の処理</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true"></a>        <span class="bu">std::</span>copy(fs::recursive_directory_iterator{path}, fs::recursive_directory_iterator{},</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true"></a>                  <span class="bu">std::</span>back_inserter(files));</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true"></a></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true"></a>        <span class="bu">std::</span>sort(files.begin(), files.end());</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true"></a>        <span class="kw">auto</span> ret = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true"></a></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true"></a>        <span class="cf">for</span> (fs::path <span class="at">const</span>&amp; p : files) {</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true"></a>            <span class="kw">auto</span> is_match = <span class="kw">false</span>;</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true"></a></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true"></a>            <span class="cf">switch</span> (condition) {</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true"></a>            <span class="cf">case</span> FindCondition::File:</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true"></a>                <span class="cf">if</span> (fs::is_regular_file(p)) {</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true"></a>                    is_match = <span class="kw">true</span>;</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true"></a>                }</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true"></a>                <span class="cf">break</span>;</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true"></a>            <span class="cf">case</span> FindCondition::Dir:</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true"></a>                <span class="cf">if</span> (fs::is_directory(p)) {</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true"></a>                    is_match = <span class="kw">true</span>;</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true"></a>                }</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true"></a>                <span class="cf">break</span>;</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true"></a>            <span class="cf">case</span> FindCondition::FileCpp: {</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true"></a>                <span class="kw">auto</span> <span class="at">const</span> filename = p.filename().generic_string();</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true"></a>                <span class="kw">auto</span> <span class="at">const</span> cpp_file = <span class="bu">std::</span>string{<span class="st">&quot;.cpp&quot;</span>};</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true"></a></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true"></a>                <span class="cf">if</span> (filename.length() &gt; cpp_file.length()</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true"></a>                    &amp;&amp; (filename.substr(filename.length() - cpp_file.length()) == cpp_file)) {</span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true"></a>                    is_match = <span class="kw">true</span>;</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true"></a>                }</span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true"></a>                <span class="cf">break</span>;</span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true"></a>            }</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true"></a>            <span class="cf">default</span>:</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true"></a>                <span class="ot">assert</span>(<span class="kw">false</span>);</span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true"></a>            }</span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true"></a></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true"></a>            <span class="cf">if</span> (is_match) {</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true"></a>                ret.emplace_back(p.generic_string());</span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true"></a>            }</span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true"></a>        }</span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true"></a></span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true"></a>        <span class="cf">return</span> ret;</span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true"></a>    }</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true"></a></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true"></a>    TEST(DesignPatternQ, Strategy)</span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true"></a>    {</span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true"></a>        <span class="kw">auto</span> sort = [](<span class="kw">auto</span>&amp;&amp; v) {</span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true"></a>            <span class="bu">std::</span>sort(v.begin(), v.end());</span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true"></a>            <span class="cf">return</span> v;</span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true"></a>        };</span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true"></a></span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true"></a>        {</span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true"></a>            <span class="kw">auto</span> exp = sort(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{</span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true"></a>                <span class="st">&quot;../ut_data/a.cpp&quot;</span>, <span class="st">&quot;../ut_data/a.h&quot;</span>, <span class="st">&quot;../ut_data/abc.cpp&quot;</span>, <span class="st">&quot;../ut_data/abc.h&quot;</span>,</span>
<span id="cb79-72"><a href="#cb79-72" aria-hidden="true"></a>                <span class="st">&quot;../ut_data/d/a.d&quot;</span>, <span class="st">&quot;../ut_data/efghij.cpp&quot;</span>, <span class="st">&quot;../ut_data/efghij.h&quot;</span>,</span>
<span id="cb79-73"><a href="#cb79-73" aria-hidden="true"></a>                <span class="st">&quot;../ut_data/lib/lib.cpp&quot;</span>, <span class="st">&quot;../ut_data/lib/lib.h&quot;</span>, <span class="st">&quot;../ut_data/o/a.o&quot;</span>});</span>
<span id="cb79-74"><a href="#cb79-74" aria-hidden="true"></a>            <span class="kw">auto</span> act = find_files(<span class="st">&quot;../ut_data&quot;</span>, FindCondition::File);</span>
<span id="cb79-75"><a href="#cb79-75" aria-hidden="true"></a></span>
<span id="cb79-76"><a href="#cb79-76" aria-hidden="true"></a>            ASSERT_EQ(exp, act);</span>
<span id="cb79-77"><a href="#cb79-77" aria-hidden="true"></a>        }</span>
<span id="cb79-78"><a href="#cb79-78" aria-hidden="true"></a>        {</span>
<span id="cb79-79"><a href="#cb79-79" aria-hidden="true"></a>            <span class="kw">auto</span> exp = sort(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;../ut_data/d&quot;</span>, <span class="st">&quot;../ut_data/lib&quot;</span>, <span class="st">&quot;../ut_data/o&quot;</span>});</span>
<span id="cb79-80"><a href="#cb79-80" aria-hidden="true"></a>            <span class="kw">auto</span> act = find_files(<span class="st">&quot;../ut_data&quot;</span>, FindCondition::Dir);</span>
<span id="cb79-81"><a href="#cb79-81" aria-hidden="true"></a></span>
<span id="cb79-82"><a href="#cb79-82" aria-hidden="true"></a>            ASSERT_EQ(exp, act);</span>
<span id="cb79-83"><a href="#cb79-83" aria-hidden="true"></a>        }</span>
<span id="cb79-84"><a href="#cb79-84" aria-hidden="true"></a>        {</span>
<span id="cb79-85"><a href="#cb79-85" aria-hidden="true"></a>            <span class="kw">auto</span> exp</span>
<span id="cb79-86"><a href="#cb79-86" aria-hidden="true"></a>                = sort(<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;../ut_data/a.cpp&quot;</span>, <span class="st">&quot;../ut_data/abc.cpp&quot;</span>,</span>
<span id="cb79-87"><a href="#cb79-87" aria-hidden="true"></a>                                                <span class="st">&quot;../ut_data/efghij.cpp&quot;</span>, <span class="st">&quot;../ut_data/lib/lib.cpp&quot;</span>});</span>
<span id="cb79-88"><a href="#cb79-88" aria-hidden="true"></a>            <span class="kw">auto</span> act = find_files(<span class="st">&quot;../ut_data&quot;</span>, FindCondition::FileCpp);</span>
<span id="cb79-89"><a href="#cb79-89" aria-hidden="true"></a></span>
<span id="cb79-90"><a href="#cb79-90" aria-hidden="true"></a>            ASSERT_EQ(exp, act);</span>
<span id="cb79-91"><a href="#cb79-91" aria-hidden="true"></a>        }</span>
<span id="cb79-92"><a href="#cb79-92" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_19">Strategy</a></li>
<li><a href="exercise_a.html#SS_20_9_21">解答例-Strategy</a></li>
</ul>
<h3 id="演習-visitor">演習-Visitor <a id="SS_19_9_22"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/visitor.cpp 9</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true"></a>    <span class="co">// 下記クラスFile、Dir、OtherEntityはクラスFileEntityから派生し、</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true"></a>    <span class="co">// それぞれが自身をstd::stringに変換するアルゴリズム関数</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true"></a>    <span class="co">//      * to_string_normal()</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true"></a>    <span class="co">//      * to_string_with_char()</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true"></a>    <span class="co">//      * to_string_with_children()</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true"></a>    <span class="co">// をオーバーライドしている。これはポリモーフィズムの使用方法としては正しいが、</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true"></a>    <span class="co">// to_string_xxx系統のインターフェースがが大量に増えた場合に、</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true"></a>    <span class="co">// FileEntityのインターフェースがそれに比例して増えてしまう問題を持っている。</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true"></a>    <span class="co">// Visitorパターンを使用しこれに対処せよ。</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true"></a>    <span class="kw">class</span> FileEntity {</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true"></a>        <span class="kw">explicit</span> FileEntity(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : <span class="va">pathname_</span>{strip(pathname)} {}</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true"></a>        <span class="kw">virtual</span> ~FileEntity() = <span class="cf">default</span>;</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; Pathname() <span class="at">const</span> <span class="kw">noexcept</span> { <span class="cf">return</span> <span class="va">pathname_</span>; }</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true"></a>        <span class="bu">std::</span>string ToStringNormal() <span class="at">const</span> { <span class="cf">return</span> to_string_normal(); }</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true"></a>        <span class="bu">std::</span>string ToStringWithChar() <span class="at">const</span> { <span class="cf">return</span> to_string_with_char(); }</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true"></a>        <span class="bu">std::</span>string ToStringWithChildren() <span class="at">const</span> { <span class="cf">return</span> to_string_with_children(); }</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">pathname_</span>;</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_normal() <span class="at">const</span>        = <span class="dv">0</span>;</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_char() <span class="at">const</span>     = <span class="dv">0</span>;</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_children() <span class="at">const</span> = <span class="dv">0</span>;</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>string strip(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true"></a>        {</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true"></a>            <span class="cf">return</span> <span class="bu">std::</span>regex_replace(pathname, <span class="bu">std::</span>regex{<span class="st">R&quot;(/+$)&quot;</span>}, <span class="st">&quot;&quot;</span>);</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true"></a>        }</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true"></a>    };</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true"></a>    <span class="kw">class</span> File <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true"></a>        <span class="kw">explicit</span> File(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true"></a></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_normal() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname(); }</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_char() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname(); };</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_children() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname(); };</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true"></a>    };</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true"></a></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true"></a>    <span class="kw">class</span> Dir <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true"></a>        <span class="kw">explicit</span> Dir(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true"></a></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_normal() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname() + <span class="ch">&#39;/&#39;</span>; }</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_char() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> to_string_normal(); };</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_children() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> find_files(Pathname()); };</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true"></a></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>string find_files(<span class="bu">std::</span>string <span class="at">const</span>&amp; dir)</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true"></a>        {</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true"></a>            <span class="kw">namespace</span> fs = <span class="bu">std::</span>filesystem;</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true"></a></span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true"></a>            <span class="kw">auto</span> files = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true"></a></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true"></a>            <span class="bu">std::</span>for_each(fs::recursive_directory_iterator{dir}, fs::recursive_directory_iterator{},</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true"></a>                          [&amp;files](fs::path <span class="at">const</span>&amp; p) { files.emplace_back(p.generic_string()); });</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true"></a></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true"></a>            <span class="bu">std::</span>sort(files.begin(), files.end());</span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true"></a></span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>string{dir};</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true"></a></span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> f : files) {</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true"></a>                ret += <span class="ch">&#39; &#39;</span> + f;</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true"></a>            }</span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true"></a></span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true"></a>            <span class="cf">return</span> ret;</span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true"></a>        }</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true"></a>    };</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true"></a></span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true"></a>    <span class="kw">class</span> OtherEntity <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true"></a>        <span class="kw">explicit</span> OtherEntity(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true"></a></span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_normal() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname(); }</span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_char() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname() + <span class="ch">&#39;+&#39;</span>; };</span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string_with_children() <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> Pathname(); };</span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true"></a>    };</span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true"></a></span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true"></a>    TEST(DesignPatternQ, Visitor)</span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true"></a>    {</span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> f0 = File{<span class="st">&quot;../ut_data/a.cpp&quot;</span>};</span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> f1 = File{<span class="st">&quot;../ut_data/a.cpp///&quot;</span>};</span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true"></a></span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.Pathname());</span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.Pathname());</span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToStringNormal());</span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToStringWithChar());</span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToStringWithChildren());</span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true"></a></span>
<span id="cb80-97"><a href="#cb80-97" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> dir = Dir{<span class="st">&quot;../ut_data/lib/&quot;</span>};</span>
<span id="cb80-98"><a href="#cb80-98" aria-hidden="true"></a></span>
<span id="cb80-99"><a href="#cb80-99" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib&quot;</span>, dir.Pathname());</span>
<span id="cb80-100"><a href="#cb80-100" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib/&quot;</span>, dir.ToStringNormal());</span>
<span id="cb80-101"><a href="#cb80-101" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib/&quot;</span>, dir.ToStringWithChar());</span>
<span id="cb80-102"><a href="#cb80-102" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib ../ut_data/lib/lib.cpp ../ut_data/lib/lib.h&quot;</span>,</span>
<span id="cb80-103"><a href="#cb80-103" aria-hidden="true"></a>                  dir.ToStringWithChildren());</span>
<span id="cb80-104"><a href="#cb80-104" aria-hidden="true"></a></span>
<span id="cb80-105"><a href="#cb80-105" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> other = OtherEntity{<span class="st">&quot;symbolic_link&quot;</span>};</span>
<span id="cb80-106"><a href="#cb80-106" aria-hidden="true"></a></span>
<span id="cb80-107"><a href="#cb80-107" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.Pathname());</span>
<span id="cb80-108"><a href="#cb80-108" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.ToStringNormal());</span>
<span id="cb80-109"><a href="#cb80-109" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link+&quot;</span>, other.ToStringWithChar());</span>
<span id="cb80-110"><a href="#cb80-110" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.ToStringWithChildren());</span>
<span id="cb80-111"><a href="#cb80-111" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_20">Visitor</a></li>
<li><a href="exercise_a.html#SS_20_9_22">解答例-Visitor</a></li>
</ul>
<h3 id="演習-crtp">演習-CRTP <a id="SS_19_9_23"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/crtp.cpp 9</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true"></a>    <span class="co">// 下記クラスFileEntityから派生しクラスFile、Dir、OtherEntityは、</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true"></a>    <span class="co">// Visitorパターンを利用しているため、そのすべてで下記のコードクローンを持つ。</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true"></a>    <span class="co">//    virtual std::string to_string(Visitor const&amp; to_s) const { return to_s.Visit(*this); }</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true"></a>    <span class="co">// このコードクローンのthisの型は、それぞれFile、Dir、OtherEntityとなるため、</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true"></a>    <span class="co">// この関数をFileEntityで定義すると動作が変わってしまい、単純には統一できない。</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true"></a>    <span class="co">// CRTPを用い、このクローンを削除せよ。</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true"></a>    <span class="kw">class</span> Visitor;</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true"></a>    <span class="kw">class</span> FileEntity {</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true"></a>        <span class="kw">explicit</span> FileEntity(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : <span class="va">pathname_</span>{strip(pathname)} {}</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true"></a>        <span class="kw">virtual</span> ~FileEntity() = <span class="cf">default</span>;</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span>&amp; Pathname() <span class="at">const</span> { <span class="cf">return</span> <span class="va">pathname_</span>; }</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true"></a>        <span class="bu">std::</span>string        ToString(Visitor <span class="at">const</span>&amp; to_s) <span class="at">const</span> { <span class="cf">return</span> to_string(to_s); }</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true"></a>        <span class="bu">std::</span>string <span class="at">const</span> <span class="va">pathname_</span>;</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string(Visitor <span class="at">const</span>&amp; to_s) <span class="at">const</span> = <span class="dv">0</span>;</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>string  strip(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true"></a>        {</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true"></a>            <span class="cf">return</span> <span class="bu">std::</span>regex_replace(pathname, <span class="bu">std::</span>regex{<span class="st">R&quot;(/+$)&quot;</span>}, <span class="st">&quot;&quot;</span>);</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true"></a>        }</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true"></a>    };</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true"></a></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true"></a>    <span class="kw">class</span> File;</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true"></a>    <span class="kw">class</span> Dir;</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true"></a>    <span class="kw">class</span> OtherEntity;</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true"></a>    <span class="kw">class</span> Visitor {</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true"></a>        <span class="kw">virtual</span> ~Visitor() = <span class="cf">default</span>;</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true"></a>        <span class="bu">std::</span>string Visit(File <span class="at">const</span>&amp; file) <span class="at">const</span> { <span class="cf">return</span> visit(file); }</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true"></a>        <span class="bu">std::</span>string Visit(Dir <span class="at">const</span>&amp; dir) <span class="at">const</span> { <span class="cf">return</span> visit(dir); }</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true"></a>        <span class="bu">std::</span>string Visit(OtherEntity <span class="at">const</span>&amp; other) <span class="at">const</span> { <span class="cf">return</span> visit(other); }</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(File <span class="at">const</span>&amp; file) <span class="at">const</span>     = <span class="dv">0</span>;</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(Dir <span class="at">const</span>&amp; dir) <span class="at">const</span>       = <span class="dv">0</span>;</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(OtherEntity <span class="at">const</span>&amp; f) <span class="at">const</span> = <span class="dv">0</span>;</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true"></a>    };</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true"></a></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true"></a>    <span class="kw">class</span> File <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true"></a>        <span class="kw">explicit</span> File(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true"></a></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string(Visitor <span class="at">const</span>&amp; to_s) <span class="at">const</span> { <span class="cf">return</span> to_s.Visit(*<span class="kw">this</span>); }</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true"></a>    };</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true"></a>    <span class="kw">class</span> Dir <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true"></a>        <span class="kw">explicit</span> Dir(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true"></a></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string(Visitor <span class="at">const</span>&amp; to_s) <span class="at">const</span> { <span class="cf">return</span> to_s.Visit(*<span class="kw">this</span>); }</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true"></a>    };</span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true"></a></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true"></a>    <span class="kw">class</span> OtherEntity <span class="kw">final</span> : <span class="kw">public</span> FileEntity {</span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true"></a>        <span class="kw">explicit</span> OtherEntity(<span class="bu">std::</span>string <span class="at">const</span>&amp; pathname) : FileEntity{pathname} {}</span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true"></a></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string to_string(Visitor <span class="at">const</span>&amp; to_s) <span class="at">const</span> { <span class="cf">return</span> to_s.Visit(*<span class="kw">this</span>); }</span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true"></a>    };</span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true"></a></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true"></a>    <span class="kw">class</span> ToStringNormal : <span class="kw">public</span> Visitor {</span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(File <span class="at">const</span>&amp; file) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> file.Pathname(); }</span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(Dir <span class="at">const</span>&amp; dir) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> dir.Pathname() + <span class="ch">&#39;/&#39;</span>; }</span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(OtherEntity <span class="at">const</span>&amp; other) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> other.Pathname(); }</span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true"></a>    };</span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true"></a></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true"></a>    <span class="kw">class</span> ToStringWithChar : <span class="kw">public</span> Visitor {</span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(File <span class="at">const</span>&amp; file) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> file.Pathname(); }</span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(Dir <span class="at">const</span>&amp; dir) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> dir.Pathname() + <span class="ch">&#39;/&#39;</span>; }</span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(OtherEntity <span class="at">const</span>&amp; other) <span class="at">const</span> <span class="kw">override</span></span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true"></a>        {</span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true"></a>            <span class="cf">return</span> other.Pathname() + <span class="ch">&#39;+&#39;</span>;</span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true"></a>        }</span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true"></a>    };</span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true"></a></span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true"></a>    <span class="kw">class</span> ToStringWithChildren : <span class="kw">public</span> Visitor {</span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(File <span class="at">const</span>&amp; file) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> file.Pathname(); }</span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(Dir <span class="at">const</span>&amp; dir) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> find_files(dir.Pathname()); }</span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true"></a>        <span class="kw">virtual</span> <span class="bu">std::</span>string visit(OtherEntity <span class="at">const</span>&amp; other) <span class="at">const</span> <span class="kw">override</span> { <span class="cf">return</span> other.Pathname(); }</span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true"></a></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true"></a>        <span class="at">static</span> <span class="bu">std::</span>string find_files(<span class="bu">std::</span>string <span class="at">const</span>&amp; dir)</span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true"></a>        {</span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true"></a>            <span class="kw">namespace</span> fs = <span class="bu">std::</span>filesystem;</span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true"></a></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true"></a>            <span class="kw">auto</span> files = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{};</span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true"></a></span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true"></a>            <span class="bu">std::</span>for_each(fs::recursive_directory_iterator{dir}, fs::recursive_directory_iterator{},</span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true"></a>                          [&amp;files](fs::path <span class="at">const</span>&amp; p) { files.emplace_back(p.generic_string()); });</span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true"></a></span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true"></a>            <span class="bu">std::</span>sort(files.begin(), files.end());</span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true"></a></span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true"></a>            <span class="kw">auto</span> ret = <span class="bu">std::</span>string{dir};</span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true"></a></span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true"></a>            <span class="cf">for</span> (<span class="kw">auto</span> f : files) {</span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true"></a>                ret += <span class="ch">&#39; &#39;</span> + f;</span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true"></a>            }</span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true"></a></span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true"></a>            <span class="cf">return</span> ret;</span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true"></a>        }</span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true"></a>    };</span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true"></a></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true"></a>    TEST(DesignPatternQ, CRTP)</span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true"></a>    {</span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true"></a>        <span class="kw">auto</span> ts_normal   = ToStringNormal{};</span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true"></a>        <span class="kw">auto</span> ts_char     = ToStringWithChar{};</span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true"></a>        <span class="kw">auto</span> ts_children = ToStringWithChildren{};</span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true"></a></span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> f0 = File{<span class="st">&quot;../ut_data/a.cpp&quot;</span>};</span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> f1 = File{<span class="st">&quot;../ut_data/a.cpp///&quot;</span>};</span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true"></a></span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.Pathname());</span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.Pathname());</span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true"></a></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToString(ts_normal));</span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToString(ts_char));</span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/a.cpp&quot;</span>, f0.ToString(ts_children));</span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true"></a></span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> dir = Dir{<span class="st">&quot;../ut_data/lib/&quot;</span>};</span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true"></a></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib&quot;</span>, dir.Pathname());</span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib/&quot;</span>, dir.ToString(ts_normal));</span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib/&quot;</span>, dir.ToString(ts_char));</span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;../ut_data/lib ../ut_data/lib/lib.cpp ../ut_data/lib/lib.h&quot;</span>,</span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true"></a>                  dir.ToString(ts_children));</span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true"></a></span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true"></a>        <span class="kw">auto</span> <span class="at">const</span> other = OtherEntity{<span class="st">&quot;symbolic_link&quot;</span>};</span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true"></a></span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.Pathname());</span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.ToString(ts_normal));</span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link+&quot;</span>, other.ToString(ts_char));</span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;symbolic_link&quot;</span>, other.ToString(ts_children));</span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_21">CRTP(curiously recurring template pattern)</a></li>
<li><a href="exercise_a.html#SS_20_9_23">解答例-CRTP</a></li>
</ul>
<h3 id="演習-observer">演習-Observer <a id="SS_19_9_24"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/design_pattern_q/observer.cpp 7</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true"></a>    <span class="co">// 下記クラスはそれぞれが</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true"></a>    <span class="co">//      * ViewX、 ViewY : GUIへの出力(描画)</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true"></a>    <span class="co">//      * Model         : 何らかのビジネスロジックの演算</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true"></a>    <span class="co">//      * Controller    : OKボタンクリックイベントをModelへ通知</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true"></a>    <span class="co">// を行うことを模擬している。</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true"></a>    <span class="co">// 依存関係Model-&gt;ViewX、ViewYはMVCに逆行しているため下記のような問題を持つ。</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true"></a>    <span class="co">//      * ViewX、ViewYの変更がModelに伝搬してしまう。</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true"></a>    <span class="co">//      * この例は単純であるためViewX、ViewY-&gt;Modelへの依存関係は存在しないが、</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true"></a>    <span class="co">//        実際のアプリケーションではそのような依存関係が存在するため、依存関係が循環してしまう。</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true"></a>    <span class="co">//      * ModelがダイレクトにViewX、ViewYへ出力するため、単体テストの実施は困難である。</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true"></a>    <span class="co">//      * この依存関係が直接の原因ではないが、このような依存関係を持つアプリケーションのクラスは</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true"></a>    <span class="co">//        巨大になる。</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true"></a>    <span class="co">//  アプリケーションが小規模である時には、このような問題がバグや開発効率悪化の原因となることは稀</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true"></a>    <span class="co">//  であり放置されることが多いが、大規模化に伴いこのような潜在的問題が表出する。</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true"></a>    <span class="co">//  ModelにObserverパターンを適用する等をしてこの問題に対処するとともに、Modelの単体テストを行え。</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true"></a>    <span class="kw">class</span> ViewX {</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true"></a>        <span class="dt">void</span> DisplaySomething(<span class="bu">std::</span>string <span class="at">const</span>&amp;) <span class="kw">noexcept</span> {}</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true"></a>    };</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true"></a>    ViewX <span class="va">g_ViewX</span>;</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true"></a>    <span class="kw">class</span> ViewY {</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true"></a>        <span class="dt">void</span> DisplaySomething(<span class="bu">std::</span>string <span class="at">const</span>&amp;) <span class="kw">noexcept</span> {}</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true"></a>    };</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true"></a>    ViewY <span class="va">g_ViewY</span>;</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true"></a></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true"></a>    <span class="kw">class</span> Model {</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true"></a>        Model() = <span class="cf">default</span>;</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true"></a>        ~Model() { wait_future(); }</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true"></a></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true"></a>        <span class="dt">void</span> DoSomething()</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true"></a>        {</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true"></a>            wait_future();</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true"></a></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true"></a>            <span class="va">future_</span> = <span class="bu">std::</span>async(<span class="bu">std::</span>launch<span class="bu">::</span>async, [] {</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true"></a>                <span class="co">// 本来は非同期処理が必要な重い処理</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true"></a>                <span class="kw">auto</span> result = <span class="bu">std::</span>string{<span class="st">&quot;result of doing something&quot;</span>};</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true"></a></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true"></a>                <span class="va">g_ViewX</span>.DisplaySomething(result);</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true"></a>                <span class="va">g_ViewY</span>.DisplaySomething(result);</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true"></a>            });</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true"></a>        }</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true"></a></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true"></a>        <span class="bu">std::</span>future&lt;<span class="dt">void</span>&gt; <span class="va">future_</span>;</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true"></a></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true"></a>        <span class="dt">void</span> wait_future() <span class="kw">noexcept</span></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true"></a>        {</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true"></a>            <span class="cf">if</span> (<span class="va">future_</span>.valid()) {</span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true"></a>                <span class="va">future_</span>.wait();</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true"></a>            }</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true"></a>        }</span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true"></a>    };</span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true"></a></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true"></a>    <span class="kw">class</span> Controller {</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true"></a>        Controller(Model&amp; model) <span class="kw">noexcept</span> : <span class="va">model_</span>{model} {}</span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true"></a>        <span class="dt">void</span> OK_Clicked() { <span class="va">model_</span>.DoSomething(); }</span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true"></a></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true"></a>        Model&amp; <span class="va">model_</span>;</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true"></a>    };</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true"></a></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true"></a>    TEST(DesignPatternQ, Observer)</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true"></a>    {</span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true"></a>        <span class="kw">auto</span> model      = Model{};</span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true"></a>        <span class="kw">auto</span> controller = Controller{model};</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true"></a></span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true"></a>        controller.OK_Clicked();</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true"></a>        controller.OK_Clicked();</span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true"></a>        controller.OK_Clicked();</span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="design_pattern.html#SS_9_22">Observer</a></li>
<li><a href="exercise_a.html#SS_20_9_24">解答例-Observer</a></li>
</ul>
<h3 id="演習-デザインパターン選択1">演習-デザインパターン選択1 <a id="SS_19_9_25"></a></h3>
<ul>
<li><p>問題<br />
オブジェクトの状態と、 それに伴う振る舞いを分離して記述する場合に使用されるデザインパターンとは何か？ 下記から選択せよ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>Singleton</li>
<li>State</li>
<li>Observer</li>
<li>Null Object</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_9_25">解答-デザインパターン選択1</a></p></li>
</ul>
<h3 id="演習-デザインパターン選択2">演習-デザインパターン選択2 <a id="SS_19_9_26"></a></h3>
<ul>
<li><p>問題<br />
オブジェクトへのポインタがヌルかどうかを確かめるif文が頻繁に出てくる場合、 そのif文を無くすために使われるデザインパターンは何か？ 下記から選択せよ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>Singleton</li>
<li>State</li>
<li>Observer</li>
<li>Null Object</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_9_26">解答-デザインパターン選択2</a></p></li>
</ul>
<h3 id="演習-デザインパターン選択3">演習-デザインパターン選択3 <a id="SS_19_9_27"></a></h3>
<ul>
<li><p>問題<br />
MVCアーキテクチャの実現のためによく使われるデザインパターンは何か？ 以下から選択せよ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>Singleton</li>
<li>State</li>
<li>Observer</li>
<li>Null Object</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_9_27">解答-デザインパターン選択3</a></p></li>
</ul>
<h2 id="開発プロセスとインフラ全般">開発プロセスとインフラ(全般) <a id="SS_19_10"></a></h2>
<h3 id="演習-プロセス分類">演習-プロセス分類 <a id="SS_19_10_1"></a></h3>
<ul>
<li><p>問題<br />
ソフトウェア開発プロセスは(A)、(B)、(C)の3つに分類できる。 (A)から順に初期計画順守的であり、(C)から逆順に状況適応的である。 状況適応的であることは、無計画であることを意味しない。 ただ単にプライオリティの問題として、 計画に従うことより状況に適応、 対処することを選択するということである。<br />
(A)、(B)、(C)それぞれにふさわしいものを下記から選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>ウォーターフォール</li>
<li>反復型</li>
<li>アジャイル</li>
<li>無手順</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_1">解答-プロセス分類</a></p></li>
</ul>
<h3 id="演習-v字モデル">演習-V字モデル <a id="SS_19_10_2"></a></h3>
<ul>
<li><p>問題<br />
ウォーターフォールモデルもしくはV字モデルと呼ばれるプロセスでは、<br />
「フェーズA」→「フェーズB」→「フェーズC」→「フェーズD」→「プログラミング」<br />
といった工程でソフトウェアを作り、その後<br />
「単体テスト(UT)」→「結合テスト(IT)」→「システムテスト」→「受入テスト(運用テスト)」<br />
といった工程でテストを行う。<br />
フェーズA、B、C、Dそれぞれにふさわしいものを下記から選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>詳細設計</li>
<li>基本設計</li>
<li>機能設計</li>
<li>要件分析</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_2">解答-V字モデル</a></p></li>
</ul>
<h3 id="演習-アジャイル">演習-アジャイル <a id="SS_19_10_3"></a></h3>
<ul>
<li><p>問題<br />
アジャイル系プロセスの説明にふさわしくないものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>アジャイル系プロセスとは、敏捷かつ適応的にソフトウェア開発を行う軽量な開発手法群の総称である。</li>
<li>アジャイル系プロセスには計画は必要ない。</li>
<li>ほとんどのアジャイル系プロセスでは、イテレーションを繰り返すことにより開発を進める。</li>
<li>アジャイル系プロセスにはスクラムやXPがある。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_3">解答-アジャイル</a></p></li>
</ul>
<h3 id="演習-自動化">演習-自動化 <a id="SS_19_10_4"></a></h3>
<ul>
<li><p>問題<br />
一般に、(A)とは、個々のクラスや関数といったソフトウェア構成要素の機能が正確に 動作することを検証するためのテストを指す。 原理的には、デバッガ等を利用して(B)で(A)を実行することは可能であるが、<br />
「工数が膨大になる」、「テストの(C)が低い」<br />
等の問題があるため、現実的ではない。 自動(A)とは、この問題に対処するためのもので、 ワンコマンドもしくはワンクリックで(A)を実行するように開発されるプログラムである。<br />
(A)、(B)、(C)それぞれにふさわしいものを下記から選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>単体テスト</li>
<li>統合テスト</li>
<li>自動</li>
<li>手作業</li>
<li>再現性</li>
<li>可塑性</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_4">解答-自動化</a></p></li>
</ul>
<h3 id="演習-単体テスト">演習-単体テスト <a id="SS_19_10_5"></a></h3>
<ul>
<li><p>問題<br />
単体テストの説明としてふさわしくないものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>単体テストで検出可能なバグを、統合テストで検出・デバッグすることは非効率である。</li>
<li>単体テストが可能なクラス設計には、プログラマのスキルの向上が必要である。</li>
<li>自動単体テストは工数をほとんどロスすることなしに何度でも実行できるため、 機能追加、バグ修正、リファクタリング等のソースコード修正後の回帰テストが容易になる。</li>
<li>単体テストはアジャイル系プロセスのみで使われるテスト手法である。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_5">解答-単体テスト</a></p></li>
</ul>
<h3 id="演習-リファクタリングに付随する活動">演習-リファクタリングに付随する活動 <a id="SS_19_10_6"></a></h3>
<ul>
<li><p>問題<br />
リファクタリングに付随する活動ではないものを選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>ソースコードインスペクション</li>
<li>受入テスト</li>
<li>回帰テスト</li>
<li>クラス分割</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_6">解答-リファクタリングに付随する活動</a></p></li>
</ul>
<h3 id="演習-リファクタリング対象コード">演習-リファクタリング対象コード <a id="SS_19_10_7"></a></h3>
<ul>
<li><p>問題<br />
リファクタリングの対象とならないソースコードの問題点を下記から選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>巨大なクラス</li>
<li>コードクローン</li>
<li>メモリリーク</li>
<li>間違った依存関係</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_7">解答-リファクタリング対象コード</a></p></li>
</ul>
<h3 id="演習-ci">演習-CI <a id="SS_19_10_8"></a></h3>
<ul>
<li><p>問題<br />
CI(継続的インテグレーション)を前提とするプロセスに特徴的な活動すべてを下記から選べ。</p></li>
<li><p>選択肢</p>
<ol type="1">
<li>(svnやgitリポジトリへの)コミット前にコードインスペクションを行う。</li>
<li>リポジトリの最新ソースコードを自動的にビルド、単体テストを行うプログラムの開発や設定を行う。</li>
<li>コミット前に回帰テストを行う。</li>
<li>開発者全員に共有されているブランチになるべく頻繁にコミットする。</li>
</ol></li>
<li><p><a href="exercise_a.html#SS_20_10_8">解答-CI</a></p></li>
</ul>
<h2 id="テンプレートメタプログラミング">テンプレートメタプログラミング <a id="SS_19_11"></a></h2>
<h3 id="演習-パラメータパック">演習-パラメータパック <a id="SS_19_11_1"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/parameter_pack.cpp 5</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true"></a>    <span class="co">// 下記の関数Maxは、単体テストが示す通り、2つのパラメータの大きい方を返す。</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true"></a>    <span class="co">// 任意の個数の引数を取れるようにMaxを修正せよ。</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true"></a>    <span class="kw">template</span> &lt;<span class="kw">typename</span> T&gt;</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true"></a>    T Max(T <span class="at">const</span>&amp; t0, T <span class="at">const</span>&amp; t1) <span class="kw">noexcept</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true"></a>    {</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true"></a>        <span class="cf">return</span> t0 &gt; t1 ? t0 : t1;</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true"></a>    }</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, parameter_pack)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true"></a>    {</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true"></a>        ASSERT_EQ(<span class="dv">2</span>, Max(<span class="dv">1</span>, <span class="dv">2</span>));</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true"></a>        ASSERT_EQ(<span class="st">&quot;bcd&quot;</span>, Max(<span class="bu">std::</span>string{<span class="st">&quot;abc&quot;</span>}, <span class="bu">std::</span>string{<span class="st">&quot;bcd&quot;</span>}));</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_1_3">パラメータパック</a></li>
<li><a href="exercise_a.html#SS_20_11_1">解答例-パラメータパック</a></li>
</ul>
<h3 id="演習-エイリアステンプレート">演習-エイリアステンプレート <a id="SS_19_11_2"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/template_alias.cpp 5</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true"></a>    <span class="co">// 下記の単体テストでしているstd::vector&lt;std::vector&lt;XXX&gt;&gt;を、</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true"></a>    <span class="co">// テンプレートエイリアスによって簡潔に記述せよ。</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, template_alias)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true"></a>    {</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true"></a>        {</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true"></a>            <span class="kw">auto</span> vv = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;&gt;{{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>}, {<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>}};</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">2</span>, vv.size());</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>}), vv[<span class="dv">0</span>]);</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;{<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>}), vv[<span class="dv">1</span>]);</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">5</span>, vv[<span class="dv">1</span>][<span class="dv">2</span>]);</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true"></a>        }</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true"></a>        {</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true"></a>            <span class="kw">auto</span> vv = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>vector&lt;<span class="dt">float</span>&gt;&gt;{{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>}, {<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>}};</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">2</span>, vv.size());</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">float</span>&gt;{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>}), vv[<span class="dv">0</span>]);</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="dt">float</span>&gt;{<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>}), vv[<span class="dv">1</span>]);</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">5</span>, vv[<span class="dv">1</span>][<span class="dv">2</span>]);</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true"></a>        }</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true"></a>        {</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true"></a>            <span class="kw">auto</span> vv = <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;&gt;{{<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>}, {<span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>}};</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true"></a>            ASSERT_EQ(<span class="dv">2</span>, vv.size());</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>}), vv[<span class="dv">0</span>]);</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true"></a>            ASSERT_EQ((<span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt;{<span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>}), vv[<span class="dv">1</span>]);</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;5&quot;</span>, vv[<span class="dv">1</span>][<span class="dv">2</span>]);</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true"></a>        }</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true"></a>    }</span></code></pre></div>
<ul>
<li><a href="exercise_a.html#SS_20_11_2">解答例-エイリアステンプレート</a></li>
</ul>
<h3 id="演習-名前空間による修飾不要なoperator">演習-名前空間による修飾不要なoperator&lt;&lt; <a id="SS_19_11_3"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/put_to.cpp 3</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true"></a>    <span class="co">// 下記のように名前空間TemplateMP、エイリアスInts_tとそのoperator&lt;&lt;が定義されている場合、</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true"></a>    <span class="co">// 単体テストで示した通り、Ints_tのoperator&lt;&lt;を使用するためには、</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true"></a>    <span class="co">// 名前空間による修飾やusing宣言/ディレクティブの記述が必要になる。</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true"></a>    <span class="co">// Ints_tをstd::vectorから継承したクラスとして定義することにより、このような記述を不要にせよ。</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true"></a>    <span class="kw">namespace</span> TemplateMP {</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true"></a>    <span class="kw">using</span> <span class="dt">Ints_t</span> = <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;;</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true"></a>    <span class="bu">std::</span>ostream&amp; <span class="kw">operator</span>&lt;&lt;(<span class="bu">std::</span>ostream&amp; os, <span class="dt">Ints_t</span> <span class="at">const</span>&amp; ints)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true"></a>    {</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true"></a>        <span class="kw">auto</span> first = <span class="kw">true</span>;</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">auto</span> i : ints) {</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true"></a>            <span class="cf">if</span> (!<span class="bu">std::</span>exchange(first, <span class="kw">false</span>)) {</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true"></a>                os &lt;&lt; <span class="st">&quot; : &quot;</span>;</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true"></a>            }</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true"></a>            os &lt;&lt; i;</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true"></a>        }</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true"></a>        <span class="cf">return</span> os;</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true"></a>    }</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true"></a>    }  <span class="co">// namespace TemplateMP</span></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, put_to)</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true"></a>    {</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true"></a>        {</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true"></a>            <span class="kw">auto</span> oss  = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true"></a>            <span class="kw">auto</span> ints = TemplateMP::<span class="dt">Ints_t</span>{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>};</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true"></a></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true"></a>            <span class="co">// oss &lt;&lt; ints;</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true"></a>            TemplateMP::<span class="kw">operator</span>&lt;&lt;(oss, ints);  <span class="co">// 名前空間による飾</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true"></a></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1 : 2 : 3&quot;</span>, oss.str());</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true"></a>        }</span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true"></a>        {</span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true"></a>            <span class="kw">auto</span> oss  = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true"></a>            <span class="kw">auto</span> ints = TemplateMP::<span class="dt">Ints_t</span>{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>};</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true"></a></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true"></a>            <span class="kw">using</span> TemplateMP::<span class="kw">operator</span>&lt;&lt;;  <span class="co">// using宣言</span></span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true"></a>            oss &lt;&lt; ints;</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true"></a></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1 : 2 : 3&quot;</span>, oss.str());</span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true"></a>        }</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true"></a>        {</span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true"></a>            <span class="kw">auto</span> oss  = <span class="bu">std::</span>ostringstream{};</span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true"></a>            <span class="kw">auto</span> ints = TemplateMP::<span class="dt">Ints_t</span>{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>};</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true"></a></span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true"></a>            <span class="kw">using</span> <span class="kw">namespace</span> TemplateMP;  <span class="co">// usingディレクティブ</span></span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true"></a>            oss &lt;&lt; ints;</span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true"></a></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true"></a>            ASSERT_EQ(<span class="st">&quot;1 : 2 : 3&quot;</span>, oss.str());</span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true"></a>        }</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true"></a>    }</span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_1_6">Ints_tのログ登録</a>、<a href="template_meta_programming.html#SS_13_1_6_5">Ints_tを構造体としてApp内に宣言する</a>、</li>
<li><a href="exercise_a.html#SS_20_11_3">解答例-名前空間による修飾不要なoperator&lt;&lt;</a></li>
</ul>
<h3 id="演習-stdarrayの継承">演習-std::arrayの継承 <a id="SS_19_11_4"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/safe_array.cpp 3</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true"></a>    <span class="co">// std::array、std::vector、std::string等のSTLの配列型コンテナはインデックスアクセスに対して、</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true"></a>    <span class="co">// レンジのチェックをしないため、不正なメモリアクセスをしてしまうことがある。</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true"></a>    <span class="co">// std::arrayを使用して、このような問題のないSafeArrayを作り、単体テストを行え。</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, safe_array)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true"></a>    {</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true"></a>        <span class="co">// SafeArrayの単体テスト</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true"></a>    }</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_2_3">安全な配列型コンテナ</a></li>
<li><a href="exercise_a.html#SS_20_11_4">解答例-std::arrayの継承</a></li>
</ul>
<h3 id="演習-sfinaeを利用しない関数テンプレートの特殊化によるis_void">演習-SFINAEを利用しない関数テンプレートの特殊化によるis_void <a id="SS_19_11_5"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/is_void.cpp 3</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true"></a>    <span class="co">// 下記の仕様を満たす関数テンプレートis_void_f&lt;T&gt;と定数テンプレートis_void_f_v&lt;T&gt;を作れ。</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidの場合、trueを返す</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidでない場合、falseを返す</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true"></a>    <span class="co">//    * std::is_sameを使わない</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true"></a>    <span class="co">//    * 下記の単体テストをパスする(#if 0を削除してもコンパイルできる)</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true"></a>    <span class="kw">namespace</span> IsVoidTest {</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true"></a>    <span class="dt">void</span>        test_func_0() <span class="kw">noexcept</span> {};</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true"></a>    <span class="bu">std::</span>string test_func_1() { <span class="cf">return</span> <span class="st">&quot;test&quot;</span>; };</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true"></a>    }  <span class="co">// namespace IsVoidTest</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, is_void_f)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true"></a>    {</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true"></a><span class="co">        static_assert(!is_void_f_v&lt;int&gt;);</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true"></a><span class="co">        static_assert(is_void_f_v&lt;void&gt;);</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true"></a><span class="co">        static_assert(is_void_f_v&lt;decltype(IsVoidTest::test_func_0())&gt;);</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true"></a><span class="co">        static_assert(!is_void_f_v&lt;decltype(IsVoidTest::test_func_1())&gt;);</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true"></a>    }</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_2_1">is_void_fの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_5">解答例-SFINAEを利用しない関数テンプレートの特殊化によるis_void</a></li>
</ul>
<h3 id="演習-sfinaeを利用しないクラステンプレートの特殊化によるis_void">演習-SFINAEを利用しないクラステンプレートの特殊化によるis_void <a id="SS_19_11_6"></a></h3>
<ul>
<li><p>問題 // @@@ exercise/template_q/is_void.cpp 30 // [Q] // 下記の仕様を満たすクラステンプレートis_void_s<T>と定数テンプレートis_void_s_v<T>を作れ。 // * 与えられたテンプレートパラメータがvoidの場合、メンバvalueがtrueになる // * 与えられたテンプレートパラメータがvoidでない場合、メンバvalueがtrueになる // * std::is_sameを使わない // * std::true_type/std::false_typeを利用する // * 下記の単体テストをパスする(#if 0を削除してもコンパイルできる)</p>
<p>namespace {</p>
<p>TEST(TemplateMetaProgrammingQ, is_void_s) { #if 0 static_assert(!is_void_s_v<int>); static_assert(is_void_s_v<void>); static_assert(is_void_s_v&lt;decltype(IsVoidTest::test_func_0())&gt;); static_assert(!is_void_s_v&lt;decltype(IsVoidTest::test_func_1())&gt;); #endif } } // namespace</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode cpp"><code class="sourceCode cpp"></code></pre></div></li>
<li><p>参照 <a href="template_meta_programming.html#SS_13_3_2_2">is_void_sの実装</a></p></li>
<li><p><a href="exercise_a.html#SS_20_11_6">解答例-SFINAEを利用しないクラステンプレートの特殊化によるis_void</a></p></li>
</ul>
<h3 id="演習-sfinaeを利用した関数テンプレートの特殊化によるis_void">演習-SFINAEを利用した関数テンプレートの特殊化によるis_void <a id="SS_19_11_7"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/is_void.cpp 53</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true"></a>    <span class="co">// 下記の仕様を満たす関数テンプレートis_void_sfinae_f&lt;T&gt;と</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true"></a>    <span class="co">// 定数テンプレートis_void_sfinae_f&lt;T&gt;を作れ。</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidの場合、trueを返す</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidでない場合、falseを返す</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true"></a>    <span class="co">//    * std::is_sameを使わない</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true"></a>    <span class="co">//    * SFINAEを利用する</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true"></a>    <span class="co">//    * 下記の単体テストをパスする(#if 0を削除してもコンパイルできる)</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, is_void_sfinae_f)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true"></a>    {</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true"></a><span class="co">        static_assert(!is_void_sfinae_f_v&lt;int&gt;);</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true"></a><span class="co">        static_assert(is_void_sfinae_f_v&lt;void&gt;);</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true"></a><span class="co">        static_assert(is_void_sfinae_f_v&lt;decltype(IsVoidTest::test_func_0())&gt;);</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true"></a><span class="co">        static_assert(!is_void_sfinae_f_v&lt;decltype(IsVoidTest::test_func_1())&gt;);</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true"></a>    }</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_2_3">is_void_sfinae_fの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_7">解答例-SFINAEを利用した関数テンプレートの特殊化によるis_void</a></li>
</ul>
<h3 id="演習-sfinaeを利用したクラステンプレートの特殊化によるis_void">演習-SFINAEを利用したクラステンプレートの特殊化によるis_void <a id="SS_19_11_8"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/is_void.cpp 77</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true"></a>    <span class="co">// 下記の仕様を満たすクラステンプレートis_void_sfinae_s&lt;T&gt;と</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true"></a>    <span class="co">// 定数テンプレートis_void_sfinae_s_v&lt;T&gt;を作れ。</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidの場合、メンバvalueがtrueになる</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true"></a>    <span class="co">//    * 与えられたテンプレートパラメータがvoidでない場合、メンバvalueがtrueになる</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true"></a>    <span class="co">//    * std::is_sameを使わない</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true"></a>    <span class="co">//    * std::true_type/std::false_typeを利用する</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true"></a>    <span class="co">//    * SFINAEを利用する</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true"></a>    <span class="co">//    * 下記の単体テストをパスする(#if 0を削除してもコンパイルできる)</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, is_void_sfinae_s)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true"></a>    {</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true"></a><span class="co">        static_assert(!is_void_sfinae_s_v&lt;int&gt;);</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true"></a><span class="co">        static_assert(is_void_sfinae_s_v&lt;void&gt;);</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true"></a><span class="co">        static_assert(is_void_sfinae_s_v&lt;decltype(IsVoidTest::test_func_0())&gt;);</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true"></a><span class="co">        static_assert(!is_void_sfinae_s_v&lt;decltype(IsVoidTest::test_func_1())&gt;);</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true"></a>    }</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_2_4">is_void_sfinae_sの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_8">解答例-SFINAEを利用したクラステンプレートの特殊化によるis_void</a></li>
</ul>
<h3 id="演習-テンプレートテンプレートパラメータ">演習-テンプレートテンプレートパラメータ <a id="SS_19_11_9"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/template_template.cpp 3</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true"></a>    <span class="co">// 以下の使用を満たすクラステンプレートを作れ。</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true"></a>    <span class="co">//  * 任意のSTLコンテナを唯一のテンプレートパラメータとする</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true"></a>    <span class="co">//  * そのコンテナを使用しint型のデータを格納する</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, template_template)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true"></a>    {</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true"></a>        <span class="co">//</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true"></a>    }</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_3_6">is_same_templの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_9">解答例-テンプレートテンプレートパラメータ</a></li>
</ul>
<h3 id="演習-テンプレートパラメータを可変長にしたstdis_same">演習-テンプレートパラメータを可変長にしたstd::is_same <a id="SS_19_11_10"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/is_same.cpp 3</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true"></a>    <span class="co">// 以下の仕様を満たすクラステンプレートis_same_some_of&lt;T, U...&gt;と</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true"></a>    <span class="co">// 定数テンプレートis_same_some_of_v&lt;T, U...&gt;を作れ。</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true"></a>    <span class="co">//  * 2個以上のテンプレートパラメータを持つ</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true"></a>    <span class="co">//  * 第1パラメータと他のパラメータの何れかが同一の型であった場合、メンバvalueがtrueになる</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true"></a>    <span class="co">//  * 前行の条件が成立しなかった場合、メンバvalueがfalseになる</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true"></a>    <span class="co">//  * 型の同一性はstd::is_sameを使って判定する</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, is_same_some_of)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true"></a>    {</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true"></a><span class="co">        static_assert(!is_same_some_of_v&lt;int, int8_t, int16_t, uint16_t&gt;);</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true"></a><span class="co">        static_assert(is_same_some_of_v&lt;int, int8_t, int16_t, uint16_t, int32_t&gt;);</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true"></a><span class="co">        static_assert(is_same_some_of_v&lt;int&amp;, int8_t, int16_t, int32_t&amp;, int32_t&gt;);</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true"></a><span class="co">        static_assert(!is_same_some_of_v&lt;int&amp;, int8_t, int16_t, uint32_t&amp;, int32_t&gt;);</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true"></a><span class="co">        static_assert(is_same_some_of_v&lt;std::string, int, char*, std::string&gt;);</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true"></a><span class="co">        static_assert(!is_same_some_of_v&lt;std::string, int, char*&gt;);</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true"></a>    }</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_3_7">IsSameSomeOfの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_10">解答例-テンプレートパラメータを可変長にしたstd::is_same</a></li>
</ul>
<h3 id="演習-メンバ関数の存在の診断">演習-メンバ関数の存在の診断 <a id="SS_19_11_11"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/exists_func.cpp 3</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true"></a>    <span class="co">// テンプレートパラメータの型がメンバ関数c_str()を持つか否かを判定する</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true"></a>    <span class="co">// クラステンプレートhas_c_str&lt;T&gt;と定数テンプレートhas_c_str_v&lt;T&gt;を作れ。</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, has_c_str)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true"></a>    {</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true"></a><span class="co">        static_assert(has_c_str_v&lt;std::string&gt;);</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true"></a><span class="co">        static_assert(!has_c_str_v&lt;std::vector&lt;int&gt;&gt;);</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true"></a>    }</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_5">関数の存在の診断</a></li>
<li><a href="exercise_a.html#SS_20_11_11">解答例-メンバ関数の存在の診断</a></li>
</ul>
<h3 id="演習-範囲for文のオペランドになれるかどうかの診断">演習-範囲for文のオペランドになれるかどうかの診断 <a id="SS_19_11_12"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/exists_func.cpp 20</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true"></a>    <span class="co">// 範囲for文は、</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true"></a>    <span class="co">//      for(auto a : obj ) { ... }</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true"></a>    <span class="co">// のような形式で表現される。</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true"></a>    <span class="co">// テンプレートパラメータから生成されたオブジェクトが、</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true"></a>    <span class="co">// このobjに指定できるか否かを判定するクラステンプレートis_range&lt;T&gt;</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true"></a>    <span class="co">// と定数テンプレートis_range_v&lt;T&gt;を作れ。</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, is_range)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true"></a>    {</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true"></a><span class="co">        static_assert(is_range_v&lt;std::string&gt;);</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true"></a><span class="co">        static_assert(is_range_v&lt;std::vector&lt;int&gt;&gt;);</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true"></a><span class="co">        static_assert(!is_range_v&lt;std::mutex&gt;);</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true"></a><span class="co">        static_assert(!is_range_v&lt;std::lock_guard&lt;std::mutex&gt;&gt;);</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true"></a>    }</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_5">関数の存在の診断</a></li>
<li><a href="exercise_a.html#SS_20_11_12">解答例-範囲for文のオペランドになれるかどうかの診断</a></li>
</ul>
<h3 id="演習-配列の長さの取り出し">演習-配列の長さの取り出し <a id="SS_19_11_13"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/array_op.cpp 3</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true"></a>    <span class="co">// 配列を引数に取り、その長さを返す関数テンプレートarray_lengthを作れ。</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, array_length)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true"></a>    {</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true"></a><span class="co">        int         i[5];</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true"></a><span class="co">        std::string str[]{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;};</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true"></a><span class="co">        static_assert(array_length(i) == 5);</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true"></a><span class="co">        static_assert(array_length(str) == 3);</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true"></a>    }</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_5">関数の存在の診断</a></li>
<li><a href="exercise_a.html#SS_20_11_13">解答例-配列の長さの取り出し</a></li>
</ul>
<h3 id="演習-配列の次元の取り出し">演習-配列の次元の取り出し <a id="SS_19_11_14"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/array_op.cpp 22</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true"></a>    <span class="co">// 配列を引数に取り、その次元を返す関数テンプレートarray_dimensionを作れ。</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, array_dimension)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true"></a>    {</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true"></a>    <span class="pp">#if 0</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true"></a><span class="co">        constexpr int i1[5]{};</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true"></a><span class="co">        constexpr int i2[5][2]{};</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true"></a><span class="co">        constexpr int i3[5][2][3]{};</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true"></a><span class="co">        static_assert(array_dimension(i1) == 1);</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true"></a><span class="co">        static_assert(array_dimension(i2) == 2);</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true"></a><span class="co">        static_assert(array_dimension(i3) == 3);</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true"></a><span class="co">    </span><span class="pp">#endif</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true"></a>    }</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_3_5_9">ValueTypeの実装</a></li>
<li><a href="exercise_a.html#SS_20_11_14">解答例-配列の次元の取り出し</a></li>
</ul>
<h3 id="演習-関数型のテンプレートパラメータを持つクラステンプレート">演習-関数型のテンプレートパラメータを持つクラステンプレート <a id="SS_19_11_15"></a></h3>
<ul>
<li>問題</li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true"></a>    <span class="co">// @@@ exercise/template_q/scoped_guard.cpp 8</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true"></a>    <span class="co">// [Q]</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true"></a>    <span class="co">// RAIIを行うための下記クラスscoped_guardをstd::functionを使わずに再実装せよ。</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true"></a>    <span class="kw">class</span> scoped_guard {</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true"></a>    <span class="kw">public</span>:</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true"></a>        <span class="kw">explicit</span> scoped_guard(<span class="bu">std::</span>function&lt;<span class="dt">void</span>()&gt; f) <span class="kw">noexcept</span> : <span class="va">f_</span>{f} {}</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true"></a>        ~scoped_guard() { <span class="va">f_</span>(); }</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true"></a>        scoped_guard(scoped_guard <span class="at">const</span>&amp;)   = <span class="kw">delete</span>;</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true"></a>        <span class="dt">void</span> <span class="kw">operator</span>=(scoped_guard <span class="at">const</span>&amp;) = <span class="kw">delete</span>;</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true"></a>    <span class="kw">private</span>:</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true"></a>        <span class="bu">std::</span>function&lt;<span class="dt">void</span>()&gt; <span class="va">f_</span>;</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true"></a>    };</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true"></a>    <span class="kw">namespace</span> {</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true"></a>    TEST(TemplateMetaProgrammingQ, scoped_guard)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true"></a>    {</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true"></a>        {</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true"></a>            <span class="kw">auto</span> demangled = abi::__cxa_demangle(<span class="kw">typeid</span>(<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;).name(), <span class="dv">0</span>, <span class="dv">0</span>, <span class="kw">nullptr</span>);</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true"></a>            <span class="kw">auto</span> sg        = scoped_guard{[demangled]() <span class="kw">noexcept</span> { free(demangled); }};</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true"></a>            ASSERT_STREQ(<span class="st">&quot;std::vector&lt;int, std::allocator&lt;int&gt; &gt;&quot;</span>, demangled);</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true"></a>        }</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true"></a>        {</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true"></a>            <span class="kw">auto</span> stream = popen(<span class="st">&quot;ls &quot;</span> <span class="ot">__FILE__</span>, <span class="st">&quot;r&quot;</span>);</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true"></a>            <span class="kw">auto</span> sg     = scoped_guard{[stream]() <span class="kw">noexcept</span> { fclose(stream); }};</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true"></a></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true"></a>            <span class="dt">char</span> buff[<span class="dv">256</span>]{};</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true"></a>            fgets(buff, <span class="kw">sizeof</span>(buff) - <span class="dv">1</span>, stream);</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true"></a></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true"></a>            ASSERT_STREQ(<span class="st">&quot;scoped_guard.cpp</span><span class="sc">\n</span><span class="st">&quot;</span>, buff);</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true"></a>        }</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true"></a>    }</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true"></a>    }  <span class="co">// namespace</span></span></code></pre></div>
<ul>
<li>参照 <a href="template_meta_programming.html#SS_13_6_8">関数型をテンプレートパラメータで使う</a></li>
<li><a href="exercise_a.html#SS_20_11_15">解答例-関数型のテンプレートパラメータを持つクラステンプレート</a></li>
</ul>
</body>
</html>
